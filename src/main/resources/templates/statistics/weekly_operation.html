<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{main}">
<!--begin::Main-->
<meta name="_csrf" th:content="${_csrf.token}"/>
<meta name="_csrf_header" th:content="${_csrf.headerName}"/>
<div layout:fragment="content">
    <script src="/assets/plugins/global/plugins.bundle.js"></script>
    <div class="d-flex flex-column flex-column-fluid">
        <!--begin::Toolbar-->
        <div id="kt_app_toolbar" class="app-toolbar py-3 py-lg-6">
            <!--begin::Toolbar container-->
            <div id="kt_app_toolbar_container" class="app-container container-xxl d-flex flex-stack">
                <!--begin::Page title-->
                <div class="page-title d-flex flex-column justify-content-center flex-wrap me-3">
                    <!--begin::Title-->
                    <h1 class="page-heading d-flex text-gray-900 fw-bold fs-3 flex-column justify-content-center my-0">주간 운영현황</h1>
                    <!--end::Title-->
                    <!--begin::Breadcrumb-->
                    <ul class="breadcrumb breadcrumb-separatorless fw-semibold fs-7 my-0 pt-1">
                        <!--begin::Item-->
                        <li class="breadcrumb-item text-muted">
                            <a href="/main" class="text-muted text-hover-primary">Home</a>
                        </li>
                        <!--end::Item-->
                        <!--begin::Item-->
                        <li class="breadcrumb-item">
                            <span class="bullet bg-gray-500 w-5px h-2px"></span>
                        </li>
                        <!--end::Item-->
                        <!--begin::Item-->
                        <li class="breadcrumb-item text-muted">통계</li>
                        <!--end::Item-->
                        <!--begin::Item-->
                        <li class="breadcrumb-item">
                            <span class="bullet bg-gray-500 w-5px h-2px"></span>
                        </li>
                        <!--end::Item-->
                        <!--begin::Item-->
                        <li class="breadcrumb-item text-muted">주간 운영현황</li>
                        <!--end::Item-->
                    </ul>
                    <!--end::Breadcrumb-->
                </div>
                <!--end::Page title-->
            </div>
            <!--end::Toolbar container-->
        </div>
        <!--end::Toolbar-->

        <!--begin::Content-->
        <div id="kt_app_content" class="app-content flex-column-fluid">
            <!--begin::Content container-->
            <div id="kt_app_content_container" class="app-container container-xxl">
                <!-- 1.주간 통계 현황 -->
                <div class="card card-flush mb-6">
                    <div class="card-header border-0 pt-5">
                        <h3 class="card-title align-items-start flex-column">
                            <span class="card-label fw-bold fs-3 mb-1">1.주간 통계 현황</span>
                        </h3>
                        <div class="card-toolbar">
                            <div class="d-flex align-items-center position-relative">
                                <input class="form-control form-control-solid w-250px" placeholder="날짜 범위 선택" id="weekly_datepicker" readonly/>
                                <button type="button" class="btn btn-primary ms-3" id="searchBtn">조회</button>
                            </div>
                        </div>
                    </div>
                    <div class="card-body pt-0">
                        <table class="table table-row-bordered table-striped gy-5 gs-7">
                            <thead>
                                <tr class="fw-semibold fs-6 text-gray-800 text-center border-bottom border-gray-200">
                                    <th>일자</th>
                                    <th>요일</th>
                                    <th>총통화</th>
                                    <th>인입호</th>
                                    <th>단순문의호</th>
                                    <th>응대가능호</th>
                                    <th>조회호</th>
                                    <th>취결호</th>
                                    <th>부결호수</th>
                                    <th>총취결율</th>
                                </tr>
                            </thead>
                            <tbody class="text-center">
                                <tr>
                                    <td>2024-02-02</td>
                                    <td>금</td>
                                    <td>23</td>
                                    <td>15</td>
                                    <td>6</td>
                                    <td>17</td>
                                    <td>16</td>
                                    <td>1</td>
                                    <td>1</td>
                                    <td>94.1%</td>
                                </tr>
                                <tr>
                                    <td>2024-02-05</td>
                                    <td>월</td>
                                    <td>21</td>
                                    <td>8</td>
                                    <td>9</td>
                                    <td>12</td>
                                    <td>11</td>
                                    <td>1</td>
                                    <td>1</td>
                                    <td>91.7%</td>
                                </tr>
                                <tr>
                                    <td>2024-02-06</td>
                                    <td>화</td>
                                    <td>18</td>
                                    <td>11</td>
                                    <td>5</td>
                                    <td>13</td>
                                    <td>8</td>
                                    <td>5</td>
                                    <td>3</td>
                                    <td>61.5%</td>
                                </tr>
                                <tr>
                                    <td>2024-02-07</td>
                                    <td>수</td>
                                    <td>10</td>
                                    <td>7</td>
                                    <td>3</td>
                                    <td>7</td>
                                    <td>5</td>
                                    <td>2</td>
                                    <td>1</td>
                                    <td>71.4%</td>
                                </tr>
                                <tr>
                                    <td>2024-02-08</td>
                                    <td>목</td>
                                    <td>6</td>
                                    <td>3</td>
                                    <td>3</td>
                                    <td>3</td>
                                    <td>3</td>
                                    <td>0</td>
                                    <td>0</td>
                                    <td>100%</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- 차트 영역 -->
                <div class="card card-flush mb-6">
                    <div class="card-header border-0 pt-5">
                        <h3 class="card-title align-items-start flex-column">
                            <span class="card-label fw-bold fs-3 mb-1">주간 운영 추이</span>
                        </h3>
                    </div>
                    <div class="card-body">
                        <div id="kt_weekly_trend_chart" style="height: 350px;"></div>
                    </div>
                </div>

                <!-- 2.주간 통화 시간 현황 -->
                <div class="card card-flush mb-6">
                    <div class="card-header border-0 pt-5">
                        <h3 class="card-title align-items-start flex-column">
                            <span class="card-label fw-bold fs-3 mb-1">2.주간 통화 시간 현황</span>
                        </h3>
                    </div>
                    <div class="card-body pt-0">
                        <table class="table table-row-bordered table-striped gy-5 gs-7">
                            <thead>
                                <tr class="fw-semibold fs-6 text-gray-800 text-center border-bottom border-gray-200">
                                    <th>일자</th>
                                    <th>통화인원</th>
                                    <th>총통화시간(초)</th>
                                    <th>조회호</th>
                                    <th>CB건수</th>
                                    <th>개시건</th>
                                    <th>평균</th>
                                    <th>총통화시간</th>
                                    <th>IN 통화시간</th>
                                </tr>
                            </thead>
                            <tbody class="text-center">
                                <tr>
                                    <td>2024-02-02</td>
                                    <td>2</td>
                                    <td>15</td>
                                    <td>16</td>
                                    <td>2</td>
                                    <td>11</td>
                                    <td>0</td>
                                    <td>29</td>
                                    <td>1:08:17</td>
                                </tr>
                                <tr>
                                    <td>2024-02-03</td>
                                    <td>0</td>
                                    <td>0</td>
                                    <td>0</td>
                                    <td>0</td>
                                    <td>0</td>
                                    <td>0</td>
                                    <td>0</td>
                                    <td>0:00:00</td>
                                </tr>
                                <tr>
                                    <td>2024-02-04</td>
                                    <td>0</td>
                                    <td>0</td>
                                    <td>0</td>
                                    <td>0</td>
                                    <td>0</td>
                                    <td>0</td>
                                    <td>0</td>
                                    <td>0:00:00</td>
                                </tr>
                                <tr>
                                    <td>2024-02-05</td>
                                    <td>2</td>
                                    <td>8</td>
                                    <td>11</td>
                                    <td>3</td>
                                    <td>11</td>
                                    <td>0</td>
                                    <td>25</td>
                                    <td>0:35:40</td>
                                </tr>
                                <tr>
                                    <td>2024-02-06</td>
                                    <td>2</td>
                                    <td>11</td>
                                    <td>8</td>
                                    <td>5</td>
                                    <td>7</td>
                                    <td>0</td>
                                    <td>20</td>
                                    <td>0:34:55</td>
                                </tr>
                                <tr>
                                    <td>2024-02-07</td>
                                    <td>2</td>
                                    <td>7</td>
                                    <td>5</td>
                                    <td>0</td>
                                    <td>9</td>
                                    <td>0</td>
                                    <td>14</td>
                                    <td>0:16:39</td>
                                </tr>
                                <tr>
                                    <td>2024-02-08</td>
                                    <td>2</td>
                                    <td>3</td>
                                    <td>3</td>
                                    <td>0</td>
                                    <td>11</td>
                                    <td>0</td>
                                    <td>14</td>
                                    <td>0:07:05</td>
                                </tr>
                                <tr class="fw-bold bg-light-primary">
                                    <td>합계</td>
                                    <td>10</td>
                                    <td>44</td>
                                    <td>43</td>
                                    <td>10</td>
                                    <td>49</td>
                                    <td>0</td>
                                    <td>102</td>
                                    <td>1:08:17</td>
                                </tr>
                                <tr class="fw-bold bg-light-secondary">
                                    <td>평균</td>
                                    <td>2</td>
                                    <td>8.8</td>
                                    <td>8.6</td>
                                    <td>2</td>
                                    <td>9.8</td>
                                    <td>0</td>
                                    <td>20.4</td>
                                    <td>1:08:17</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- 3.상담유형 상담현황 -->
                <div class="row g-5 g-xl-8">
                    <div class="col-xl-5">
                        <div class="card card-flush h-xl-100">
                            <div class="card-header border-0 pt-5">
                                <h3 class="card-title align-items-start flex-column">
                                    <span class="card-label fw-bold fs-3 mb-1">3.상담유형 상담현황</span>
                                </h3>
                            </div>
                            <div class="card-body pt-0">
                                <table class="table table-row-bordered table-striped gy-5 gs-7">
                                    <thead>
                                        <tr class="fw-semibold fs-6 text-gray-800 text-center border-bottom border-gray-200">
                                            <th>상담유형</th>
                                            <th>상담경로</th>
                                            <th>상담수</th>
                                            <th>비율</th>
                                        </tr>
                                    </thead>
                                    <tbody class="text-center">
                                        <tr>
                                            <td rowspan="2">직원</td>
                                            <td>기타</td>
                                            <td>0</td>
                                            <td>0%</td>
                                        </tr>
                                        <tr>
                                            <td>적극권유/추천</td>
                                            <td>0</td>
                                            <td>0%</td>
                                        </tr>
                                        <tr>
                                            <td rowspan="3">상품</td>
                                            <td>기타</td>
                                            <td>1</td>
                                            <td>3.2%</td>
                                        </tr>
                                        <tr>
                                            <td>일반문의</td>
                                            <td>3</td>
                                            <td>9.7%</td>
                                        </tr>
                                        <tr>
                                            <td>자발적문의</td>
                                            <td>1</td>
                                            <td>3.2%</td>
                                        </tr>
                                        <tr>
                                            <td>결제</td>
                                            <td>기타</td>
                                            <td>0</td>
                                            <td>0%</td>
                                        </tr>
                                        <tr>
                                            <td>기타</td>
                                            <td>기타</td>
                                            <td>0</td>
                                            <td>0%</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-7">
                        <div class="card card-flush h-xl-100">
                            <div class="card-body p-0">
                                <div id="kt_weekly_counseling_types" class="min-h-auto" style="height: 400px"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 4.주간 현황 비교 차트 -->
                <div class="card card-flush mt-6">
                    <div class="card-header border-0 pt-5">
                        <h3 class="card-title align-items-start flex-column">
                            <span class="card-label fw-bold fs-3 mb-1">4.주간 현황 비교</span>
                        </h3>
                    </div>
                    <div class="card-body">
                        <div id="kt_weekly_comparison_chart" style="height: 350px;"></div>
                    </div>
                </div>
            </div>
            <!--end::Content container-->
        </div>
        <!--end::Content-->
    </div>

    <!--begin::Javascript-->
    <script>
        // 날짜 범위 선택 초기화
        $("#weekly_datepicker").flatpickr({
            mode: "range",
            dateFormat: "Y-m-d",
            defaultDate: [new Date(new Date().getFullYear(), new Date().getMonth(), new Date().getDate() - new Date().getDay() + 1), new Date(new Date().getFullYear(), new Date().getMonth(), new Date().getDate() - new Date().getDay() + 7)],
            locale: "ko"
        });

        // 검색 버튼 이벤트
        document.getElementById('searchBtn').addEventListener('click', function() {
            console.log('검색 버튼 클릭됨: ' + document.getElementById('weekly_datepicker').value);
            // 검색 로직은 백엔드 구현 후 추가 예정
        });

        // 주간 운영 추이 차트
        var weeklyTrendElement = document.getElementById('kt_weekly_trend_chart');
        var weeklyTrendOptions = {
            series: [{
                name: '통화건수',
                type: 'column',
                data: [23, 21, 18, 10, 6]
            }, {
                name: '취결율',
                type: 'line',
                data: [94.1, 91.7, 61.5, 71.4, 100]
            }],
            chart: {
                height: 350,
                type: 'line',
                stacked: false
            },
            dataLabels: {
                enabled: false
            },
            stroke: {
                width: [0, 3]
            },
            title: {
                text: '주간 통화건수 및 취결율',
                align: 'left'
            },
            xaxis: {
                categories: ['2024-02-02(금)', '2024-02-05(월)', '2024-02-06(화)', '2024-02-07(수)', '2024-02-08(목)'],
            },
            yaxis: [{
                title: {
                    text: '통화건수',
                },
            }, {
                opposite: true,
                title: {
                    text: '취결율(%)'
                }
            }],
            tooltip: {
                y: {
                    formatter: function (val, opts) {
                        if (opts.seriesIndex === 0) {
                            return val + " 건";
                        } else if (opts.seriesIndex === 1) {
                            return val + "%";
                        }
                        return val;
                    }
                }
            },
            fill: {
                opacity: [0.85, 1],
                colors: ['#009ef7', '#ff6384']
            },
            legend: {
                position: 'top',
                horizontalAlign: 'right',
                offsetY: -25
            }
        };
        var weeklyTrendChart = new ApexCharts(weeklyTrendElement, weeklyTrendOptions);
        weeklyTrendChart.render();

        // 파이 차트 (상담유형)
        var counselingTypesElement = document.getElementById('kt_weekly_counseling_types');
        var counselingTypesOptions = {
            series: [44.2, 36.8, 10.1, 5.9, 3.0],
            chart: {
                type: 'pie',
                height: 400
            },
            labels: ['상품', '직원', '결제', '운영', '기타'],
            colors: ['#fe5151', '#5ead60', '#7250e7', '#efc22e', '#487eb3'],
            legend: {
                position: 'right',
                offsetY: 50
            },
            responsive: [{
                breakpoint: 480,
                options: {
                    chart: {
                        width: 200
                    },
                    legend: {
                        position: 'bottom'
                    }
                }
            }]
        };
        var counselingTypesChart = new ApexCharts(counselingTypesElement, counselingTypesOptions);
        counselingTypesChart.render();

        // 주간 현황 비교 차트
        var weeklyComparisonElement = document.getElementById('kt_weekly_comparison_chart');
        var weeklyComparisonOptions = {
            series: [{
                name: '통화건수',
                data: [78, 52, 40, 58, 92]
            }, {
                name: '취결건수',
                data: [42, 33, 30, 41, 69]
            }],
            chart: {
                type: 'bar',
                height: 350,
                stacked: false
            },
            plotOptions: {
                bar: {
                    horizontal: false,
                    columnWidth: '55%',
                    endingShape: 'rounded'
                }
            },
            dataLabels: {
                enabled: false
            },
            stroke: {
                show: true,
                width: 2,
                colors: ['transparent']
            },
            xaxis: {
                categories: ['월요일', '화요일', '수요일', '목요일', '금요일'],
            },
            yaxis: {
                title: {
                    text: '건수'
                }
            },
            fill: {
                opacity: 1,
                colors: ['#009ef7', '#ff6384']
            },
            tooltip: {
                y: {
                    formatter: function (val) {
                        return val + " 건";
                    }
                }
            },
            legend: {
                position: 'top',
                horizontalAlign: 'right'
            }
        };
        var weeklyComparisonChart = new ApexCharts(weeklyComparisonElement, weeklyComparisonOptions);
        weeklyComparisonChart.render();
    </script>
    <!--end::Javascript-->
</div>
</html> 