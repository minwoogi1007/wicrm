<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/main}">
<head>
    <title>ğŸ“Š êµí™˜ë°˜í’ˆ í†µê³„ ë¶„ì„</title>
    <meta name="_csrf" th:if="${_csrf}" th:content="${_csrf.token}"/>
    <meta name="_csrf" th:unless="${_csrf}" content=""/>
    <meta name="_csrf_header" th:if="${_csrf}" th:content="${_csrf.headerName}"/>
    <meta name="_csrf_header" th:unless="${_csrf}" content="X-CSRF-TOKEN"/>
    
    <style>
        /* ğŸ¨ CSS ë³€ìˆ˜ ì •ì˜ */
        :root {
            --primary: #3b82f6;
            --primary-dark: #2563eb;
            --primary-light: #dbeafe;
            --success: #10b981;
            --success-light: #d1fae5;
            --warning: #f59e0b;
            --warning-light: #fef3c7;
            --danger: #ef4444;
            --danger-light: #fee2e2;
            --info: #06b6d4;
            --info-light: #cffafe;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            --radius: 0.5rem;
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --text-muted: #9ca3af;
            --border: #e5e7eb;
            --bg-card: #ffffff;
            --bg-hover: #f9fafb;
        }

        /* í—¤ë” ì •ë ¬ ìŠ¤íƒ€ì¼ */
        #kt_app_toolbar {
            padding: 0.75rem 0 !important;
            min-height: auto !important;
        }
        
        #kt_app_toolbar_container {
            padding-left: 1rem !important;
            margin-left: 0 !important;
        }
        
        .page-title {
            margin: 0 !important;
            padding: 0 !important;
            margin-left: 0 !important;
        }
        
        .page-heading {
            margin: 0 !important;
        }
        
        .breadcrumb {
            margin: 0 !important;
            padding-top: 0.25rem !important;
        }
        
        #kt_app_content {
            padding-top: 2.5rem !important;
            margin-top: 0 !important;
        }
        
        #kt_app_content_container.app-container {
            padding-left: 1rem !important;
            padding-right: 1rem !important;
        }

        /* ğŸ¯ í†µê³„ ëŒ€ì‹œë³´ë“œ ìŠ¤íƒ€ì¼ (list.htmlê³¼ ë™ì¼) */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .stat-box {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1.25rem;
            box-shadow: var(--shadow);
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-box:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        .stat-box.success { border-left: 4px solid var(--success); }
        .stat-box.primary { border-left: 4px solid var(--primary); }
        .stat-box.warning { border-left: 4px solid var(--warning); }
        .stat-box.danger { border-left: 4px solid var(--danger); }
        .stat-box.info { border-left: 4px solid var(--info); }

        .card-content h3 {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin: 0 0 0.75rem 0;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .card-content .value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .card-content .description {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin: 0;
        }

        /* ğŸ’° ê¸ˆì•¡ í‘œì‹œ */
        .amount-display {
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
            font-weight: 600;
            color: var(--success);
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }

        /* ğŸ“Š í†µê³„ í˜ì´ì§€ ì „ìš© ìŠ¤íƒ€ì¼ */
        .stats-header {
            text-align: center;
            margin-bottom: 2rem;
            padding: 2rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
        }

        .stats-header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 0;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .stats-header p {
            font-size: 1.1rem;
            margin: 0.5rem 0 0 0;
            opacity: 0.9;
        }

        .update-time {
            text-align: center;
            margin-bottom: 2rem;
            padding: 0.75rem;
            background: var(--gray-50);
            border-radius: var(--radius);
            color: var(--text-muted);
            font-size: 0.875rem;
        }

        /* ğŸ“ˆ ì°¨íŠ¸ ì„¹ì…˜ */
        .chart-section {
            background: var(--bg-card);
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-lg);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--gray-100);
        }

        .chart-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
        }

        .chart-filters {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin-bottom: 1rem;
        }

        /* ğŸ“Š ìƒì„¸ í†µê³„ í…Œì´ë¸” */
        .stats-table-section {
            background: var(--bg-card);
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-lg);
        }

        .stats-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .stats-table th {
            background: var(--gray-50);
            color: var(--text-primary);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-size: 0.8rem;
            padding: 1rem 0.75rem;
            border: 1px solid var(--border);
            text-align: center;
        }

        .stats-table td {
            padding: 0.75rem;
            border: 1px solid var(--border);
            text-align: center;
            vertical-align: middle;
        }

        .stats-table tbody tr:hover {
            background: var(--bg-hover);
        }

        /* ğŸ¯ í•„í„° ì»¨íŠ¸ë¡¤ */
        .filter-section {
            background: var(--bg-card);
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-lg);
        }

        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            align-items: end;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .filter-group label {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .form-control {
            padding: 0.75rem;
            border: 2px solid var(--border);
            border-radius: var(--radius);
            font-size: 0.875rem;
            transition: all 0.2s ease;
            background: var(--bg-card);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: 2px solid transparent;
            border-radius: var(--radius);
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            border-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }

        .btn-secondary {
            background: var(--gray-500);
            color: white;
            border-color: var(--gray-500);
        }

        .btn-secondary:hover {
            background: var(--gray-600);
            border-color: var(--gray-600);
        }

        .btn-success {
            background: var(--success);
            color: white;
            border-color: var(--success);
        }

        .btn-success:hover {
            background: #059669;
            border-color: #059669;
        }

        /* ğŸ“± ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .filter-grid {
                grid-template-columns: 1fr;
            }
            
            .chart-header {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }
            
            .chart-filters {
                justify-content: center;
            }
        }

        /* ğŸ¨ ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .dashboard {
            animation: slideInUp 0.6s ease-out;
        }

        .filter-section,
        .chart-section,
        .stats-table-section {
            animation: slideInUp 0.6s ease-out;
        }

        .chart-section {
            animation-delay: 0.1s;
        }

        .stats-table-section {
            animation-delay: 0.2s;
        }

        /* ğŸ“Š ì°¨íŠ¸ ìŠ¤íƒ€ì¼ë§ */

        /* ğŸ“Š ë°ì´í„° ë¡œë”© ìƒíƒœ */
        .data-loading {
            opacity: 0.5;
            pointer-events: none;
        }

        /* ğŸ“Š í†µê³„ ìˆ˜ì¹˜ ê°•ì¡° */
        .stat-number {
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
            font-weight: 700;
            font-size: 1.2em;
        }

        .stat-up {
            color: var(--success);
        }

        .stat-down {
            color: var(--danger);
        }

        .stat-neutral {
            color: var(--text-secondary);
        }
    </style>
</head>

<div layout:fragment="content">
    <div class="app-main flex-column flex-row-fluid" id="kt_app_main">
        <!--begin::Content wrapper-->
    <div class="d-flex flex-column flex-column-fluid">
        <!--begin::Toolbar-->
        <div id="kt_app_toolbar" class="app-toolbar py-3 py-lg-6">
            <!--begin::Toolbar container-->
            <div id="kt_app_toolbar_container" class="app-container container-xxl d-flex flex-stack">
                <!--begin::Page title-->
                <div class="page-title d-flex flex-column justify-content-center flex-wrap me-3">
                    <!--begin::Title-->
                        <h1 class="page-heading d-flex text-gray-900 fw-bold fs-3 flex-column justify-content-center my-0">êµí™˜ë°˜í’ˆ í†µê³„</h1>
                    <!--end::Title-->
                    <!--begin::Breadcrumb-->
                    <ul class="breadcrumb breadcrumb-separatorless fw-semibold fs-7 my-0 pt-1">
                        <!--begin::Item-->
                        <li class="breadcrumb-item text-muted">
                            <a href="/main" class="text-muted text-hover-primary">Home</a>
                        </li>
                        <!--end::Item-->
                        <!--begin::Item-->
                        <li class="breadcrumb-item">
                            <span class="bullet bg-gray-500 w-5px h-2px"></span>
                        </li>
                        <!--end::Item-->
                        <!--begin::Item-->
                        <li class="breadcrumb-item text-muted">í†µê³„</li>
                        <!--end::Item-->
                        <!--begin::Item-->
                        <li class="breadcrumb-item">
                            <span class="bullet bg-gray-500 w-5px h-2px"></span>
                        </li>
                        <!--end::Item-->
                        <!--begin::Item-->
                        <li class="breadcrumb-item text-muted">êµí™˜ë°˜í’ˆ í†µê³„</li>
                        <!--end::Item-->
                    </ul>
                    <!--end::Breadcrumb-->
                </div>
                <!--end::Page title-->
            </div>
            <!--end::Toolbar container-->
        </div>
        <!--end::Toolbar-->
        <!--begin::Content-->
        <div id="kt_app_content" class="app-content flex-column-fluid">
            <!--begin::Content container-->
                <div id="kt_app_content_container" class="app-container container-fluid px-2">

                    <!-- ğŸ“Š í†µê³„ ëŒ€ì‹œë³´ë“œ í—¤ë” -->
                        <div class="stats-header">
                        <h1>ğŸ“Š êµí™˜ë°˜í’ˆ í†µê³„ ëŒ€ì‹œë³´ë“œ</h1>
                        <p>ì‹¤ì‹œê°„ êµí™˜ë°˜í’ˆ í˜„í™© ë° í†µê³„ ë¶„ì„</p>
                            </div>
                            
                    <!-- ğŸ“Š ìƒë‹¨ ì¹´ë“œ ëŒ€ì‹œë³´ë“œ (list.html êµ¬ì¡° ì™„ì „ ì ìš©) -->
                        <div class="dashboard">
                            <!-- â‘  íšŒìˆ˜ì™„ë£Œ ì¹´ë“œ -->
                        <div class="stat-box success">
                                <div class="card-content">
                                    <h3>ğŸ“¦ íšŒìˆ˜ì™„ë£Œ</h3>
                                    <div class="value">
                                        <span id="collectionCompleted">0</span>
                                    <span> / </span>
                                    <span id="collectionPending">0</span>
                            </div>
                                <div class="description">ì™„ë£Œ / ë¯¸ì™„ë£Œ</div>
                            </div>
                            </div>
                            
                            <!-- â‘¡ ë¬¼ë¥˜í™•ì¸ ì¹´ë“œ -->
                        <div class="stat-box primary">
                                <div class="card-content">
                                <h3>ğŸš› ë¬¼ë¥˜í™•ì¸</h3>
                                    <div class="value">
                                        <span id="logisticsConfirmed">0</span>
                                    <span> / </span>
                                    <span id="logisticsPending">0</span>
                            </div>
                                <div class="description">í™•ì¸ / ë¯¸í™•ì¸</div>
                            </div>
                        </div>
                        
                        <!-- â‘¢ êµí™˜ ì¶œê³ ì¼ì ì¹´ë“œ -->
                        <div class="stat-box warning">
                                <div class="card-content">
                                <h3>ğŸ“¤ êµí™˜ ì¶œê³ </h3>
                                    <div class="value">
                                        <span id="exchangeShipped">0</span>
                                    <span> / </span>
                                    <span id="exchangeNotShipped">0</span>
                            </div>
                                <div class="description">ì¶œê³ ì™„ë£Œ / ì¶œê³ ëŒ€ê¸°</div>
                            </div>
                            </div>
                            
                        <!-- â‘£ ë°˜í’ˆ í™˜ë¶ˆì¼ì ì¹´ë“œ (ë°˜í’ˆë§Œ) -->
                        <div class="stat-box danger">
                                <div class="card-content">
                                <h3>ğŸ’° ë°˜í’ˆ í™˜ë¶ˆ</h3>
                                    <div class="value">
                                        <span id="returnRefunded">0</span>
                                    <span> / </span>
                                    <span id="returnNotRefunded">0</span>
                        </div>
                                <div class="description">í™˜ë¶ˆì™„ë£Œ / í™˜ë¶ˆëŒ€ê¸°</div>
                                <div class="amount-display">
                                    ì´ í™˜ë¶ˆê¸ˆì•¡: <span id="totalRefundAmount">0ì›</span>
                                </div>
                    </div>
                </div>

                        <!-- â‘¤ ë°°ì†¡ë¹„ì…ê¸ˆ ì¹´ë“œ (êµí™˜ë§Œ) -->
                        <div class="stat-box warning">
                                <div class="card-content">
                                    <h3>ğŸ’³ ë°°ì†¡ë¹„ì…ê¸ˆ</h3>
                                    <div class="value">
                                    <span id="paymentPending">0</span>
                                    <span> / </span>
                                        <span id="paymentCompleted">0</span>
                                </div>
                                <div class="description">ì…ê¸ˆëŒ€ê¸° / ì…ê¸ˆì™„ë£Œ</div>
                                <div class="amount-display">
                                    ì´ ë°°ì†¡ë¹„: <span id="totalShippingFee">0ì›</span>
                                </div>
                        </div>
                    </div>
                    
                            <!-- â‘¥ ì „ì²´ì™„ë£Œ ì¹´ë“œ -->
                        <div class="stat-box info">
                                <div class="card-content">
                                    <h3>âœ… ì „ì²´ì™„ë£Œ</h3>
                                    <div class="value">
                                        <span id="totalCompleted">0</span>
                                    <span> / </span>
                                    <span id="totalIncompleted">0</span>
                                </div>
                                <div class="description">ì™„ë£Œ / ë¯¸ì™„ë£Œ</div>
                            </div>
                        </div>
                        
                        <!-- â‘¦ ì²˜ë¦¬ê¸°ê°„ ì„ë°• ì¹´ë“œ -->
                        <div class="stat-box danger">
                            <div class="card-content">
                                <h3>ğŸš¨ ì²˜ë¦¬ê¸°ê°„ ì„ë°•</h3>
                                <div class="value">
                                    <span id="overdueTenDaysCount">0</span>
                                </div>
                                <div class="description">10ì¼ ì´ìƒ ë¯¸ì™„ë£Œ</div>
                                    </div>
                                </div>
                            </div>

                        <!-- ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„ -->
                    <div class="update-time">
                        <i class="ki-duotone ki-time fs-5">
                            <span class="path1"></span>
                            <span class="path2"></span>
                        </i>
                        ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: <span id="updateTimeText" th:text="${#dates.format(#dates.createNow(), 'yyyy. MM. dd. HH:mm:ss')}">2025. 07. 03. 15:06:27</span>
                    </div>
                    
                    <!-- ğŸ” ê¸°ë³¸ ì¡°íšŒ ì¡°ê±´ (ê°„ì†Œí™”) -->
                    <div class="filter-section">
                        <h3 class="chart-title">ğŸ” ì¡°íšŒ ê¸°ê°„ ì„¤ì •</h3>
                        <div class="filter-grid">
                            <!-- ì‹œì‘ì¼ -->
                            <div class="filter-group">
                                <label>ì‹œì‘ì¼</label>
                                <input type="date" class="form-control" id="startDate">
                            </div>

                            <!-- ì¢…ë£Œì¼ -->
                            <div class="filter-group">
                                <label>ì¢…ë£Œì¼</label>
                                <input type="date" class="form-control" id="endDate">
                                </div>

                            <!-- ë¹ ë¥¸ ì„ íƒ -->
                            <div class="filter-group">
                                <label>ë¹ ë¥¸ ì„ íƒ</label>
                                <select class="form-control" id="periodType" onchange="setQuickPeriod()">
                                    <option value="TODAY">ì˜¤ëŠ˜</option>
                                    <option value="WEEK">ìµœê·¼ 7ì¼</option>
                                    <option value="MONTH" selected>ì´ë²ˆë‹¬</option>
                                    <option value="LAST_MONTH">ì§€ë‚œë‹¬</option>
                                    <option value="QUARTER">ìµœê·¼ 3ê°œì›”</option>
                            </select>
                        </div>

                            <!-- ì¡°íšŒ ë²„íŠ¼ -->
                            <div class="filter-group">
                                <button type="button" class="btn btn-primary" onclick="loadStatistics()">
                                    ğŸ” ì¡°íšŒ
                                </button>
                </div>

                            <!-- ì—‘ì…€ ë‹¤ìš´ë¡œë“œ -->
                            <div class="filter-group">
                                <button type="button" class="btn btn-success" onclick="downloadStatisticsExcel()">
                                    ğŸ“¥ ì—‘ì…€ë‹¤ìš´
                                </button>
                        </div>
                    </div>
                </div>

                    <!-- ğŸ“ˆ ì°¨íŠ¸ ë¶„ì„ ì„¹ì…˜ -->
                    <div class="row">
                        <!-- íŠ¸ë Œë“œ ì°¨íŠ¸ -->
                        <div class="col-lg-8">
                            <div class="chart-section">
                                <div class="chart-header">
                                    <h3 class="chart-title">ğŸ“ˆ ì¼ë³„ íŠ¸ë Œë“œ ë¶„ì„</h3>
                                </div>
                                <div class="chart-container">
                                    <canvas id="trendChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                        <!-- ìœ í˜•ë³„ ì°¨íŠ¸ -->
                        <div class="col-lg-4">
                            <div class="chart-section">
                                <div class="chart-header">
                                    <h3 class="chart-title">ìœ í˜•ë³„ ë¶„í¬</h3>
                            </div>
                                <div class="chart-container">
                                    <canvas id="typeChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                    <!-- ğŸ“Š ìƒì„¸ í†µê³„ í…Œì´ë¸” -->
                    <div class="stats-table-section">
                        <div class="chart-header">
                            <h3 class="chart-title">ğŸ“Š ìƒì„¸ í†µê³„ í˜„í™©</h3>
                        </div>
                        <div class="table-responsive">
                            <table class="stats-table">
                                <thead>
                                    <tr>
                                        <th>êµ¬ë¶„</th>
                                        <th>ì „ì²´êµí™˜</th>
                                        <th>ë¶€ë¶„êµí™˜</th>
                                        <th>ì „ì²´ë°˜í’ˆ</th>
                                        <th>ë¶€ë¶„ë°˜í’ˆ</th>
                                        <th>í•©ê³„</th>
                                        <th>ë¹„ìœ¨</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>íšŒìˆ˜ì™„ë£Œ</strong></td>
                                        <td id="collectionExchangeFull">0</td>
                                        <td id="collectionExchangePartial">0</td>
                                        <td id="collectionReturnFull">0</td>
                                        <td id="collectionReturnPartial">0</td>
                                        <td id="collectionTotal">0</td>
                                        <td id="collectionRate">0%</td>
                                    </tr>
                                    <tr>
                                        <td><strong>ë¬¼ë¥˜í™•ì¸</strong></td>
                                        <td id="logisticsExchangeFull">0</td>
                                        <td id="logisticsExchangePartial">0</td>
                                        <td id="logisticsReturnFull">0</td>
                                        <td id="logisticsReturnPartial">0</td>
                                        <td id="logisticsTotal">0</td>
                                        <td id="logisticsRate">0%</td>
                                    </tr>
                                    <tr>
                                        <td><strong>êµí™˜ì¶œê³ </strong></td>
                                        <td id="exchangeShippedFull">0</td>
                                        <td id="exchangeShippedPartial">0</td>
                                        <td>-</td>
                                        <td>-</td>
                                        <td id="exchangeTotal">0</td>
                                        <td id="exchangeRate">0%</td>
                                    </tr>
                                    <tr>
                                        <td><strong>ë°˜í’ˆí™˜ë¶ˆ</strong></td>
                                        <td>-</td>
                                        <td>-</td>
                                        <td id="returnRefundedFull">0</td>
                                        <td id="returnRefundedPartial">0</td>
                                        <td id="returnTotal">0</td>
                                        <td id="returnRate">0%</td>
                                    </tr>
                                    <tr>
                                        <td><strong>ë°°ì†¡ë¹„ì…ê¸ˆ</strong></td>
                                        <td id="paymentExchangeFull">0</td>
                                        <td id="paymentExchangePartial">0</td>
                                        <td>-</td>
                                        <td>-</td>
                                        <td id="paymentTotal">0</td>
                                        <td id="paymentRate">0%</td>
                                    </tr>
                                    <tr style="background: var(--gray-50); font-weight: 600;">
                                        <td><strong>ì „ì²´ì™„ë£Œ</strong></td>
                                        <td id="completedExchangeFull">0</td>
                                        <td id="completedExchangePartial">0</td>
                                        <td id="completedReturnFull">0</td>
                                        <td id="completedReturnPartial">0</td>
                                        <td id="totalCompleted">0</td>
                                        <td id="completionRate">0%</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- ğŸ’° ê¸ˆì•¡ ìš”ì•½ -->
                    <div class="stats-table-section">
                        <div class="chart-header">
                            <h3 class="chart-title">ğŸ’° ê¸ˆì•¡ ìš”ì•½</h3>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="stat-box primary">
                                    <div class="card-content">
                                        <h3>ğŸ’° ì´ í™˜ë¶ˆê¸ˆì•¡</h3>
                                        <div class="value amount-display">
                                            <span id="summaryRefundAmount">0</span>ì›
                                        </div>
                                        <div class="description">ë°˜í’ˆ ê±´ì— ëŒ€í•œ ì´ í™˜ë¶ˆê¸ˆì•¡</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="stat-box warning">
                                    <div class="card-content">
                                        <h3>ğŸšš ì´ ë°°ì†¡ë¹„</h3>
                                        <div class="value amount-display">
                                            <span id="summaryShippingFee">0</span>ì›
                                        </div>
                                        <div class="description">êµí™˜ ê±´ì— ëŒ€í•œ ì´ ë°°ì†¡ë¹„</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

            </div>
            <!--end::Content container-->
        </div>
        <!--end::Content-->
    </div>
        <!--end::Content wrapper-->
    </div>
    <!--end::App main-->



    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- html2canvas for image generation -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script th:inline="javascript">
        // CSRF í† í°ì„ ì „ì—­ ë³€ìˆ˜ë¡œ ì„¤ì •
        window.csrfToken = /*[[${_csrf != null ? _csrf.token : ''}]]*/ '';
        window.csrfHeader = /*[[${_csrf != null ? _csrf.headerName : 'X-CSRF-TOKEN'}]]*/ 'X-CSRF-TOKEN';

        // ì „ì—­ ë³€ìˆ˜
        let trendChart = null;
        let typeChart = null;
        let currentStats = {};
        

        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            // console.log('ğŸ“Š êµí™˜ë°˜í’ˆ í†µê³„ í˜ì´ì§€ ë¡œë”© ì‹œì‘...');
            
            // ê¸°ë³¸ ë‚ ì§œ ì„¤ì • (ì´ë²ˆë‹¬)
            setQuickPeriod();
            
            // ì´ˆê¸° í†µê³„ ë¡œë“œ
            loadStatistics();
            
            // ì°¨íŠ¸ ì´ˆê¸°í™”
            initializeCharts();
        });

        // ë¹ ë¥¸ ê¸°ê°„ ì„¤ì •
        function setQuickPeriod() {
            const periodType = document.getElementById('periodType').value;
            const startDate = document.getElementById('startDate');
            const endDate = document.getElementById('endDate');
            
            const today = new Date();
            let start, end;
            
            switch (periodType) {
                case 'TODAY':
                    start = end = today;
                    break;
                case 'WEEK':
                    start = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
                    end = today;
                    break;
                case 'MONTH':
                    start = new Date(today.getFullYear(), today.getMonth(), 1);
                    end = today;
                    break;
                case 'LAST_MONTH':
                    start = new Date(today.getFullYear(), today.getMonth() - 1, 1);
                    end = new Date(today.getFullYear(), today.getMonth(), 0);
                    break;
                case 'QUARTER':
                    start = new Date(today.getTime() - 90 * 24 * 60 * 60 * 1000);
                    end = today;
                    break;
                default:
                    return;
            }
            
            startDate.value = start.toISOString().split('T')[0];
            endDate.value = end.toISOString().split('T')[0];
        }

        // í†µê³„ ë°ì´í„° ë¡œë“œ
        async function loadStatistics() {
            try {
                // console.log('ğŸ“Š í†µê³„ ë°ì´í„° ë¡œë”© ì‹œì‘...');
                
                // ì¡°íšŒ ì¡°ê±´ ìˆ˜ì§‘
                const startDate = document.getElementById('startDate').value;
                const endDate = document.getElementById('endDate').value;
                
                // console.log('ğŸ“‹ ì¡°íšŒ ì¡°ê±´:', { startDate, endDate });
                
                // ì¡°íšŒ ì¡°ê±´ ê²€ì¦
                if (!startDate || !endDate) {
                    // console.warn('âš ï¸ ì¡°íšŒ ì¡°ê±´ì´ ì—†ìŠµë‹ˆë‹¤. ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.');
                    setQuickPeriod();
                    return;
                }
                
                // ë°±ì—”ë“œ API íŒŒë¼ë¯¸í„° êµ¬ì¡°ì— ë§ì¶° ìˆ˜ì •
                const params = {
                    startDate: startDate,  // YYYY-MM-DD í˜•ì‹
                    endDate: endDate,      // YYYY-MM-DD í˜•ì‹
                    dateFilterType: 'CS_RECEIVED',  // ê¸°ë³¸ ë‚ ì§œ ê¸°ì¤€
                    returnType: ''         // ì „ì²´ ìœ í˜•
                };
                
                // console.log('ğŸ“‹ API ì „ì†¡ íŒŒë¼ë¯¸í„°:', params);
                
                // ğŸ”§ CSRF í† í° í™•ì¸
                if (!window.csrfToken) {
                    // console.warn('âš ï¸ CSRF í† í°ì´ ì—†ìŠµë‹ˆë‹¤.');
                }
                
                // API í˜¸ì¶œ (POST ë°©ì‹, JSON Body)
                const response = await fetch('/exchange/api/statistics', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        [window.csrfHeader]: window.csrfToken
                    },
                    body: JSON.stringify(params)
                });
                
                // console.log('ğŸ“¡ API ì‘ë‹µ ìƒíƒœ:', response.status, response.statusText);
                // console.log('ğŸ“¡ API ì‘ë‹µ í—¤ë”:', Object.fromEntries(response.headers));
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP ${response.status}: ${response.statusText}\nì‘ë‹µ ë‚´ìš©: ${errorText}`);
                }
                
                const result = await response.json();
                
                // ğŸ” API ì‘ë‹µ ë°ì´í„° ì™„ì „ ë¶„ì„
                // console.log('ğŸ” ===== API ì‘ë‹µ ì™„ì „ ë¶„ì„ =====');
                // console.log('ğŸ“Š ì „ì²´ API ì‘ë‹µ:', result);
                // console.log('ğŸ“Š success ì—¬ë¶€:', result.success);
                
                if (result.processStats) {
                    // console.log('ğŸ“Š processStats ì™„ì „ ë¶„ì„:');
                    // console.log('  - íƒ€ì…:', typeof result.processStats);
                    // console.log('  - í‚¤ë“¤:', Object.keys(result.processStats));
                    // console.log('  - ì „ì²´ ë‚´ìš©:', result.processStats);
                    
                    // ê° í†µê³„ ê°’ í•˜ë‚˜ì”© í™•ì¸
                    Object.entries(result.processStats).forEach(([key, value]) => {
                        // console.log(`  - ${key}: ${value} (íƒ€ì…: ${typeof value})`);
                    });
                } else {
                    // console.error('âŒ processStatsê°€ ì—†ìŠµë‹ˆë‹¤!');
                }
                
                if (result.typeStats) {
                    // console.log('ğŸ“Š typeStats ì™„ì „ ë¶„ì„:');
                    // console.log('  - íƒ€ì…:', typeof result.typeStats);
                    // console.log('  - í‚¤ë“¤:', Object.keys(result.typeStats));
                    // console.log('  - ì „ì²´ ë‚´ìš©:', result.typeStats);
                    
                    // ê° ìœ í˜•ë³„ ê°’ í•˜ë‚˜ì”© í™•ì¸
                    Object.entries(result.typeStats).forEach(([key, value]) => {
                        // console.log(`  - ${key}: ${value} (íƒ€ì…: ${typeof value})`);
                    });
                    
                    // ì´ ê±´ìˆ˜ ê³„ì‚°
                    const totalTypeCount = Object.values(result.typeStats)
                        .reduce((sum, value) => sum + (parseInt(value) || 0), 0);
                    // console.log('  - ğŸ“Š typeStats ì´ ê±´ìˆ˜:', totalTypeCount);
                } else {
                    // console.error('âŒ typeStatsê°€ ì—†ìŠµë‹ˆë‹¤!');
                }
                
                if (result.trendData) {
                    // console.log('ğŸ“Š trendData ì™„ì „ ë¶„ì„:');
                    // console.log('  - íƒ€ì…:', typeof result.trendData);
                    // console.log('  - í‚¤ë“¤:', Object.keys(result.trendData));
                    // console.log('  - ì „ì²´ ë‚´ìš©:', result.trendData);
                    
                    if (result.trendData.labels) {
                        // console.log('  - labels ê¸¸ì´:', result.trendData.labels.length);
                        // console.log('  - labels ë‚´ìš©:', result.trendData.labels);
                    }
                    if (result.trendData.exchange) {
                        // console.log('  - exchange ê¸¸ì´:', result.trendData.exchange.length);
                        // console.log('  - exchange ë‚´ìš©:', result.trendData.exchange);
                        // console.log('  - exchange í•©ê³„:', result.trendData.exchange.reduce((a, b) => a + b, 0));
                    }
                    if (result.trendData.return) {
                        // console.log('  - return ê¸¸ì´:', result.trendData.return.length);
                        // console.log('  - return ë‚´ìš©:', result.trendData.return);
                        // console.log('  - return í•©ê³„:', result.trendData.return.reduce((a, b) => a + b, 0));
                    }
                } else {
                    // console.error('âŒ trendDataê°€ ì—†ìŠµë‹ˆë‹¤!');
                }
                
                if (result.amountStats) {
                    // console.log('ğŸ“Š amountStats ì™„ì „ ë¶„ì„:');
                    // console.log('  - íƒ€ì…:', typeof result.amountStats);
                    // console.log('  - í‚¤ë“¤:', Object.keys(result.amountStats));
                    // console.log('  - ì „ì²´ ë‚´ìš©:', result.amountStats);
                } else {
                    // console.error('âŒ amountStatsê°€ ì—†ìŠµë‹ˆë‹¤!');
                }
                
                // totalCount í™•ì¸
                if (result.totalCount !== undefined) {
                    // console.log('ğŸ“Š totalCount:', result.totalCount, '(íƒ€ì…:', typeof result.totalCount, ')');
                } else {
                    // console.error('âŒ totalCountê°€ ì—†ìŠµë‹ˆë‹¤!');
                }
                
                // console.log('ğŸ” ===== API ì‘ë‹µ ë¶„ì„ ì™„ë£Œ =====');
                
                if (result.success) {
                    currentStats = result;
                    updateStatisticsDisplay(result);
                    updateChartsData(result);
                    updateLastUpdateTime();
                    // console.log('âœ… í†µê³„ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                    // console.log('âœ… í†µê³„ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                } else {
                    throw new Error(result.message || 'í†µê³„ ì¡°íšŒ ì‹¤íŒ¨');
                }
                
            } catch (error) {
                // console.error('âŒ í†µê³„ ë¡œë”© ì‹¤íŒ¨:', error);
                showErrorMessage('í†µê³„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
                initializeDefaultData();
            }
        }

        // ğŸ”„ ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ ë°ì´í„° ì´ˆê¸°í™”
        function initializeDefaultData() {
            // console.log('ğŸ”„ ê¸°ë³¸ ë°ì´í„°ë¡œ ì´ˆê¸°í™” ì¤‘...');
            
            // ê¸°ë³¸ í†µê³„ ë°ì´í„°
            const defaultStats = {
                processStats: {
                    totalCount: 0,
                    avgProcessingTime: 0,
                    completedToday: 0,
                    pendingCount: 0
                },
                typeStats: {
                    FULL_EXCHANGE: 0,
                    PARTIAL_EXCHANGE: 0,
                    FULL_RETURN: 0,
                    PARTIAL_RETURN: 0
                },
                amountStats: {
                    totalAmount: 0,
                    avgAmount: 0,
                    maxAmount: 0,
                    minAmount: 0
                },
                trendData: {
                    labels: ['ìµœê·¼ 7ì¼', '6ì¼ ì „', '5ì¼ ì „', '4ì¼ ì „', '3ì¼ ì „', '2ì¼ ì „', 'ì–´ì œ'],
                    exchange: [0, 0, 0, 0, 0, 0, 0],
                    return: [0, 0, 0, 0, 0, 0, 0]
                }
            };
            
            updateStatisticsDisplay(defaultStats);
            updateChartsData(defaultStats);
            updateLastUpdateTime();
            
            // console.log('âœ… ê¸°ë³¸ ë°ì´í„° ì´ˆê¸°í™” ì™„ë£Œ');
        }

        // ğŸ”„ ê¸°ë³¸ ì°¨íŠ¸ ì´ˆê¸°í™”
        function initializeDefaultCharts() {
            // console.log('ğŸ”„ ê¸°ë³¸ ì°¨íŠ¸ë¡œ ì´ˆê¸°í™” ì¤‘...');
            
            try {
                if (trendChart) {
                    trendChart.data.labels = ['ìµœê·¼ 7ì¼', '6ì¼ ì „', '5ì¼ ì „', '4ì¼ ì „', '3ì¼ ì „', '2ì¼ ì „', 'ì–´ì œ'];
                    trendChart.data.datasets[0].data = [0, 0, 0, 0, 0, 0, 0];
                    trendChart.data.datasets[1].data = [0, 0, 0, 0, 0, 0, 0];
                    trendChart.update('none');
                }
                
                if (typeChart) {
                    typeChart.data.labels = ['ë°ì´í„° ì—†ìŒ (0ê±´)'];
                    typeChart.data.datasets[0].data = [1];
                    typeChart.data.datasets[0].backgroundColor = ['#95a5a6'];
                    typeChart.data.datasets[0].borderColor = ['#95a5a680'];
                    typeChart.update('none');
                }
                
                // console.log('âœ… ê¸°ë³¸ ì°¨íŠ¸ ì´ˆê¸°í™” ì™„ë£Œ');
            } catch (error) {
                // console.error('âŒ ê¸°ë³¸ ì°¨íŠ¸ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
            }
        }

        // ğŸ“Š ì°¨íŠ¸ ë°ì´í„° ì—…ë°ì´íŠ¸ (ëŒ€í­ ìˆ˜ì •)
        function updateChartsData(data) {
            try {
                // console.log('ğŸ“Š ì°¨íŠ¸ ë°ì´í„° ì—…ë°ì´íŠ¸ ì‹œì‘...');
                // console.log('ğŸ“Š ë°›ì€ ë°ì´í„°:', data);
                
                // ğŸš¨ DEBUG: íŠ¸ë Œë“œ ë°ì´í„° êµ¬ì¡° ì™„ì „ ë¶„ì„
                // console.log('ğŸš¨ DEBUG: data.trendData ì¡´ì¬ ì—¬ë¶€:', !!data.trendData);
                if (data.trendData) {
                    // console.log('ğŸš¨ DEBUG: data.trendData ì „ì²´:', data.trendData);
                    // console.log('ğŸš¨ DEBUG: data.trendData.labels:', data.trendData.labels);
                    // console.log('ğŸš¨ DEBUG: data.trendData.exchange:', data.trendData.exchange);
                    // console.log('ğŸš¨ DEBUG: data.trendData.return:', data.trendData.return);
                    // console.log('ğŸš¨ DEBUG: labels ê¸¸ì´:', data.trendData.labels ? data.trendData.labels.length : 'undefined');
                    // console.log('ğŸš¨ DEBUG: exchange ê¸¸ì´:', data.trendData.exchange ? data.trendData.exchange.length : 'undefined');
                    // console.log('ğŸš¨ DEBUG: return ê¸¸ì´:', data.trendData.return ? data.trendData.return.length : 'undefined');
                } else {
                    // console.log('ğŸš¨ DEBUG: data.trendDataê°€ ì—†ìŠµë‹ˆë‹¤!');
                }
                
                // ğŸ”¥ ê°•ì œ ì‹¤í–‰ í™•ì¸
                // console.log('ğŸ”¥ íŠ¸ë Œë“œ ì°¨íŠ¸ ê°ì²´ í™•ì¸:', !!trendChart);
                // console.log('ğŸ”¥ ìœ í˜•ë³„ ì°¨íŠ¸ ê°ì²´ í™•ì¸:', !!typeChart);
                
                // 1. ğŸ” íŠ¸ë Œë“œ ì°¨íŠ¸ ì—…ë°ì´íŠ¸ (ê°•ì œ ì‹¤í–‰)
                // console.log('ğŸ“ˆ === íŠ¸ë Œë“œ ì°¨íŠ¸ ì—…ë°ì´íŠ¸ ì‹œì‘ ===');
                
                if (trendChart) {
                    // console.log('ğŸ“ˆ íŠ¸ë Œë“œ ì°¨íŠ¸ ê°ì²´ ì¡´ì¬ âœ…');
                    
                    let finalLabels = [];
                    let finalExchange = [];
                    let finalReturn = [];
                    
                    // ğŸš¨ ì‹¤ì œ íŠ¸ë Œë“œ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ê·¸ëŒ€ë¡œ ì‚¬ìš© (ê°€ì¥ ìš°ì„ )
                    if (data.trendData && data.trendData.labels && data.trendData.exchange && data.trendData.return) {
                        // console.log('ğŸ“ˆ ğŸ”¥ ì‹¤ì œ íŠ¸ë Œë“œ ë°ì´í„° ë°œê²¬! ê·¸ëŒ€ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.');
                        // console.log('ğŸ“ˆ ğŸ”¥ íŠ¸ë Œë“œ ë¼ë²¨:', data.trendData.labels);
                        // console.log('ğŸ“ˆ ğŸ”¥ íŠ¸ë Œë“œ êµí™˜:', data.trendData.exchange);
                        // console.log('ğŸ“ˆ ğŸ”¥ íŠ¸ë Œë“œ ë°˜í’ˆ:', data.trendData.return);
                        
                        finalLabels = [...data.trendData.labels];
                        finalExchange = [...data.trendData.exchange];
                        finalReturn = [...data.trendData.return];
                        
                    } else {
                        // console.log('ğŸ“ˆ âš ï¸ ì‹¤ì œ íŠ¸ë Œë“œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ê¸°ë³¸ ë°ì´í„°ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.');
                        
                        // ê¸°ë³¸ 7ì¼ ë°ì´í„°
                        finalLabels = ['06-01', '06-02', '06-03', '06-04', '06-05', '06-06', '06-07'];
                        finalExchange = [0, 0, 0, 0, 0, 0, 0];
                        finalReturn = [0, 0, 0, 0, 0, 0, 0];
                    }
                    
                    // console.log('ğŸ“ˆ ğŸ”¥ ìµœì¢… íŠ¸ë Œë“œ ë°ì´í„°:');
                    // console.log('  - ë¼ë²¨:', finalLabels);
                    // console.log('  - êµí™˜ ë°ì´í„°:', finalExchange);
                    // console.log('  - ë°˜í’ˆ ë°ì´í„°:', finalReturn);
                    // console.log('  - êµí™˜ ì´í•©:', finalExchange.reduce((a, b) => a + b, 0));
                    // console.log('  - ë°˜í’ˆ ì´í•©:', finalReturn.reduce((a, b) => a + b, 0));
                    
                    // ğŸ”¥ ê°•ì œ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
                    // console.log('ğŸ“ˆ ğŸ”¥ ì°¨íŠ¸ ì—…ë°ì´íŠ¸ ê°•ì œ ì‹¤í–‰...');
                    
                    try {
                        trendChart.data.labels = finalLabels;
                        trendChart.data.datasets[0].data = finalExchange;
                        trendChart.data.datasets[1].data = finalReturn;
                        
                        // ì—¬ëŸ¬ ë°©ì‹ìœ¼ë¡œ ì—…ë°ì´íŠ¸ ì‹œë„
                        trendChart.update('active');
                        setTimeout(() => {
                            trendChart.update('none');
                        }, 100);
                        
                        // console.log('ğŸ“ˆ ğŸ”¥ ì°¨íŠ¸ ì—…ë°ì´íŠ¸ ì™„ë£Œ!');
                        // console.log('ğŸ“ˆ ğŸ”¥ ì—…ë°ì´íŠ¸ëœ ë¼ë²¨:', trendChart.data.labels);
                        // console.log('ğŸ“ˆ ğŸ”¥ ì—…ë°ì´íŠ¸ëœ êµí™˜:', trendChart.data.datasets[0].data);
                        // console.log('ğŸ“ˆ ğŸ”¥ ì—…ë°ì´íŠ¸ëœ ë°˜í’ˆ:', trendChart.data.datasets[1].data);
                        
                    } catch (chartError) {
                        // console.error('âŒ ì°¨íŠ¸ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', chartError);
                    }
                    
                } else {
                    // console.error('âŒ ğŸ”¥ trendChart ê°ì²´ê°€ ì—†ìŠµë‹ˆë‹¤!');
                    // console.log('âŒ ğŸ”¥ í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì„œ ì°¨íŠ¸ë¥¼ ë‹¤ì‹œ ì´ˆê¸°í™”í•˜ì„¸ìš”.');
                }
                
                // console.log('ğŸ“ˆ === íŠ¸ë Œë“œ ì°¨íŠ¸ ì—…ë°ì´íŠ¸ ì™„ë£Œ ===');
                
                // 2. ğŸ¥§ ìœ í˜•ë³„ ë¶„í¬ ì°¨íŠ¸ ì—…ë°ì´íŠ¸ (ê°œì„ ëœ ë²„ì „)
                if (typeChart) {
                    // console.log('ğŸ¥§ ìœ í˜•ë³„ ì°¨íŠ¸ ì—…ë°ì´íŠ¸ ì¤‘...');
                    
                    if (data.typeStats) {
                        // console.log('ğŸ¥§ ìœ í˜•ë³„ ë°ì´í„° ì¡´ì¬ í™•ì¸ âœ…');
                        // console.log('ğŸ¥§ ìœ í˜•ë³„ í†µê³„ ì›ë³¸:', data.typeStats);
                        
                        const typeStats = data.typeStats;
                        // console.log('ğŸ” typeStats í‚¤ë“¤:', Object.keys(typeStats));
                        
                        // ğŸ”§ ê°œì„ ëœ í•œêµ­ì–´ ë¼ë²¨ ë§¤í•‘ ë° ê·¸ë£¹í™”
                        const processedData = [];
                        
                        // êµí™˜ ë°ì´í„° ê·¸ë£¹í™”
                        const fullExchange = parseInt(typeStats.FULL_EXCHANGE) || 0;
                        const partialExchange = parseInt(typeStats.PARTIAL_EXCHANGE) || 0;
                        const totalExchange = fullExchange + partialExchange;
                        
                        // ë°˜í’ˆ ë°ì´í„° ê·¸ë£¹í™”
                        const fullReturn = parseInt(typeStats.FULL_RETURN) || 0;
                        const partialReturn = parseInt(typeStats.PARTIAL_RETURN) || 0;
                        const totalReturn = fullReturn + partialReturn;
                        
                        // console.log('ğŸ” ìœ í˜•ë³„ ì§‘ê³„:');
                        // console.log(`  - ì „ì²´êµí™˜: ${fullExchange}ê±´, ë¶€ë¶„êµí™˜: ${partialExchange}ê±´ â†’ êµí™˜ ì´ê³„: ${totalExchange}ê±´`);
                        // console.log(`  - ì „ì²´ë°˜í’ˆ: ${fullReturn}ê±´, ë¶€ë¶„ë°˜í’ˆ: ${partialReturn}ê±´ â†’ ë°˜í’ˆ ì´ê³„: ${totalReturn}ê±´`);
                        
                        // ğŸ“Š ì°¨íŠ¸ ë°ì´í„° êµ¬ì„± (ë‹¨ìˆœ ë¼ë²¨ ì‚¬ìš©)
                        const labels = [];
                        const values = [];
                        const colors = [];
                        
                        // êµí™˜ ë°ì´í„° ì¶”ê°€
                        if (totalExchange > 0) {
                            labels.push('êµí™˜');
                            values.push(totalExchange);
                            colors.push('#3498db');
                        }
                        
                        // ë°˜í’ˆ ë°ì´í„° ì¶”ê°€
                        if (totalReturn > 0) {
                            labels.push('ë°˜í’ˆ');
                            values.push(totalReturn);
                            colors.push('#e74c3c');
                        }
                        
                        // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
                        if (labels.length > 0) {
                            // console.log('ğŸ¥§ ìµœì¢… ì°¨íŠ¸ ë°ì´í„°:');
                            // console.log('  - labels:', labels);
                            // console.log('  - values:', values);
                            // console.log('  - colors:', colors);
                            
                            typeChart.data.labels = labels;
                            typeChart.data.datasets[0].data = values;
                            typeChart.data.datasets[0].backgroundColor = colors;
                            typeChart.data.datasets[0].borderColor = colors.map(color => color + '80');
                            typeChart.update('none');
                            
                            // console.log('âœ… ìœ í˜•ë³„ ì°¨íŠ¸ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                        } else {
                            // console.log('ğŸ¥§ ìœ í˜•ë³„ ë°ì´í„°ê°€ ëª¨ë‘ 0. ê¸°ë³¸ ì°¨íŠ¸ë¡œ ì´ˆê¸°í™”...');
                            typeChart.data.labels = ['ë°ì´í„° ì—†ìŒ'];
                            typeChart.data.datasets[0].data = [1];
                            typeChart.data.datasets[0].backgroundColor = ['#95a5a6'];
                            typeChart.data.datasets[0].borderColor = ['#95a5a680'];
                            typeChart.update('none');
                        }
                    } else {
                        // console.error('âŒ data.typeStatsê°€ ì—†ìŠµë‹ˆë‹¤!');
                        // console.log('ğŸ¥§ ê¸°ë³¸ ì°¨íŠ¸ë¡œ ì´ˆê¸°í™”...');
                        typeChart.data.labels = ['ë°ì´í„° ì—†ìŒ'];
                        typeChart.data.datasets[0].data = [1];
                        typeChart.data.datasets[0].backgroundColor = ['#95a5a6'];
                        typeChart.data.datasets[0].borderColor = ['#95a5a680'];
                        typeChart.update('none');
                    }
                } else {
                    // console.error('âŒ typeChartê°€ ì—†ìŠµë‹ˆë‹¤!');
                }
                
                // console.log('ğŸ“Š ì°¨íŠ¸ ë°ì´í„° ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                
            } catch (error) {
                // console.error('âŒ ì°¨íŠ¸ ë°ì´í„° ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
                // console.error('âŒ ì˜¤ë¥˜ ìŠ¤íƒ:', error.stack);
                
                // ì°¨íŠ¸ ì´ˆê¸°í™”ë¡œ ëŒ€ì²´
                initializeDefaultCharts();
            }
        }

        // í†µê³„ í™”ë©´ ì—…ë°ì´íŠ¸
        function updateStatisticsDisplay(data) {
            try {
                // console.log('ğŸ¨ í†µê³„ í™”ë©´ ì—…ë°ì´íŠ¸ ì‹œì‘');
                // console.log('ğŸ“Š ì—…ë°ì´íŠ¸ ë°ì´í„°:', data);
                
                // ë°ì´í„° êµ¬ì¡° í™•ì¸ ë° ê¸°ë³¸ê°’ ì„¤ì •
                const processStats = data.processStats || {};
                const amountStats = data.amountStats || {};
                const totalCount = data.totalCount || 0;
                
                // API ì‘ë‹µ ë°ì´í„°ë¥¼ ê·¸ëŒ€ë¡œ í‘œì‹œ (í™”ë©´ì—ì„œ ì¡°ì‘í•˜ì§€ ì•ŠìŒ)
                // console.log('ğŸ“Š API ì‘ë‹µ ë°ì´í„° ì›ë³¸:', data);
                // console.log('ğŸ“Š processStats:', processStats);
                // console.log('ğŸ“Š amountStats:', amountStats);
                // console.log('ğŸ“Š totalCount:', totalCount);
                
                // â‘  íšŒìˆ˜ì™„ë£Œ ì¹´ë“œ - ë°±ì—”ë“œì—ì„œ ê³„ì‚°ëœ ì •í™•í•œ ê°’ ì‚¬ìš©
                updateElement('collectionCompleted', processStats.collectionCompleted || 0);
                updateElement('collectionPending', processStats.collectionPending || 0);
                
                // â‘¡ ë¬¼ë¥˜í™•ì¸ ì¹´ë“œ - ë°±ì—”ë“œì—ì„œ ê³„ì‚°ëœ ì •í™•í•œ ê°’ ì‚¬ìš©
                updateElement('logisticsConfirmed', processStats.logisticsConfirmed || 0);
                updateElement('logisticsPending', processStats.logisticsPending || 0);
                
                // â‘¢ êµí™˜ì¶œê³  ì¹´ë“œ - ë°±ì—”ë“œì—ì„œ ê³„ì‚°ëœ ì •í™•í•œ ê°’ ì‚¬ìš©
                updateElement('exchangeShipped', processStats.exchangeShipped || 0);
                updateElement('exchangeNotShipped', processStats.exchangeNotShipped || 0);
                
                // â‘£ ë°˜í’ˆí™˜ë¶ˆ ì¹´ë“œ - ë°±ì—”ë“œì—ì„œ ê³„ì‚°ëœ ì •í™•í•œ ê°’ ì‚¬ìš©
                updateElement('returnRefunded', processStats.returnRefunded || 0);
                updateElement('returnNotRefunded', processStats.returnNotRefunded || 0);
                updateElement('totalRefundAmount', (amountStats.totalRefundAmount || 0).toLocaleString() + 'ì›');
                
                // â‘¤ ë°°ì†¡ë¹„ì…ê¸ˆ ì¹´ë“œ - ë°±ì—”ë“œì—ì„œ ê³„ì‚°ëœ ì •í™•í•œ ê°’ ì‚¬ìš©
                updateElement('paymentPending', processStats.paymentPending || 0);
                updateElement('paymentCompleted', processStats.paymentCompleted || 0);
                updateElement('totalShippingFee', (amountStats.totalShippingFee || 0).toLocaleString() + 'ì›');
                
                // â‘¥ ì „ì²´ì™„ë£Œ ì¹´ë“œ - ë°±ì—”ë“œì—ì„œ ê³„ì‚°ëœ ì •í™•í•œ ê°’ ì‚¬ìš©
                updateElement('totalCompleted', processStats.totalCompleted || 0);
                updateElement('totalIncompleted', processStats.totalIncompleted || 0);
                
                // â‘¦ ì²˜ë¦¬ê¸°ê°„ ì„ë°• ì¹´ë“œ - ë°±ì—”ë“œì—ì„œ ê³„ì‚°ëœ ì •í™•í•œ ê°’ ì‚¬ìš© (ì¡°íšŒì¡°ê±´ ë¬´ê´€)
                updateElement('overdueTenDaysCount', processStats.overdueTenDaysCount || 0);
                
                // ğŸ“Š ìƒì„¸í†µê³„í˜„í™© í…Œì´ë¸” ì—…ë°ì´íŠ¸
                updateDetailStatsTable(data);
                
                // ğŸ’° ê¸ˆì•¡ ìš”ì•½ ì„¹ì…˜ ì—…ë°ì´íŠ¸
                updateAmountSummary(data);
                
                // console.log('âœ… í†µê³„ í™”ë©´ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                
            } catch (error) {
                // console.error('âŒ í†µê³„ í™”ë©´ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
            }
        }

        // ìƒì„¸í†µê³„í˜„í™© í…Œì´ë¸” ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateDetailStatsTable(data) {
            try {
                // console.log('ğŸ“Š ìƒì„¸í†µê³„í˜„í™© í…Œì´ë¸” ì—…ë°ì´íŠ¸ ì‹œì‘');
                
                const processStats = data.processStats || {};
                const typeStats = data.typeStats || {};
                const totalCount = data.totalCount || 0;
                
                // ìœ í˜•ë³„ ë¹„ìœ¨ ê³„ì‚°
                const totalExchange = (typeStats.FULL_EXCHANGE || 0) + (typeStats.PARTIAL_EXCHANGE || 0);
                const totalReturn = (typeStats.FULL_RETURN || 0) + (typeStats.PARTIAL_RETURN || 0);
                const totalAllTypes = totalExchange + totalReturn;
                
                // ê° ìœ í˜•ë³„ ë¹„ìœ¨ (ì „ì²´ ê±´ìˆ˜ ê¸°ì¤€)
                const fullExchangeRatio = totalAllTypes > 0 ? (typeStats.FULL_EXCHANGE || 0) / totalAllTypes : 0;
                const partialExchangeRatio = totalAllTypes > 0 ? (typeStats.PARTIAL_EXCHANGE || 0) / totalAllTypes : 0;
                const fullReturnRatio = totalAllTypes > 0 ? (typeStats.FULL_RETURN || 0) / totalAllTypes : 0;
                const partialReturnRatio = totalAllTypes > 0 ? (typeStats.PARTIAL_RETURN || 0) / totalAllTypes : 0;
                
                // 1. íšŒìˆ˜ì™„ë£Œ ìƒì„¸í†µê³„
                const collectionCompleted = processStats.collectionCompleted || 0;
                const collectionPending = processStats.collectionPending || 0;
                const collectionTotal = collectionCompleted + collectionPending;
                
                updateElement('collectionExchangeFull', Math.round(collectionCompleted * fullExchangeRatio));
                updateElement('collectionExchangePartial', Math.round(collectionCompleted * partialExchangeRatio));
                updateElement('collectionReturnFull', Math.round(collectionCompleted * fullReturnRatio));
                updateElement('collectionReturnPartial', Math.round(collectionCompleted * partialReturnRatio));
                updateElement('collectionTotal', collectionCompleted);
                updateElement('collectionRate', collectionTotal > 0 ? Math.round((collectionCompleted / collectionTotal) * 100) + '%' : '0%');
                
                // 2. ë¬¼ë¥˜í™•ì¸ ìƒì„¸í†µê³„
                const logisticsConfirmed = processStats.logisticsConfirmed || 0;
                const logisticsPending = processStats.logisticsPending || 0;
                const logisticsTotal = logisticsConfirmed + logisticsPending;
                
                updateElement('logisticsExchangeFull', Math.round(logisticsConfirmed * fullExchangeRatio));
                updateElement('logisticsExchangePartial', Math.round(logisticsConfirmed * partialExchangeRatio));
                updateElement('logisticsReturnFull', Math.round(logisticsConfirmed * fullReturnRatio));
                updateElement('logisticsReturnPartial', Math.round(logisticsConfirmed * partialReturnRatio));
                updateElement('logisticsTotal', logisticsConfirmed);
                updateElement('logisticsRate', logisticsTotal > 0 ? Math.round((logisticsConfirmed / logisticsTotal) * 100) + '%' : '0%');
                
                // 3. êµí™˜ì¶œê³  ìƒì„¸í†µê³„ (êµí™˜ë§Œ í•´ë‹¹)
                const exchangeShipped = processStats.exchangeShipped || 0;
                const exchangeNotShipped = processStats.exchangeNotShipped || 0;
                const exchangeShippingTotal = exchangeShipped + exchangeNotShipped;
                const exchangeFullRatio = totalExchange > 0 ? (typeStats.FULL_EXCHANGE || 0) / totalExchange : 0;
                const exchangePartialRatio = totalExchange > 0 ? (typeStats.PARTIAL_EXCHANGE || 0) / totalExchange : 0;
                
                updateElement('exchangeShippedFull', Math.round(exchangeShipped * exchangeFullRatio));
                updateElement('exchangeShippedPartial', Math.round(exchangeShipped * exchangePartialRatio));
                updateElement('exchangeTotal', exchangeShipped);
                updateElement('exchangeRate', exchangeShippingTotal > 0 ? Math.round((exchangeShipped / exchangeShippingTotal) * 100) + '%' : '0%');
                
                // 4. ë°˜í’ˆí™˜ë¶ˆ ìƒì„¸í†µê³„ (ë°˜í’ˆë§Œ í•´ë‹¹)
                const returnRefunded = processStats.returnRefunded || 0;
                const returnNotRefunded = processStats.returnNotRefunded || 0;
                const returnRefundTotal = returnRefunded + returnNotRefunded;
                const returnFullRatio = totalReturn > 0 ? (typeStats.FULL_RETURN || 0) / totalReturn : 0;
                const returnPartialRatio = totalReturn > 0 ? (typeStats.PARTIAL_RETURN || 0) / totalReturn : 0;
                
                updateElement('returnRefundedFull', Math.round(returnRefunded * returnFullRatio));
                updateElement('returnRefundedPartial', Math.round(returnRefunded * returnPartialRatio));
                updateElement('returnTotal', returnRefunded);
                updateElement('returnRate', returnRefundTotal > 0 ? Math.round((returnRefunded / returnRefundTotal) * 100) + '%' : '0%');
                
                // 5. ë°°ì†¡ë¹„ì…ê¸ˆ ìƒì„¸í†µê³„ (êµí™˜ë§Œ í•´ë‹¹)
                const paymentCompleted = processStats.paymentCompleted || 0;
                const paymentPending = processStats.paymentPending || 0;
                const paymentTotal = paymentCompleted + paymentPending;
                
                updateElement('paymentExchangeFull', Math.round(paymentCompleted * exchangeFullRatio));
                updateElement('paymentExchangePartial', Math.round(paymentCompleted * exchangePartialRatio));
                updateElement('paymentTotal', paymentCompleted);
                updateElement('paymentRate', paymentTotal > 0 ? Math.round((paymentCompleted / paymentTotal) * 100) + '%' : '0%');
                
                // 6. ì „ì²´ì™„ë£Œ ìƒì„¸í†µê³„ (IS_COMPLETED ê¸°ì¤€)
                const totalCompleted = processStats.totalCompleted || 0;
                const totalIncompleted = processStats.totalIncompleted || 0;
                const allTotal = totalCompleted + totalIncompleted;
                
                // ğŸ” ì „ì²´ì™„ë£Œ ê´€ë ¨ ë°ì´í„° ìƒì„¸ ë¡œê·¸
                // console.log('ğŸ“Š ì „ì²´ì™„ë£Œ ìƒì„¸ ë°ì´í„°:');
                // console.log('  âœ… IS_COMPLETED = 1 (ì™„ë£Œ):', totalCompleted);
                // console.log('  âŒ IS_COMPLETED = 0 (ë¯¸ì™„ë£Œ):', totalIncompleted);
                // console.log('  ğŸ“Š ì „ì²´ ê±´ìˆ˜ (ì™„ë£Œ+ë¯¸ì™„ë£Œ):', allTotal);
                // console.log('  ğŸ“Š APIì˜ totalCount:', totalCount);
                
                // ğŸš¨ ì „ì²´ì™„ë£Œê°€ 0ì¸ ê²½ìš° ê²½ê³  ë©”ì‹œì§€
                if (totalCompleted === 0 && totalIncompleted === 0) {
                    // console.error('ğŸš¨ ì „ì²´ì™„ë£Œ ë°ì´í„°ê°€ ëª¨ë‘ 0ì…ë‹ˆë‹¤!');
                    // console.error('   - ë°±ì—”ë“œì—ì„œ IS_COMPLETED ì»¬ëŸ¼ì„ ì œëŒ€ë¡œ ì¡°íšŒí•˜ì§€ ëª»í•œ ê²ƒ ê°™ìŠµë‹ˆë‹¤.');
                    // console.error('   - ì„œë²„ ë¡œê·¸ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.');
                    // console.error('   - processStats ì „ì²´:', processStats);
                    // console.error('   - API ì›ë³¸ ë°ì´í„°:', data);
                } else {
                    // console.log('âœ… ì „ì²´ì™„ë£Œ ë°ì´í„° ì •ìƒ:', {
                    //     ì™„ë£Œ: totalCompleted,
                    //     ë¯¸ì™„ë£Œ: totalIncompleted,
                    //     ì „ì²´: allTotal,
                    //     ì™„ë£Œìœ¨: Math.round((totalCompleted / allTotal) * 100) + '%'
                    // });
                }
                
                // ìƒì„¸í†µê³„í˜„í™© í…Œì´ë¸”ì˜ ì „ì²´ì™„ë£Œ í–‰ ì—…ë°ì´íŠ¸
                const completedExchangeFull = Math.round(totalCompleted * fullExchangeRatio);
                const completedExchangePartial = Math.round(totalCompleted * partialExchangeRatio);
                const completedReturnFull = Math.round(totalCompleted * fullReturnRatio);
                const completedReturnPartial = Math.round(totalCompleted * partialReturnRatio);
                
                // console.log('ï¿½ï¿½ ì „ì²´ì™„ë£Œ ìƒì„¸í†µê³„í˜„í™© ê³„ì‚°:');
                // console.log('  ğŸ“Š IS_COMPLETED = 1 (ì‹¤ì œê°’):', totalCompleted);
                // console.log('  ğŸ“Š ì „ì²´êµí™˜ (ì¶”ì •):', completedExchangeFull, '(', totalCompleted, '*', fullExchangeRatio.toFixed(3), ')');
                // console.log('  ğŸ“Š ë¶€ë¶„êµí™˜ (ì¶”ì •):', completedExchangePartial, '(', totalCompleted, '*', partialExchangeRatio.toFixed(3), ')');
                // console.log('  ğŸ“Š ì „ì²´ë°˜í’ˆ (ì¶”ì •):', completedReturnFull, '(', totalCompleted, '*', fullReturnRatio.toFixed(3), ')');
                // console.log('  ğŸ“Š ë¶€ë¶„ë°˜í’ˆ (ì¶”ì •):', completedReturnPartial, '(', totalCompleted, '*', partialReturnRatio.toFixed(3), ')');
                
                updateElement('completedExchangeFull', completedExchangeFull);
                updateElement('completedExchangePartial', completedExchangePartial);
                updateElement('completedReturnFull', completedReturnFull);
                updateElement('completedReturnPartial', completedReturnPartial);
                
                // ì „ì²´ì™„ë£Œ ë¹„ìœ¨ ê³„ì‚° (IS_COMPLETED ê¸°ì¤€)
                let completionRate = '0%';
                if (allTotal > 0) {
                    completionRate = Math.round((totalCompleted / allTotal) * 100) + '%';
                    // console.log('ğŸ“Š ì •ìƒì ì¸ ì™„ë£Œìœ¨ ê³„ì‚°: ' + completionRate);
                } else if (totalCount > 0) {
                    // allTotalì´ 0ì¸ ê²½ìš° ì„ì‹œë¡œ totalCount ê¸°ì¤€ìœ¼ë¡œ ê³„ì‚°
                    // console.warn('âš ï¸ IS_COMPLETED ë°ì´í„°ê°€ ì—†ì–´ totalCount ê¸°ì¤€ìœ¼ë¡œ ê³„ì‚°');
                    completionRate = Math.round((totalCompleted / totalCount) * 100) + '%';
                    // console.warn('âš ï¸ ì„ì‹œ ì™„ë£Œìœ¨ ê³„ì‚°: ' + completionRate);
                } else {
                    // console.error('ğŸš¨ ì™„ë£Œìœ¨ ê³„ì‚° ë¶ˆê°€: ëª¨ë“  ë°ì´í„°ê°€ 0');
                }
                
                updateElement('completionRate', completionRate);
                // console.log('ğŸ“Š ìµœì¢… ì „ì²´ì™„ë£Œìœ¨:', completionRate);
                
                // console.log('âœ… ìƒì„¸í†µê³„í˜„í™© í…Œì´ë¸” ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                
            } catch (error) {
                // console.error('âŒ ìƒì„¸í†µê³„í˜„í™© í…Œì´ë¸” ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
            }
        }

        // ğŸ’° ê¸ˆì•¡ ìš”ì•½ ì„¹ì…˜ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateAmountSummary(data) {
            try {
                // console.log('ğŸ’° ê¸ˆì•¡ ìš”ì•½ ì„¹ì…˜ ì—…ë°ì´íŠ¸ ì‹œì‘');
                // console.log('ğŸ’° ë°›ì€ ì „ì²´ ë°ì´í„°:', data);
                
                const amountStats = data.amountStats || {};
                // console.log('ğŸ’° amountStats ì›ë³¸:', amountStats);
                
                // ê¸ˆì•¡ ë°ì´í„° ì¶”ì¶œ ë° ë¡œê¹…
                const totalRefundAmount = amountStats.totalRefundAmount || 0;
                const totalShippingFee = amountStats.totalShippingFee || 0;
                const totalCount = amountStats.totalCount || 0;
                
                // console.log('ğŸ’° ê¸ˆì•¡ ìš”ì•½ ë°ì´í„° ë¶„ì„:');
                // console.log(`  - ì´ í™˜ë¶ˆê¸ˆì•¡: ${totalRefundAmount.toLocaleString()}ì›`);
                // console.log(`  - ì´ ë°°ì†¡ë¹„: ${totalShippingFee.toLocaleString()}ì›`);
                // console.log(`  - ëŒ€ìƒ ê±´ìˆ˜: ${totalCount}ê±´`);
                
                // ì¡°íšŒ ì¡°ê±´ í™•ì¸
                const searchParams = data.searchParams || {};
                // console.log('ğŸ’° í˜„ì¬ ì¡°íšŒ ì¡°ê±´:');
                // console.log(`  - ì‹œì‘ë‚ ì§œ: ${searchParams.startDate || 'ì—†ìŒ'}`);
                // console.log(`  - ì¢…ë£Œë‚ ì§œ: ${searchParams.endDate || 'ì—†ìŒ'}`);
                // console.log(`  - ë°˜í’ˆìœ í˜•: ${searchParams.returnType || 'ì „ì²´'}`);
                
                // ê¸ˆì•¡ ìš”ì•½ ì„¹ì…˜ ì—…ë°ì´íŠ¸
                updateElement('summaryRefundAmount', totalRefundAmount.toLocaleString());
                updateElement('summaryShippingFee', totalShippingFee.toLocaleString());
                
                // console.log('âœ… ê¸ˆì•¡ ìš”ì•½ ì„¹ì…˜ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                
            } catch (error) {
                // console.error('âŒ ê¸ˆì•¡ ìš”ì•½ ì„¹ì…˜ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
                // console.error('âŒ ì˜¤ë¥˜ ìŠ¤íƒ:', error.stack);
            }
        }

        // ìš”ì†Œ ì—…ë°ì´íŠ¸ í—¬í¼ í•¨ìˆ˜
        function updateElement(id, value) {
            const element = document.getElementById(id);
            if (element) {
                element.textContent = typeof value === 'number' ? value.toLocaleString() : value;
                
                // ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
                element.style.transform = 'scale(1.1)';
                element.style.transition = 'transform 0.3s ease';
                setTimeout(() => {
                    element.style.transform = 'scale(1)';
                }, 300);
            }
        }

        // ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„ í‘œì‹œ
        function updateLastUpdateTime() {
            const now = new Date();
            const timeString = now.toLocaleString('ko-KR', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            
            const element = document.getElementById('updateTimeText');
            if (element) {
                element.textContent = timeString;
            }
        }

        // ì°¨íŠ¸ ì´ˆê¸°í™” (ê°œì„ ëœ ë²„ì „)
        function initializeCharts() {
            try {
                // console.log('ğŸ“Š ì°¨íŠ¸ ì´ˆê¸°í™” ì‹œì‘...');
                
                // íŠ¸ë Œë“œ ì°¨íŠ¸ ì´ˆê¸°í™”
                const trendCtx = document.getElementById('trendChart');
                if (trendCtx) {
                    // console.log('ğŸ“ˆ íŠ¸ë Œë“œ ì°¨íŠ¸ ì´ˆê¸°í™” ì¤‘...');
                    
                    // ê¸°ì¡´ ì°¨íŠ¸ê°€ ìˆìœ¼ë©´ ì œê±°
                    if (trendChart) {
                        trendChart.destroy();
                    }
                    
                    trendChart = new Chart(trendCtx, {
                        type: 'line',
                        data: {
                            labels: ['ìµœê·¼ 7ì¼', '6ì¼ ì „', '5ì¼ ì „', '4ì¼ ì „', '3ì¼ ì „', '2ì¼ ì „', 'ì–´ì œ'],
                            datasets: [{
                                label: 'êµí™˜',
                                data: [0, 0, 0, 0, 0, 0, 0],
                                borderColor: '#3b82f6',
                                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                borderWidth: 3,
                                fill: true,
                                tension: 0.4,
                                pointBackgroundColor: '#3b82f6',
                                pointBorderColor: '#ffffff',
                                pointBorderWidth: 2,
                                pointRadius: 6,
                                pointHoverRadius: 8
                            }, {
                                label: 'ë°˜í’ˆ',
                                data: [0, 0, 0, 0, 0, 0, 0],
                                borderColor: '#ef4444',
                                backgroundColor: 'rgba(239, 68, 68, 0.1)',
                                borderWidth: 3,
                                fill: true,
                                tension: 0.4,
                                pointBackgroundColor: '#ef4444',
                                pointBorderColor: '#ffffff',
                                pointBorderWidth: 2,
                                pointRadius: 6,
                                pointHoverRadius: 8
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            interaction: {
                                intersect: false,
                                mode: 'index'
                            },
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'ì¼ë³„ êµí™˜/ë°˜í’ˆ íŠ¸ë Œë“œ',
                                    font: {
                                        size: 16,
                                        weight: 'bold'
                                    },
                                    padding: 20
                                },
                                legend: {
                                    position: 'top',
                                    labels: {
                                        usePointStyle: true,
                                        padding: 20,
                                        font: {
                                            size: 12,
                                            weight: '600'
                                        }
                                    }
                                },
                                tooltip: {
                                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                    titleFont: {
                                        size: 14,
                                        weight: 'bold'
                                    },
                                    bodyFont: {
                                        size: 13
                                    },
                                    cornerRadius: 8,
                                    displayColors: true,
                                    callbacks: {
                                        title: function(context) {
                                            return context[0].label;
                                        },
                                        label: function(context) {
                                            return context.dataset.label + ': ' + context.parsed.y + 'ê±´';
                                        }
                                    }
                                }
                            },
                            scales: {
                                x: {
                                    grid: {
                                        display: true,
                                        color: '#e5e7eb'
                                    },
                                    ticks: {
                                        font: {
                                            size: 12
                                        },
                                        color: '#6b7280'
                                    }
                                },
                                y: {
                                    beginAtZero: true,
                                    grid: {
                                        display: true,
                                        color: '#e5e7eb'
                                    },
                                    ticks: {
                                        font: {
                                            size: 12
                                        },
                                        color: '#6b7280',
                                        callback: function(value) {
                                            return value + 'ê±´';
                                        }
                                    }
                                }
                            },
                            animation: {
                                duration: 1500,
                                easing: 'easeInOutQuart'
                            }
                        }
                    });
                    
                    // console.log('âœ… íŠ¸ë Œë“œ ì°¨íŠ¸ ì´ˆê¸°í™” ì™„ë£Œ');
                } else {
                    // console.error('âŒ íŠ¸ë Œë“œ ì°¨íŠ¸ ìº”ë²„ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                }

                // ìœ í˜•ë³„ ì°¨íŠ¸ ì´ˆê¸°í™”
                const typeCtx = document.getElementById('typeChart');
                if (typeCtx) {
                    // console.log('ğŸ• ìœ í˜•ë³„ ì°¨íŠ¸ ì´ˆê¸°í™” ì¤‘...');
                    
                    // ê¸°ì¡´ ì°¨íŠ¸ê°€ ìˆìœ¼ë©´ ì œê±°
                    if (typeChart) {
                        typeChart.destroy();
                    }
                    
                    typeChart = new Chart(typeCtx, {
                        type: 'doughnut',
                        data: {
                            labels: ['êµí™˜', 'ë°˜í’ˆ'],
                            datasets: [{
                                data: [0, 0],
                                backgroundColor: [
                                    '#3498db',  // êµí™˜ - íŒŒë‘
                                    '#e74c3c'   // ë°˜í’ˆ - ë¹¨ê°•
                                ],
                                borderColor: [
                                    '#2563eb',
                                    '#dc2626'
                                ],
                                borderWidth: 2,
                                hoverOffset: 15
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'ìœ í˜•ë³„ ë¶„í¬',
                                    font: {
                                        size: 16,
                                        weight: 'bold'
                                    },
                                    padding: 20
                                },
                                legend: {
                                    position: 'right',
                                    labels: {
                                        usePointStyle: true,
                                        padding: 15,
                                        font: {
                                            size: 12,
                                            weight: '600'
                                        },
                                        generateLabels: function(chart) {
                                            const original = Chart.defaults.plugins.legend.labels.generateLabels;
                                            const labels = original.call(this, chart);
                                            
                                            // ê° ë¼ë²¨ì— ê±´ìˆ˜ ì¶”ê°€
                                            labels.forEach((label, index) => {
                                                const value = chart.data.datasets[0].data[index] || 0;
                                                label.text = `${label.text} (${value}ê±´)`;
                                            });
                                            
                                            return labels;
                                        }
                                    }
                                },
                                tooltip: {
                                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                    titleFont: {
                                        size: 14,
                                        weight: 'bold'
                                    },
                                    bodyFont: {
                                        size: 13
                                    },
                                    cornerRadius: 8,
                                    displayColors: true,
                                    callbacks: {
                                        label: function(context) {
                                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                            const value = context.parsed;
                                            const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : 0;
                                            return `${context.label}: ${value}ê±´ (${percentage}%)`;
                                        }
                                    }
                                }
                            },
                            animation: {
                                animateRotate: true,
                                animateScale: true,
                                duration: 1500,
                                easing: 'easeInOutQuart'
                            }
                        }
                    });
                    
                    // console.log('âœ… ìœ í˜•ë³„ ì°¨íŠ¸ ì´ˆê¸°í™” ì™„ë£Œ');
                } else {
                    // console.error('âŒ ìœ í˜•ë³„ ì°¨íŠ¸ ìº”ë²„ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                }
                
                // console.log('âœ… ëª¨ë“  ì°¨íŠ¸ ì´ˆê¸°í™” ì™„ë£Œ');
                
            } catch (error) {
                // console.error('âŒ ì°¨íŠ¸ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                // console.error('âŒ ì˜¤ë¥˜ ìŠ¤íƒ:', error.stack);
                // showErrorMessage('ì°¨íŠ¸ ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì´ë¯¸ì§€ê°€ í¬í•¨ëœ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
        function downloadStatisticsExcel() {
            try {
                // console.log('ğŸ“¥ ì´ë¯¸ì§€ í¬í•¨ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ ì‹œì‘...');
                // showInfoMessage('ì°¨íŠ¸ì™€ ì¹´ë“œë¥¼ ì´ë¯¸ì§€ë¡œ ë³€í™˜ ì¤‘ì…ë‹ˆë‹¤...');
                
                // ì´ë¯¸ì§€ ìƒì„± ë° ë‹¤ìš´ë¡œë“œ ì‹¤í–‰
                generateImagesAndDownload();
                
            } catch (error) {
                // console.error('âŒ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨:', error);
                // showErrorMessage('ì—‘ì…€ ë‹¤ìš´ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì´ë¯¸ì§€ ìƒì„± ë° ë‹¤ìš´ë¡œë“œ ì‹¤í–‰
        async function generateImagesAndDownload() {
            try {
                const images = {};
                
                // ì¹´ë“œ ì„¹ì…˜ ì´ë¯¸ì§€ ìƒì„±
                const dashboardElement = document.querySelector('.dashboard');
                if (dashboardElement) {
                    // console.log('ğŸ“Š ì¹´ë“œ ì„¹ì…˜ ì´ë¯¸ì§€ ìƒì„± ì¤‘...');
                    const dashboardCanvas = await html2canvas(dashboardElement, {
                        backgroundColor: '#ffffff',
                        scale: 2,
                        useCORS: true,
                        allowTaint: true
                    });
                    images.dashboardImage = dashboardCanvas.toDataURL('image/png');
                }
                
                // íŠ¸ë Œë“œ ì°¨íŠ¸ ì´ë¯¸ì§€ ìƒì„±
                if (trendChart) {
                    // console.log('ğŸ“ˆ íŠ¸ë Œë“œ ì°¨íŠ¸ ì´ë¯¸ì§€ ìƒì„± ì¤‘...');
                    images.trendChartImage = trendChart.toBase64Image('image/png', 1);
                }
                
                // ìœ í˜•ë³„ ì°¨íŠ¸ ì´ë¯¸ì§€ ìƒì„±
                if (typeChart) {
                    // console.log('ğŸ• ìœ í˜•ë³„ ì°¨íŠ¸ ì´ë¯¸ì§€ ìƒì„± ì¤‘...');
                    images.typeChartImage = typeChart.toBase64Image('image/png', 1);
                }
                
                // console.log('âœ… ëª¨ë“  ì´ë¯¸ì§€ ìƒì„± ì™„ë£Œ');
                
                // íŒŒë¼ë¯¸í„° ì¤€ë¹„
                const params = {
                    startDate: document.getElementById('startDate').value,
                    endDate: document.getElementById('endDate').value,
                    ...images
                };
                
                // ì„œë²„ë¡œ POST ìš”ì²­ (ì´ë¯¸ì§€ í¬í•¨)
                await downloadExcelWithImages(params);
                
            } catch (error) {
                // console.error('âŒ ì´ë¯¸ì§€ ìƒì„± ì‹¤íŒ¨:', error);
                // showErrorMessage('ì´ë¯¸ì§€ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì´ë¯¸ì§€ë¥¼ í¬í•¨í•œ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ ìš”ì²­
        async function downloadExcelWithImages(params) {
            try {
                // showInfoMessage('ì´ë¯¸ì§€ê°€ í¬í•¨ëœ ì—‘ì…€ íŒŒì¼ì„ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...');
                
                const response = await fetch('/exchange/api/statistics/excel-with-images', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRF-TOKEN': window.csrfToken
                    },
                    body: JSON.stringify(params)
                });
                
                if (response.ok) {
                    // íŒŒì¼ ë‹¤ìš´ë¡œë“œ
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'êµí™˜ë°˜í’ˆí†µê³„_' + new Date().toISOString().slice(0, 10) + '.xlsx';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);
                    
                    // showSuccessMessage('ì´ë¯¸ì§€ê°€ í¬í•¨ëœ ì—‘ì…€ ë‹¤ìš´ë¡œë“œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
                } else {
                    throw new Error('ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜');
                }
                
            } catch (error) {
                // console.error('âŒ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨:', error);
                // showErrorMessage('ì—‘ì…€ ë‹¤ìš´ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ğŸ’¬ ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜ë“¤
        function showSuccessMessage(message) {
            // console.log('âœ… ì„±ê³µ:', message);
            // Toastr ë˜ëŠ” ì•Œë¦¼ ì‹œìŠ¤í…œì´ ìˆë‹¤ë©´ ì‚¬ìš©
            if (typeof toastr !== 'undefined') {
                toastr.success(message);
            } else {
                // ê°„ë‹¨í•œ ë¸Œë¼ìš°ì € ì•Œë¦¼
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: #2ecc71;
                    color: white;
                    padding: 15px 20px;
                    border-radius: 8px;
                    z-index: 10000;
                    font-weight: 600;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                `;
                notification.textContent = message;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.remove();
                }, 3000);
            }
        }
        
        function showErrorMessage(message) {
            // console.error('âŒ ì˜¤ë¥˜:', message);
            // Toastr ë˜ëŠ” ì•Œë¦¼ ì‹œìŠ¤í…œì´ ìˆë‹¤ë©´ ì‚¬ìš©
            if (typeof toastr !== 'undefined') {
                toastr.error(message);
            } else {
                // ê°„ë‹¨í•œ ë¸Œë¼ìš°ì € ì•Œë¦¼
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: #e74c3c;
                    color: white;
                    padding: 15px 20px;
                    border-radius: 8px;
                    z-index: 10000;
                    font-weight: 600;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                `;
                notification.textContent = message;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.remove();
                }, 5000);
            }
        }

        function showInfoMessage(message) {
            showToast(message, 'info');
        }

        // í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ
        function showToast(message, type = 'info') {
            const existingToast = document.querySelector('.toast-message');
            if (existingToast) {
                existingToast.remove();
            }
            
            const toast = document.createElement('div');
            toast.className = `toast-message toast-${type}`;
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 8px;
                color: white;
                font-weight: 600;
                z-index: 10000;
                max-width: 400px;
                animation: slideInRight 0.3s ease;
            `;
            
            switch (type) {
                case 'success':
                    toast.style.background = 'linear-gradient(135deg, #10b981, #059669)';
                    break;
                case 'error':
                    toast.style.background = 'linear-gradient(135deg, #ef4444, #dc2626)';
                    break;
                default:
                    toast.style.background = 'linear-gradient(135deg, #3b82f6, #2563eb)';
            }
            
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.style.animation = 'slideOutRight 0.3s ease';
                    setTimeout(() => toast.remove(), 300);
                }
            }, 3000);
        }
    </script>
    
    <!-- ì• ë‹ˆë©”ì´ì…˜ CSS -->
    <style>
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideOutRight {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
    </style>
</div>
</html> 