<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/main}">

<div layout:fragment="content">
    <style>
        /* í—¤ë” ì •ë ¬ ìŠ¤íƒ€ì¼ - list.htmlê³¼ ë™ì¼í•˜ê²Œ */
        #kt_app_toolbar {
            padding: 0.75rem 0 !important;
            min-height: auto !important;
        }
        
        #kt_app_toolbar_container {
            padding-left: 1rem !important;
            margin-left: 0 !important;
        }
        
        .page-title {
            margin: 0 !important;
            padding: 0 !important;
            margin-left: 0 !important;
        }
        
        .page-heading {
            margin: 0 !important;
        }
        
        .breadcrumb {
            margin: 0 !important;
            padding-top: 0.25rem !important;
        }
        
        #kt_app_content {
            padding-top: 2.5rem !important;
            margin-top: 0 !important;
        }
        
        /* ì»¨í…ì¸  ì˜ì—­ì€ ì›ë˜ íŒ¨ë”© ìœ ì§€ */
        #kt_app_content_container.app-container {
            padding-left: 1rem !important;
            padding-right: 1rem !important;
        }

        /* ì…ê¸ˆ ë“±ë¡ ì „ìš© ìŠ¤íƒ€ì¼ */
        .payment-container {
            padding: 1.5rem !important;
            width: 100%;
        }
        
        /* ì‹¬í”Œ í—¤ë” */
        .simple-header {
            padding: 1rem 0;
            border-bottom: 1px solid #e5e7eb;
        }
        
        /* í¼ ì¹´ë“œ */
        .form-card {
            background: white;
            border: 1px solid #eff2f5;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            margin-bottom: 2rem;
        }
        
        .form-card-header {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 1.5rem;
            border-bottom: 2px solid #e3e6f0;
        }
        
        .form-card-body {
            padding: 2rem;
        }
        
        /* ì…ë ¥ í•„ë“œ ìŠ¤íƒ€ì¼ */
        .form-label {
            font-weight: 600;
            color: #3f4254;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }
        
        .form-control,
        .form-select {
            border: 2px solid #e4e6ef;
            border-radius: 8px;
            padding: 0.8rem 1rem;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        
        .form-control:focus,
        .form-select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
            transform: translateY(-1px);
        }
        
        /* í•„ìˆ˜ í•„ë“œ í‘œì‹œ */
        .required::after {
            content: ' *';
            color: #e74c3c;
            font-weight: bold;
        }
        
        /* ë¸Œëœë“œ ì„ íƒ ë²„íŠ¼ - ì‹¬í”Œ ìŠ¤íƒ€ì¼ */
        .brand-selector {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .brand-btn {
            flex: 1;
            padding: 0.7rem 1rem;
            border: 1px solid #ddd;
            background: white;
            border-radius: 6px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .brand-btn:hover {
            border-color: #007bff;
            background: #f8f9fa;
        }
        
        .brand-btn.active {
            border-color: #007bff;
            background: #007bff;
            color: white;
        }
        
        .brand-btn .brand-name {
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        /* ì…ë ¥ ê·¸ë£¹ ìŠ¤íƒ€ì¼ */
        .input-group {
            position: relative;
            margin-bottom: 1.5rem;
        }
        
        .input-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #6c757d;
            z-index: 3;
        }
        
        .input-group .form-control,
        .input-group .form-select {
            padding-left: 3rem;
        }
        
        /* ê¸ˆì•¡ ì…ë ¥ ìŠ¤íƒ€ì¼ */
        .amount-input {
            font-size: 1.2rem;
            font-weight: 600;
            text-align: right;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }
        
        /* ë‚ ì§œ/ì‹œê°„ ì…ë ¥ ìŠ¤íƒ€ì¼ */
        .datetime-inputs {
            display: flex;
            gap: 1rem;
        }
        
        .datetime-inputs .form-control {
            flex: 1;
        }
        
        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn-register {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            border: none;
            padding: 1rem 2rem;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 10px;
            color: white;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .btn-register:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.4);
        }
        
        .btn-register::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }
        
        .btn-register:hover::before {
            left: 100%;
        }
        
        .btn-reset {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            border: none;
            padding: 1rem 2rem;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 10px;
            color: white;
            transition: all 0.3s ease;
        }
        
        .btn-reset:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(108, 117, 125, 0.4);
        }
        
        /* ìµœê·¼ ì…ê¸ˆ ë‚´ì—­ ì¹´ë“œ */
        .recent-payments {
            background: white;
            border: 1px solid #eff2f5;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }
        
        .recent-payments-header {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 1.5rem;
            border-bottom: 2px solid #e3e6f0;
        }
        
        .recent-payments-body {
            padding: 1.5rem;
        }
        
        .payment-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 18px;
            border: 1px solid #e1e5e9;
            border-radius: 10px;
            margin-bottom: 10px;
            background: white;
            transition: all 0.2s ease;
        }
        
        .payment-item:hover {
            border-color: #009ef7;
            box-shadow: 0 3px 12px rgba(0, 158, 247, 0.15);
            transform: translateY(-1px);
        }
        
        .payment-info {
            flex: 1;
        }
        
        .payment-brand-customer {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }
        
        .brand-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .brand-badge.renoma {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .brand-badge.coralique {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        
        .customer-name {
            font-weight: 600;
            color: #181c32;
            font-size: 14px;
        }
        
        .payment-customer {
            font-weight: 600;
            color: #3f4254;
            margin-bottom: 0.2rem;
        }
        
        .payment-details {
            font-size: 13px;
            color: #7e8299;
        }
        
        .payment-bank-time {
            display: flex;
            align-items: center;
            margin-bottom: 4px;
        }
        
        .payment-date {
            display: flex;
            align-items: center;
        }
        
        .payment-amount {
            font-weight: 700;
            font-size: 16px;
            color: #181c32;
            text-align: right;
            margin-bottom: 6px;
        }
        
        .payment-status {
            font-size: 11px;
            padding: 3px 10px;
            border-radius: 6px;
            text-align: center;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }
        
        .status-pending {
            background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
            color: #2d3436;
        }
        
        .status-mapped {
            background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);
            color: white;
        }
        
        /* ë„ì›€ë§ íˆ´íŒ */
        .help-tooltip {
            position: relative;
            display: inline-block;
            margin-left: 0.5rem;
            cursor: help;
        }
        
        .help-tooltip .tooltip-text {
            visibility: hidden;
            width: 200px;
            background: #333;
            color: white;
            text-align: center;
            border-radius: 6px;
            padding: 0.5rem;
            position: absolute;
            z-index: 1000;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.8rem;
        }
        
        .help-tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        
        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .payment-container {
                padding: 1rem !important;
            }
            
            .brand-selector {
                flex-direction: column;
            }
            
            .datetime-inputs {
                flex-direction: column;
            }
            
            .d-flex.gap-3 {
                flex-direction: column;
                gap: 1rem !important;
            }
            
            .btn-register,
            .btn-reset {
                width: 100%;
                margin-bottom: 0.5rem;
            }
        }
        
        /* ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .form-card,
        .recent-payments {
            animation: slideInUp 0.6s ease-out;
        }
        
        .recent-payments {
            animation-delay: 0.1s;
        }
        
        /* ë¡œë”© ìŠ¤í”¼ë„ˆ */
        .loading-spinner {
            display: none;
            text-align: center;
            padding: 2rem;
        }
        
        .spinner-border {
            width: 2rem;
            height: 2rem;
            border-width: 0.2em;
        }

        /* ê²€ìƒ‰ í•„í„° ìŠ¤íƒ€ì¼ */
        .search-filters {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 1px solid #e3e6f0;
            border-radius: 10px;
            padding: 1rem;
        }
        
        .search-filters .form-control,
        .search-filters .form-select {
            border: 1px solid #d1d3e2;
            border-radius: 6px;
            font-size: 0.8rem;
            padding: 0.4rem 0.6rem;
        }
        
        .search-filters .form-control:focus,
        .search-filters .form-select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.1rem rgba(102, 126, 234, 0.25);
        }
        
        .search-filters .btn {
            font-size: 0.8rem;
            padding: 0.4rem 0.8rem;
            border-radius: 6px;
        }
        
        /* ê²€ìƒ‰ í†µê³„ */
        .search-stats {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 0.5rem 0.8rem;
            text-align: center;
        }
        
        /* í˜ì´ì§• ìŠ¤íƒ€ì¼ */
        .pagination-container {
            border-top: 1px solid #e9ecef;
            padding-top: 1rem;
        }
        
        .pagination-sm .page-link {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
        }
        
        .pagination-sm .page-item.active .page-link {
            background-color: #667eea;
            border-color: #667eea;
        }
        
        .pagination-sm .page-link:hover {
            background-color: #f8f9fa;
            border-color: #667eea;
            color: #667eea;
        }
        
        /* ì…ê¸ˆ ë‚´ì—­ ë¦¬ìŠ¤íŠ¸ ê°œì„  */
        #paymentList {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
        }
        
        #paymentList .payment-item {
            margin-bottom: 8px;
            border-radius: 8px;
            font-size: 0.85rem;
        }
        
        #paymentList .payment-item:last-child {
            margin-bottom: 0;
        }
        
        /* ì‚¬ì´íŠ¸ëª…ê³¼ ë¹„ê³  ìŠ¤íƒ€ì¼ */
        .payment-site,
        .payment-notes {
            font-size: 0.75rem;
            color: #6c757d;
            margin-top: 2px;
        }
        
        .payment-notes {
            font-style: italic;
        }
        
        /* ë¹ˆ ìƒíƒœ ìŠ¤íƒ€ì¼ */
        .empty-state {
            text-align: center;
            padding: 2rem 1rem;
            color: #6c757d;
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
        
        /* ë°˜ì‘í˜• ê²€ìƒ‰ í•„í„° */
        @media (max-width: 768px) {
            .search-filters .col-6 {
                flex: 0 0 100%;
                max-width: 100%;
            }
            
            .search-filters .btn {
                width: 100%;
                margin-bottom: 0.5rem;
            }
        }
    </style>

    <div class="app-main flex-column flex-row-fluid" id="kt_app_main">
        <!--begin::Content wrapper-->
        <div class="d-flex flex-column flex-column-fluid">
            <!--begin::Toolbar-->
            <div id="kt_app_toolbar" class="app-toolbar py-3 py-lg-6">
                <!--begin::Toolbar container-->
                <div id="kt_app_toolbar_container" class="app-container container-xxl d-flex flex-stack">
                    <!--begin::Page title-->
                    <div class="page-title d-flex flex-column justify-content-center flex-wrap me-3">
                        <!--begin::Title-->
                        <h1 class="page-heading d-flex text-gray-900 fw-bold fs-3 flex-column justify-content-center my-0">ë°°ì†¡ë¹„ ì…ê¸ˆ ë“±ë¡</h1>
                        <!--end::Title-->
                        <!--begin::Breadcrumb-->
                        <ul class="breadcrumb breadcrumb-separatorless fw-semibold fs-7 my-0 pt-1">
                            <!--begin::Item-->
                            <li class="breadcrumb-item text-muted">
                                <a href="/main" class="text-muted text-hover-primary">Home</a>
                            </li>
                            <!--end::Item-->
                            <!--begin::Item-->
                            <li class="breadcrumb-item">
                                <span class="bullet bg-gray-500 w-5px h-2px"></span>
                            </li>
                            <!--end::Item-->
                            <!--begin::Item-->
                            <li class="breadcrumb-item text-muted">ì…ê¸ˆ ê´€ë¦¬</li>
                            <!--end::Item-->
                            <!--begin::Item-->
                            <li class="breadcrumb-item">
                                <span class="bullet bg-gray-500 w-5px h-2px"></span>
                            </li>
                            <!--end::Item-->
                            <!--begin::Item-->
                            <li class="breadcrumb-item text-muted">ë°°ì†¡ë¹„ ì…ê¸ˆ ë“±ë¡</li>
                            <!--end::Item-->
                        </ul>
                        <!--end::Breadcrumb-->
                    </div>
                    <!--end::Page title-->
                    <!--begin::Actions-->
                    <div class="d-flex align-items-center gap-2 gap-lg-3">
                        <!-- ì•¡ì…˜ ë²„íŠ¼ë“¤ -->
                    </div>
                    <!--end::Actions-->
                </div>
                <!--end::Toolbar container-->
            </div>
            <!--end::Toolbar-->
            <!--begin::Content-->
            <div id="kt_app_content" class="app-content flex-column-fluid">
                <!--begin::Content container-->
                <div id="kt_app_content_container" class="app-container container-fluid px-2">

                    <div class="payment-container">
                        <!-- í˜ì´ì§€ í—¤ë” - ì‹¬í”Œ ë²„ì „ -->
                        <div class="simple-header mb-4">
                            <div class="d-flex justify-content-between align-items-center">
                                <h2 class="text-dark fw-bold mb-0">ğŸ’³ ë°°ì†¡ë¹„ ì…ê¸ˆ ë“±ë¡</h2>
                                <div class="text-end">
                                    <small class="text-muted">ì˜¤ëŠ˜ ë“±ë¡</small>
                                    <h4 class="text-primary fw-bold mb-0" id="todayCount" th:text="${todayCount != null ? todayCount + 'ê±´' : '0ê±´'}">0ê±´</h4>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <!-- ì…ê¸ˆ ë“±ë¡ í¼ -->
                            <div class="col-lg-6">
                                <div class="form-card">
                                    <div class="form-card-header">
                                        <h4 class="mb-0">
                                            <i class="ki-duotone ki-bill fs-2 me-2"></i>
                                            ì…ê¸ˆ ì •ë³´ ë“±ë¡
                                        </h4>
                                        <p class="text-muted mb-0 mt-1">ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
                                    </div>
                                    <div class="form-card-body">
                                        <form id="paymentRegisterForm">
                                            <!-- ë¸Œëœë“œ ì„ íƒ -->
                                            <div class="mb-4">
                                                <label class="form-label required">ë¸Œëœë“œ</label>
                                                <div class="brand-selector">
                                                    <div class="brand-btn active" data-brand="RENOMA" onclick="selectBrand('RENOMA')">
                                                        <span class="brand-name">RENOMA</span>
                                                    </div>
                                                    <div class="brand-btn" data-brand="CORALIQUE" onclick="selectBrand('CORALIQUE')">
                                                        <span class="brand-name">CORALIQUE</span>
                                                    </div>
                                                </div>
                                                <input type="hidden" name="brand" id="selectedBrand" value="RENOMA" required>
                                            </div>

                                            <div class="row">
                                                <!-- ì‚¬ì´íŠ¸ëª… -->
                                                <div class="col-md-6">
                                                    <div class="input-group">
                                                        <label class="form-label">ì‚¬ì´íŠ¸ëª…</label>
                                                        <i class="ki-duotone ki-shop input-icon fs-4"></i>
                                                        <select name="siteName" class="form-select" id="siteName">
                                                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                                            <!-- ë ˆë…¸ë§ˆ ì‚¬ì´íŠ¸ë“¤ -->
                                                            <option value="29CM-ë ˆë…¸ë§ˆ">29CM-ë ˆë…¸ë§ˆ</option>
                                                            <option value="ë¡¯ë°ì˜¨-ë ˆë…¸ë§ˆ">ë¡¯ë°ì˜¨-ë ˆë…¸ë§ˆ</option>
                                                            <option value="ë¬´ì‹ ì‚¬-ë ˆë…¸ë§ˆ">ë¬´ì‹ ì‚¬-ë ˆë…¸ë§ˆ</option>
                                                            <option value="ìŠ¤í† ì–´íŒœ-ë ˆë…¸ë§ˆ">ìŠ¤í† ì–´íŒœ-ë ˆë…¸ë§ˆ</option>
                                                            <option value="ìì‚¬ëª°-ë ˆë…¸ë§ˆ">ìì‚¬ëª°-ë ˆë…¸ë§ˆ</option>
                                                            <option value="ì§€ê·¸ì¬ê·¸-ë ˆë…¸ë§ˆ">ì§€ê·¸ì¬ê·¸-ë ˆë…¸ë§ˆ</option>
                                                            <option value="ë¸Œëœë””-ë ˆë…¸ë§ˆ">ë¸Œëœë””-ë ˆë…¸ë§ˆ</option>
                                                            <option value="íŒ¨ì…˜ëª¨ì•„-ë ˆë…¸ë§ˆ">íŒ¨ì…˜ëª¨ì•„-ë ˆë…¸ë§ˆ</option>
                                                            <option value="í•˜í”Œê¸€ë¦¼-ë ˆë…¸ë§ˆ">í•˜í”Œê¸€ë¦¼-ë ˆë…¸ë§ˆ</option>
                                                            <option value="SSG-ë ˆë…¸ë§ˆ">SSG-ë ˆë…¸ë§ˆ</option>
                                                            <option value="Wì»¨ì…‰-ë ˆë…¸ë§ˆ">Wì»¨ì…‰-ë ˆë…¸ë§ˆ</option>
                                                            <!-- ì½”ë„ë¦¬í¬ ì‚¬ì´íŠ¸ë“¤ -->
                                                            <option value="29CM-ì½”ë„ë¦¬í¬">29CM-ì½”ë„ë¦¬í¬</option>
                                                            <option value="ë¬´ì‹ ì‚¬-ì½”ë„ë¦¬í¬">ë¬´ì‹ ì‚¬-ì½”ë„ë¦¬í¬</option>
                                                            <option value="ìì‚¬ëª°-ì½”ë„ë¦¬í¬">ìì‚¬ëª°-ì½”ë„ë¦¬í¬</option>
                                                            <option value="ì§€ê·¸ì¬ê·¸-ì½”ë„ë¦¬í¬">ì§€ê·¸ì¬ê·¸-ì½”ë„ë¦¬í¬</option>
                                                            <option value="CJì˜¤ì‡¼í•‘-ì½”ë„ë¦¬í¬">CJì˜¤ì‡¼í•‘-ì½”ë„ë¦¬í¬</option>
                                                            <option value="SSG-ì½”ë„ë¦¬í¬">SSG-ì½”ë„ë¦¬í¬</option>
                                                            <option value="Wì»¨ì…‰-ì½”ë„ë¦¬í¬">Wì»¨ì…‰-ì½”ë„ë¦¬í¬</option>
                                                            <option value="EQL-ì½”ë„ë¦¬í¬">EQL-ì½”ë„ë¦¬í¬</option>
                                                            <option value="LFëª°-ì½”ë„ë¦¬í¬">LFëª°-ì½”ë„ë¦¬í¬</option>
                                                            <option value="ìŠ¤í† ì–´íŒœ-ì½”ë„ë¦¬í¬">ìŠ¤í† ì–´íŒœ-ì½”ë„ë¦¬í¬</option>
                                                        </select>
                                                    </div>
                                                </div>

                                                <!-- ì€í–‰ëª… -->
                                                <div class="col-md-6">
                                                    <div class="input-group">
                                                        <label class="form-label required">ì€í–‰ëª…</label>
                                                        <i class="ki-duotone ki-bank input-icon fs-4"></i>
                                                        <select name="bankName" class="form-select" id="bankName" required>
                                                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                                            <option value="ìš°ë¦¬ì€í–‰">ìš°ë¦¬ì€í–‰</option>
                                                            <option value="í•˜ë‚˜ì€í–‰">í•˜ë‚˜ì€í–‰</option>
                                                            <option value="êµ­ë¯¼ì€í–‰">êµ­ë¯¼ì€í–‰</option>
                                                            <option value="ì‹ í•œì€í–‰">ì‹ í•œì€í–‰</option>
                                                            <option value="ë†í˜‘ì€í–‰">ë†í˜‘ì€í–‰</option>
                                                            <option value="ê¸°ì—…ì€í–‰">ê¸°ì—…ì€í–‰</option>
                                                            <option value="ì‹ í˜‘">ì‹ í˜‘</option>
                                                            <option value="ìš°ì²´êµ­">ìš°ì²´êµ­</option>
                                                            <option value="ìƒˆë§ˆì„ê¸ˆê³ ">ìƒˆë§ˆì„ê¸ˆê³ </option>
                                                            <option value="ê²½ë‚¨ì€í–‰">ê²½ë‚¨ì€í–‰</option>
                                                            <option value="ë¶€ì‚°ì€í–‰">ë¶€ì‚°ì€í–‰</option>
                                                            <option value="ëŒ€êµ¬ì€í–‰">ëŒ€êµ¬ì€í–‰</option>
                                                            <option value="ê´‘ì£¼ì€í–‰">ê´‘ì£¼ì€í–‰</option>
                                                            <option value="ì „ë¶ì€í–‰">ì „ë¶ì€í–‰</option>
                                                            <option value="ì œì£¼ì€í–‰">ì œì£¼ì€í–‰</option>
                                                            <option value="ìˆ˜í˜‘ì€í–‰">ìˆ˜í˜‘ì€í–‰</option>
                                                            <option value="ì‚°ì—…ì€í–‰">ì‚°ì—…ì€í–‰</option>
                                                            <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- ê³ ê°ëª…ê³¼ ì…ê¸ˆ ê¸ˆì•¡ì„ í•œ ì¤„ë¡œ -->
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="input-group">
                                                        <label class="form-label required">ê³ ê°ëª…</label>
                                                        <i class="ki-duotone ki-user input-icon fs-4"></i>
                                                        <input type="text" name="customerName" class="form-control" placeholder="ì…ê¸ˆìëª…ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                                                    </div>
                                                </div>
                                                
                                                <div class="col-md-6">
                                                    <div class="input-group">
                                                        <label class="form-label required">ì…ê¸ˆ ê¸ˆì•¡</label>
                                                        <i class="ki-duotone ki-dollar input-icon fs-4"></i>
                                                        <input type="number" name="amount" class="form-control amount-input" placeholder="0" min="0" step="1000" required>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- ì…ê¸ˆ ì¼ì‹œ -->
                                            <div class="mb-3">
                                                <label class="form-label required">ì…ê¸ˆ ì¼ì‹œ</label>
                                                <div class="datetime-inputs">
                                                    <input type="date" name="paymentDate" class="form-control" required>
                                                    <input type="time" name="paymentTime" class="form-control" required>
                                                </div>
                                            </div>

                                            <!-- ë“±ë¡ì ì •ë³´ -->
                                            <div class="input-group">
                                                <label class="form-label">ë“±ë¡ì</label>
                                                <i class="ki-duotone ki-profile-user input-icon fs-4"></i>
                                                <input type="text" class="form-control" 
                                                       th:value="${currentUser}" 
                                                       readonly 
                                                       style="background-color: #f8f9fa; cursor: default;"
                                                       placeholder="ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤">
                                            </div>

                                            <!-- ë¹„ê³  -->
                                            <div class="input-group">
                                                <label class="form-label">ë¹„ê³ </label>
                                                <i class="ki-duotone ki-notepad input-icon fs-4"></i>
                                                <textarea name="notes" class="form-control" rows="3" placeholder="ì¶”ê°€ ì •ë³´ë‚˜ íŠ¹ì´ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                                            </div>

                                            <!-- ë²„íŠ¼ ê·¸ë£¹ -->
                                            <div class="d-flex justify-content-end gap-3 mt-4">
                                                <button type="button" class="btn btn-reset" onclick="resetForm()">
                                                    <i class="ki-duotone ki-arrow-clockwise fs-4 me-2"></i>
                                                    ì´ˆê¸°í™”
                                                </button>
                                                <button type="submit" class="btn btn-register">
                                                    <i class="ki-duotone ki-check fs-4 me-2"></i>
                                                    ë“±ë¡í•˜ê¸°
                                                </button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>

                            <!-- ì…ê¸ˆ ë‚´ì—­ ì¡°íšŒ - í™•ì¥ëœ ë²„ì „ -->
                            <div class="col-lg-6">
                                <div class="recent-payments">
                                    <div class="recent-payments-header">
                                        <h5 class="mb-0">
                                            <i class="ki-duotone ki-search-list fs-2 me-2"></i>
                                            ì…ê¸ˆ ë‚´ì—­ ì¡°íšŒ
                                        </h5>
                                        <p class="text-muted mb-0 mt-1">ê²€ìƒ‰ ë° ìµœì‹  ì…ê¸ˆ ë‚´ì—­</p>
                                    </div>
                                    <div class="recent-payments-body">
                                        <!-- ê²€ìƒ‰ í•„í„° -->
                                        <div class="search-filters mb-3">
                                            <div class="row g-2">
                                                <div class="col-12">
                                                    <input type="text" id="searchKeyword" class="form-control form-control-sm" placeholder="ê³ ê°ëª…, ì€í–‰ëª… ê²€ìƒ‰...">
                                                </div>
                                                <div class="col-6">
                                                    <select id="searchBrand" class="form-select form-select-sm">
                                                        <option value="">ì „ì²´ ë¸Œëœë“œ</option>
                                                        <option value="RENOMA">ë ˆë…¸ë§ˆ</option>
                                                        <option value="CORALIQUE">ì½”ë„ë¦¬í¬</option>
                                                    </select>
                                                </div>
                                                <div class="col-6">
                                                    <select id="searchStatus" class="form-select form-select-sm">
                                                        <option value="">ì „ì²´ ìƒíƒœ</option>
                                                        <option value="PENDING">ë¯¸ë§¤í•‘</option>
                                                        <option value="MAPPED">ë§¤í•‘ì™„ë£Œ</option>
                                                    </select>
                                                </div>
                                                <div class="col-6">
                                                    <input type="date" id="searchStartDate" class="form-control form-control-sm">
                                                </div>
                                                <div class="col-6">
                                                    <input type="date" id="searchEndDate" class="form-control form-control-sm">
                                                </div>
                                                <div class="col-12 text-center">
                                                    <button type="button" class="btn btn-primary btn-sm me-2" onclick="searchPayments()">
                                                        <i class="ki-duotone ki-magnifier fs-6 me-1"></i>ê²€ìƒ‰
                                                    </button>
                                                    <button type="button" class="btn btn-secondary btn-sm" onclick="resetSearch()">
                                                        <i class="ki-duotone ki-arrow-clockwise fs-6 me-1"></i>ì´ˆê¸°í™”
                                                    </button>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- ê²°ê³¼ í†µê³„ -->
                                        <div class="search-stats mb-2">
                                            <small class="text-muted">
                                                <span id="totalCount">0</span>ê±´ ì¤‘ 
                                                <span id="currentRange">0</span> í‘œì‹œ
                                            </small>
                                        </div>

                                        <!-- ì…ê¸ˆ ë‚´ì—­ ë¦¬ìŠ¤íŠ¸ -->
                                        <div id="paymentList" style="max-height: 500px; overflow-y: auto;">
                                            <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë˜ëŠ” ë¦¬ìŠ¤íŠ¸ -->
                                        </div>
                                        
                                        <!-- ë¡œë”© ìŠ¤í”¼ë„ˆ -->
                                        <div id="loadingSpinner" class="loading-spinner">
                                            <div class="spinner-border text-primary" role="status">
                                                <span class="visually-hidden">ë¡œë”© ì¤‘...</span>
                                            </div>
                                            <p class="mt-2 text-muted">ì…ê¸ˆ ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                                        </div>

                                        <!-- í˜ì´ì§• -->
                                        <div class="pagination-container mt-3">
                                            <nav aria-label="ì…ê¸ˆ ë‚´ì—­ í˜ì´ì§•">
                                                <ul class="pagination pagination-sm justify-content-center" id="paginationList">
                                                    <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë˜ëŠ” í˜ì´ì§• -->
                                                </ul>
                                            </nav>
                                        </div>

                                        <!-- ì „ì²´ ë‚´ì—­ ë³´ê¸° ë§í¬ -->
                                        <!--
                                        <div class="text-center mt-3">
                                            <a href="/payment/list" class="btn btn-light btn-sm">
                                                ì „ì²´ ë‚´ì—­ ê´€ë¦¬
                                                <i class="ki-duotone ki-arrow-right fs-6 ms-1"></i>
                                            </a>
                                        </div>
                                        -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <!--end::Content container-->
            </div>
            <!--end::Content-->
        </div>
        <!--end::Content wrapper-->
    </div>
    <!--end::App main-->

    <!-- JavaScript -->
    <script th:inline="javascript">
        // CSRF í† í° ì„¤ì •
        window.csrfToken = /*[[${_csrf != null ? _csrf.token : ''}]]*/ '';
        window.csrfHeader = /*[[${_csrf != null ? _csrf.headerName : 'X-CSRF-TOKEN'}]]*/ 'X-CSRF-TOKEN';
        
        // ì „ì—­ ë³€ìˆ˜
        let currentPage = 0;
        let pageSize = 10;
        let totalPages = 0;
        let totalElements = 0;

        document.addEventListener('DOMContentLoaded', function() {
            // í˜„ì¬ ë‚ ì§œ/ì‹œê°„ ì„¤ì •
            setCurrentDateTime();
            
            // ë¸Œëœë“œ ë³€ê²½ ì‹œ ê¸°ë³¸ ì€í–‰ ì„¤ì •
            selectBrand('RENOMA');
            
            // í¼ ì œì¶œ ì´ë²¤íŠ¸
            document.getElementById('paymentRegisterForm').addEventListener('submit', handleFormSubmit);
            
            // ê²€ìƒ‰ í•„í„° ì´ë²¤íŠ¸ ì„¤ì •
            setupSearchEvents();
            
            // ì´ˆê¸° ë°ì´í„° ë¡œë“œ
            loadPaymentList();
        });

        // ê²€ìƒ‰ ì´ë²¤íŠ¸ ì„¤ì •
        function setupSearchEvents() {
            // ì—”í„°í‚¤ë¡œ ê²€ìƒ‰
            document.getElementById('searchKeyword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchPayments();
                }
            });
            
            // ë‚ ì§œ í•„ë“œ ê¸°ë³¸ê°’ ì„¤ì • (ìµœê·¼ 1ê°œì›”)
            const endDate = new Date();
            const startDate = new Date();
            startDate.setMonth(startDate.getMonth() - 1);
            
            document.getElementById('searchEndDate').value = endDate.toISOString().split('T')[0];
            document.getElementById('searchStartDate').value = startDate.toISOString().split('T')[0];
        }

        // ë¸Œëœë“œ ì„ íƒ (ì…ê¸ˆ ë“±ë¡ í¼ ì „ìš©)
        function selectBrand(brand) {
            // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.brand-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-brand="${brand}"]`).classList.add('active');
            
            // íˆë“  í•„ë“œ ì—…ë°ì´íŠ¸
            document.getElementById('selectedBrand').value = brand;
            
            // ê¸°ë³¸ ì€í–‰ ì„¤ì •
            const defaultBanks = {
                'RENOMA': 'ìš°ë¦¬ì€í–‰',
                'CORALIQUE': 'í•˜ë‚˜ì€í–‰'
            };
            
            document.getElementById('bankName').value = defaultBanks[brand] || '';
            
            // ì‚¬ì´íŠ¸ëª… í•„í„°ë§
            filterSiteOptions(brand);
            
            // ì£¼ì˜: ì…ê¸ˆë‚´ì—­ ì¡°íšŒì—ëŠ” ì˜í–¥ì„ ì£¼ì§€ ì•ŠìŒ
        }

        // ë¸Œëœë“œì— ë”°ë¥¸ ì‚¬ì´íŠ¸ëª… ì˜µì…˜ í•„í„°ë§
        function filterSiteOptions(selectedBrand) {
            const siteSelect = document.getElementById('siteName');
            
            // ëª¨ë“  ì‚¬ì´íŠ¸ ì˜µì…˜ ë°ì´í„° (í•œë²ˆë§Œ ì •ì˜)
            const allSiteOptions = {
                'RENOMA': [
                    '29CM-ë ˆë…¸ë§ˆ', 'ë¡¯ë°ì˜¨-ë ˆë…¸ë§ˆ', 'ë¬´ì‹ ì‚¬-ë ˆë…¸ë§ˆ', 'ìŠ¤í† ì–´íŒœ-ë ˆë…¸ë§ˆ', 
                    'ìì‚¬ëª°-ë ˆë…¸ë§ˆ', 'ì§€ê·¸ì¬ê·¸-ë ˆë…¸ë§ˆ', 'ë¸Œëœë””-ë ˆë…¸ë§ˆ', 'íŒ¨ì…˜ëª¨ì•„-ë ˆë…¸ë§ˆ', 
                    'í•˜í”Œê¸€ë¦¼-ë ˆë…¸ë§ˆ', 'SSG-ë ˆë…¸ë§ˆ', 'Wì»¨ì…‰-ë ˆë…¸ë§ˆ'
                ],
                'CORALIQUE': [
                    '29CM-ì½”ë„ë¦¬í¬', 'ë¬´ì‹ ì‚¬-ì½”ë„ë¦¬í¬', 'ìì‚¬ëª°-ì½”ë„ë¦¬í¬', 'ì§€ê·¸ì¬ê·¸-ì½”ë„ë¦¬í¬', 
                    'CJì˜¤ì‡¼í•‘-ì½”ë„ë¦¬í¬', 'SSG-ì½”ë„ë¦¬í¬', 'Wì»¨ì…‰-ì½”ë„ë¦¬í¬', 'EQL-ì½”ë„ë¦¬í¬', 
                    'LFëª°-ì½”ë„ë¦¬í¬', 'ìŠ¤í† ì–´íŒœ-ì½”ë„ë¦¬í¬'
                ]
            };
            
            // ê¸°ì¡´ ì˜µì…˜ ëª¨ë‘ ì œê±° (ì²« ë²ˆì§¸ "ì„ íƒí•˜ì„¸ìš”" ì œì™¸)
            const options = siteSelect.querySelectorAll('option');
            for (let i = options.length - 1; i > 0; i--) {
                options[i].remove();
            }
            
            // ì„ íƒëœ ë¸Œëœë“œì˜ ì‚¬ì´íŠ¸ë“¤ë§Œ ì¶”ê°€
            const sitesForBrand = allSiteOptions[selectedBrand] || [];
            sitesForBrand.forEach(site => {
                const option = document.createElement('option');
                option.value = site;
                option.textContent = site;
                siteSelect.appendChild(option);
            });
            
            // ì‚¬ì´íŠ¸ëª… ì„ íƒ ì´ˆê¸°í™”
            siteSelect.value = '';
        }

        // í˜„ì¬ ë‚ ì§œ/ì‹œê°„ ì„¤ì •
        function setCurrentDateTime() {
            const now = new Date();
            const date = now.toISOString().split('T')[0];
            const time = now.toTimeString().slice(0, 5);
            
            document.querySelector('input[name="paymentDate"]').value = date;
            document.querySelector('input[name="paymentTime"]').value = time;
        }

        // í¼ ì œì¶œ ì²˜ë¦¬
        function handleFormSubmit(event) {
            event.preventDefault();
            
            // ë¡œë”© í‘œì‹œ
            const submitBtn = document.querySelector('.btn-register');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="spinner-border spinner-border-sm me-2"></i>ë“±ë¡ ì¤‘...';
            submitBtn.disabled = true;
            
            // í¼ ë°ì´í„° ìˆ˜ì§‘
            const formData = new FormData(event.target);
            
            // ë‚ ì§œì™€ ì‹œê°„ì„ í•©ì³ì„œ timestampë¡œ ë³€í™˜
            const paymentDate = formData.get('paymentDate');
            const paymentTime = formData.get('paymentTime');
            const paymentDateTime = `${paymentDate}T${paymentTime}:00`;
            
            // ì„œë²„ë¡œ ì „ì†¡í•  ë°ì´í„° ì¤€ë¹„
            const submitData = {
                brand: formData.get('brand'),
                siteName: formData.get('siteName'),
                bankName: formData.get('bankName'),
                customerName: formData.get('customerName'),
                amount: parseInt(formData.get('amount')),
                paymentDate: paymentDateTime,
                notes: formData.get('notes') || ''
            };
            
            console.log('ì œì¶œ ë°ì´í„°:', submitData);
            
            // API í˜¸ì¶œ
            fetch('/payment/api/register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    [window.csrfHeader]: window.csrfToken
                },
                body: JSON.stringify(submitData)
            })
            .then(response => response.json())
            .then(data => {
                console.log('ì„œë²„ ì‘ë‹µ:', data);
                
                if (data.success) {
                    // ì„±ê³µ ë©”ì‹œì§€
                    showSuccessMessage('ì…ê¸ˆ ì •ë³´ê°€ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    
                    // í¼ ì´ˆê¸°í™”
                    resetForm();
                    
                    // ìµœê·¼ ì…ê¸ˆ ë‚´ì—­ ìƒˆë¡œê³ ì¹¨
                    refreshRecentPayments();
                    
                    // ì˜¤ëŠ˜ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
                    updateTodayCount();
                } else {
                    showErrorMessage(data.message || 'ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            })
            .catch(error => {
                console.error('ë“±ë¡ ì˜¤ë¥˜:', error);
                showErrorMessage('ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            })
            .finally(() => {
                // ë²„íŠ¼ ë³µì›
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            });
        }

        // í¼ ì´ˆê¸°í™”
        function resetForm() {
            document.getElementById('paymentRegisterForm').reset();
            setCurrentDateTime();
            selectBrand('RENOMA');
        }

        // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
        function showSuccessMessage(message) {
            showToast(message, 'success', 'ki-check-circle');
        }
        
        // ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ
        function showErrorMessage(message) {
            showToast(message, 'error', 'ki-cross-circle');
        }
        
        // í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ ê³µí†µ í•¨ìˆ˜
        function showToast(message, type, icon) {
            const toastColor = type === 'success' ? '#28a745' : '#dc3545';
            const toastBg = type === 'success' ? 'linear-gradient(135deg, #28a745, #20c997)' : 'linear-gradient(135deg, #dc3545, #c82333)';
            
            const alertHtml = `
                <div class="alert alert-${type === 'success' ? 'success' : 'danger'} alert-dismissible fade show position-fixed" 
                     style="top: 20px; right: 20px; z-index: 9999; min-width: 300px; background: ${toastBg}; border: none; color: white;">
                    <i class="ki-duotone ${icon} fs-2 me-2"></i>
                    ${message}
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="alert"></button>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', alertHtml);
            
            // 5ì´ˆ í›„ ìë™ ì œê±°
            setTimeout(() => {
                const alert = document.querySelector('.alert:last-child');
                if (alert) {
                    alert.remove();
                }
            }, 5000);
        }
        
        // ê²€ìƒ‰ ì‹¤í–‰
        function searchPayments() {
            currentPage = 0; // ê²€ìƒ‰ ì‹œ ì²« í˜ì´ì§€ë¡œ ì´ë™
            loadPaymentList();
        }

        // ê²€ìƒ‰ ì´ˆê¸°í™”
        function resetSearch() {
            document.getElementById('searchKeyword').value = '';
            document.getElementById('searchBrand').value = '';
            document.getElementById('searchStatus').value = '';
            
            // ë‚ ì§œ í•„ë“œ ì´ˆê¸°í™” (ìµœê·¼ 1ê°œì›”)
            const endDate = new Date();
            const startDate = new Date();
            startDate.setMonth(startDate.getMonth() - 1);
            
            document.getElementById('searchEndDate').value = endDate.toISOString().split('T')[0];
            document.getElementById('searchStartDate').value = startDate.toISOString().split('T')[0];
            
            currentPage = 0;
            loadPaymentList();
        }

        // ì…ê¸ˆ ë‚´ì—­ ëª©ë¡ ë¡œë“œ
        function loadPaymentList() {
            const spinner = document.getElementById('loadingSpinner');
            const paymentList = document.getElementById('paymentList');
            
            if (spinner) {
                spinner.style.display = 'block';
            }

            // ê²€ìƒ‰ íŒŒë¼ë¯¸í„° ìˆ˜ì§‘
            const searchParams = {
                page: currentPage,
                size: pageSize,
                keyword: document.getElementById('searchKeyword').value.trim(),
                startDate: document.getElementById('searchStartDate').value,
                endDate: document.getElementById('searchEndDate').value
            };

            // ë¸Œëœë“œ í•„í„°
            const brand = document.getElementById('searchBrand').value;
            if (brand) {
                searchParams.brand = brand;
            }

            // ìƒíƒœ í•„í„°
            const status = document.getElementById('searchStatus').value;
            if (status) {
                searchParams.mappingStatus = status;
            }

            console.log('ê²€ìƒ‰ íŒŒë¼ë¯¸í„°:', searchParams);

            // URL íŒŒë¼ë¯¸í„° ìƒì„±
            const urlParams = new URLSearchParams();
            Object.keys(searchParams).forEach(key => {
                if (searchParams[key] !== '' && searchParams[key] !== null && searchParams[key] !== undefined) {
                    urlParams.append(key, searchParams[key]);
                }
            });

            fetch(`/payment/api/list?${urlParams.toString()}`)
                .then(response => {
                    console.log('HTTP ì‘ë‹µ ìƒíƒœ:', response.status);
                    return response.json();
                })
                .then(data => {
                    console.log('ì „ì²´ API ì‘ë‹µ:', data);
                    console.log('success ê°’:', data.success);
                    console.log('content ë°ì´í„°:', data.content);
                    console.log('totalElements ê°’:', data.totalElements);
                    
                    if (data.success) {
                        // í˜ì´ì§• ì •ë³´ ì—…ë°ì´íŠ¸
                        totalElements = data.totalElements || 0;
                        totalPages = data.totalPages || 0;
                        
                        console.log('ì„¤ì •ëœ totalElements:', totalElements);
                        console.log('ì„¤ì •ëœ totalPages:', totalPages);
                        
                        // ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
                        const contentData = data.content || [];
                        console.log('ì—…ë°ì´íŠ¸í•  ì»¨í…ì¸ :', contentData);
                        updatePaymentList(contentData);
                        
                        // í†µê³„ ì •ë³´ ì—…ë°ì´íŠ¸
                        updateSearchStats();
                        
                        // í˜ì´ì§• UI ì—…ë°ì´íŠ¸
                        updatePagination();
                    } else {
                        console.error('API ì‹¤íŒ¨:', data.message);
                        showErrorMessage(data.message || 'ì…ê¸ˆ ë‚´ì—­ ì¡°íšŒì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                        updatePaymentList([]);
                    }
                })
                .catch(error => {
                    console.error('ì…ê¸ˆ ë‚´ì—­ ë¡œë“œ ì˜¤ë¥˜:', error);
                    showErrorMessage('ì…ê¸ˆ ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    updatePaymentList([]);
                })
                .finally(() => {
                    if (spinner) {
                        spinner.style.display = 'none';
                    }
                });
        }

        // ìµœê·¼ ì…ê¸ˆ ë‚´ì—­ ìƒˆë¡œê³ ì¹¨ (ê¸°ì¡´ í•¨ìˆ˜ëª… ìœ ì§€, ìƒˆ êµ¬í˜„)
        function refreshRecentPayments() {
            loadPaymentList();
        }
        
        // ì…ê¸ˆ ë‚´ì—­ ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        function updatePaymentList(payments) {
            console.log('updatePaymentList í˜¸ì¶œë¨. payments:', payments);
            console.log('payments íƒ€ì…:', typeof payments);
            console.log('payments ê¸¸ì´:', payments ? payments.length : 'undefined');
            
            const listContainer = document.getElementById('paymentList');
            
            if (!payments || payments.length === 0) {
                console.log('ë¹ˆ ìƒíƒœ ì²˜ë¦¬');
                listContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="ki-duotone ki-information-2"></i>
                        <p>ê²€ìƒ‰ ì¡°ê±´ì— ë§ëŠ” ì…ê¸ˆ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                `;
                return;
            }
            
            const itemsHtml = payments.map(payment => {
                // Oracle Map í‚¤ëŠ” ëŒ€ë¬¸ìë¡œ ë°˜í™˜ë¨
                const customerName = payment.CUSTOMERNAME || payment.customerName || '';
                const bankName = payment.BANKNAME || payment.bankName || '';
                const siteName = payment.SITENAME || payment.siteName || '';
                const brand = payment.BRAND || payment.brand || '';
                const amount = payment.AMOUNT || payment.amount || 0;
                const mappingStatus = payment.MAPPINGSTATUS || payment.mappingStatus || 'PENDING';
                const registerDate = payment.REGISTERDATE || payment.registerDate || '';
                const paymentDate = payment.PAYMENTDATE || payment.paymentDate || '';
                const registerId = payment.REGISTERID || payment.registerId || '';
                const notes = payment.NOTES || payment.notes || '';
                
                // ì…ê¸ˆ ì‹œê°„ ì¶”ì¶œ (PAYMENT_DATEì—ì„œ)
                let paymentTimeStr = '';
                if (paymentDate && typeof paymentDate === 'string' && paymentDate.length >= 16) {
                    paymentTimeStr = paymentDate.substring(11, 16); // HH:mm ì¶”ì¶œ
                } else if (paymentDate) {
                    try {
                        paymentTimeStr = new Date(paymentDate).toLocaleTimeString('ko-KR', {hour: '2-digit', minute: '2-digit'});
                    } catch (e) {
                        paymentTimeStr = '';
                    }
                }
                
                // ì…ê¸ˆ ë‚ ì§œ ì¶”ì¶œ (PAYMENT_DATEì—ì„œ)
                let paymentDateStr = '';
                if (paymentDate && typeof paymentDate === 'string' && paymentDate.length >= 10) {
                    paymentDateStr = paymentDate.substring(0, 10); // YYYY-MM-DD ì¶”ì¶œ
                } else if (paymentDate) {
                    try {
                        paymentDateStr = new Date(paymentDate).toLocaleDateString('ko-KR');
                    } catch (e) {
                        paymentDateStr = '';
                    }
                }
                
                // ë¸Œëœë“œ í‘œì‹œëª… ë³€í™˜
                const brandDisplayName = brand === 'RENOMA' ? 'ë ˆë…¸ë§ˆ' : brand === 'CORALIQUE' ? 'ì½”ë„ë¦¬í¬' : brand;
                const brandClass = brand.toLowerCase() === 'renoma' ? 'renoma' : 'coralique';
                
                return `
                    <div class="payment-item" data-id="${registerId}">
                        <div class="payment-info">
                            <div class="payment-brand-customer">
                                <span class="brand-badge ${brandClass}">${brandDisplayName}</span>
                                <span class="customer-name">${customerName}</span>
                            </div>
                            <div class="payment-details">
                                <div class="payment-bank-time">
                                    <i class="ki-duotone ki-bank fs-6 me-1"></i>
                                    ${bankName} â€¢ ${paymentTimeStr}
                                </div>
                                <div class="payment-date">
                                    <i class="ki-duotone ki-calendar fs-6 me-1"></i>
                                    ${paymentDateStr}
                                </div>
                                ${siteName ? `<div class="payment-site"><i class="ki-duotone ki-shop fs-6 me-1"></i>${siteName}</div>` : ''}
                                ${notes ? `<div class="payment-notes"><i class="ki-duotone ki-notepad fs-6 me-1"></i>${notes}</div>` : ''}
                            </div>
                        </div>
                        <div>
                            <div class="payment-amount">${Number(amount).toLocaleString()}ì›</div>
                            <div class="payment-status ${mappingStatus === 'PENDING' ? 'status-pending' : 'status-mapped'}">
                                ${mappingStatus === 'PENDING' ? 'ë¯¸ë§¤í•‘' : 'ë§¤í•‘ì™„ë£Œ'}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            listContainer.innerHTML = itemsHtml;
        }

        // ê²€ìƒ‰ í†µê³„ ì •ë³´ ì—…ë°ì´íŠ¸
        function updateSearchStats() {
            const totalCountEl = document.getElementById('totalCount');
            const currentRangeEl = document.getElementById('currentRange');
            
            const startIndex = (currentPage * pageSize) + 1;
            const endIndex = Math.min((currentPage + 1) * pageSize, totalElements);
            
            totalCountEl.textContent = totalElements.toLocaleString();
            currentRangeEl.textContent = totalElements > 0 ? `${startIndex}-${endIndex}` : '0';
        }

        // í˜ì´ì§• UI ì—…ë°ì´íŠ¸
        function updatePagination() {
            const paginationList = document.getElementById('paginationList');
            
            if (totalPages <= 1) {
                paginationList.innerHTML = '';
                return;
            }
            
            let paginationHtml = '';
            
            // ì´ì „ ë²„íŠ¼
            paginationHtml += `
                <li class="page-item ${currentPage === 0 ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="goToPage(${currentPage - 1})" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>
            `;
            
            // í˜ì´ì§€ ë²ˆí˜¸ë“¤
            const startPage = Math.max(0, currentPage - 2);
            const endPage = Math.min(totalPages - 1, currentPage + 2);
            
            if (startPage > 0) {
                paginationHtml += `<li class="page-item"><a class="page-link" href="#" onclick="goToPage(0)">1</a></li>`;
                if (startPage > 1) {
                    paginationHtml += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
                }
            }
            
            for (let i = startPage; i <= endPage; i++) {
                paginationHtml += `
                    <li class="page-item ${i === currentPage ? 'active' : ''}">
                        <a class="page-link" href="#" onclick="goToPage(${i})">${i + 1}</a>
                    </li>
                `;
            }
            
            if (endPage < totalPages - 1) {
                if (endPage < totalPages - 2) {
                    paginationHtml += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
                }
                paginationHtml += `<li class="page-item"><a class="page-link" href="#" onclick="goToPage(${totalPages - 1})">${totalPages}</a></li>`;
            }
            
            // ë‹¤ìŒ ë²„íŠ¼
            paginationHtml += `
                <li class="page-item ${currentPage === totalPages - 1 ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="goToPage(${currentPage + 1})" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            `;
            
            paginationList.innerHTML = paginationHtml;
        }

        // í˜ì´ì§€ ì´ë™
        function goToPage(page) {
            if (page < 0 || page >= totalPages || page === currentPage) {
                return;
            }
            
            currentPage = page;
            loadPaymentList();
        }

        // ìµœê·¼ ì…ê¸ˆ ë‚´ì—­ UI ì—…ë°ì´íŠ¸ (ê¸°ì¡´ í•¨ìˆ˜ëª… ìœ ì§€, ìƒˆ êµ¬í˜„ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸)
        function updateRecentPaymentsList(payments) {
            updatePaymentList(payments);
        }
        
        // ì˜¤ëŠ˜ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
        function updateTodayCount() {
            fetch('/payment/api/today-count')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const countElement = document.getElementById('todayCount');
                        if (countElement) {
                            countElement.textContent = `${data.count}ê±´`;
                        }
                    }
                })
                .catch(error => {
                    console.error('ì˜¤ëŠ˜ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
                });
        }
    </script>
</div>
</html> 