<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" 
      layout:decorate="~{layouts/main}">
<head>
    <title>êµí™˜/ë°˜í’ˆ ëª©ë¡</title>
    <meta name="_csrf" th:if="${_csrf}" th:content="${_csrf.token}"/>
    <meta name="_csrf" th:unless="${_csrf}" content=""/>
    <meta name="_csrf_header" th:if="${_csrf}" th:content="${_csrf.headerName}"/>
    <meta name="_csrf_header" th:unless="${_csrf}" content="X-CSRF-TOKEN"/>
    
    <!-- í˜„ëŒ€ì ì¸ CSS ìŠ¤íƒ€ì¼ -->
    <style>
        /* ğŸ¨ CSS ë³€ìˆ˜ ì •ì˜ */
        :root {
            --primary: #3b82f6;
            --primary-dark: #2563eb;
            --primary-light: #dbeafe;
            --success: #10b981;
            --success-light: #d1fae5;
            --warning: #f59e0b;
            --warning-light: #fef3c7;
            --danger: #ef4444;
            --danger-light: #fee2e2;
            --info: #06b6d4;
            --info-light: #cffafe;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            --radius: 0.5rem;
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --text-muted: #9ca3af;
            --border: #e5e7eb;
            --bg-card: #ffffff;
            --bg-hover: #f9fafb;
        }

        /* í—¤ë” ì •ë ¬ ìŠ¤íƒ€ì¼ */
        #kt_app_toolbar {
            padding: 0.75rem 0 !important;
            min-height: auto !important;
        }
        
        #kt_app_toolbar_container {
            padding-left: 1rem !important;
            margin-left: 0 !important;
        }
        
        .page-title {
            margin: 0 !important;
            padding: 0 !important;
            margin-left: 0 !important;
        }
        
        .page-heading {
            margin: 0 !important;
        }
        
        .breadcrumb {
            margin: 0 !important;
            padding-top: 0.25rem !important;
        }
        
        #kt_app_content {
            padding-top: 2.5rem !important;
            margin-top: 0 !important;
        }
        
        /* ì»¨í…ì¸  ì˜ì—­ì€ ì›ë˜ íŒ¨ë”© ìœ ì§€ */
        #kt_app_content_container.app-container {
            padding-left: 1rem !important;
            padding-right: 1rem !important;
        }

        /* ğŸ¯ ëŒ€ì‹œë³´ë“œ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .stat-box {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1.25rem;
            box-shadow: var(--shadow);
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-box:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        .stat-box.active {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .stat-box.success { border-left: 4px solid var(--success); }
        .stat-box.primary { border-left: 4px solid var(--primary); }
        .stat-box.warning { border-left: 4px solid var(--warning); }
        .stat-box.danger { border-left: 4px solid var(--danger); }
        .stat-box.info { border-left: 4px solid var(--info); }

        .card-content h3 {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin: 0 0 0.75rem 0;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .card-content .value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .card-content .description {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin: 0;
        }

        .filter-link {
            cursor: pointer;
            transition: all 0.2s ease;
            padding: 0.125rem 0.25rem;
            border-radius: 0.25rem;
        }

        .filter-link:hover {
            background-color: rgba(59, 130, 246, 0.1);
            color: var(--primary-dark);
            transform: scale(1.05);
        }

        /* ğŸ” ê²€ìƒ‰ ì»¨í…Œì´ë„ˆ */
        .search-container {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow);
        }

        .search-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0 0 1rem 0;
        }

        .search-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .search-row {
            display: flex;
            gap: 1rem;
            align-items: end;
            flex-wrap: wrap;
        }

        .search-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            flex: 1;
            min-width: 200px;
        }

        .search-group label {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .form-control {
            padding: 0.5rem 0.75rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            font-size: 0.875rem;
            transition: all 0.2s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .btn {
            padding: 0.5rem 1rem;
            border: 1px solid transparent;
            border-radius: var(--radius);
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        .btn-search {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .btn-search:hover {
            background: var(--primary-dark);
            border-color: var(--primary-dark);
        }

        .btn-reset {
            background: var(--gray-100);
            color: var(--text-secondary);
            border-color: var(--border);
        }

        .btn-reset:hover {
            background: var(--gray-200);
        }

        .btn-secondary {
            background: var(--gray-500);
            color: white;
            border-color: var(--gray-500);
        }

        .btn-secondary:hover {
            background: var(--gray-600);
            border-color: var(--gray-600);
        }

        .btn-success {
            background: var(--success);
            color: white;
            border-color: var(--success);
        }

        .btn-success:hover {
            background: #059669;
            border-color: #059669;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
            border-color: var(--warning);
        }

        .btn-warning:hover {
            background: #d97706;
            border-color: #d97706;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            border-color: var(--primary-dark);
        }

        .button-group {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        /* ğŸ“Š í†µê³„ ìš”ì•½ */
        .simple-stats {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow);
        }

        .stats-toggle {
            display: none;
        }

        .stats-header {
            display: block;
            padding: 1rem 1.5rem;
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            cursor: pointer;
            border-bottom: 1px solid var(--border);
            transition: all 0.2s ease;
            position: relative;
        }

        .stats-header:hover {
            background: var(--bg-hover);
        }

        .stats-header::after {
            content: 'â–¼';
            position: absolute;
            right: 1.5rem;
            top: 50%;
            transform: translateY(-50%);
            transition: transform 0.2s ease;
        }

        .stats-toggle:checked + .stats-header::after {
            transform: translateY(-50%) rotate(180deg);
        }

        .stats-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .stats-toggle:checked ~ .stats-content {
            max-height: 1000px;
        }

        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            padding: 1.5rem;
        }

        .stats-group h4 {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin: 0 0 0.75rem 0;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .stats-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .stats-list li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--gray-100);
        }

        .stats-list li:last-child {
            border-bottom: none;
        }

        .stats-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .stats-value {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-primary);
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
        }

        .stats-value.primary { background: var(--primary-light); color: var(--primary-dark); }
        .stats-value.success { background: var(--success-light); color: #065f46; }
        .stats-value.warning { background: var(--warning-light); color: #92400e; }
        .stats-value.danger { background: var(--danger-light); color: #991b1b; }

        /* ğŸ—‚ï¸ í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        .table-container {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border);
            background: var(--gray-50);
        }

        .table-header h3 {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
        }

        .table-meta {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .table-wrapper {
            overflow-x: auto;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 1.1rem; /* ê¸°ë³¸ ê¸€ì”¨ í¬ê¸° ë”ìš± ì¦ê°€ */
            min-width: 2700px; /* ìµœì†Œ ë„ˆë¹„ ì¡°ì • (ìƒ‰ìƒ/ì‚¬ì´ì¦ˆ/ìˆ˜ëŸ‰ ì»¬ëŸ¼ ì¶•ì†Œë¡œ ì¸í•œ ì¡°ì •) */
        }

        .data-table th {
            background: #F3F6F9;
            color: #3F4254;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em; /* ê¸€ì ê°„ê²© ì¤„ì„ */
            font-size: 1rem; /* í—¤ë” ê¸€ì”¨ í¬ê¸° ë”ìš± ì¦ê°€ */
            padding: 0.8rem 0.4rem; /* íŒ¨ë”© ì¤„ì—¬ì„œ ê³µë°± ê°ì†Œ */
            border: 1px solid #E4E6EF;
            text-align: center;
            white-space: nowrap;
        }

        .data-table td {
            padding: 0.7rem 0.5rem; /* íŒ¨ë”© ì•½ê°„ ì¦ê°€ */
            border: 1px solid var(--border);
            text-align: center;
            vertical-align: middle;
            font-size: 1rem; /* í—¤ë”ì™€ ë™ì¼í•œ í¬ê¸° */
            line-height: 1.4;
            font-weight: 600; /* í—¤ë”ì™€ ë™ì¼í•œ ë‘ê»˜ */
            white-space: nowrap; /* ëª¨ë“  ì…€ì—ì„œ ì¤„ë°”ê¿ˆ ë°©ì§€ */
        }

        /* ì»¬ëŸ¼ë³„ ìµœì†Œ ë„ˆë¹„ ì„¤ì • - ëª¨ë“  ì»¬ëŸ¼ ëŒ€í­ í™•ëŒ€ */
        .data-table th:nth-child(1), .data-table td:nth-child(1) { min-width: 50px; } /* ì²´í¬ë°•ìŠ¤ */
        .data-table th:nth-child(2), .data-table td:nth-child(2) { min-width: 100px; } /* ìœ í˜• */
        .data-table th:nth-child(3), .data-table td:nth-child(3) { min-width: 120px; } /* ì£¼ë¬¸ì¼ */
        .data-table th:nth-child(4), .data-table td:nth-child(4) { min-width: 120px; } /* CSìˆ˜ì‹ ì¼ */
        .data-table th:nth-child(5), .data-table td:nth-child(5) { min-width: 140px; } /* ì‚¬ì´íŠ¸ */
        .data-table th:nth-child(6), .data-table td:nth-child(6) { min-width: 180px; } /* ì£¼ë¬¸ë²ˆí˜¸ */
        .data-table th:nth-child(7), .data-table td:nth-child(7) { min-width: 80px; } /* ìˆ˜ëŸ‰ */
        .data-table th:nth-child(8), .data-table td:nth-child(8) { min-width: 100px; } /* í™˜ë¶ˆê¸ˆì•¡ */
        .data-table th:nth-child(9), .data-table td:nth-child(9) { min-width: 100px; } /* ê³ ê°ëª… */
        .data-table th:nth-child(10), .data-table td:nth-child(10) { 
            min-width: 160px; 
            white-space: nowrap; 
        } /* ì—°ë½ì²˜ - í•œì¤„ í‘œì‹œë¥¼ ìœ„í•´ ëŒ€í­ í™•ëŒ€ */
        .data-table th:nth-child(11), .data-table td:nth-child(11) { min-width: 120px; } /* ì§„í–‰ìƒíƒœ */
        .data-table th:nth-child(12), .data-table td:nth-child(12) { min-width: 100px; } /* ì‚¬ìœ  */
        .data-table th:nth-child(13), .data-table td:nth-child(13) { min-width: 160px; } /* ìš´ì†¡ì¥ë²ˆí˜¸ */
        .data-table th:nth-child(14), .data-table td:nth-child(14) { min-width: 200px; } /* íšŒìˆ˜ì™„ë£Œì¼ - ë”ìš± ëŒ€í­ í™•ëŒ€ */
        .data-table th:nth-child(15), .data-table td:nth-child(15) { min-width: 100px; } /* ë°°ì†¡ë¹„ */
        .data-table th:nth-child(16), .data-table td:nth-child(16) { min-width: 160px; } /* ìš´ì†¡ì¥ë²ˆí˜¸2 */
        .data-table th:nth-child(17), .data-table td:nth-child(17) { min-width: 200px; } /* ë¬¼ë¥˜í™•ì¸ì¼ - ë”ìš± ëŒ€í­ í™•ëŒ€ */
        .data-table th:nth-child(18), .data-table td:nth-child(18) { min-width: 200px; } /* ì¶œê³ ì¼ - ë”ìš± ëŒ€í­ í™•ëŒ€ */
        .data-table th:nth-child(19), .data-table td:nth-child(19) { min-width: 200px; } /* í™˜ë¶ˆì¼ - ë”ìš± ëŒ€í­ í™•ëŒ€ */
        .data-table th:nth-child(20), .data-table td:nth-child(20) { 
            min-width: 120px; 
            white-space: nowrap;
        } /* ë¹„ê³  - í™•ëŒ€í•˜ì—¬ ì „ì²´ í…ìŠ¤íŠ¸ í‘œì‹œ */
        .data-table th:nth-child(21), .data-table td:nth-child(21) { min-width: 100px; } /* ê´€ë¦¬ */

        .data-table tbody tr:hover {
            background: var(--bg-hover);
        }

        .data-table tbody tr.completed {
            background: rgba(16, 185, 129, 0.05);
            border-left: 4px solid var(--success);
        }

        .data-table tbody tr.date-changed {
            background: rgba(245, 158, 11, 0.1);
            border-left: 4px solid var(--warning);
        }

        .data-table tbody tr.completion-changed {
            border-left: 4px solid var(--warning);
        }

        .text-left { text-align: left !important; }
        .text-center { text-align: center !important; }

        /* ğŸ·ï¸ ë°°ì§€ ìŠ¤íƒ€ì¼ */
        .type-badge {
            display: inline-block;
            padding: 0.3rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.85rem; /* ë°°ì§€ ê¸€ì”¨ í¬ê¸° ë” ì¦ê°€ */
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.03em;
        }

        .type-badge.full-return { background: var(--danger-light); color: #991b1b; }
        .type-badge.partial-return { background: var(--warning-light); color: #92400e; }
        .type-badge.full-exchange { background: var(--primary-light); color: var(--primary-dark); }
        .type-badge.partial-exchange { background: var(--info-light); color: #0c4a6e; }
        .type-badge.exchange { background: var(--success-light); color: #065f46; }

        .badge {
            display: inline-block;
            padding: 0.4rem 0.8rem;
            border-radius: 0.375rem;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            min-width: 70px;
            text-align: center;
        }

        .bg-success { background: var(--success); }
        .bg-warning { background: var(--warning); }
        .bg-danger { background: var(--danger); }
        .bg-info { background: var(--info); }
        .bg-secondary { background: var(--gray-500); }
        .text-white { color: white; }
        .text-dark { color: var(--gray-800); }

        /* ğŸ“‹ ë³µì‚¬ ê°€ëŠ¥í•œ ìš”ì†Œë“¤ */
        .order-number-copy,
        .customer-name-copy,
        .customer-phone-copy,
        .order-item-code-copy,
        .tracking-number-copy {
            cursor: pointer;
            transition: all 0.2s ease;
            padding: 0.125rem 0.25rem;
            border-radius: 0.25rem;
            font-weight: 500;
        }

        .order-number-copy:hover,
        .customer-name-copy:hover,
        .customer-phone-copy:hover,
        .order-item-code-copy:hover,
        .tracking-number-copy:hover {
            background: var(--primary-light);
            color: var(--primary-dark);
            transform: scale(1.02);
        }

        /* ğŸ’° ê¸ˆì•¡ ì •ë³´ */
        .money-info {
            font-size: 1rem; /* í—¤ë”ì™€ ë™ì¼í•œ í¬ê¸° */
            font-weight: 600;
            color: var(--success);
        }

        .important-info {
            font-size: 1rem; /* í—¤ë”ì™€ ë™ì¼í•œ í¬ê¸° */
            font-weight: 600;
            color: var(--text-primary);
        }

        .contact-info {
            font-family: 'Courier New', monospace;
            font-size: 1rem; /* í—¤ë”ì™€ ë™ì¼í•œ í¬ê¸° */
            font-weight: 600; /* í—¤ë”ì™€ ë™ì¼í•œ ë‘ê»˜ */
        }

        .order-info {
            font-family: 'Courier New', monospace;
            font-size: 1rem; /* í—¤ë”ì™€ ë™ì¼í•œ í¬ê¸° */
            font-weight: 600; /* í—¤ë”ì™€ ë™ì¼í•œ ë‘ê»˜ */
        }

        /* ğŸ“… ë‚ ì§œ ì…ë ¥ í•„ë“œ */
        .date-input {
            font-size: 1.0rem !important; /* í—¤ë”ì™€ ë™ì¼í•œ í¬ê¸° */
            font-weight: 600 !important; /* í—¤ë”ì™€ ë™ì¼í•œ ë‘ê»˜ */
            padding: 0.5rem !important; /* ì ì ˆí•œ íŒ¨ë”© */
            border: 1px solid var(--border);
            border-radius: 0.25rem;
            width: 140px !important; /* ì ì ˆí•œ ë„ˆë¹„ */
            min-height: 38px !important; /* í…Œì´ë¸” í–‰ ë†’ì´ì™€ ì¡°í™” */
        }

        .date-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
        }

        .btn-clear-date {
            background: none;
            border: none;
            color: var(--danger);
            cursor: pointer;
            padding: 0.2rem;
            font-size: 0.7rem;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.25rem;
            transition: all 0.2s ease;
        }

        .btn-clear-date:hover {
            background: var(--danger-light);
            color: #991b1b;
        }

        /* ğŸ”— ì•¡ì…˜ ë§í¬ */
        .action-link {
            color: var(--primary);
            text-decoration: none;
            font-size: 1rem; /* í—¤ë”ì™€ ë™ì¼í•œ í¬ê¸° */
            font-weight: 600; /* í—¤ë”ì™€ ë™ì¼í•œ ë‘ê»˜ */
            transition: color 0.2s ease;
        }

        .action-link:hover {
            color: var(--primary-dark);
            text-decoration: underline;
        }

        .action-link.danger {
            color: var(--danger);
        }

        .action-link.danger:hover {
            color: #991b1b;
        }

        /* ğŸ“„ í˜ì´ì§€ë„¤ì´ì…˜ */
        .pagination-container {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--border);
            background: var(--gray-50);
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 0.25rem;
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .pagination li {
            display: inline-block;
        }

        .page-link {
            display: block;
            padding: 0.5rem 0.75rem;
            color: var(--text-secondary);
            text-decoration: none;
            border: 1px solid var(--border);
            border-radius: 0.25rem;
            transition: all 0.2s ease;
            font-size: 0.875rem;
        }

        .page-link:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        .page-link.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* ğŸ“Š í•„í„° ìƒíƒœ í‘œì‹œ */
        .filter-status {
            background: linear-gradient(90deg, #3b82f6, #1d4ed8);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius);
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
        }

        .filter-text {
            font-weight: 600;
        }

        .clear-filter {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 0.25rem;
            cursor: pointer;
            font-size: 0.875rem;
            transition: background 0.2s ease;
        }

        .clear-filter:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* ğŸš« ë°ì´í„° ì—†ìŒ */
        .no-data {
            text-align: center;
            padding: 3rem;
            color: var(--text-muted);
            font-style: italic;
        }

        /* ğŸ“± ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .search-row {
                flex-direction: column;
            }
            
            .search-group {
                min-width: 100%;
            }
            
            .button-group {
                justify-content: center;
            }
            
            .table-wrapper {
                font-size: 0.65rem;
            }
            
            .data-table th,
            .data-table td {
                padding: 0.25rem;
            }
        }

        /* ğŸ¨ ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
        
        /* ì¶”ê°€ ìŠ¤íƒ€ì¼ë“¤ */
        .customer-name {
            font-size: 1rem; /* í—¤ë”ì™€ ë™ì¼í•œ í¬ê¸° */
            font-weight: 600; /* í—¤ë”ì™€ ë™ì¼í•œ ë‘ê»˜ */
            color: #1f2937;
            margin-bottom: 0.125rem;
        }
        
        .customer-phone {
            font-size: 1rem; /* í—¤ë”ì™€ ë™ì¼í•œ í¬ê¸° */
            font-weight: 600; /* í—¤ë”ì™€ ë™ì¼í•œ ë‘ê»˜ */
            color: #6b7280;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
        }
        
        /* ê¸ˆì•¡ ìŠ¤íƒ€ì¼ */
        .amount-cell {
            font-size: 1rem; /* í—¤ë”ì™€ ë™ì¼í•œ í¬ê¸° */
            font-weight: 600;
            color: #dc2626;
        }
        
        /* ë‚ ì§œ ìŠ¤íƒ€ì¼ */
        .date-cell {
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
            font-size: 1rem; /* ë‚ ì§œ ê¸€ì”¨ í¬ê¸° ë”ìš± ì¦ê°€ */
            color: #6b7280;
            font-weight: 600; /* ë‚ ì§œ ê¸€ì”¨ ë‘ê»˜ ì¦ê°€ */
        }
        
        /* ë‚ ì§œ ì…ë ¥ í•„ë“œ ìŠ¤íƒ€ì¼ */
        .data-table input[type="date"] {
            width: 100%;
            max-width: 180px; /* ë‚ ì§œ ì…ë ¥ í•„ë“œ ë„ˆë¹„ ë”ìš± ëŒ€í­ ì¦ê°€ */
            font-size: 1.2rem; /* ì…ë ¥ í•„ë“œ ê¸€ì”¨ í¬ê¸° ë”ìš± ì¦ê°€ */
            font-weight: 600; /* ê¸€ì”¨ ë‘ê»˜ ì¦ê°€ */
            padding: 0.6rem;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            background: white;
            min-height: 45px; /* ìµœì†Œ ë†’ì´ ì¦ê°€ */
        }
        
        .data-table input[type="date"]:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
        }
        
        /* ìƒíƒœ ë°°ì§€ */
        .status-badge {
            padding: 0.4rem 0.6rem;
            border-radius: 6px;
            font-size: 0.9rem; /* ìƒíƒœ ë°°ì§€ ê¸€ì”¨ í¬ê¸° ë” ì¦ê°€ */
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.02em;
            display: inline-flex;
            align-items: center;
            gap: 0.2rem;
        }
        
        .status-badge:before {
            content: '';
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: currentColor;
        }
        
        .status-pending { 
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #fde68a;
        }
        .status-processing { 
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #bfdbfe;
        }
        .status-shipping { 
            background: #e0e7ff;
            color: #3730a3;
            border: 1px solid #c7d2fe;
        }
        .status-completed { 
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }
        .status-canceled { 
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }
        
        /* íƒ€ì… ë°°ì§€ */
        .type-badge {
            padding: 0.375rem 0.75rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .type-exchange { 
            background: #f3f4f6;
            color: #374151;
            border: 1px solid #d1d5db;
        }
        
        .type-return { 
            background: #fef2f2;
            color: #7f1d1d;
            border: 1px solid #fecaca;
        }
        
        .type-full-return { 
            background: #fffbeb;
            color: #92400e;
            border: 1px solid #fde68a;
        }
        
        .type-partial-return { 
            background: #f0f9ff;
            color: #1e40af;
            border: 1px solid #bfdbfe;
        }
        
        /* í•„í„° ë²„íŠ¼ */
        .filter-btn {
            padding: 0.5rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s ease;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
            background: white;
            color: #6b7280;
        }
        
        .filter-btn.active {
            background: #4f46e5;
            color: white;
            border-color: #4f46e5;
        }
        
        .filter-btn:not(.active):hover {
            border-color: #9ca3af;
            color: #374151;
        }
        
        /* ì•¡ì…˜ ë²„íŠ¼ */
        .action-btn {
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.85rem; /* ì•¡ì…˜ ë²„íŠ¼ ê¸€ì”¨ í¬ê¸° ì¦ê°€ */
            font-weight: 500;
            border: none;
            transition: all 0.3s;
            margin-right: 0.3rem;
        }
        
        .btn-view {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }
        
        .btn-edit {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
        }
        
        .btn-delete {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: white;
        }
        
        .action-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        /* ë¡œë”© ìŠ¤í”¼ë„ˆ */
        .loading-spinner {
            display: none;
            text-align: center;
            padding: 2rem;
        }
        
        .spinner-border {
            width: 3rem;
            height: 3rem;
            border-width: 0.3em;
        }
        
        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .exchange-container {
                padding: 1rem !important;
            }
            
            .stat-item {
                margin-bottom: 1rem;
            }
            
            .exchange-table {
                font-size: 0.8rem;
            }
            
            .exchange-table td,
            .exchange-table th {
                padding: 0.5rem 0.3rem;
            }
        }
    </style>
</head>

<div layout:fragment="content">
    <div class="app-main flex-column flex-row-fluid" id="kt_app_main">
        <!--begin::Content wrapper-->
        <div class="d-flex flex-column flex-column-fluid">
            <!--begin::Toolbar-->
            <div id="kt_app_toolbar" class="app-toolbar py-3 py-lg-6">
                <!--begin::Toolbar container-->
                <div id="kt_app_toolbar_container" class="app-container container-xxl d-flex flex-stack">
                    <!--begin::Page title-->
                    <div class="page-title d-flex flex-column justify-content-center flex-wrap me-3">
                        <!--begin::Title-->
                        <h1 class="page-heading d-flex text-gray-900 fw-bold fs-3 flex-column justify-content-center my-0">êµí™˜/ë°˜í’ˆ ê´€ë¦¬</h1>
                        <!--end::Title-->
                        <!--begin::Breadcrumb-->
                        <ul class="breadcrumb breadcrumb-separatorless fw-semibold fs-7 my-0 pt-1">
                            <!--begin::Item-->
                            <li class="breadcrumb-item text-muted">
                                <a href="/main" class="text-muted text-hover-primary">Home</a>
                            </li>
                            <!--end::Item-->
                            <!--begin::Item-->
                            <li class="breadcrumb-item">
                                <span class="bullet bg-gray-500 w-5px h-2px"></span>
                            </li>
                            <!--end::Item-->
                            <!--begin::Item-->
                            <li class="breadcrumb-item text-muted">êµí™˜/ë°˜í’ˆ ê´€ë¦¬</li>
                            <!--end::Item-->
                            <!--begin::Item-->
                            <li class="breadcrumb-item">
                                <span class="bullet bg-gray-500 w-5px h-2px"></span>
                            </li>
                            <!--end::Item-->
                            <!--begin::Item-->
                            <li class="breadcrumb-item text-muted">êµí™˜/ë°˜í’ˆ</li>
                            <!--end::Item-->
                        </ul>
                        <!--end::Breadcrumb-->
                    </div>
                    <!--end::Page title-->
                    <!--begin::Actions-->
                    <div class="d-flex align-items-center gap-2 gap-lg-3">
                        <!-- ì•¡ì…˜ ë²„íŠ¼ë“¤ì„ ê²€ìƒ‰ ì˜ì—­ìœ¼ë¡œ ì´ë™ -->
                    </div>
                    <!--end::Actions-->
                </div>
                <!--end::Toolbar container-->
            </div>
            <!--end::Toolbar-->
            <!--begin::Content-->
            <div id="kt_app_content" class="app-content flex-column-fluid">
                <!--begin::Content container-->
                <div id="kt_app_content_container" class="app-container container-fluid px-2">

            <!-- ğŸ¯ í˜„ì¬ í•„í„° ìƒíƒœ ë°°ë„ˆ (ì¡°ê±´ë¶€ í‘œì‹œ) -->
            <div th:if="${currentFilter != null and currentFilter != ''}" 
                 class="alert alert-info alert-dismissible fade show mb-4" role="alert">
                <div class="d-flex align-items-center">
                    <i class="ki-duotone ki-filter fs-2 me-3">
                        <span class="path1"></span>
                        <span class="path2"></span>
                    </i>
                    <div>
                        <h6 class="mb-0">í˜„ì¬ ì ìš©ëœ í•„í„°</h6>
                        <span class="text-muted">
                            <span th:text="${filterDisplayName != null ? filterDisplayName : 'ì•Œ ìˆ˜ ì—†ëŠ” í•„í„°'}"></span>
                            ì¡°ê±´ìœ¼ë¡œ í•„í„°ë§ ì¤‘ì…ë‹ˆë‹¤.
                        </span>
                    </div>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close" 
                        onclick="clearAllFilters()"></button>
            </div>

            <!-- ğŸ¯ ë‹¤ì¤‘ í•„í„° ìƒíƒœ ë°°ë„ˆ (ì¡°ê±´ë¶€ í‘œì‹œ) -->
            <div th:if="${currentFilters != null and currentFilters != ''}" 
                 class="alert alert-success alert-dismissible fade show mb-4" role="alert">
                <div class="d-flex align-items-center">
                    <i class="ki-duotone ki-filter fs-2 me-3 text-success">
                        <span class="path1"></span>
                        <span class="path2"></span>
                    </i>
                    <div>
                        <h6 class="mb-0 text-success">ğŸ¯ ë‹¤ì¤‘ í•„í„° ì ìš©ë¨</h6>
                        <span class="text-muted">
                            <span th:if="${activeFilterNames != null and !activeFilterNames.isEmpty()}">
                                <span th:each="filterName, iter : ${activeFilterNames}">
                                    <span th:text="${filterName}">í•„í„°ëª…</span>
                                    <span th:if="!${iter.last}">, </span>
                                </span>
                            </span>
                            <span th:if="${activeFilterNames == null or activeFilterNames.isEmpty()}" th:text="${currentFilters}">í•„í„°</span>
                            ì¡°ê±´ìœ¼ë¡œ í•„í„°ë§ ì¤‘ì…ë‹ˆë‹¤.
                        </span>
                    </div>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close" 
                        onclick="clearAllFilters()"></button>
            </div>

            <!-- ğŸ¯ í•„í„° ì„ íƒ ì˜ì—­ ì œê±° - ì¹´ë“œ í´ë¦­ ë°©ì‹ìœ¼ë¡œ ë³€ê²½ -->

            <!-- ğŸ¯ ìƒë‹¨ ì¹´ë“œ ëŒ€ì‹œë³´ë“œ -->
            <div class="dashboard">
                <!-- â‘  íšŒìˆ˜ì™„ë£Œ ì¹´ë“œ -->
                <div class="stat-box success" data-card="collection">
                    <div class="card-content">
                        <h3>ğŸ“¦ íšŒìˆ˜ì™„ë£Œ</h3>
                        <div class="value clickable">
                            <span class="filter-link" data-filter="collection-completed" data-stat="collection-completed" th:text="${cardStats?.collectionCompleted ?: 0}">0</span>
                            <span> / </span>
                            <span class="filter-link" data-filter="collection-pending" data-stat="collection-pending" th:text="${cardStats?.collectionPending ?: 0}">0</span>
                        </div>
                        <div class="description">ì™„ë£Œ / ë¯¸ì™„ë£Œ</div>
                    </div>
                </div>
                
                <!-- â‘¡ ë¬¼ë¥˜í™•ì¸ ì¹´ë“œ -->
                <div class="stat-box primary" data-card="logistics">
                    <div class="card-content">
                        <h3>ğŸš› ë¬¼ë¥˜í™•ì¸</h3>
                        <div class="value clickable">
                            <span class="filter-link" data-filter="logistics-confirmed" data-stat="logistics-confirmed" th:text="${cardStats?.logisticsConfirmed ?: 0}">0</span>
                            <span> / </span>
                            <span class="filter-link" data-filter="logistics-pending" data-stat="logistics-pending" th:text="${cardStats?.logisticsPending ?: 0}">0</span>
                        </div>
                        <div class="description">í™•ì¸ / ë¯¸í™•ì¸</div>
                    </div>
                </div>
                
                <!-- â‘¢ êµí™˜ ì¶œê³ ì¼ì ì¹´ë“œ -->
                <div class="stat-box warning" data-card="exchange">
                    <div class="card-content">
                        <h3>ğŸ“¤ êµí™˜ ì¶œê³ </h3>
                        <div class="value clickable">
                            <span class="filter-link" data-filter="shipping-completed" data-stat="exchange-shipped" th:text="${cardStats?.exchangeShipped ?: 0}">0</span>
                            <span> / </span>
                            <span class="filter-link" data-filter="shipping-pending" data-stat="exchange-not-shipped" th:text="${cardStats?.exchangeNotShipped ?: 0}">0</span>
                        </div>
                        <div class="description">ì¶œê³ ì™„ë£Œ / ì¶œê³ ëŒ€ê¸°</div>
                    </div>
                </div>
                
                <!-- â‘£ ë°˜í’ˆ í™˜ë¶ˆì¼ì ì¹´ë“œ (ë°˜í’ˆë§Œ) -->
                <div class="stat-box danger" data-card="return">
                    <div class="card-content">
                        <h3>ğŸ’° ë°˜í’ˆ í™˜ë¶ˆ</h3>
                        <div class="value clickable">
                            <span class="filter-link" data-filter="refund-completed" data-stat="return-refunded" th:text="${cardStats?.returnRefunded ?: 0}">0</span>
                            <span> / </span>
                            <span class="filter-link" data-filter="refund-pending" data-stat="return-not-refunded" th:text="${cardStats?.returnNotRefunded ?: 0}">0</span>
                        </div>
                        <div class="description">í™˜ë¶ˆì™„ë£Œ / í™˜ë¶ˆëŒ€ê¸°</div>
                    </div>
                </div>
                
                <!-- â‘¤ ë°°ì†¡ë¹„ì…ê¸ˆ ì¹´ë“œ (êµí™˜ë§Œ) -->
                <div class="stat-box warning" data-card="payment">
                    <div class="card-content">
                        <h3>ğŸ’³ ë°°ì†¡ë¹„ì…ê¸ˆ</h3>
                        <div class="value clickable">
                            <span class="filter-link" data-filter="payment-pending" data-stat="payment-pending" th:text="${cardStats?.paymentPending ?: 0}">0</span>
                            <span> / </span>
                            <span class="filter-link" data-filter="payment-completed" data-stat="payment-completed" th:text="${cardStats?.paymentCompleted ?: 0}">0</span>
                        </div>
                        <div class="description">ì…ê¸ˆëŒ€ê¸° / ì…ê¸ˆì™„ë£Œ</div>
                    </div>
                </div>
                
                <!-- â‘¥ ì „ì²´ì™„ë£Œ ì¹´ë“œ -->
                <div class="stat-box info" data-card="completion">
                    <div class="card-content">
                        <h3>âœ… ì „ì²´ì™„ë£Œ</h3>
                        <div class="value clickable">
                            <span class="filter-link" data-filter="completed" data-stat="completed-count" th:text="${cardStats?.completedCount ?: 0}">0</span>
                            <span> / </span>
                            <span class="filter-link" data-filter="incompleted" data-stat="incomplete-count" th:text="${cardStats?.incompletedCount ?: 0}">0</span>
                        </div>
                        <div class="description">ì™„ë£Œ / ë¯¸ì™„ë£Œ</div>
                    </div>
                </div>
                
                <!-- â‘¦ ì²˜ë¦¬ê¸°ê°„ ì„ë°• ì¹´ë“œ (Sample í†µí•©) -->
                <div class="stat-box warning" data-card="overdue-ten-days">
                    <div class="card-content">
                        <h3>ğŸš¨ ì²˜ë¦¬ê¸°ê°„ ì„ë°•</h3>
                        <div class="value clickable">
                            <span class="filter-link" data-filter="overdue-ten-days" data-stat="overdue-ten-days-count" th:text="${cardStats?.overdueTenDaysCount ?: 0}">0</span>
                        </div>
                        <div class="description">10ì¼ ì´ìƒ ë¯¸ì™„ë£Œ</div>
                    </div>
                </div>
            </div>
            
            <!-- í•„í„° ìƒíƒœ í‘œì‹œ -->
            <div id="filterStatus" class="filter-status" style="display: none;">
                <span class="filter-text"></span>
                <button class="clear-filter" id="clearFilterBtn">âœ• í•„í„° í•´ì œ</button>
            </div>
            
            <!-- í†µê³„ ìš”ì•½
            <div class="simple-stats">
                <input type="checkbox" id="statsToggle" class="stats-toggle">
                <label for="statsToggle" class="stats-header">ğŸ“Š í˜„í™© ìš”ì•½</label>
                <div class="stats-content">
                    <div class="stats-row">
                    <!-- ì²˜ë¦¬ ìƒíƒœ
                    <div class="stats-group">
                        <h4>ì²˜ë¦¬ ìƒíƒœ</h4>
                        <ul class="stats-list">
                            <li>
                                <span class="stats-label">ì „ì²´ ê±´ìˆ˜</span>
                                <span class="stats-value primary" data-stat="total-count" th:text="${totalItems != null ? totalItems : 0}">0</span>
                            </li>
                            <li>
                                <span class="stats-label">ì˜¤ëŠ˜ ë“±ë¡</span>
                                <span class="stats-value success" data-stat="today-count" th:text="${todayCount != null ? todayCount : 0}">0</span>
                            </li>
                            <li>
                                <span class="stats-label">ì™„ë£Œìœ¨</span>
                                <span class="stats-value info" data-stat="completion-rate">0%</span>
                            </li>
                            <li>
                                <span class="stats-label">ë¯¸ì™„ë£Œ</span>
                                <span class="stats-value warning" data-stat="incomplete-count" th:text="${cardStats != null and cardStats['incompletedCount'] != null ? cardStats['incompletedCount'] : 0}">0</span>
                            </li>
                            <li>
                                <span class="stats-label">ì™„ë£Œ</span>
                                <span class="stats-value success" data-stat="completed-count" th:text="${cardStats != null and cardStats['completedCount'] != null ? cardStats['completedCount'] : 0}">0</span>
                            </li>
                        </ul>
                    </div>


                    <div class="stats-group">
                        <h4>ìœ í˜•ë³„ í˜„í™©</h4>
                        <ul class="stats-list">
                            <li>
                                <span class="stats-label">ì „ì²´ë°˜í’ˆ</span>
                                <span class="stats-value danger" data-stat="type-full-return" th:text="${typeCounts != null and typeCounts['ì „ì²´ë°˜í’ˆ'] != null ? typeCounts['ì „ì²´ë°˜í’ˆ'] : 0}">0</span>
                            </li>
                            <li>
                                <span class="stats-label">ë¶€ë¶„ë°˜í’ˆ</span>
                                <span class="stats-value warning" data-stat="type-partial-return" th:text="${typeCounts != null and typeCounts['ë¶€ë¶„ë°˜í’ˆ'] != null ? typeCounts['ë¶€ë¶„ë°˜í’ˆ'] : 0}">0</span>
                            </li>
                            <li>
                                <span class="stats-label">ì „ì²´êµí™˜</span>
                                <span class="stats-value primary" data-stat="type-full-exchange" th:text="${typeCounts != null and typeCounts['ì „ì²´êµí™˜'] != null ? typeCounts['ì „ì²´êµí™˜'] : 0}">0</span>
                            </li>
                            <li>
                                <span class="stats-label">ë¶€ë¶„êµí™˜</span>
                                <span class="stats-value info" data-stat="type-partial-exchange" th:text="${typeCounts != null and typeCounts['ë¶€ë¶„êµí™˜'] != null ? typeCounts['ë¶€ë¶„êµí™˜'] : 0}">0</span>
                            </li>
                        </ul>
                    </div>


                    <div class="stats-group">
                        <h4>ê¸ˆì•¡ í˜„í™©</h4>
                        <ul class="stats-list">
                            <li>
                                <span class="stats-label">ì´ í™˜ë¶ˆê¸ˆì•¡</span>
                                <span class="stats-value primary" data-stat="total-refund-amount" th:text="${amountSummary != null and amountSummary['totalRefundAmount'] != null ? #numbers.formatInteger(amountSummary['totalRefundAmount'], 0, 'COMMA') + 'ì›' : '0ì›'}">0ì›</span>
                            </li>
                            <li>
                                <span class="stats-label">ë°°ì†¡ë¹„ í•©ê³„</span>
                                <span class="stats-value warning" data-stat="total-shipping-fee" th:text="${amountSummary != null and amountSummary['totalShippingFee'] != null ? #numbers.formatInteger(amountSummary['totalShippingFee'], 0, 'COMMA') + 'ì›' : '0ì›'}">0ì›</span>
                            </li>
                            <li>
                                <span class="stats-label">í‰ê·  í™˜ë¶ˆê¸ˆì•¡</span>
                                <span class="stats-value info" data-stat="avg-refund-amount">0ì›</span>
                            </li>
                        </ul>
                    </div>
                </div>


                <div class="stats-row" th:if="${(reasonCounts != null and !reasonCounts.isEmpty()) or (siteCounts != null and !siteCounts.isEmpty()) or (brandCounts != null and !brandCounts.isEmpty())}">

                    <div class="stats-group" th:if="${reasonCounts != null and !reasonCounts.isEmpty()}">
                        <h4>ì£¼ìš” ì‚¬ìœ </h4>
                        <ul class="stats-list">
                            <li th:each="reasonKey : ${reasonCounts.keySet()}">
                                <span class="stats-label" th:text="${reasonKey}">ê³ ê°ë³€ì‹¬</span>
                                <span class="stats-value" th:text="${reasonCounts.get(reasonKey)}">4</span>
                            </li>
                        </ul>
                    </div>


                    <div class="stats-group" th:if="${siteCounts != null and !siteCounts.isEmpty()}">
                        <h4>ì£¼ìš” ì‚¬ì´íŠ¸</h4>
                        <ul class="stats-list">
                            <li th:each="siteKey : ${siteCounts.keySet()}">
                                <span class="stats-label" th:text="${siteKey}">ìì‚¬ëª°-ë ˆë…¸ë§ˆ</span>
                                <span class="stats-value" th:text="${siteCounts.get(siteKey)}">4</span>
                            </li>
                        </ul>
                    </div>


                    <div class="stats-group" th:if="${brandCounts != null and !brandCounts.isEmpty()}">
                        <h4>ë¸Œëœë“œë³„ í˜„í™©</h4>
                        <ul class="stats-list">
                            <li>
                                <span class="stats-label">ë ˆë…¸ë§ˆ</span>
                                <span class="stats-value primary" th:text="${brandCounts != null and brandCounts['ë ˆë…¸ë§ˆ'] != null ? brandCounts['ë ˆë…¸ë§ˆ'] : 0}">0</span>
                            </li>
                            <li>
                                <span class="stats-label">ì½”ë„ë¦¬í¬</span>
                                <span class="stats-value success" th:text="${brandCounts != null and brandCounts['ì½”ë„ë¦¬í¬'] != null ? brandCounts['ì½”ë„ë¦¬í¬'] : 0}">0</span>
                            </li>
                        </ul>
                    </div>
                </div>
                </div>
            </div>-->

            <!-- í†µí•© ê²€ìƒ‰ -->
            <div class="search-container">
                <h3 class="search-title">ğŸ” í†µí•© ê²€ìƒ‰</h3>
                <form id="searchForm" action="/exchange/list" method="get" class="search-form" th:object="${searchDTO}">
                    <!-- ğŸ¯ í•„í„° ì •ë³´ íˆë“  í•„ë“œ -->
                    <input type="hidden" id="filtersInput" name="filters" th:value="${filters}">
                    
                    <div class="search-row">
                        <div class="search-group" style="flex: 2;">
                            <label for="keyword">í†µí•©ê²€ìƒ‰</label>
                            <input type="text" id="keyword" name="keyword" class="form-control" 
                                   placeholder="ì£¼ë¬¸ë²ˆí˜¸, ê³ ê°ëª…, ì—°ë½ì²˜, ì‚¬ì´íŠ¸, í’ˆë²ˆ, ìƒ‰ìƒ, ì‚¬ì´ì¦ˆ, ìš´ì†¡ì¥ë²ˆí˜¸, ìœ í˜•, ì‚¬ìœ  ë“± ê²€ìƒ‰" 
                                   th:field="*{keyword}">
                        </div>
                        <div class="search-group">
                            <label for="startDate">CSì ‘ìˆ˜ ì‹œì‘ì¼</label>
                            <input type="date" id="startDate" name="startDate" class="form-control" th:field="*{startDate}">
                        </div>
                        <div class="search-group">
                            <label for="endDate">CSì ‘ìˆ˜ ì¢…ë£Œì¼</label>
                            <input type="date" id="endDate" name="endDate" class="form-control" th:field="*{endDate}">
                        </div>
                        <div class="search-group">
                            <label>&nbsp;</label>
                            <div style="display: flex; gap: 0.5rem;">
                                <button type="submit" class="btn btn-search">ğŸ” ê²€ìƒ‰</button>
                                <button type="button" class="btn btn-reset" onclick="window.location.href='/exchange/list'">ğŸ”„ ì´ˆê¸°í™”</button>
                            </div>
                        </div>
                        <div class="search-group">
                            <label>&nbsp;</label>
                            <div class="button-group">
                                <!-- ğŸ“¥ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ -->
                                <button type="button" class="btn btn-primary" style="font-size: 1.1rem; padding: 0.75rem 1.5rem;" onclick="downloadExcel()">ğŸ“¥ ì—‘ì…€ë‹¤ìš´</button>
                                
                                <!-- ğŸ“¤ ì—‘ì…€ ì—…ë¡œë“œ ë²„íŠ¼
                                <button type="button" class="btn btn-success" style="font-size: 1.1rem; padding: 0.75rem 1.5rem;" onclick="openExcelUploadModal()">ğŸ“¤ ì—‘ì…€ì—…ë¡œë“œ</button>
                                
                               ğŸ“„ í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ ë²„íŠ¼
                                <button type="button" class="btn btn-secondary" style="font-size: 1.1rem; padding: 0.75rem 1.5rem;" onclick="downloadTemplate()">ğŸ“„ í…œí”Œë¦¿</button>
                                -->
                                <button type="button" id="bulkSaveBtn" class="btn btn-success" style="font-size: 1.1rem; padding: 0.75rem 1.5rem; min-width: 180px; white-space: nowrap;" onclick="saveBulkDateChanges()" disabled>ğŸ’¾ ë‚ ì§œì €ì¥ (<span id="changeCount">0</span>ê±´)</button>
                                <!-- ì™„ë£Œì²˜ë¦¬ ë²„íŠ¼ ì£¼ì„ ì²˜ë¦¬
                                <button type="button" id="bulkCompleteBtn" class="btn btn-warning" onclick="saveBulkCompletionChanges()" disabled style="min-width: 160px; white-space: nowrap;">âœ… ì™„ë£Œì²˜ë¦¬ (<span id="completeCount">0</span>ê±´)</button>
                                -->
                                <!-- ë“±ë¡ ë²„íŠ¼ ì£¼ì„ ì²˜ë¦¬
                                <a href="/exchange/create" class="btn btn-primary">â• ë“±ë¡</a>
                                -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- ê²€ìƒ‰ ë„ì›€ë§ -->
                    <div style="margin-top: 0.5rem; padding: 0.5rem; background-color: var(--primary-light); border-radius: var(--radius); font-size: 0.7rem; color: var(--text-muted);">
                        ğŸ’¡ <strong>ê²€ìƒ‰ íŒ:</strong> ì£¼ë¬¸ë²ˆí˜¸, ê³ ê°ëª…, ì—°ë½ì²˜, ì‚¬ì´íŠ¸ëª…, í’ˆë²ˆ, ìƒ‰ìƒ, ì‚¬ì´ì¦ˆ, ìš´ì†¡ì¥ë²ˆí˜¸, ìœ í˜•, ë°˜í’ˆì‚¬ìœ , ì²˜ë¦¬ì, ë¹„ê³  ë“± ëª¨ë“  ì •ë³´ë¥¼ í•˜ë‚˜ì˜ ê²€ìƒ‰ì°½ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br/>
                        ğŸ¯ <strong>ì™„ë£Œ ìƒíƒœ ê²€ìƒ‰:</strong> "ì™„ë£Œ" ë˜ëŠ” "ì „ì²´ì™„ë£Œ" â†’ ì™„ë£Œëœ ê±´ë§Œ ì¡°íšŒ | "ë¯¸ì™„ë£Œ" ë˜ëŠ” "ì§„í–‰ì¤‘" â†’ ë¯¸ì™„ë£Œ ê±´ë§Œ ì¡°íšŒ | "Y" â†’ ì™„ë£Œ | "N" â†’ ë¯¸ì™„ë£Œ
                    </div>
                </form>
            </div>

            <!-- ë°ì´í„° í…Œì´ë¸” -->
            <div class="table-container">
                <div class="table-header">
                    <h3>êµí™˜/ë°˜í’ˆ ëª©ë¡</h3>
                    <div class="table-meta">
                        <span th:text="${returnItems != null ? 'ì´ ' + returnItems.totalElements + 'ê±´' : 'ì´ 0ê±´'}">ì´ 0ê±´</span>
                    </div>
                </div>
                
                <div class="table-wrapper">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th style="width: 35px;"><input type="checkbox" id="selectAll"></th>
                                <th style="width: 50px;">ìœ í˜•</th>
                                <th style="width: 60px;">ì£¼ë¬¸ì¼</th>
                                <th style="width: 60px;">CSì ‘ìˆ˜ì¼</th>
                                <th style="width: 80px;">ì‚¬ì´íŠ¸</th>
                                <th style="width: 100px;">ì£¼ë¬¸ë²ˆí˜¸</th>
                                <th style="width: 60px;">í™˜ë¶ˆê¸ˆì•¡</th>
                                <th style="width: 60px;">ìˆ˜ì·¨ì¸</th>
                                <th style="width: 85px;">ì—°ë½ì²˜</th>
                                <th style="width: 70px;">ë¬¼ë¥˜í™•ì¸</th>
                                <th style="width: 80px;">ì£¼ë¬¸í’ˆë²ˆ</th>
                                <th style="width: 30px;">ìƒ‰ìƒ</th>
                                <th style="width: 30px;">ì‚¬ì´ì¦ˆ</th>
                                <th style="width: 25px;">ìˆ˜ëŸ‰</th>
                                <th style="width: 55px;">ë°°ì†¡ë¹„</th>
                                <th style="width: 100px;">ğŸ¯ ì…ê¸ˆìƒíƒœ</th>
                                <th style="width: 60px;">ì‚¬ìœ </th>
                                <th style="width: 80px;">ìš´ì†¡ì¥ë²ˆí˜¸</th>
                                <th style="width: 70px;">íšŒìˆ˜ì™„ë£Œ</th>
                                <th style="width: 70px;">ì¶œê³ ì¼ì</th>
                                <th style="width: 70px;">í™˜ë¶ˆì¼ì</th>
                                <th style="width: 40px;">ì™„ë£Œ</th>
                                <th style="width: 80px;">ë¹„ê³ </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="item, iterStat : ${returnItems}" th:if="${returnItems != null and !returnItems.empty}">
                                <td><input type="checkbox" name="selected" th:value="${item.id}"></td>
                                <td>
                                    <span class="type-badge" 
                                          th:classappend="${item.returnTypeCode == 'FULL_RETURN' ? 'full-return' : 
                                                          item.returnTypeCode == 'PARTIAL_RETURN' ? 'partial-return' : 
                                                          item.returnTypeCode == 'FULL_EXCHANGE' ? 'full-exchange' :
                                                          item.returnTypeCode == 'PARTIAL_EXCHANGE' ? 'partial-exchange' :
                                                          item.returnTypeCode == 'EXCHANGE' ? 'exchange' : 'partial-return'}"
                                          th:text="${item.returnTypeCode == 'FULL_RETURN' ? 'ì „ì²´ë°˜í’ˆ' : 
                                                    item.returnTypeCode == 'PARTIAL_RETURN' ? 'ë¶€ë¶„ë°˜í’ˆ' : 
                                                    item.returnTypeCode == 'FULL_EXCHANGE' ? 'ì „ì²´êµí™˜' :
                                                    item.returnTypeCode == 'PARTIAL_EXCHANGE' ? 'ë¶€ë¶„êµí™˜' :
                                                    item.returnTypeCode == 'EXCHANGE' ? 'êµí™˜' : item.returnTypeCode}">ë¶€ë¶„ë°˜í’ˆ</span>
                                </td>
                                <td th:text="${item.orderDate != null ? #temporals.format(item.orderDate, 'MM-dd') : ''}">04-26</td>
                                <td th:text="${item.csReceivedDate != null ? #temporals.format(item.csReceivedDate, 'MM-dd') : ''}">05-03</td>
                                <td class="text-left" th:text="${item.siteName}">ìì‚¬ëª°-ë ˆë…¸ë§ˆ</td>
                                <td class="order-info">
                                    <span class="order-number-copy" 
                                          th:text="${item.orderNumber}" 
                                          th:data-order-number="${item.orderNumber}"
                                          onclick="copyOrderNumber(this)"
                                          title="í´ë¦­í•˜ë©´ ì£¼ë¬¸ë²ˆí˜¸ê°€ ë³µì‚¬ë©ë‹ˆë‹¤">20250426-0001236-03</span>
                                </td>
                                <td class="money-info" th:text="${item.refundAmount != null ? #numbers.formatInteger(item.refundAmount, 0, 'COMMA') : ''}">39,200</td>
                                <td class="important-info">
                                    <span class="customer-name-copy" 
                                          th:text="${item.customerName}" 
                                          th:data-customer-name="${item.customerName}"
                                          onclick="copyCustomerName(this)"
                                          title="í´ë¦­í•˜ë©´ ê³ ê°ëª…ì´ ë³µì‚¬ë©ë‹ˆë‹¤">ê¹€ë¯¼ì§€</span>
                                </td>
                                <td class="contact-info">
                                    <span class="customer-phone-copy" 
                                          th:text="${item.customerPhone}" 
                                          th:data-customer-phone="${item.customerPhone}"
                                          onclick="copyCustomerPhone(this)"
                                          title="í´ë¦­í•˜ë©´ ì—°ë½ì²˜ê°€ ë³µì‚¬ë©ë‹ˆë‹¤">010-7409-5050</span>
                                </td>
                                <td>
                                    <div style="display: flex; align-items: center; gap: 0.25rem;">
                                        <input type="date" 
                                               class="form-control date-input" 
                                               data-field="logisticsConfirmedDate"
                                               th:data-id="${item.id}"
                                               th:value="${item.logisticsConfirmedDate}"
                                               onchange="markDateAsChanged(this)"
                                               style="width: 140px; font-size: 1.2rem; padding: 0.6rem; min-height: 45px; font-weight: 600;">
                                        <button type="button" 
                                                class="btn-clear-date" 
                                                th:data-id="${item.id}"
                                                data-field="logisticsConfirmedDate"
                                                onclick="clearDateField(this)"
                                                title="ë‚ ì§œ ì´ˆê¸°í™”"
                                                style="background: none; border: none; color: #dc3545; cursor: pointer; padding: 0.2rem; font-size: 0.7rem; width: 18px; height: 18px; display: flex; align-items: center; justify-content: center;">âœ•</button>
                                    </div>
                                </td>
                                <td class="order-info">
                                    <span class="order-item-code-copy" 
                                          th:text="${item.orderItemCode}" 
                                          th:data-order-item-code="${item.orderItemCode}"
                                          onclick="copyOrderItemCode(this)"
                                          title="í´ë¦­í•˜ë©´ ì£¼ë¬¸í’ˆë²ˆì´ ë³µì‚¬ë©ë‹ˆë‹¤">RN-GSZD962</span>
                                </td>
                                <td th:text="${item.productColor}">PK</td>
                                <td th:text="${item.productSize}">75</td>
                                <td th:text="${item.quantity}">1</td>
                                <td class="text-center">
                                    <span th:if="${item.shippingFee != null and item.shippingFee == 'ì…ê¸ˆí•„ìš”'}" 
                                          class="badge bg-danger text-white">ì…ê¸ˆí•„ìš”</span>
                                    <span th:if="${item.shippingFee != null and item.shippingFee == 'ì…ê¸ˆëŒ€ê¸°'}" 
                                          class="badge bg-warning text-dark">ì…ê¸ˆëŒ€ê¸°</span>
                                    <span th:if="${item.shippingFee != null and item.shippingFee != 'ì…ê¸ˆí•„ìš”' and item.shippingFee != 'ì…ê¸ˆëŒ€ê¸°'}" 
                                          class="money-info" 
                                          th:text="${item.shippingFee matches '[0-9]+' ? #numbers.formatInteger(T(java.lang.Integer).parseInt(item.shippingFee), 0, 'COMMA') : item.shippingFee}">3,000</span>
                                </td>
                                <td class="text-center">
                                    <span th:if="${item.paymentStatus == 'COMPLETED'}" 
                                          class="badge bg-success text-white" 
                                          th:text="${item.paymentStatusText}">ì…ê¸ˆì™„ë£Œ</span>
                                    <span th:if="${item.paymentStatus == 'PENDING'}" 
                                          class="badge bg-warning text-dark" 
                                          th:text="${item.paymentStatusText}">ì…ê¸ˆëŒ€ê¸°</span>
                                    <span th:if="${item.paymentStatus == 'NOT_REQUIRED'}" 
                                          class="badge bg-info text-white" 
                                          th:text="${item.paymentStatusText}">ì…ê¸ˆë¶ˆí•„ìš”</span>
                                    <span th:if="${item.paymentStatus != 'COMPLETED' and item.paymentStatus != 'PENDING' and item.paymentStatus != 'NOT_REQUIRED'}" 
                                          class="badge bg-secondary text-white" 
                                          th:text="${item.paymentStatusText}">ê¸°íƒ€</span>
                                </td>
                                <td class="text-left" th:text="${item.returnReason}">ê³ ê°ë³€ì‹¬</td>
                                <td class="order-info">
                                    <span class="tracking-number-copy" 
                                          th:text="${item.trackingNumber}" 
                                          th:data-tracking-number="${item.trackingNumber}"
                                          onclick="copyTrackingNumber(this)"
                                          title="í´ë¦­í•˜ë©´ ìš´ì†¡ì¥ë²ˆí˜¸ê°€ ë³µì‚¬ë©ë‹ˆë‹¤">5738757014</span>
                                </td>
                                <td class="date-cell" th:text="${item.collectionCompletedDate != null ? #temporals.format(item.collectionCompletedDate, 'yyyy-MM-dd') : ''}">2025-01-10</td>
                                <td class="date-cell" th:text="${item.shippingDate != null ? #temporals.format(item.shippingDate, 'yyyy-MM-dd') : ''}">2025-01-12</td>
                                <td class="date-cell" th:text="${item.refundDate != null ? #temporals.format(item.refundDate, 'yyyy-MM-dd') : ''}">2025-01-14</td>
                                <td>
                                    <input type="checkbox" 
                                           th:checked="${item.isCompleted}" 
                                           th:data-id="${item.id}"
                                           onchange="markCompletionAsChanged(this)"
                                           style="transform: scale(1.2);">
                                </td>
                                <td class="text-left" th:text="${item.remarks}"></td>
                                <!--<td>
                                    <a th:href="@{'/exchange/view/' + ${item.id}}" class="action-link" style="font-size: 1.0rem; font-weight: 600;">ë³´ê¸°</a>
                                     ìˆ˜ì •, ì‚­ì œ ë²„íŠ¼ ì£¼ì„ ì²˜ë¦¬
                                     |
                                    <a th:href="@{'/exchange/edit/' + ${item.id}}" class="action-link">ìˆ˜ì •</a> |
                                    <a href="#" th:onclick="'if(confirm(&quot;ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?&quot;)) { 
                                        fetch(&quot;/exchange/api/&quot; + ' + ${item.id} + ', { 
                                            method: &quot;DELETE&quot;, 
                                            headers: { &quot;Content-Type&quot;: &quot;application/json&quot; } 
                                        }).then(response => { 
                                            if(response.ok) { 
                                                alert(&quot;ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.&quot;); 
                                                location.reload(); 
                                            } else { 
                                                alert(&quot;ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.&quot;); 
                                            } 
                                        }).catch(error => { 
                                            alert(&quot;ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.&quot;); 
                                        }); 
                                    }'" class="action-link danger">ì‚­ì œ</a>

                                </td>-->
                            </tr>
                            <tr th:if="${returnItems == null or returnItems.empty}">
                                <td colspan="24" class="no-data">ë“±ë¡ëœ êµí™˜/ë°˜í’ˆ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
                <div class="pagination-container" th:if="${returnItems != null and returnItems.totalPages > 1}">
                    <ul class="pagination">
                        <!-- ì²« í˜ì´ì§€ -->
                        <li th:if="${currentPage > 0}">
                            <a class="page-link" th:href="@{${currentFilters != null and currentFilters != '' ? '/exchange/list/filters' : '/exchange/list'}(
                                page=0, 
                                size=${returnItems.size},
                                keyword=${searchDTO != null ? searchDTO.keyword : ''},
                                startDate=${searchDTO != null ? searchDTO.startDate : ''},
                                endDate=${searchDTO != null ? searchDTO.endDate : ''},
                                filters=${currentFilters != null ? currentFilters : ''}
                            )}">&laquo;</a>
                        </li>
                        <!-- ì´ì „ í˜ì´ì§€ -->
                        <li th:if="${currentPage > 0}">
                            <a class="page-link" th:href="@{${currentFilters != null and currentFilters != '' ? '/exchange/list/filters' : '/exchange/list'}(
                                page=${currentPage - 1}, 
                                size=${returnItems.size},
                                keyword=${searchDTO != null ? searchDTO.keyword : ''},
                                startDate=${searchDTO != null ? searchDTO.startDate : ''},
                                endDate=${searchDTO != null ? searchDTO.endDate : ''},
                                filters=${currentFilters != null ? currentFilters : ''}
                            )}">&lt;</a>
                        </li>
                        
                        <!-- í˜ì´ì§€ ë²ˆí˜¸ë“¤ -->
                        <li th:each="i : ${#numbers.sequence(T(java.lang.Math).max(0, currentPage - 2), T(java.lang.Math).min(returnItems.totalPages - 1, currentPage + 2))}">
                            <a class="page-link" 
                               th:href="@{${currentFilters != null and currentFilters != '' ? '/exchange/list/filters' : '/exchange/list'}(
                                   page=${i}, 
                                   size=${returnItems.size},
                                   keyword=${searchDTO != null ? searchDTO.keyword : ''},
                                   startDate=${searchDTO != null ? searchDTO.startDate : ''},
                                   endDate=${searchDTO != null ? searchDTO.endDate : ''},
                                   filters=${currentFilters != null ? currentFilters : ''}
                               )}"
                               th:text="${i + 1}"
                               th:classappend="${i == currentPage ? 'active' : ''}">1</a>
                        </li>
                        
                        <!-- ë‹¤ìŒ í˜ì´ì§€ -->
                        <li th:if="${currentPage < returnItems.totalPages - 1}">
                            <a class="page-link" th:href="@{${currentFilters != null and currentFilters != '' ? '/exchange/list/filters' : '/exchange/list'}(
                                page=${currentPage + 1}, 
                                size=${returnItems.size},
                                keyword=${searchDTO != null ? searchDTO.keyword : ''},
                                startDate=${searchDTO != null ? searchDTO.startDate : ''},
                                endDate=${searchDTO != null ? searchDTO.endDate : ''},
                                filters=${currentFilters != null ? currentFilters : ''}
                            )}">&gt;</a>
                        </li>
                        <!-- ë§ˆì§€ë§‰ í˜ì´ì§€ -->
                        <li th:if="${currentPage < returnItems.totalPages - 1}">
                            <a class="page-link" th:href="@{${currentFilters != null and currentFilters != '' ? '/exchange/list/filters' : '/exchange/list'}(
                                page=${returnItems.totalPages - 1}, 
                                size=${returnItems.size},
                                keyword=${searchDTO != null ? searchDTO.keyword : ''},
                                startDate=${searchDTO != null ? searchDTO.startDate : ''},
                                endDate=${searchDTO != null ? searchDTO.endDate : ''},
                                filters=${currentFilters != null ? currentFilters : ''}
                            )}">&raquo;</a>
                        </li>
                    </ul>
                </div>
            </div>
                </div>
                <!--end::Content container-->
            </div>
            <!--end::Content-->
        </div>
        <!--end::Content wrapper-->
    </div>
    <!--end::App main-->

    <!-- JavaScript -->
    <script th:inline="javascript">
        console.log('ğŸ”¥ ì„œë²„ ê¸°ë°˜ í•„í„°ë§ ì‹œìŠ¤í…œ ë¡œë”©...');
        
        // CSRF í† í°ì„ ì „ì—­ ë³€ìˆ˜ë¡œ ì„¤ì •
        window.csrfToken = /*[[${_csrf != null ? _csrf.token : ''}]]*/ '';
        window.csrfHeader = /*[[${_csrf != null ? _csrf.headerName : 'X-CSRF-TOKEN'}]]*/ 'X-CSRF-TOKEN';
        
        // ğŸ¯ ì„ íƒëœ í•„í„°ë“¤ì„ ì €ì¥í•˜ëŠ” Set
        let selectedFilters = new Set();
        
        // ğŸ¯ í˜ì´ì§€ ë¡œë“œ ì‹œ í˜„ì¬ ì ìš©ëœ í•„í„°ë“¤ì„ selectedFiltersì— ì¶”ê°€
        const currentFilters = /*[[${currentFilters}]]*/ '';
        if (currentFilters && currentFilters.trim() !== '') {
            const filtersArray = currentFilters.split(',');
            filtersArray.forEach(filter => {
                selectedFilters.add(filter.trim());
            });
            
            // í•´ë‹¹ í•„í„° ë²„íŠ¼ë“¤ì„ í™œì„±í™” ìƒíƒœë¡œ í‘œì‹œ
            selectedFilters.forEach(filter => {
                const button = document.querySelector(`button[data-filter="${filter}"]`);
                if (button) {
                    button.classList.add('active');
                }
            });
        }
        
        // ğŸ¯ í•„í„° í† ê¸€ í•¨ìˆ˜ (ë‹¤ì¤‘ ì„ íƒ ê°€ëŠ¥)
        function toggleFilter(button) {
            const filterType = button.getAttribute('data-filter');
            
            if (selectedFilters.has(filterType)) {
                // ì´ë¯¸ ì„ íƒëœ í•„í„°ë©´ ì œê±°
                selectedFilters.delete(filterType);
                button.classList.remove('active');
                console.log('âŒ í•„í„° ì œê±°:', filterType);
                    } else {
                // ìƒˆë¡œìš´ í•„í„° ì¶”ê°€
                selectedFilters.add(filterType);
                button.classList.add('active');
                console.log('âœ… í•„í„° ì¶”ê°€:', filterType);
            }
            
            console.log('ğŸ¯ í˜„ì¬ ì„ íƒëœ í•„í„°ë“¤:', Array.from(selectedFilters));
        }
        
        // ğŸ¯ ì„ íƒí•œ í•„í„°ë“¤ ì ìš©
        function applySelectedFilters() {
            if (selectedFilters.size === 0) {
                alert('ì„ íƒëœ í•„í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ìµœì†Œ 1ê°œ ì´ìƒì˜ í•„í„°ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return;
                }
                
            console.log('ğŸ¯ í•„í„° ì ìš©:', Array.from(selectedFilters));
            
            // í˜„ì¬ ê²€ìƒ‰ ì¡°ê±´ë“¤ ê°€ì ¸ì˜¤ê¸°
            const keyword = document.getElementById('keyword').value || '';
            const startDate = document.getElementById('startDate').value || '';
            const endDate = document.getElementById('endDate').value || '';
            
            // ì„ íƒëœ í•„í„°ë“¤ì„ ì‰¼í‘œë¡œ êµ¬ë¶„ëœ ë¬¸ìì—´ë¡œ ë³€í™˜
            const filtersString = Array.from(selectedFilters).join(',');
            
            // ì„œë²„ë¡œ ì´ë™
            const url = new URL('/exchange/list/filters', window.location.origin);
            url.searchParams.set('filters', filtersString);
            url.searchParams.set('page', '0');
            url.searchParams.set('size', '20');
            
            if (keyword.trim()) url.searchParams.set('keyword', keyword.trim());
            if (startDate.trim()) url.searchParams.set('startDate', startDate.trim());
            if (endDate.trim()) url.searchParams.set('endDate', endDate.trim());
            
            console.log('ğŸš€ ì„œë²„ë¡œ ì´ë™:', url.toString());
            window.location.href = url.toString();
        }
        
        // ğŸ”„ ëª¨ë“  í•„í„° í•´ì œ
        function clearAllFilters() {
            console.log('ğŸ”„ ëª¨ë“  í•„í„° í•´ì œ');
            
            // ì„ íƒëœ í•„í„°ë“¤ ì´ˆê¸°í™”
            selectedFilters.clear();
            
            // ëª¨ë“  í•„í„° ë²„íŠ¼ ë¹„í™œì„±í™”
            document.querySelectorAll('.filter-btn').forEach(button => {
                button.classList.remove('active');
            });
            
            // ê¸°ë³¸ ëª©ë¡ í˜ì´ì§€ë¡œ ì´ë™ (ê²€ìƒ‰ ì¡°ê±´ì€ ìœ ì§€)
            const keyword = document.getElementById('keyword').value || '';
            const startDate = document.getElementById('startDate').value || '';
            const endDate = document.getElementById('endDate').value || '';
            
            const url = new URL('/exchange/list', window.location.origin);
            url.searchParams.set('page', '0');
            url.searchParams.set('size', '20');
            
            if (keyword.trim()) url.searchParams.set('keyword', keyword.trim());
            if (startDate.trim()) url.searchParams.set('startDate', startDate.trim());
            if (endDate.trim()) url.searchParams.set('endDate', endDate.trim());
            
            console.log('ğŸš€ ê¸°ë³¸ ëª©ë¡ìœ¼ë¡œ ì´ë™:', url.toString());
            window.location.href = url.toString();
        }
        
        // ğŸš€ í…Œì´ë¸” ë°ì´í„° ì—…ë°ì´íŠ¸ (AJAX ê²°ê³¼ë¡œ)
        function updateTableWithFilteredData(data, filterType) {
            console.log('ğŸ” í…Œì´ë¸” ì—…ë°ì´íŠ¸ ì‹œì‘ - data:', data, 'filterType:', filterType);
            
            const tbody = document.querySelector('.data-table tbody');
            if (!tbody) {
                console.error('âŒ í…Œì´ë¸” ë³¸ë¬¸ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                return;
            }
            
            // ğŸ“‹ ì•ˆì „í•œ ë°ì´í„° ì²˜ë¦¬ (null/undefined ì²´í¬)
            if (!data || !Array.isArray(data)) {
                console.warn('âš ï¸ ë°ì´í„°ê°€ ë°°ì—´ì´ ì•„ë‹ˆê±°ë‚˜ nullì…ë‹ˆë‹¤:', data);
                data = [];  // ë¹ˆ ë°°ì—´ë¡œ ì´ˆê¸°í™”
            }
            
            // í…Œì´ë¸” ë‚´ìš© êµì²´
            tbody.innerHTML = '';
            
            if (data.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="20" style="text-align: center; padding: 2rem; color: #666;">
                            í•´ë‹¹ ì¡°ê±´ì— ë§ëŠ” ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.
                        </td>
                    </tr>
                `;
                return;
            }
            
            data.forEach((item, index) => {
                const row = createTableRow(item, index);
                tbody.appendChild(row);
            });
            
            console.log('âœ… í…Œì´ë¸” ì—…ë°ì´íŠ¸ ì™„ë£Œ:', data.length, 'ê±´');
            
            // ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸ ë‹¤ì‹œ ë“±ë¡
            reattachCheckboxEvents();
        }
        
        // ğŸš€ ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸ ë‹¤ì‹œ ë“±ë¡
        function reattachCheckboxEvents() {
            // í—¤ë” ì²´í¬ë°•ìŠ¤ ì´ˆê¸°í™”
            const selectAllCheckbox = document.getElementById('selectAll');
            if (selectAllCheckbox) {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = false;
            }
            
            // ê°œë³„ ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸ ì¬ë“±ë¡
            const rowCheckboxes = document.querySelectorAll('input[name="selected"]');
            rowCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', updateSelectAllState);
            });
            
            console.log('âœ… ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸ ì¬ë“±ë¡ ì™„ë£Œ:', rowCheckboxes.length, 'ê°œ');
        }
        
        // í…Œì´ë¸” í–‰ ìƒì„±
        function createTableRow(item, index) {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td class="text-center">
                    <input type="checkbox" name="selected" value="${item.returnId}">
                </td>
                <td class="text-center">${index + 1}</td>
                <td class="text-center">${item.returnTypeCode || '-'}</td>
                <td class="text-center">${item.orderDate || '-'}</td>
                <td class="text-center">${item.csReceivedDate || '-'}</td>
                <td class="text-left">${item.siteName || '-'}</td>
                <td class="order-info">
                    <span class="order-number-copy" data-order-number="${item.orderNumber}" onclick="copyOrderNumber(this)" title="í´ë¦­í•˜ë©´ ì£¼ë¬¸ë²ˆí˜¸ê°€ ë³µì‚¬ë©ë‹ˆë‹¤">
                        ${item.orderNumber || '-'}
                        </span>
                </td>
                <td class="text-right">${item.refundAmount ? Number(item.refundAmount).toLocaleString() + 'ì›' : '-'}</td>
                <td class="text-left">${item.customerName || '-'}</td>
                <td class="text-left">${item.customerPhone || '-'}</td>
                <td class="text-left">${item.orderItemCode || '-'}</td>
                <td class="text-left">${item.productColor || '-'}</td>
                <td class="text-left">${item.productSize || '-'}</td>
                <td class="text-center">${item.quantity || '-'}</td>
                <td class="text-center">${item.shippingFee || '-'}</td>
                <td class="text-center">
                    <span class="badge ${getPaymentStatusClass(item.paymentStatus)}">
                        ${getPaymentStatusText(item)}
                        </span>
                </td>
                <td class="text-left">${item.returnReason || '-'}</td>
                <td class="order-info">
                    <span class="tracking-number-copy" data-tracking-number="${item.trackingNumber}" onclick="copyTrackingNumber(this)" title="í´ë¦­í•˜ë©´ ìš´ì†¡ì¥ë²ˆí˜¸ê°€ ë³µì‚¬ë©ë‹ˆë‹¤">
                        ${item.trackingNumber || '-'}
                    </span>
                </td>
                <td class="text-center date-editable">
                    <input type="date" value="${item.collectionCompletedDate || ''}" data-id="${item.returnId}" data-field="collectionCompletedDate" onchange="markDateAsChanged(this)" style="width: 100%; border: none; background: transparent;">
                </td>
                <td class="text-center date-editable">
                    <input type="date" value="${item.logisticsConfirmedDate || ''}" data-id="${item.returnId}" data-field="logisticsConfirmedDate" onchange="markDateAsChanged(this)" style="width: 100%; border: none; background: transparent;">
                </td>
                <td class="text-center date-editable">
                    <input type="date" value="${item.shippingDate || ''}" data-id="${item.returnId}" data-field="shippingDate" onchange="markDateAsChanged(this)" style="width: 100%; border: none; background: transparent;">
                </td>
                <td class="text-center date-editable">
                    <input type="date" value="${item.refundDate || ''}" data-id="${item.returnId}" data-field="refundDate" onchange="markDateAsChanged(this)" style="width: 100%; border: none; background: transparent;">
                </td>
                <td class="text-center">
                    <span class="badge ${item.isCompleted ? 'bg-success' : 'bg-warning'}">
                        ${item.isCompleted ? 'ì™„ë£Œ' : 'ë¯¸ì™„ë£Œ'}
                    </span>
                </td>
            `;
            return row;
        }
        
        // ê²°ì œ ìƒíƒœ í´ë˜ìŠ¤ ë°˜í™˜
        function getPaymentStatusClass(status) {
            switch(status) {
                case 'COMPLETED': return 'bg-success text-white';
                case 'PENDING': return 'bg-warning text-dark';
                case 'NOT_REQUIRED': return 'bg-info text-white';
                default: return 'bg-secondary text-white';
            }
        }
        
        // ê²°ì œ ìƒíƒœ í…ìŠ¤íŠ¸ ë°˜í™˜
        function getPaymentStatusText(item) {
            if (item.shippingFee === 'ì…ê¸ˆí•„ìš”' || item.shippingFee === 'ì…ê¸ˆëŒ€ê¸°') {
                return 'ì…ê¸ˆí•„ìš”';
            }
            
            switch(item.paymentStatus) {
                case 'PENDING': return 'ì…ê¸ˆí•„ìš”';
                case 'COMPLETED': return 'ì…ê¸ˆì™„ë£Œ';
                case 'NOT_REQUIRED': return 'ì…ê¸ˆë¶ˆí•„ìš”';
                default: return item.paymentStatus || 'ê¸°íƒ€';
            }
        }
        
        // ğŸš€ í•„í„° ë°°ë„ˆ í‘œì‹œ
        function showFilterBanner(filterType, totalCount) {
            // ê¸°ì¡´ ë°°ë„ˆ ì œê±°
            const existingBanner = document.querySelector('.filter-banner');
            if (existingBanner) {
                existingBanner.remove();
            }
            
            const filterNames = {
                'collection-completed': 'ğŸ“¦ íšŒìˆ˜ì™„ë£Œ',
                'collection-pending': 'ğŸ“¦ íšŒìˆ˜ë¯¸ì™„ë£Œ',
                'logistics-confirmed': 'ğŸš› ë¬¼ë¥˜í™•ì¸ì™„ë£Œ',
                'logistics-pending': 'ğŸš› ë¬¼ë¥˜í™•ì¸ë¯¸ì™„ë£Œ',
                'shipping-completed': 'ğŸ“¤ ì¶œê³ ì™„ë£Œ',
                'shipping-pending': 'ğŸ“¤ ì¶œê³ ëŒ€ê¸°',
                'refund-completed': 'ğŸ’° í™˜ë¶ˆì™„ë£Œ',
                'refund-pending': 'ğŸ’° í™˜ë¶ˆëŒ€ê¸°',
                'payment-pending': 'ğŸ’³ ì…ê¸ˆëŒ€ê¸°',
                'payment-completed': 'ğŸ’³ ì…ê¸ˆì™„ë£Œ',
                'completed': 'âœ… ì „ì²´ì™„ë£Œ',
                'incompleted': 'âŒ ë¯¸ì™„ë£Œ'
            };
            
            const filterName = filterNames[filterType] || filterType;
            
            const banner = document.createElement('div');
            banner.className = 'filter-banner';
            banner.innerHTML = `
                <div style="background: linear-gradient(90deg, #28a745, #20c997); color: white; padding: 0.75rem 1.5rem; border-radius: 0.5rem; margin-bottom: 1rem; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);">
                    <span>ğŸ¯ <strong>í•„í„° ì ìš©:</strong> ${filterName} - ${totalCount}ê±´ í‘œì‹œ</span>
                    <button onclick="clearFilterFast()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.25rem 0.75rem; border-radius: 0.25rem; cursor: pointer; font-size: 0.875rem;">âœ• í•„í„° í•´ì œ</button>
                </div>
            `;
            
            const tableContainer = document.querySelector('.table-container');
            tableContainer.parentNode.insertBefore(banner, tableContainer);
        }
        
        // ğŸš€ ë¹ ë¥¸ í•„í„° í•´ì œ (AJAX ë°©ì‹)
        function clearFilterFast() {
            console.log('ğŸš€ ë¹ ë¥¸ í•„í„° í•´ì œ');
            
            // í•„í„° ë°°ë„ˆ ì œê±°
            const existingBanner = document.querySelector('.filter-banner');
            if (existingBanner) {
                existingBanner.remove();
            }
            
            // í™œì„±í™”ëœ ì¹´ë“œ ìŠ¤íƒ€ì¼ ì œê±°
            document.querySelectorAll('.stat-box').forEach(box => {
                box.classList.remove('active');
            });
            
            // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ìœ¼ë¡œ ì›ë˜ ë°ì´í„° ë³µì›
            window.location.href = '/exchange/list';
        }
        
        // ì „ì²´ ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸° (ê¸°ì¡´ í˜¸í™˜ì„± ìœ ì§€)
        function clearFilter() {
            clearFilterFast();
        }
        
        // í˜„ì¬ í•„í„° ìƒíƒœ í‘œì‹œ (ì„œë²„ì—ì„œ ì „ë‹¬ë°›ì€ ê²½ìš°)
        document.addEventListener('DOMContentLoaded', function() {
            const currentFilter = /*[[${currentFilter}]]*/ '';
            if (currentFilter && currentFilter !== 'null' && currentFilter !== '') {
                console.log('ğŸ¯ í˜„ì¬ ì ìš©ëœ í•„í„°:', currentFilter);
                
                // í•´ë‹¹ ì¹´ë“œë¥¼ í™œì„±í™”
                const filterElement = document.querySelector(`[data-filter="${currentFilter}"]`);
                if (filterElement) {
                    const parentCard = filterElement.closest('.stat-box');
                    if (parentCard) {
                        parentCard.classList.add('active');
                    }
                }
                
                // í•„í„° ë°°ë„ˆ í‘œì‹œ (ì„œë²„ì—ì„œ ì „ë‹¬í•˜ë¯€ë¡œ ì£¼ì„ ì²˜ë¦¬)
                // showCurrentFilterBanner(currentFilter);
            }
        });
        
        // í˜„ì¬ í•„í„° ë°°ë„ˆ í‘œì‹œ
        function showCurrentFilterBanner(filterType) {
            const filterNames = {
                'collection-completed': 'ğŸ“¦ íšŒìˆ˜ì™„ë£Œ',
                'collection-pending': 'ğŸ“¦ íšŒìˆ˜ë¯¸ì™„ë£Œ',
                'logistics-confirmed': 'ğŸš› ë¬¼ë¥˜í™•ì¸ì™„ë£Œ',
                'logistics-pending': 'ğŸš› ë¬¼ë¥˜í™•ì¸ë¯¸ì™„ë£Œ',
                'shipping-completed': 'ğŸ“¤ ì¶œê³ ì™„ë£Œ',
                'shipping-pending': 'ğŸ“¤ ì¶œê³ ëŒ€ê¸°',
                'refund-completed': 'ğŸ’° í™˜ë¶ˆì™„ë£Œ',
                'refund-pending': 'ğŸ’° í™˜ë¶ˆëŒ€ê¸°',
                'payment-pending': 'ğŸ’³ ì…ê¸ˆëŒ€ê¸°',
                'payment-completed': 'ğŸ’³ ì…ê¸ˆì™„ë£Œ',
                'completed': 'âœ… ì „ì²´ì™„ë£Œ',
                'incompleted': 'âŒ ë¯¸ì™„ë£Œ'
            };
            
            const filterName = filterNames[filterType] || filterType;
            const totalItems = /*[[${totalItems}]]*/ '0';
            
            const banner = document.createElement('div');
            banner.className = 'filter-banner';
            banner.innerHTML = `
                <div style="background: linear-gradient(90deg, #4361ee, #3f37c9); color: white; padding: 0.75rem 1.5rem; border-radius: 0.5rem; margin-bottom: 1rem; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 8px rgba(67, 97, 238, 0.3);">
                    <span>ğŸ” <strong>í•„í„° ì ìš©ë¨:</strong> ${filterName} - ${totalItems}ê±´ í‘œì‹œ</span>
                    <button onclick="clearFilter()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.25rem 0.75rem; border-radius: 0.25rem; cursor: pointer; font-size: 0.875rem;">âœ• í•„í„° í•´ì œ</button>
                </div>
            `;
            
            const tableContainer = document.querySelector('.table-container');
            tableContainer.parentNode.insertBefore(banner, tableContainer);
        }
        
        // DOM ë¡œë“œ ì™„ë£Œ í›„ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ¯ DOM ë¡œë“œ ì™„ë£Œ - ì¹´ë“œ ì´ë²¤íŠ¸ ë“±ë¡ ì‹œì‘');
            
            // ğŸ¯ ì„ íƒëœ í•„í„°ë“¤ì„ ê´€ë¦¬í•˜ëŠ” Set
            let selectedFilters = new Set();
            
            // ğŸ¯ í˜„ì¬ ê²€ìƒ‰ ì¡°ê±´ì„ ì½ì–´ì˜¤ëŠ” í•¨ìˆ˜ (filters ì œì™¸)
            function getCurrentSearchParams() {
                const searchForm = document.getElementById('searchForm');
                const formData = new FormData(searchForm);
                const params = new URLSearchParams();
                
                // ê²€ìƒ‰ ì¡°ê±´ë“¤ì„ íŒŒë¼ë¯¸í„°ë¡œ ì¶”ê°€ (filtersëŠ” ì œì™¸)
                for (const [key, value] of formData.entries()) {
                    if (key !== 'filters' && value && value.trim() !== '') {
                        params.append(key, value);
                    }
                }
                
                return params;
            }
            
            // ğŸ¯ ëª¨ë“  ì¡°ê±´(ê²€ìƒ‰ + í•„í„° + í˜ì´ì§€)ì„ í¬í•¨í•œ URL ìƒì„± í•¨ìˆ˜
            function getFullParamsUrl() {
                const params = new URLSearchParams();
                
                // ê²€ìƒ‰ ì¡°ê±´ ì¶”ê°€
                const keyword = document.getElementById('keyword').value.trim();
                if (keyword) {
                    params.append('keyword', keyword);
                }
                
                const startDate = document.getElementById('startDate').value;
                if (startDate) {
                    params.append('startDate', startDate);
                }
                
                const endDate = document.getElementById('endDate').value;
                if (endDate) {
                    params.append('endDate', endDate);
                }
                
                // í•„í„° ì •ë³´ ì¶”ê°€
                if (selectedFilters.size > 0) {
                    const filtersArray = Array.from(selectedFilters);
                    params.append('filters', filtersArray.join(','));
                }
                
                // í˜„ì¬ í˜ì´ì§€ ì •ë³´ ì¶”ê°€
                const currentPage = new URLSearchParams(window.location.search).get('page') || '0';
                params.append('page', currentPage);
                
                return params.toString();
            }
            
            // ğŸ¯ í•„í„° í† ê¸€ í•¨ìˆ˜ (ë‹¤ì¤‘ ì„ íƒ ê°€ëŠ¥)
            function toggleFilter(filterType) {
                if (selectedFilters.has(filterType)) {
                    selectedFilters.delete(filterType);
                } else {
                    selectedFilters.add(filterType);
                }
                
                console.log('ğŸ¯ í•„í„° í† ê¸€:', filterType, 'í˜„ì¬ ì„ íƒëœ í•„í„°:', Array.from(selectedFilters));
            }
            
            // ğŸ¯ ì„ íƒí•œ í•„í„°ë“¤ ì ìš© (ì„œë²„ ë°©ì‹)
            function applySelectedFilters() {
                const searchParams = getCurrentSearchParams();
                searchParams.set('page', '0');
                
                if (selectedFilters.size > 0) {
                    const filterParams = Array.from(selectedFilters).join(',');
                    searchParams.append('filters', filterParams);
                }
                
                const urlWithParams = `/exchange/list/filters${searchParams.toString() ? '?' + searchParams.toString() : ''}`;
                window.location.href = urlWithParams;
            }
            
            // ğŸ¯ ëª¨ë“  í•„í„° í•´ì œ
            function clearAllFilters() {
                selectedFilters.clear();
                
                // ê²€ìƒ‰ ì¡°ê±´ì´ ìˆìœ¼ë©´ ê²€ìƒ‰ ì¡°ê±´ë§Œìœ¼ë¡œ ì¡°íšŒ, ì—†ìœ¼ë©´ ì „ì²´ ëª©ë¡
                const searchForm = document.getElementById('searchForm');
                const formData = new FormData(searchForm);
                const hasSearchCondition = (formData.get('keyword') && formData.get('keyword').trim() !== '') ||
                                          formData.get('startDate') || formData.get('endDate');
                
                if (hasSearchCondition) {
                    searchForm.submit();
                } else {
                    window.location.href = '/exchange/list';
                }
            }
            
            // ğŸ¯ ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸ ë“±ë¡
            setTimeout(function() {
                // í—¤ë” ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
                const selectAllCheckbox = document.getElementById('selectAll');
                if (selectAllCheckbox) {
                    selectAllCheckbox.addEventListener('change', toggleSelectAll);
                    console.log('âœ… í—¤ë” ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸ ë“±ë¡ ì™„ë£Œ');
                }
                
                // ê°œë³„ ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
                const rowCheckboxes = document.querySelectorAll('input[name="selected"]');
                rowCheckboxes.forEach(checkbox => {
                    checkbox.addEventListener('change', updateSelectAllState);
                });
                console.log('âœ… ê°œë³„ ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸ ë“±ë¡ ì™„ë£Œ:', rowCheckboxes.length, 'ê°œ');
                
                // ğŸš€ ì¹´ë“œ í´ë¦­ ì´ë²¤íŠ¸ ë“±ë¡ (sample/list.html ë°©ì‹)
                const cardMappings = [
                    { selector: '[data-filter="collection-completed"]', filterType: 'collection-completed' },
                    { selector: '[data-filter="collection-pending"]', filterType: 'collection-pending' },
                    { selector: '[data-filter="logistics-confirmed"]', filterType: 'logistics-confirmed' },
                    { selector: '[data-filter="logistics-pending"]', filterType: 'logistics-pending' },
                    { selector: '[data-filter="shipping-completed"]', filterType: 'shipping-completed' },
                    { selector: '[data-filter="shipping-pending"]', filterType: 'shipping-pending' },
                    { selector: '[data-filter="refund-completed"]', filterType: 'refund-completed' },
                    { selector: '[data-filter="refund-pending"]', filterType: 'refund-pending' },
                    { selector: '[data-filter="payment-pending"]', filterType: 'payment-pending' },
                    { selector: '[data-filter="payment-completed"]', filterType: 'payment-completed' },
                    { selector: '[data-filter="completed"]', filterType: 'completed' },
                    { selector: '[data-filter="incompleted"]', filterType: 'incompleted' },
                    { selector: '[data-filter="overdue-ten-days"]', filterType: 'overdue-ten-days' }
                ];
                
                cardMappings.forEach(mapping => {
                    const elements = document.querySelectorAll(mapping.selector);
                    console.log(`ğŸ”— ${mapping.selector} ìš”ì†Œ ê°œìˆ˜:`, elements.length);
                    
                    elements.forEach(element => {
                        element.style.cursor = 'pointer';
                        element.style.transition = 'all 0.2s ease';
                        
                        element.addEventListener('click', function(e) {
                            e.stopPropagation();
                            console.log('ğŸ¯ ì¹´ë“œ í´ë¦­ (ì„œë²„ ë°©ì‹):', mapping.filterType);
                            
                            // ğŸ¯ ê°œë³„ ì¹´ë“œ í™œì„± ìƒíƒœ í† ê¸€
                            const parentCard = this.closest('.stat-box');
                            if (parentCard) {
                                if (selectedFilters.has(mapping.filterType)) {
                                    // ì´ë¯¸ í™œì„±í™”ëœ í•„í„°ë©´ ë¹„í™œì„±í™”
                                    parentCard.classList.remove('active');
                                    selectedFilters.delete(mapping.filterType);
                                } else {
                                    // ë¹„í™œì„±í™”ëœ í•„í„°ë©´ í™œì„±í™”
                                parentCard.classList.add('active');
                                    selectedFilters.add(mapping.filterType);
                                }
                            }
                            
                            // ğŸš€ ë°”ë¡œ ì„œë²„ë¡œ ì´ë™
                            applySelectedFilters();
                        });
                        
                        // í˜¸ë²„ íš¨ê³¼
                        element.addEventListener('mouseenter', function() {
                            this.style.transform = 'scale(1.1)';
                            this.style.textShadow = '0 2px 4px rgba(0,0,0,0.3)';
                        });
                        
                        element.addEventListener('mouseleave', function() {
                            this.style.transform = 'scale(1)';
                            this.style.textShadow = 'none';
                        });
                    });
                });
                
                console.log('âœ… ëª¨ë“  ì¹´ë“œ ì´ë²¤íŠ¸ ë“±ë¡ ì™„ë£Œ - ì„œë²„ ë°©ì‹ ì ìš©');
            }, 500);
            
            // ğŸ¯ í˜ì´ì§€ ë¡œë“œ ì‹œ URL íŒŒë¼ë¯¸í„°ì—ì„œ í•„í„° ìƒíƒœ ë³µì›
            function syncFiltersFromUrl() {
                const urlParams = new URLSearchParams(window.location.search);
                const urlFilters = urlParams.get('filters');
                
                if (urlFilters) {
                    const filters = urlFilters.split(',').map(f => f.trim()).filter(f => f);
                    filters.forEach(filter => {
                        selectedFilters.add(filter);
                        
                        // í•´ë‹¹ í•„í„° ì¹´ë“œë“¤ì„ í™œì„± ìƒíƒœë¡œ í‘œì‹œ
                        const filterElement = document.querySelector(`[data-filter="${filter}"]`);
                        if (filterElement) {
                            const parentCard = filterElement.closest('.stat-box');
                            if (parentCard) {
                                parentCard.classList.add('active');
                            }
                        }
                    });
                    
                    // í•„í„° ë°°ë„ˆ í‘œì‹œ
                    if (filters.length > 0) {
                        showCurrentFilterBanner(filters);
                    }
                }
            }
            
            // ğŸ¯ ë‹¤ì¤‘ í•„í„° ë°°ë„ˆ í‘œì‹œ
            function showCurrentFilterBanner(filters) {
                const filterNames = {
                    'collection-completed': 'íšŒìˆ˜ì™„ë£Œ',
                    'collection-pending': 'íšŒìˆ˜ë¯¸ì™„ë£Œ',
                    'logistics-confirmed': 'ë¬¼ë¥˜í™•ì¸ì™„ë£Œ',
                    'logistics-pending': 'ë¬¼ë¥˜í™•ì¸ë¯¸ì™„ë£Œ',
                    'shipping-completed': 'ì¶œê³ ì™„ë£Œ',
                    'shipping-pending': 'ì¶œê³ ëŒ€ê¸°',
                    'refund-completed': 'í™˜ë¶ˆì™„ë£Œ',
                    'refund-pending': 'í™˜ë¶ˆëŒ€ê¸°',
                    'payment-pending': 'ì…ê¸ˆëŒ€ê¸°',
                    'payment-completed': 'ì…ê¸ˆì™„ë£Œ',
                    'completed': 'ì „ì²´ì™„ë£Œ',
                    'incompleted': 'ë¯¸ì™„ë£Œ',
                    'overdue-ten-days': 'ì²˜ë¦¬ê¸°ê°„ ì„ë°•'
                };
                
                const filterArray = Array.isArray(filters) ? filters : [filters];
                const totalItems = /*[[${totalItems}]]*/ '0';
                
                // ê°œë³„ í•„í„° ë°°ì§€ ìƒì„±
                const filterBadges = filterArray.map(filter => {
                    const displayName = filterNames[filter] || filter;
                    return `<span class="filter-badge" style="background: rgba(255,255,255,0.2); padding: 0.25rem 0.5rem; border-radius: 1rem; font-size: 0.75rem; margin-right: 0.5rem; display: inline-flex; align-items: center; gap: 0.25rem;">
                        ${displayName}
                        <button onclick="removeFilter('${filter}')" style="background: rgba(255,255,255,0.3); border: none; color: white; border-radius: 50%; width: 1rem; height: 1rem; font-size: 0.6rem; cursor: pointer; display: flex; align-items: center; justify-content: center;" title="ì´ í•„í„° ì œê±°">Ã—</button>
                    </span>`;
                }).join('');
                
                const banner = document.createElement('div');
                banner.className = 'filter-banner';
                banner.innerHTML = `
                    <div style="background: linear-gradient(90deg, #4361ee, #3f37c9); color: white; padding: 0.75rem 1.5rem; border-radius: 0.5rem; margin-bottom: 1rem; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 8px rgba(67, 97, 238, 0.3);">
                        <div style="flex: 1;">
                            <div style="margin-bottom: 0.25rem;">ğŸ” <strong>í•„í„° ì ìš©ë¨:</strong> ${totalItems}ê±´ í‘œì‹œ <small>(${filterArray.length}ê°œ í•„í„° í™œì„±)</small></div>
                            <div style="display: flex; flex-wrap: wrap; gap: 0.25rem;">
                                ${filterBadges}
                            </div>
                        </div>
                        <div>
                            <button onclick="clearAllFilters()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.25rem 0.75rem; border-radius: 0.25rem; cursor: pointer; font-size: 0.875rem; margin-left: 0.5rem;">âœ• ëª¨ë“  í•„í„° í•´ì œ</button>
                        </div>
                    </div>
                `;
                
                const tableContainer = document.querySelector('.table-container');
                if (tableContainer) {
                    tableContainer.parentNode.insertBefore(banner, tableContainer);
                }
            }
            
            // ğŸ¯ ê°œë³„ í•„í„° ì œê±° í•¨ìˆ˜
            window.removeFilter = function(filterType) {
                selectedFilters.delete(filterType);
                
                // í•´ë‹¹ ì¹´ë“œì˜ í™œì„± ìƒíƒœ ì œê±°
                const filterElement = document.querySelector(`[data-filter="${filterType}"]`);
                if (filterElement) {
                    const parentCard = filterElement.closest('.stat-box');
                    if (parentCard) {
                        parentCard.classList.remove('active');
                    }
                }
                
                // ì„œë²„ë¡œ ì´ë™
                applySelectedFilters();
            };
            
            // ğŸ¯ ì „ì—­ í•¨ìˆ˜ë¡œ ë“±ë¡
            window.clearAllFilters = clearAllFilters;
            
            // ğŸ¯ í˜ì´ì§€ ë¡œë“œ ì‹œ í•„í„° ìƒíƒœ ë³µì›
            syncFiltersFromUrl();
        });
        
        // ğŸ¯ ì „ì²´ ì„ íƒ/í•´ì œ ê¸°ëŠ¥
        function toggleSelectAll() {
            const selectAllCheckbox = document.getElementById('selectAll');
            const rowCheckboxes = document.querySelectorAll('input[name="selected"]');
            
            console.log('ğŸ”„ ì „ì²´ ì„ íƒ í† ê¸€:', selectAllCheckbox.checked);
            console.log('ğŸ“ ëŒ€ìƒ ì²´í¬ë°•ìŠ¤ ê°œìˆ˜:', rowCheckboxes.length);
            
            // ëª¨ë“  í–‰ ì²´í¬ë°•ìŠ¤ë¥¼ í—¤ë” ì²´í¬ë°•ìŠ¤ ìƒíƒœì— ë§ì¶¤
            rowCheckboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
            });
            
            // ì„ íƒëœ ê°œìˆ˜ ì—…ë°ì´íŠ¸
            updateSelectedCount();
        }
        
        // ê°œë³„ ì²´í¬ë°•ìŠ¤ í´ë¦­ ì‹œ í—¤ë” ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateSelectAllState() {
            const selectAllCheckbox = document.getElementById('selectAll');
            const rowCheckboxes = document.querySelectorAll('input[name="selected"]');
            const checkedCount = document.querySelectorAll('input[name="selected"]:checked').length;
            
            console.log('ğŸ“Š ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸:', checkedCount, '/', rowCheckboxes.length);
            
            if (checkedCount === 0) {
                // ì•„ë¬´ê²ƒë„ ì„ íƒë˜ì§€ ì•ŠìŒ
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = false;
            } else if (checkedCount === rowCheckboxes.length) {
                // ëª¨ë‘ ì„ íƒë¨
                selectAllCheckbox.checked = true;
                selectAllCheckbox.indeterminate = false;
            } else {
                // ì¼ë¶€ë§Œ ì„ íƒë¨ (ì¤‘ê°„ ìƒíƒœ)
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = true;
            }
            
            updateSelectedCount();
        }
        
        // ì„ íƒëœ í•­ëª© ê°œìˆ˜ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateSelectedCount() {
            const checkedCount = document.querySelectorAll('input[name="selected"]:checked').length;
            
            // ê¸°ì¡´ ì¹´ìš´í„° ì œê±°
            const existingCounter = document.querySelector('.selection-counter');
            if (existingCounter) {
                existingCounter.remove();
            }
            
            // ì„ íƒëœ í•­ëª©ì´ ìˆì„ ë•Œë§Œ ì¹´ìš´í„° í‘œì‹œ
            if (checkedCount > 0) {
                const counter = document.createElement('div');
                counter.className = 'selection-counter';
                counter.innerHTML = `
                    <div style="background: linear-gradient(90deg, #35b27f, #2d8659); color: white; padding: 0.5rem 1rem; border-radius: 0.375rem; margin-bottom: 0.5rem; display: inline-flex; align-items: center; gap: 0.5rem; font-size: 0.875rem; box-shadow: 0 2px 4px rgba(53, 178, 127, 0.3);">
                        <span>âœ… <strong>${checkedCount}ê°œ í•­ëª©</strong>ì´ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤</span>
                        <button onclick="clearAllSelections()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.125rem 0.5rem; border-radius: 0.25rem; cursor: pointer; font-size: 0.75rem;">âœ• ì„ íƒí•´ì œ</button>
                    </div>
                `;
                
                const tableContainer = document.querySelector('.table-container');
                tableContainer.parentNode.insertBefore(counter, tableContainer);
            }
        }
        
        // ëª¨ë“  ì„ íƒ í•´ì œ
        function clearAllSelections() {
            const selectAllCheckbox = document.getElementById('selectAll');
            const rowCheckboxes = document.querySelectorAll('input[name="selected"]');
            
            selectAllCheckbox.checked = false;
            selectAllCheckbox.indeterminate = false;
            
            rowCheckboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
            
            updateSelectedCount();
        }
        
        // ğŸ¯ ëŒ€í‘œë‹˜ ìš”ì²­: ë‚ ì§œ ì¼ê´„ ìˆ˜ì • ê¸°ëŠ¥
        let dateChanges = new Map(); // ë³€ê²½ëœ ë‚ ì§œë“¤ì„ ì €ì¥
        
        // ğŸ¯ ëŒ€í‘œë‹˜ ìš”ì²­: ì™„ë£Œ ìƒíƒœ ì¼ê´„ ìˆ˜ì • ê¸°ëŠ¥
        let completionChanges = new Map(); // ë³€ê²½ëœ ì™„ë£Œ ìƒíƒœë“¤ì„ ì €ì¥
        
        // ë‚ ì§œ ë³€ê²½ ì‹œ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜
        function markDateAsChanged(input) {
            const id = input.getAttribute('data-id');
            const field = input.getAttribute('data-field');
            const value = input.value;
            
            console.log('ğŸ“… ë‚ ì§œ ë³€ê²½:', id, field, value);
            
            // ë³€ê²½ì‚¬í•­ ì €ì¥
            if (!dateChanges.has(id)) {
                dateChanges.set(id, {});
            }
            
            const itemChanges = dateChanges.get(id);
            itemChanges[field] = value || null;
            
            // ì‹œê°ì  í”¼ë“œë°± - ë³€ê²½ëœ í–‰ ë°°ê²½ìƒ‰ ë³€ê²½
            const row = input.closest('tr');
            if (row) {
                row.style.backgroundColor = '#fff3cd'; // ì—°í•œ ë…¸ë€ìƒ‰
                row.classList.add('date-changed');
            }
            
            // ë³€ê²½ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
            updateDateChangeCount();
        }
        
        // ë³€ê²½ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
        function updateDateChangeCount() {
            const changeCount = dateChanges.size;
            const changeCountElement = document.getElementById('changeCount');
            
            // null ì²´í¬ ì¶”ê°€
            if (changeCountElement) {
                changeCountElement.textContent = changeCount;
            }
            
            const saveBtn = document.getElementById('bulkSaveBtn');
            if (saveBtn) {
                if (changeCount > 0) {
                    saveBtn.disabled = false;
                    saveBtn.style.backgroundColor = '#28a745';
                } else {
                    saveBtn.disabled = true;
                    saveBtn.style.backgroundColor = '#6c757d';
                }
            }
        }
        
        // ì¼ê´„ ë‚ ì§œ ì €ì¥ í•¨ìˆ˜
        function saveBulkDateChanges() {
            if (dateChanges.size === 0) {
                alert('ë³€ê²½ëœ ë‚ ì§œê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            console.log('ğŸ’¾ ì¼ê´„ ë‚ ì§œ ì €ì¥ ì‹œì‘:', dateChanges);
            
            // ì €ì¥ ë²„íŠ¼ ë¹„í™œì„±í™”
            const saveBtn = document.getElementById('bulkSaveBtn');
            if (saveBtn) {
                saveBtn.disabled = true;
                saveBtn.innerHTML = 'ğŸ’¾ ì €ì¥ì¤‘...';
            }
            
            // ì„œë²„ë¡œ ì „ì†¡í•  ë°ì´í„° ì¤€ë¹„ (null ê°’ë„ í¬í•¨)
            const updates = [];
            dateChanges.forEach((changes, id) => {
                const updateData = { id: parseInt(id) };
                
                // undefinedê°€ ì•„ë‹Œ ê²½ìš° ëª¨ë‘ ì „ì†¡ (null í¬í•¨)
                if (changes.collectionCompletedDate !== undefined) {
                    updateData.collectionCompletedDate = changes.collectionCompletedDate;
                }
                if (changes.logisticsConfirmedDate !== undefined) {
                    updateData.logisticsConfirmedDate = changes.logisticsConfirmedDate;
                }
                if (changes.shippingDate !== undefined) {
                    updateData.shippingDate = changes.shippingDate;
                }
                if (changes.refundDate !== undefined) {
                    updateData.refundDate = changes.refundDate;
                }
                
                updates.push(updateData);
            });
            
            console.log('ğŸ“¤ ì„œë²„ ì „ì†¡ ë°ì´í„°:', updates);
            
            // ì„œë²„ë¡œ AJAX ìš”ì²­
            fetch('/exchange/api/bulk-update-dates', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    [window.csrfHeader]: window.csrfToken
                },
                body: JSON.stringify(updates)
            })
            .then(response => response.json())
            .then(data => {
                console.log('ğŸ“¥ ì„œë²„ ì‘ë‹µ:', data);
                
                if (data.success) {
                    alert(`âœ… ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\nì—…ë°ì´íŠ¸ëœ ê±´ìˆ˜: ${data.updatedCount}/${data.totalCount}ê±´`);
                    
                    // ë³€ê²½ì‚¬í•­ ì´ˆê¸°í™”
                    dateChanges.clear();
                    
                    // ë³€ê²½ëœ í–‰ ë°°ê²½ìƒ‰ ì›ë³µ
                    document.querySelectorAll('.date-changed').forEach(row => {
                        row.style.backgroundColor = '';
                        row.classList.remove('date-changed');
                    });
                    
                    // ë²„íŠ¼ ìƒíƒœ ì´ˆê¸°í™”
                    updateDateChangeCount();
                    
                    // ğŸ¯ ì‹¤ì‹œê°„ ì¹´ë“œ í†µê³„ ì—…ë°ì´íŠ¸
                    setTimeout(() => {
                        refreshCardStats();
                    }, 500);
                    
                } else {
                    alert(`âŒ ì €ì¥ ì‹¤íŒ¨: ${data.message}`);
                }
            })
            .catch(error => {
                console.error('âŒ ì €ì¥ ì˜¤ë¥˜:', error);
                alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            })
            .finally(() => {
                // ë²„íŠ¼ ìƒíƒœ ë³µì›
                if (saveBtn) {
                    saveBtn.disabled = false;
                    saveBtn.innerHTML = 'ğŸ’¾ ë‚ ì§œì €ì¥ (<span id="changeCount">0</span>ê±´)';
                }
            });
        }
        
        // ì™„ë£Œ ìƒíƒœ ë³€ê²½ ì‹œ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜
        function markCompletionAsChanged(checkbox) {
            const id = checkbox.getAttribute('data-id');
            const isCompleted = checkbox.checked;
            
            console.log('âœ… ì™„ë£Œ ìƒíƒœ ë³€ê²½:', id, isCompleted);
            
            // ë³€ê²½ì‚¬í•­ ì €ì¥
            completionChanges.set(id, isCompleted);
            
            // ì‹œê°ì  í”¼ë“œë°± - ë³€ê²½ëœ í–‰ ë°°ê²½ìƒ‰ ë³€ê²½
            const row = checkbox.closest('tr');
            if (row) {
                row.style.borderLeft = '4px solid #ffc107'; // ë…¸ë€ìƒ‰ ì™¼ìª½ í…Œë‘ë¦¬
                row.classList.add('completion-changed');
            }
            
            // ì™„ë£Œ ë³€ê²½ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
            updateCompletionChangeCount();
            
            // ğŸ¯ ì‹¤ì‹œê°„ ì¹´ë“œ í†µê³„ ì—…ë°ì´íŠ¸ (ì•½ê°„ì˜ ì§€ì—° í›„)
            setTimeout(() => {
                refreshCardStats();
            }, 300);
        }
        
        // ì™„ë£Œ ë³€ê²½ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
        function updateCompletionChangeCount() {
            const changeCount = completionChanges.size;
            const changeCountElement = document.getElementById('completeCount');
            
            // null ì²´í¬ ì¶”ê°€
            if (changeCountElement) {
                changeCountElement.textContent = changeCount;
            }
            
            const completeBtn = document.getElementById('bulkCompleteBtn');
            if (completeBtn) {
                if (changeCount > 0) {
                    completeBtn.disabled = false;
                    completeBtn.style.backgroundColor = '#ffc107';
                } else {
                    completeBtn.disabled = true;
                    completeBtn.style.backgroundColor = '#6c757d';
                }
            }
        }
        
        // ì¼ê´„ ì™„ë£Œ ìƒíƒœ ì €ì¥ í•¨ìˆ˜
        function saveBulkCompletionChanges() {
            if (completionChanges.size === 0) {
                alert('ë³€ê²½ëœ ì™„ë£Œ ìƒíƒœê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            console.log('âœ… ì¼ê´„ ì™„ë£Œ ìƒíƒœ ì €ì¥ ì‹œì‘:', completionChanges);
            
            // ì €ì¥ ë²„íŠ¼ ë¹„í™œì„±í™”
            const completeBtn = document.getElementById('bulkCompleteBtn');
            if (completeBtn) {
                completeBtn.disabled = true;
                completeBtn.innerHTML = 'âœ… ì²˜ë¦¬ì¤‘...';
            }
            
            // ì„œë²„ë¡œ ì „ì†¡í•  ë°ì´í„° ì¤€ë¹„
            const updates = [];
            completionChanges.forEach((isCompleted, id) => {
                updates.push({
                    id: parseInt(id),
                    isCompleted: isCompleted
                });
            });
            
            console.log('ğŸ“¤ ì™„ë£Œ ìƒíƒœ ì„œë²„ ì „ì†¡ ë°ì´í„°:', updates);
            
            // ê° í•­ëª©ì„ ê°œë³„ì ìœ¼ë¡œ ì²˜ë¦¬
            let processedCount = 0;
            let successCount = 0;
            
            updates.forEach(update => {
                fetch('/exchange/api/update-completion', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        [window.csrfHeader]: window.csrfToken
                    },
                    body: JSON.stringify(update)
                })
                .then(response => response.json())
                .then(data => {
                    processedCount++;
                    if (data.success) {
                        successCount++;
                    }
                    
                    // ëª¨ë“  ìš”ì²­ì´ ì™„ë£Œë˜ë©´
                    if (processedCount === updates.length) {
                        if (successCount === updates.length) {
                            alert(`âœ… ì™„ë£Œ ìƒíƒœê°€ ì„±ê³µì ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤!\nì²˜ë¦¬ëœ ê±´ìˆ˜: ${successCount}/${updates.length}ê±´`);
                            
                            // ë³€ê²½ì‚¬í•­ ì´ˆê¸°í™”
                            completionChanges.clear();
                            
                            // ë³€ê²½ëœ í–‰ ìŠ¤íƒ€ì¼ ì›ë³µ
                            document.querySelectorAll('.completion-changed').forEach(row => {
                                row.style.borderLeft = '';
                                row.classList.remove('completion-changed');
                            });
                            
                            // ì™„ë£Œëœ í•­ëª©ë“¤ì— completed í´ë˜ìŠ¤ ì ìš©
                            updates.forEach(update => {
                                const checkbox = document.querySelector(`input[data-id="${update.id}"]`);
                                if (checkbox) {
                                    const row = checkbox.closest('tr');
                                    if (update.isCompleted) {
                                        row.classList.add('completed');
                                    } else {
                                        row.classList.remove('completed');
                                    }
                                }
                            });
                            
                            // ë²„íŠ¼ ìƒíƒœ ì´ˆê¸°í™”
                            updateCompletionChangeCount();
                            
                            // ğŸ¯ ì‹¤ì‹œê°„ ì¹´ë“œ í†µê³„ ì—…ë°ì´íŠ¸
                            setTimeout(() => {
                                refreshCardStats();
                            }, 500);
                            
                        } else {
                           alert(`âš ï¸ ì¼ë¶€ í•­ëª© ì²˜ë¦¬ ì‹¤íŒ¨\nì„±ê³µ: ${successCount}ê±´, ì‹¤íŒ¨: ${updates.length - successCount}ê±´`);
                       }
                       
                       // ë²„íŠ¼ ìƒíƒœ ë³µì›
                       if (completeBtn) {
                           completeBtn.disabled = false;
                           completeBtn.innerHTML = 'âœ… ì™„ë£Œì²˜ë¦¬ (<span id="completeCount">0</span>ê±´)';
                       }
                   }
               })
               .catch(error => {
                   console.error('âŒ ì™„ë£Œ ìƒíƒœ ì €ì¥ ì˜¤ë¥˜:', error);
                   processedCount++;
                   
                   if (processedCount === updates.length) {
                       alert('ì™„ë£Œ ìƒíƒœ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                       
                       // ë²„íŠ¼ ìƒíƒœ ë³µì›
                       if (completeBtn) {
                           completeBtn.disabled = false;
                           completeBtn.innerHTML = 'âœ… ì™„ë£Œì²˜ë¦¬ (<span id="completeCount">0</span>ê±´)';
                       }
                   }
               });
           });
       }
       
       // ë‚ ì§œ í•„ë“œ ì´ˆê¸°í™” í•¨ìˆ˜
       function clearDateField(button) {
           const itemId = button.getAttribute('data-id');
           const fieldName = button.getAttribute('data-field');
           
           // í•´ë‹¹ ë‚ ì§œ ì…ë ¥ í•„ë“œ ì°¾ê¸°
           const dateInput = document.querySelector(`input[data-id="${itemId}"][data-field="${fieldName}"]`);
           
           if (dateInput) {
               // ë‚ ì§œ í•„ë“œ ì´ˆê¸°í™”
               dateInput.value = '';
               
               // ë³€ê²½ì‚¬í•­ ì¶”ê°€ (nullë¡œ ì„¤ì •)
               if (!dateChanges.has(itemId)) {
                   dateChanges.set(itemId, {});
               }
               
               const changes = dateChanges.get(itemId);
               changes[fieldName] = null; // nullë¡œ ì„¤ì •í•˜ì—¬ DBì—ì„œ NULLë¡œ ì—…ë°ì´íŠ¸
               
               // í–‰ ìŠ¤íƒ€ì¼ ë³€ê²½ (ë³€ê²½ëœ ê²ƒìœ¼ë¡œ í‘œì‹œ)
               const row = dateInput.closest('tr');
               if (row) {
                   row.classList.add('date-changed');
                   row.style.backgroundColor = '#fff3cd'; // ì—°í•œ ë…¸ë€ìƒ‰ ë°°ê²½
               }
               
               // ë³€ê²½ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
               updateDateChangeCount();
               
               console.log(`ë‚ ì§œ ì´ˆê¸°í™”: ID=${itemId}, í•„ë“œ=${fieldName}`);
               
               // ğŸ¯ ì‹¤ì‹œê°„ ì¹´ë“œ í†µê³„ ì—…ë°ì´íŠ¸ (ì•½ê°„ì˜ ì§€ì—° í›„)
               setTimeout(() => {
                   refreshCardStats();
               }, 300);
           }
       }
       
       // ğŸ¯ ì£¼ë¬¸ë²ˆí˜¸ ë³µì‚¬ ê¸°ëŠ¥
       function copyOrderNumber(element) {
           const orderNumber = element.getAttribute('data-order-number');
           
           // í´ë¦½ë³´ë“œì— ë³µì‚¬
           navigator.clipboard.writeText(orderNumber).then(function() {
               console.log('ğŸ“‹ ì£¼ë¬¸ë²ˆí˜¸ ë³µì‚¬ ì„±ê³µ:', orderNumber);
               
               // ì‹œê°ì  í”¼ë“œë°±
               const originalText = element.textContent;
               const originalColor = element.style.color;
               const originalBg = element.style.backgroundColor;
               
               // ë³µì‚¬ ì™„ë£Œ í‘œì‹œ
               element.style.backgroundColor = '#28a745';
               element.style.color = 'white';
               element.style.transform = 'scale(1.05)';
               element.textContent = 'âœ… ë³µì‚¬ì™„ë£Œ!';
               
               // 1ì´ˆ í›„ ì›ë˜ ìƒíƒœë¡œ ë³µì›
               setTimeout(() => {
                   element.style.backgroundColor = originalBg;
                   element.style.color = originalColor;
                   element.style.transform = 'scale(1)';
                   element.textContent = originalText;
               }, 1000);
               
               // í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ
               showCopyToast(orderNumber, 'ğŸ“‹ ì£¼ë¬¸ë²ˆí˜¸');
               
           }).catch(function(err) {
               console.error('âŒ ì£¼ë¬¸ë²ˆí˜¸ ë³µì‚¬ ì‹¤íŒ¨:', err);
               handleCopyError(element, orderNumber, 'ì£¼ë¬¸ë²ˆí˜¸');
           });
       }
       
       // ë³µì‚¬ ì™„ë£Œ í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ
       function showCopyToast(value, type) {
           // ê¸°ì¡´ í† ìŠ¤íŠ¸ ì œê±°
           const existingToast = document.querySelector('.copy-toast');
           if (existingToast) {
               existingToast.remove();
           }
           
           // ìƒˆ í† ìŠ¤íŠ¸ ìƒì„±
           const toast = document.createElement('div');
           toast.className = 'copy-toast';
           toast.innerHTML = `
               <div style="
                   position: fixed;
                   top: 20px;
                   right: 20px;
                   background: linear-gradient(135deg, #28a745, #20c997);
                   color: white;
                   padding: 1rem 1.5rem;
                   border-radius: 0.5rem;
                   box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
                   z-index: 9999;
                   display: flex;
                   align-items: center;
                   gap: 0.5rem;
                   font-size: 0.9rem;
                   font-weight: 500;
                   animation: slideInRight 0.3s ease-out;
               ">
                   <span>${type.split(' ')[0]}</span>
                   <span><strong>${type} ë³µì‚¬ì™„ë£Œ!</strong><br/><small>${value}</small></span>
               </div>
           `;
           
           document.body.appendChild(toast);
           
           // 3ì´ˆ í›„ ìë™ ì œê±°
           setTimeout(() => {
               if (toast.parentNode) {
                   toast.style.animation = 'slideOutRight 0.3s ease-out';
                   setTimeout(() => {
                       if (toast.parentNode) {
                           toast.remove();
                       }
                   }, 300);
               }
           }, 3000);
       }
       
       // ğŸ¯ ê³ ê°ëª… ë³µì‚¬ ê¸°ëŠ¥
       function copyCustomerName(element) {
           const customerName = element.getAttribute('data-customer-name');
           
           // í´ë¦½ë³´ë“œì— ë³µì‚¬
           navigator.clipboard.writeText(customerName).then(function() {
               console.log('ğŸ‘¤ ê³ ê°ëª… ë³µì‚¬ ì„±ê³µ:', customerName);
               
               // ì‹œê°ì  í”¼ë“œë°±
               const originalText = element.textContent;
               const originalColor = element.style.color;
               const originalBg = element.style.backgroundColor;
               
               // ë³µì‚¬ ì™„ë£Œ í‘œì‹œ
               element.style.backgroundColor = '#28a745';
               element.style.color = 'white';
               element.style.transform = 'scale(1.05)';
               element.textContent = 'âœ… ë³µì‚¬ì™„ë£Œ!';
               
               // 1ì´ˆ í›„ ì›ë˜ ìƒíƒœë¡œ ë³µì›
               setTimeout(() => {
                   element.style.backgroundColor = originalBg;
                   element.style.color = originalColor;
                   element.style.transform = 'scale(1)';
                   element.textContent = originalText;
               }, 1000);
               
               // í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ
               showCopyToast(customerName, 'ğŸ‘¤ ê³ ê°ëª…');
               
           }).catch(function(err) {
               console.error('âŒ ê³ ê°ëª… ë³µì‚¬ ì‹¤íŒ¨:', err);
               handleCopyError(element, customerName, 'ê³ ê°ëª…');
           });
       }
       
       // ğŸ¯ ì—°ë½ì²˜ ë³µì‚¬ ê¸°ëŠ¥
       function copyCustomerPhone(element) {
           const customerPhone = element.getAttribute('data-customer-phone');
           
           // í´ë¦½ë³´ë“œì— ë³µì‚¬
           navigator.clipboard.writeText(customerPhone).then(function() {
               console.log('ğŸ“ ì—°ë½ì²˜ ë³µì‚¬ ì„±ê³µ:', customerPhone);
               
               // ì‹œê°ì  í”¼ë“œë°±
               const originalText = element.textContent;
               const originalColor = element.style.color;
               const originalBg = element.style.backgroundColor;
               
               // ë³µì‚¬ ì™„ë£Œ í‘œì‹œ
               element.style.backgroundColor = '#28a745';
               element.style.color = 'white';
               element.style.transform = 'scale(1.05)';
               element.textContent = 'âœ… ë³µì‚¬ì™„ë£Œ!';
               
               // 1ì´ˆ í›„ ì›ë˜ ìƒíƒœë¡œ ë³µì›
               setTimeout(() => {
                   element.style.backgroundColor = originalBg;
                   element.style.color = originalColor;
                   element.style.transform = 'scale(1)';
                   element.textContent = originalText;
               }, 1000);
               
               // í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ
               showCopyToast(customerPhone, 'ğŸ“ ì—°ë½ì²˜');
               
           }).catch(function(err) {
               console.error('âŒ ì—°ë½ì²˜ ë³µì‚¬ ì‹¤íŒ¨:', err);
               handleCopyError(element, customerPhone, 'ì—°ë½ì²˜');
           });
       }
       
       // ë³µì‚¬ ì‹¤íŒ¨ ì²˜ë¦¬ ê³µí†µ í•¨ìˆ˜
       function handleCopyError(element, value, type) {
           // ì‹¤íŒ¨ ì‹œ ëŒ€ì²´ ë°©ë²• (í…ìŠ¤íŠ¸ ì„ íƒ)
           const range = document.createRange();
           range.selectNodeContents(element);
           const selection = window.getSelection();
           selection.removeAllRanges();
           selection.addRange(range);
           
           // ì‹¤íŒ¨ í”¼ë“œë°±
           element.style.backgroundColor = '#dc3545';
           element.style.color = 'white';
           element.textContent = 'âŒ ë³µì‚¬ì‹¤íŒ¨';
           
           setTimeout(() => {
               element.style.backgroundColor = '';
               element.style.color = '';
               element.textContent = value;
               selection.removeAllRanges();
           }, 1500);
           
           alert(`${type} ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. í…ìŠ¤íŠ¸ê°€ ì„ íƒë˜ì—ˆìœ¼ë‹ˆ Ctrl+Cë¡œ ë³µì‚¬í•´ì£¼ì„¸ìš”.`);
       }
       
       // ğŸ¯ ì£¼ë¬¸í’ˆë²ˆ ë³µì‚¬ ê¸°ëŠ¥
       function copyOrderItemCode(element) {
           const orderItemCode = element.getAttribute('data-order-item-code');
           
           // í´ë¦½ë³´ë“œì— ë³µì‚¬
           navigator.clipboard.writeText(orderItemCode).then(function() {
               console.log('ğŸ·ï¸ ì£¼ë¬¸í’ˆë²ˆ ë³µì‚¬ ì„±ê³µ:', orderItemCode);
               
               // ì‹œê°ì  í”¼ë“œë°±
               const originalText = element.textContent;
               const originalColor = element.style.color;
               const originalBg = element.style.backgroundColor;
               
               // ë³µì‚¬ ì™„ë£Œ í‘œì‹œ
               element.style.backgroundColor = '#28a745';
               element.style.color = 'white';
               element.style.transform = 'scale(1.05)';
               element.textContent = 'âœ… ë³µì‚¬ì™„ë£Œ!';
               
               // 1ì´ˆ í›„ ì›ë˜ ìƒíƒœë¡œ ë³µì›
               setTimeout(() => {
                   element.style.backgroundColor = originalBg;
                   element.style.color = originalColor;
                   element.style.transform = 'scale(1)';
                   element.textContent = originalText;
               }, 1000);
               
               // í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ
               showCopyToast(orderItemCode, 'ğŸ·ï¸ ì£¼ë¬¸í’ˆë²ˆ');
               
           }).catch(function(err) {
               console.error('âŒ ì£¼ë¬¸í’ˆë²ˆ ë³µì‚¬ ì‹¤íŒ¨:', err);
               handleCopyError(element, orderItemCode, 'ì£¼ë¬¸í’ˆë²ˆ');
           });
       }
       
       // ğŸ¯ ìš´ì†¡ì¥ë²ˆí˜¸ ë³µì‚¬ ê¸°ëŠ¥
       function copyTrackingNumber(element) {
           const trackingNumber = element.getAttribute('data-tracking-number');
           
           // í´ë¦½ë³´ë“œì— ë³µì‚¬
           navigator.clipboard.writeText(trackingNumber).then(function() {
               console.log('ğŸšš ìš´ì†¡ì¥ë²ˆí˜¸ ë³µì‚¬ ì„±ê³µ:', trackingNumber);
               
               // ì‹œê°ì  í”¼ë“œë°±
               const originalText = element.textContent;
               const originalColor = element.style.color;
               const originalBg = element.style.backgroundColor;
               
               // ë³µì‚¬ ì™„ë£Œ í‘œì‹œ
               element.style.backgroundColor = '#28a745';
               element.style.color = 'white';
               element.style.transform = 'scale(1.05)';
               element.textContent = 'âœ… ë³µì‚¬ì™„ë£Œ!';
               
               // 1ì´ˆ í›„ ì›ë˜ ìƒíƒœë¡œ ë³µì›
               setTimeout(() => {
                   element.style.backgroundColor = originalBg;
                   element.style.color = originalColor;
                   element.style.transform = 'scale(1)';
                   element.textContent = originalText;
               }, 1000);
               
               // í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ
               showCopyToast(trackingNumber, 'ğŸšš ìš´ì†¡ì¥ë²ˆí˜¸');
               
           }).catch(function(err) {
               console.error('âŒ ìš´ì†¡ì¥ë²ˆí˜¸ ë³µì‚¬ ì‹¤íŒ¨:', err);
               handleCopyError(element, trackingNumber, 'ìš´ì†¡ì¥ë²ˆí˜¸');
           });
       }

       // ğŸ¯ ëŒ€í‘œë‹˜ ìš”ì²­: ì‹¤ì‹œê°„ ì¹´ë“œ í†µê³„ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
       function refreshCardStats() {
           console.log('ğŸ“Š ì¹´ë“œ í†µê³„ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ì‹œì‘...');
           
           // í˜„ì¬ ê²€ìƒ‰ ì¡°ê±´ ê°€ì ¸ì˜¤ê¸°
           const searchForm = document.getElementById('searchForm');
           const formData = new FormData(searchForm);
           const searchParams = new URLSearchParams(formData);
           
           // ì¹´ë“œ í†µê³„ API í˜¸ì¶œ
           fetch(`/exchange/api/card-stats?${searchParams.toString()}`)
               .then(response => {
                   console.log('ğŸŒ API ì‘ë‹µ ìƒíƒœ:', response.status);
                   return response.json();
               })
               .then(data => {
                   console.log('ğŸ“Š ì „ì²´ ì‘ë‹µ ë°ì´í„°:', data);
                   console.log('ğŸ“Š ì‘ë‹µ ë°ì´í„° íƒ€ì…:', typeof data);
                   console.log('ğŸ“Š data.data ë‚´ìš©:', data.data);
                   console.log('ğŸ“Š data.data íƒ€ì…:', typeof data.data);
                   
                   if (!data || (!data.data && !data.success)) {
                       console.warn('âš ï¸ ì¹´ë“œ í†µê³„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤:', data);
                       return;
                   }
                   
                   // API ì‘ë‹µ êµ¬ì¡°ì— ë”°ë¼ ìœ ì—°í•˜ê²Œ ì²˜ë¦¬
                   const statsData = data.data || data || {};
                   console.log('ğŸ“Š ì‹¤ì œ ì‚¬ìš©í•  í†µê³„ ë°ì´í„°:', statsData);
                   console.log('ğŸ“Š í†µê³„ ë°ì´í„°ì˜ ëª¨ë“  í‚¤:', Object.keys(statsData));
                   
                   // ğŸ“Š API ì‘ë‹µ í‚¤ ì´ë¦„ì— ë§ê²Œ ì¹´ë“œ ì—…ë°ì´íŠ¸
                   updateCardValue('collectionCompleted', statsData.collectionCompleted);
                   updateCardValue('collectionPending', statsData.collectionPending);
                   updateCardValue('logisticsConfirmed', statsData.logisticsConfirmed);
                   updateCardValue('logisticsPending', statsData.logisticsPending);
                   updateCardValue('exchangeShipped', statsData.exchangeShipped);
                   updateCardValue('exchangeNotShipped', statsData.exchangeNotShipped);
                   updateCardValue('returnRefunded', statsData.returnRefunded);
                   updateCardValue('returnNotRefunded', statsData.returnNotRefunded);
                   updateCardValue('paymentCompleted', statsData.paymentCompleted);
                   updateCardValue('paymentPending', statsData.paymentPending);
                   updateCardValue('completedCount', statsData.completedCount);
                   updateCardValue('incompletedCount', statsData.incompletedCount);
                   updateCardValue('overdueTenDaysCount', statsData.overdueTenDaysCount);
                   
                   // í†µê³„ ìš”ì•½ ë¶€ë¶„ì˜ todayCount ì—…ë°ì´íŠ¸
                   updateStatsValue('todayCount', statsData.todayCount);
                   
                   console.log('âœ… ì¹´ë“œ í†µê³„ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
               })
               .catch(error => {
                   console.error('âŒ ì¹´ë“œ í†µê³„ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
               });
       }
       
       // ì¹´ë“œ ê°’ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ í¬í•¨)
       function updateCardValue(cardId, newValue) {
           console.log(`ğŸ” ì¹´ë“œ ì—…ë°ì´íŠ¸ ì‹œë„: ${cardId} = ${newValue}`);
           
           // ì¹´ë“œ IDì— ë”°ë¥¸ ì‹¤ì œ data-filter ì†ì„± ë§¤í•‘
           const filterMapping = {
               'todayCount': 'today',  // ì„ì‹œë¡œ today í•„í„° ì‚¬ìš©
               'collectionCompleted': 'collection-completed',
               'collectionPending': 'collection-pending', 
               'logisticsConfirmed': 'logistics-confirmed',
               'logisticsPending': 'logistics-pending',
               'exchangeShipped': 'shipping-completed',
               'exchangeNotShipped': 'shipping-pending',
               'returnRefunded': 'refund-completed',
               'returnNotRefunded': 'refund-pending',
               'paymentCompleted': 'payment-completed',
               'paymentPending': 'payment-pending',
               'completedCount': 'completed',
               'incompletedCount': 'incompleted',
               'overdueTenDaysCount': 'overdue-ten-days'
           };
           
           const filterName = filterMapping[cardId];
           if (!filterName) {
               console.warn(`âš ï¸ ë§¤í•‘ë˜ì§€ ì•Šì€ ì¹´ë“œ ID: ${cardId}`);
               return;
           }
           
           console.log(`ğŸ¯ í•„í„°ëª… ë§¤í•‘: ${cardId} â†’ ${filterName}`);
           
           // data-filter ì†ì„±ìœ¼ë¡œ ì¹´ë“œ ìš”ì†Œ ì°¾ê¸°
           const cardElement = document.querySelector(`[data-filter="${filterName}"]`);
           console.log(`ğŸ” ìš”ì†Œ ì°¾ê¸° ê²°ê³¼:`, cardElement);
           
           if (cardElement) {
               const currentValue = parseInt(cardElement.textContent.replace(/,/g, '')) || 0;
               const safeNewValue = newValue || 0;
               
               console.log(`ğŸ“Š ê°’ ë¹„êµ: ${currentValue} â†’ ${safeNewValue}`);
               
               // í•­ìƒ ì—…ë°ì´íŠ¸ (ê°’ì´ ê°™ì•„ë„ ì‹œê°ì  í”¼ë“œë°± ì œê³µ)
               console.log(`âœ… ì¹´ë“œ ì—…ë°ì´íŠ¸ ì‹¤í–‰: ${cardId} (${filterName}) ${currentValue} â†’ ${safeNewValue}`);
               
               // ê¹œë¹¡ì„ íš¨ê³¼
               cardElement.style.transition = 'all 0.3s ease';
               cardElement.style.backgroundColor = '#fff3cd';
               cardElement.style.transform = 'scale(1.05)';
               cardElement.style.boxShadow = '0 4px 12px rgba(255, 193, 7, 0.4)';
               
               // ìˆ«ì ì—…ë°ì´íŠ¸
               setTimeout(() => {
                   cardElement.textContent = (safeNewValue || 0).toLocaleString();
                   console.log(`ğŸ“ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ ì™„ë£Œ: ${safeNewValue}`);
                   
                   // ì›ë˜ ìƒíƒœë¡œ ë³µì›
                   setTimeout(() => {
                       cardElement.style.backgroundColor = '';
                       cardElement.style.transform = '';
                       cardElement.style.boxShadow = '';
                   }, 300);
               }, 150);
           } else {
               console.error(`âŒ ì¹´ë“œ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ: ${cardId} (filter: ${filterName})`);
               console.log(`ğŸ” í˜„ì¬ í˜ì´ì§€ì˜ ëª¨ë“  data-filter ìš”ì†Œ:`, 
                   Array.from(document.querySelectorAll('[data-filter]')).map(el => el.getAttribute('data-filter')));
           }
       }
       
       // í†µê³„ ìš”ì•½ ë¶€ë¶„ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
       function updateStatsValue(statId, newValue) {
           // í†µê³„ ìš”ì•½ì—ì„œ todayCount ì°¾ê¸° (Thymeleaf ì¡°ê±´ì— ë”°ë¼ ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œ ì°¾ì•„ì•¼ í•¨)
           if (statId === 'todayCount') {
               // "ê¸ˆì¼ ë“±ë¡" ë¼ë²¨ ë‹¤ìŒì˜ ê°’ ì°¾ê¸°
               const statsLabels = document.querySelectorAll('.stats-label');
               for (let label of statsLabels) {
                   if (label.textContent.includes('ê¸ˆì¼ ë“±ë¡')) {
                       const valueElement = label.nextElementSibling;
                       if (valueElement && valueElement.classList.contains('stats-value')) {
                           const currentValue = parseInt(valueElement.textContent.replace(/[^0-9]/g, '')) || 0;
                           const safeNewValue = newValue || 0;
                           if (currentValue !== safeNewValue) {
                               console.log(`ğŸ“Š í†µê³„ ì—…ë°ì´íŠ¸: ${statId} ${currentValue} â†’ ${safeNewValue}`);
                               
                               // ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
                               valueElement.style.transition = 'all 0.3s ease';
                               valueElement.style.backgroundColor = '#fff3cd';
                               valueElement.style.transform = 'scale(1.05)';
                               
                               // ê°’ ì—…ë°ì´íŠ¸
                               setTimeout(() => {
                                   valueElement.textContent = `${safeNewValue}ê±´`;
                                   
                                   // ì›ë˜ ìƒíƒœë¡œ ë³µì›
                                   setTimeout(() => {
                                       valueElement.style.backgroundColor = '';
                                       valueElement.style.transform = '';
                                   }, 300);
                               }, 150);
                           }
                       }
                       break;
                   }
               }
           }
       }
       
       // í˜ì´ì§€ ë¡œë“œ ì‹œ ì™„ë£Œëœ í•­ëª©ë“¤ì— ìŠ¤íƒ€ì¼ ì ìš©
       document.addEventListener('DOMContentLoaded', function() {
           // ì™„ë£Œ ì²´í¬ë°•ìŠ¤ë“¤ì„ ì°¾ì•„ì„œ ì²´í¬ëœ í•­ëª©ë“¤ì˜ í–‰ì— completed í´ë˜ìŠ¤ ì¶”ê°€
           const completionCheckboxes = document.querySelectorAll('input[type="checkbox"][data-id]');
           completionCheckboxes.forEach(checkbox => {
               if (checkbox.checked) {
                   const row = checkbox.closest('tr');
                   if (row) {
                       row.classList.add('completed');
                   }
               }
           });
           
           // ğŸ¯ í˜ì´ì§€ ë¡œë“œ ì‹œ ì¹´ë“œ í†µê³„ í…ŒìŠ¤íŠ¸ (1ì´ˆ í›„)
           setTimeout(() => {
               console.log('ğŸ§ª ì¹´ë“œ í†µê³„ í…ŒìŠ¤íŠ¸ ì‹¤í–‰...');
               refreshCardStats();
           }, 1000);
       });

       // ============================================================================
       // ğŸ“Š ì—‘ì…€ ë‹¤ìš´ë¡œë“œ/ì—…ë¡œë“œ ê¸°ëŠ¥
       // ============================================================================

       /**
        * ğŸ“¥ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ (í˜„ì¬ ê²€ìƒ‰ ì¡°ê±´ì— ë§ëŠ” ë°ì´í„°)
        */
       function downloadExcel() {
           console.log('ğŸ“¥ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ ì‹œì‘...');
           
           try {
               // í˜„ì¬ ê²€ìƒ‰ í¼ì˜ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ì„œ POSTë¡œ ì „ì†¡
               const searchForm = document.getElementById('searchForm');
               const formData = new FormData(searchForm);
               
               // ìƒˆë¡œìš´ í¼ ìƒì„± (ë‹¤ìš´ë¡œë“œìš©)
               const downloadForm = document.createElement('form');
               downloadForm.method = 'POST';
               downloadForm.action = '/exchange/download/excel';
               downloadForm.style.display = 'none';
               
               // ê²€ìƒ‰ ì¡°ê±´ë“¤ì„ hidden inputìœ¼ë¡œ ì¶”ê°€
               for (let [key, value] of formData.entries()) {
                   const input = document.createElement('input');
                   input.type = 'hidden';
                   input.name = key;
                   input.value = value;
                   downloadForm.appendChild(input);
               }
               
               // CSRF í† í° ì¶”ê°€
               const csrfToken = document.querySelector('meta[name="_csrf"]').getAttribute('content');
               const csrfHeader = document.querySelector('meta[name="_csrf_header"]').getAttribute('content');
               const csrfInput = document.createElement('input');
               csrfInput.type = 'hidden';
               csrfInput.name = '_token';
               csrfInput.value = csrfToken;
               downloadForm.appendChild(csrfInput);
               
               // í¼ ì œì¶œ
               document.body.appendChild(downloadForm);
               downloadForm.submit();
               document.body.removeChild(downloadForm);
               
               showToast('ğŸ“¥ ì—‘ì…€ ë‹¤ìš´ë¡œë“œê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
               console.log('âœ… ì—‘ì…€ ë‹¤ìš´ë¡œë“œ ìš”ì²­ ì™„ë£Œ');
               
           } catch (error) {
               console.error('âŒ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨:', error);
               showToast('âŒ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
           }
       }

       /**
        * ğŸ“„ í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ
        */
       function downloadTemplate() {
           console.log('ğŸ“„ í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ ì‹œì‘...');
           
           try {
               // í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œëŠ” GET ìš”ì²­ìœ¼ë¡œ ê°„ë‹¨í•˜ê²Œ ì²˜ë¦¬
               window.location.href = '/exchange/download/template';
               showToast('ğŸ“„ í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
               console.log('âœ… í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ ìš”ì²­ ì™„ë£Œ');
               
           } catch (error) {
               console.error('âŒ í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨:', error);
               showToast('âŒ í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
           }
       }

       /**
        * ğŸ“¤ ì—‘ì…€ ì—…ë¡œë“œ ëª¨ë‹¬ ì—´ê¸°
        */
       function openExcelUploadModal() {
           console.log('ğŸ“¤ ì—‘ì…€ ì—…ë¡œë“œ ëª¨ë‹¬ ì—´ê¸°...');
           document.getElementById('excelUploadModal').style.display = 'block';
       }

       /**
        * ğŸ“¤ ì—‘ì…€ ì—…ë¡œë“œ ëª¨ë‹¬ ë‹«ê¸°
        */
       function closeExcelUploadModal() {
           document.getElementById('excelUploadModal').style.display = 'none';
           // íŒŒì¼ ì„ íƒ ì´ˆê¸°í™”
           document.getElementById('excelFile').value = '';
           // ê²°ê³¼ ì˜ì—­ ì´ˆê¸°í™”
           document.getElementById('uploadResult').innerHTML = '';
           document.getElementById('uploadProgress').style.display = 'none';
       }

       /**
        * ğŸ“¤ ì—‘ì…€ íŒŒì¼ ì—…ë¡œë“œ ì‹¤í–‰
        */
       function uploadExcelFile() {
           const fileInput = document.getElementById('excelFile');
           const file = fileInput.files[0];
           
           if (!file) {
               showToast('âŒ ì—…ë¡œë“œí•  íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
               return;
           }
           
           if (!file.name.toLowerCase().endsWith('.xlsx')) {
               showToast('âŒ Excel íŒŒì¼(.xlsx)ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'error');
               return;
           }
           
           console.log('ğŸ“¤ ì—‘ì…€ ì—…ë¡œë“œ ì‹œì‘:', file.name, 'Size:', file.size);
           
           // ì§„í–‰ ìƒíƒœ í‘œì‹œ
           document.getElementById('uploadProgress').style.display = 'block';
           document.getElementById('uploadResult').innerHTML = '';
           
           // FormData ìƒì„±
           const formData = new FormData();
           formData.append('file', file);
           
           // CSRF í† í° ì¶”ê°€
           const csrfToken = document.querySelector('meta[name="_csrf"]').getAttribute('content');
           
           // ì—…ë¡œë“œ ìš”ì²­
           fetch('/exchange/upload/excel', {
               method: 'POST',
               headers: {
                   'X-CSRF-TOKEN': csrfToken
               },
               body: formData
           })
           .then(response => response.json())
           .then(data => {
               console.log('ğŸ“Š ì—…ë¡œë“œ ê²°ê³¼:', data);
               
               // ì§„í–‰ ìƒíƒœ ìˆ¨ê¸°ê¸°
               document.getElementById('uploadProgress').style.display = 'none';
               
               if (data.success) {
                   showUploadResult(data);
                   showToast(`âœ… ì—…ë¡œë“œ ì™„ë£Œ: ì„±ê³µ ${data.successCount}ê±´, ì‹¤íŒ¨ ${data.errorCount}ê±´`, 'success');
                   
                   // ì„±ê³µí•˜ë©´ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ (ìƒˆë¡œ ë“±ë¡ëœ ë°ì´í„° í™•ì¸)
                   if (data.successCount > 0) {
                       setTimeout(() => {
                           window.location.reload();
                       }, 3000);
                   }
               } else {
                   showToast(`âŒ ì—…ë¡œë“œ ì‹¤íŒ¨: ${data.message}`, 'error');
                   document.getElementById('uploadResult').innerHTML = `
                       <div class="alert alert-danger">
                           <strong>âŒ ì—…ë¡œë“œ ì‹¤íŒ¨</strong><br>
                           ${data.message}
                       </div>
                   `;
               }
           })
           .catch(error => {
               console.error('âŒ ì—…ë¡œë“œ ì˜¤ë¥˜:', error);
               document.getElementById('uploadProgress').style.display = 'none';
               showToast('âŒ ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
               document.getElementById('uploadResult').innerHTML = `
                   <div class="alert alert-danger">
                       <strong>âŒ ì—…ë¡œë“œ ì˜¤ë¥˜</strong><br>
                       ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.
                   </div>
               `;
           });
       }

       /**
        * ğŸ“Š ì—…ë¡œë“œ ê²°ê³¼ í‘œì‹œ
        */
       function showUploadResult(data) {
           let resultHtml = `
               <div class="alert alert-success">
                   <h4>âœ… ì—…ë¡œë“œ ì™„ë£Œ</h4>
                   <p>
                       <strong>ì²˜ë¦¬ ê²°ê³¼:</strong> 
                       ì„±ê³µ <span class="badge bg-success">${data.successCount}</span>ê±´, 
                       ì‹¤íŒ¨ <span class="badge bg-danger">${data.errorCount}</span>ê±´
                   </p>
               </div>
           `;
           
           // ì„±ê³µ ëª©ë¡
           if (data.successList && data.successList.length > 0) {
               resultHtml += `
                   <div class="mt-3">
                       <h5>âœ… ì„±ê³µ ëª©ë¡ (${data.successList.length}ê±´)</h5>
                       <div class="success-list" style="max-height: 200px; overflow-y: auto;">
                           <ul class="list-group">
               `;
               data.successList.forEach(item => {
                   resultHtml += `<li class="list-group-item list-group-item-success">${item}</li>`;
               });
               resultHtml += `
                           </ul>
                       </div>
                   </div>
               `;
           }
           
           // ì‹¤íŒ¨ ëª©ë¡
           if (data.errorList && data.errorList.length > 0) {
               resultHtml += `
                   <div class="mt-3">
                       <h5>âŒ ì‹¤íŒ¨ ëª©ë¡ (${data.errorList.length}ê±´)</h5>
                       <div class="error-list" style="max-height: 200px; overflow-y: auto;">
                           <ul class="list-group">
               `;
               data.errorList.forEach(item => {
                   resultHtml += `<li class="list-group-item list-group-item-danger">${item}</li>`;
               });
               resultHtml += `
                           </ul>
                       </div>
                   </div>
               `;
           }
           
           document.getElementById('uploadResult').innerHTML = resultHtml;
       }

       /**
        * ğŸ¯ í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ
        */
       function showToast(message, type = 'info') {
           // ê¸°ì¡´ í† ìŠ¤íŠ¸ ì œê±°
           const existingToast = document.querySelector('.toast-message');
           if (existingToast) {
               existingToast.remove();
           }
           
           // ìƒˆ í† ìŠ¤íŠ¸ ìƒì„±
           const toast = document.createElement('div');
           toast.className = `toast-message toast-${type}`;
           toast.style.cssText = `
               position: fixed;
               top: 20px;
               right: 20px;
               padding: 15px 20px;
               border-radius: 8px;
               color: white;
               font-weight: 600;
               z-index: 10000;
               max-width: 400px;
               animation: slideInRight 0.3s ease;
           `;
           
           // íƒ€ì…ë³„ ë°°ê²½ìƒ‰
           switch (type) {
               case 'success':
                   toast.style.backgroundColor = '#10b981';
                   break;
               case 'error':
                   toast.style.backgroundColor = '#ef4444';
                   break;
               case 'warning':
                   toast.style.backgroundColor = '#f59e0b';
                   break;
               default:
                   toast.style.backgroundColor = '#3b82f6';
           }
           
           toast.textContent = message;
           document.body.appendChild(toast);
           
           // 3ì´ˆ í›„ ì œê±°
           setTimeout(() => {
               if (toast.parentNode) {
                   toast.style.animation = 'slideOutRight 0.3s ease';
                   setTimeout(() => toast.remove(), 300);
               }
           }, 3000);
       }
    </script>
    
    <!-- ğŸ“¤ ì—‘ì…€ ì—…ë¡œë“œ ëª¨ë‹¬ -->
    <div id="excelUploadModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999;">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; border-radius: 12px; padding: 30px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="margin: 0; color: #1f2937;">ğŸ“¤ êµí™˜/ë°˜í’ˆ ì—‘ì…€ ì—…ë¡œë“œ</h3>
                <button onclick="closeExcelUploadModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #6b7280;">Ã—</button>
            </div>
            
            <div style="margin-bottom: 20px; padding: 15px; background: #f0f9ff; border-radius: 8px; border-left: 4px solid #0ea5e9;">
                <h4 style="margin: 0 0 10px 0; color: #0c4a6e;">ğŸ“‹ ì—…ë¡œë“œ ê°€ì´ë“œ</h4>
                <ul style="margin: 0; padding-left: 20px; color: #374151;">
                    <li><strong>í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ:</strong> ë¨¼ì € 'ğŸ“„ í…œí”Œë¦¿' ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì–‘ì‹ì„ ë‹¤ìš´ë¡œë“œí•˜ì„¸ìš”.</li>
                    <li><strong>í•„ìˆ˜ í•­ëª©:</strong> ìœ í˜•*, ì£¼ë¬¸ì¼*, CSì ‘ìˆ˜ì¼*, ì‚¬ì´íŠ¸ëª…*, ì£¼ë¬¸ë²ˆí˜¸*, ê³ ê°ëª…*, ê³ ê°ì—°ë½ì²˜*</li>
                    <li><strong>ë‚ ì§œ í˜•ì‹:</strong> YYYY-MM-DD (ì˜ˆ: 2024-12-31)</li>
                    <li><strong>íŒŒì¼ í˜•ì‹:</strong> .xlsx íŒŒì¼ë§Œ ì§€ì›</li>
                </ul>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">ğŸ“‚ íŒŒì¼ ì„ íƒ</label>
                <input type="file" id="excelFile" accept=".xlsx" style="width: 100%; padding: 10px; border: 2px dashed #d1d5db; border-radius: 8px; background: #f9fafb;">
            </div>
            
            <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                <button onclick="downloadTemplate()" style="flex: 1; padding: 12px; background: #6b7280; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">ğŸ“„ í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ</button>
                <button onclick="uploadExcelFile()" style="flex: 1; padding: 12px; background: #10b981; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">ğŸ“¤ ì—…ë¡œë“œ ì‹œì‘</button>
            </div>
            
            <!-- ì§„í–‰ ìƒíƒœ -->
            <div id="uploadProgress" style="display: none; text-align: center; padding: 20px;">
                <div style="display: inline-block; width: 32px; height: 32px; border: 3px solid #f3f4f6; border-top: 3px solid #3b82f6; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                <p style="margin-top: 10px; color: #6b7280;">ì—…ë¡œë“œ ì¤‘...</p>
            </div>
            
            <!-- ê²°ê³¼ í‘œì‹œ -->
            <div id="uploadResult"></div>
        </div>
    </div>
    
    <!-- ì• ë‹ˆë©”ì´ì…˜ ìŠ¤íƒ€ì¼ -->
    <style>
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideOutRight {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ğŸ¯ í•„í„° ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .filter-btn {
            background: linear-gradient(90deg, #6c757d, #5a5f65);
            color: white;
            border: none;
            padding: 0.75rem 1.2rem;
            border-radius: 0.375rem;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .filter-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .filter-btn.active {
            background: linear-gradient(90deg, #007bff, #0056b3);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
        }
        
        .filter-btn.active:hover {
            background: linear-gradient(90deg, #0056b3, #004085);
        }
        
        .filter-selection-area {
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</div>
</html> 