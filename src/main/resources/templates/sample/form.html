<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout/default}">
<head>
    <title th:text="${isEdit ? 'êµí™˜/ë°˜í’ˆ ìˆ˜ì •' : 'êµí™˜/ë°˜í’ˆ ë“±ë¡'}">êµí™˜/ë°˜í’ˆ ë“±ë¡</title>
    <link rel="stylesheet" th:href="@{/css/exchange.css}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/browser-image-compression/2.0.0/browser-image-compression.min.js"></script>
    
    <!-- ğŸ”¥ ì´ë¯¸ì§€ ë¶™ì—¬ë„£ê¸° ê¸°ëŠ¥ (ë³„ë„ íŒŒì¼) -->
    <script src="/js/paste-image.js"></script>

    <!-- ğŸ”¥ğŸ”¥ğŸ”¥ ëŒ€í‘œë‹˜ ìµœì¢… í•´ê²°: ì™„ì „ ì¦‰ì‹œ ì‹¤í–‰ ì‹œìŠ¤í…œ -->
    <script>
        // console.log('ğŸš¨ğŸš¨ğŸš¨ ëŒ€í‘œë‹˜ ìµœì¢… í•´ê²° - ì™„ì „ ì¦‰ì‹œ ì‹¤í–‰ ì‹œìŠ¤í…œ!');

        // ğŸ”¥ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ ì¦‰ì‹œ ì‹¤í–‰ (ì§€ì—° ì—†ìŒ)
        window.addEventListener('load', function() {
            // console.log('ğŸ”¥ğŸ”¥ğŸ”¥ ëŒ€í‘œë‹˜ í˜ì´ì§€ ì™„ì „ ë¡œë“œ ì™„ë£Œ!');

            // ìˆ˜ì • ëª¨ë“œ í™•ì¸
            const isEditMode = document.querySelector('input[name="id"]') !== null;
            // console.log('ğŸ”§ ìˆ˜ì • ëª¨ë“œ í™•ì¸:', isEditMode);

            if (isEditMode) {
                // console.log('ğŸš¨ğŸ”¥ ìˆ˜ì • ëª¨ë“œ ê°ì§€ - ì¦‰ì‹œ ì²˜ë¦¬ ì‹œì‘!');

                // ğŸ”¥ 100ms í›„ ì¦‰ì‹œ ì‹¤í–‰ (DOM ì•ˆì •í™”ë§Œ ëŒ€ê¸°)
                setTimeout(function() {
                    // console.log('âš¡ ëŒ€í‘œë‹˜ ì¦‰ì‹œ ì‹¤í–‰!');

                    // ë ˆë…¸ë§ˆ ë²„íŠ¼ ì¦‰ì‹œ í´ë¦­
                    const renomaBtn = Array.from(document.querySelectorAll('.selection-btn')).find(btn =>
                        btn.textContent.trim() === 'ë ˆë…¸ë§ˆ');

                    if (renomaBtn) {
                        // console.log('ğŸ”¥ ë ˆë…¸ë§ˆ ë²„íŠ¼ ì¦‰ì‹œ í´ë¦­!');
                        renomaBtn.click();

                        // ì‚¬ì´íŠ¸ ë²„íŠ¼ ì¦‰ì‹œ í´ë¦­ (200ms í›„)
                        setTimeout(function() {
                            const siteBtn = Array.from(document.querySelectorAll('#siteButtons .selection-btn')).find(btn =>
                                btn.textContent.includes('ë¡¯ë°ì˜¨-ë ˆë…¸ë§ˆ'));

                            if (siteBtn) {
                                // console.log('ğŸ”¥ ì‚¬ì´íŠ¸ ë²„íŠ¼ ì¦‰ì‹œ í´ë¦­!');
                                siteBtn.click();
                            }
                        }, 200);

                        // ìœ í˜• ë²„íŠ¼ ì¦‰ì‹œ í´ë¦­ (400ms í›„)
                        setTimeout(function() {
                            const allRows = document.querySelectorAll('.selection-row');
                            const typeRow = allRows[2];
                            if (typeRow) {
                                // ğŸ”¥ ëŒ€í‘œë‹˜ ìˆ˜ì •: ì„œë²„ì—ì„œ ë„˜ì–´ì˜¨ ì‹¤ì œ ìœ í˜• ì½”ë“œ ì‚¬ìš©
                                const serverReturnTypeCode = serverData.returnTypeCode;
                                const typeDisplayMap = {
                                    'FULL_RETURN': 'ì „ì²´ë°˜í’ˆ',
                                    'FULL_EXCHANGE': 'ì „ì²´êµí™˜',
                                    'PARTIAL_RETURN': 'ë¶€ë¶„ë°˜í’ˆ',
                                    'PARTIAL_EXCHANGE': 'ë¶€ë¶„êµí™˜'
                                };
                                const expectedTypeText = typeDisplayMap[serverReturnTypeCode];
                                
                                // console.log('ğŸ” ì„œë²„ ìœ í˜• ì½”ë“œ:', serverReturnTypeCode);
                                // console.log('ğŸ” ì°¾ì„ ìœ í˜• í…ìŠ¤íŠ¸:', expectedTypeText);
                                
                                const typeBtn = Array.from(typeRow.querySelectorAll('.selection-btn')).find(btn =>
                                    btn.textContent.trim() === expectedTypeText);

                                if (typeBtn) {
                                    // console.log('ğŸ”¥ ìœ í˜• ë²„íŠ¼ ì¦‰ì‹œ í´ë¦­:', expectedTypeText);
                                    typeBtn.click();
                                } else {
                                    // console.log('âŒ ìœ í˜• ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ:', expectedTypeText);
                                }
                            }
                        }, 400);

                        // ì‚¬ìœ  ë²„íŠ¼ ì¦‰ì‹œ í´ë¦­ (600ms í›„)
                        setTimeout(function() {
                            const allRows = document.querySelectorAll('.selection-row');
                            const reasonRow = allRows[3];
                            if (reasonRow) {
                                // ğŸ”¥ ëŒ€í‘œë‹˜ ìˆ˜ì •: ì„œë²„ì—ì„œ ë„˜ì–´ì˜¨ ì‹¤ì œ ì‚¬ìœ  ì‚¬ìš©
                                const serverReturnReason = serverData.returnReason;
                                
                                // console.log('ğŸ” ì„œë²„ ì‚¬ìœ :', serverReturnReason);
                                
                                const reasonBtn = Array.from(reasonRow.querySelectorAll('.selection-btn')).find(btn =>
                                    btn.textContent.trim() === serverReturnReason);

                                if (reasonBtn) {
                                    // console.log('ğŸ”¥ ì‚¬ìœ  ë²„íŠ¼ ì¦‰ì‹œ í´ë¦­:', serverReturnReason);
                                    reasonBtn.click();
                                } else {
                                    // console.log('âŒ ì‚¬ìœ  ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ:', serverReturnReason);
                                }
                            }
                        }, 600);

                        // ğŸ¨ ìƒ‰ìƒ ì—…ë°ì´íŠ¸ ì¦‰ì‹œ ì‹¤í–‰ (800ms í›„)
                        setTimeout(function() {
                            // console.log('ğŸ¨ğŸ”¥ ìƒ‰ìƒ ì—…ë°ì´íŠ¸ ì¦‰ì‹œ ì‹¤í–‰!');

                            // ëª¨ë“  ì…ë ¥ í•„ë“œ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
                            const allFields = document.querySelectorAll('input, select, textarea');
                            allFields.forEach(field => {
                                if (field.value && field.value.trim() !== '') {
                                    // ì›ë³¸ ë°ì´í„°ëŠ” ë…¹ìƒ‰
                                    field.style.backgroundColor = '#e8f5e8';
                                    field.style.borderColor = '#4caf50';
                                    field.style.color = '#2e7d32';
                                    field.classList.add('original-data');
                                    // console.log(`ğŸ¨ ${field.id || field.name} ë…¹ìƒ‰ ì ìš©`);
                                }
                            });
                        }, 800);

                    } else {
                        // console.log('âŒ ë ˆë…¸ë§ˆ ë²„íŠ¼ ì—†ìŒ');
                    }

                }, 100); // 100msë§Œ ëŒ€ê¸°

            } else {
                // console.log('ğŸ†•ğŸ”¥ ë“±ë¡ ëª¨ë“œ - CS ì ‘ìˆ˜ì¼ ì¦‰ì‹œ ì„¤ì •');

                // CS ì ‘ìˆ˜ì¼ ìë™ ì„¤ì •
                const csReceivedDateField = document.getElementById('csReceivedDate');
                if (csReceivedDateField && (!csReceivedDateField.value || csReceivedDateField.value === '')) {
                    const today = new Date();
                    const todayString = today.getFullYear() + '-' +
                        String(today.getMonth() + 1).padStart(2, '0') + '-' +
                        String(today.getDate()).padStart(2, '0');
                    csReceivedDateField.value = todayString;
                    csReceivedDateField.style.backgroundColor = '#e3f2fd';
                    csReceivedDateField.style.borderColor = '#2196f3';
                    csReceivedDateField.style.color = '#1976d2';
                    // console.log('ğŸ“…ğŸ”¥ CS ì ‘ìˆ˜ì¼ ì¦‰ì‹œ ì„¤ì •:', todayString);
                }
            }
        });

        // ğŸ¨ ëŒ€í‘œë‹˜ ìš”ì²­: ì™„ì „ ìƒˆë¡œìš´ ì‹¤ì‹œê°„ ìƒ‰ìƒ ê°ì§€ ì‹œìŠ¤í…œ
        document.addEventListener('DOMContentLoaded', function() {
            // console.log('ğŸ¨ğŸ”¥ ëŒ€í‘œë‹˜ ìƒˆë¡œìš´ ì‹¤ì‹œê°„ ìƒ‰ìƒ ê°ì§€ ì‹œì‘');

            // ğŸ”¥ ìˆ˜ì • ëª¨ë“œ í™•ì¸
            const isEditMode = document.querySelector('input[name="id"]') !== null;
            // console.log('ğŸ”§ ìƒ‰ìƒ ì‹œìŠ¤í…œ ëª¨ë“œ:', isEditMode ? 'ìˆ˜ì •' : 'ë“±ë¡');

            // ëª¨ë“  ì…ë ¥ í•„ë“œì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€ (í´ë¦­ ì´ë²¤íŠ¸ ì œì™¸)
            const allFields = document.querySelectorAll('input, select, textarea');
            allFields.forEach(field => {
                // ğŸ”¥ ëŒ€í‘œë‹˜ ìš”ì²­: í´ë¦­ ì´ë²¤íŠ¸ ì œê±°, inputê³¼ changeë§Œ ì‚¬ìš©
                ['input', 'change'].forEach(eventType => {
                    field.addEventListener(eventType, function() {
                        // ğŸ”¥ ì•½ê°„ì˜ ì§€ì—°ì„ ë‘ì–´ ì‹¤ì œ ê°’ ë³€ê²½ í™•ì¸
                        setTimeout(() => {
                            const originalValue = this.dataset.originalValue || '';
                            const currentValue = this.value || '';

                            // console.log(`ğŸ” ${this.id || this.name} ê°’ ì²´í¬:`, {
                            //     original: originalValue,
                            //     current: currentValue,
                            //     changed: currentValue !== originalValue
                            // });

                            if (isEditMode) {
                                // ìˆ˜ì • ëª¨ë“œì—ì„œë§Œ ìƒ‰ìƒ ë³€ê²½
                                if (currentValue !== originalValue && currentValue !== '') {
                                    // ì‹¤ì œë¡œ ê°’ì´ ë³€ê²½ëœ ê²½ìš°ë§Œ ë¹¨ê°„ìƒ‰
                                    this.style.backgroundColor = '#ffebee';
                                    this.style.borderColor = '#f44336';
                                    this.style.color = '#d32f2f';
                                    // console.log(`ğŸ”´ ${this.id || this.name} ë¹¨ê°„ìƒ‰ ì ìš© (ì‹¤ì œ ìˆ˜ì •ë¨)`);
                                } else if (currentValue === originalValue && originalValue !== '') {
                                    // ì›ë³¸ê°’ê³¼ ê°™ìœ¼ë©´ ë…¹ìƒ‰
                                    this.style.backgroundColor = '#e8f5e8';
                                    this.style.borderColor = '#4caf50';
                                    this.style.color = '#2e7d32';
                                    // console.log(`ğŸŸ¢ ${this.id || this.name} ë…¹ìƒ‰ ì ìš© (ì›ë³¸ê°’)`);
                                }
                            } else {
                                // ë“±ë¡ ëª¨ë“œì—ì„œëŠ” íŒŒë€ìƒ‰
                                if (currentValue !== '') {
                                    this.style.backgroundColor = '#e3f2fd';
                                    this.style.borderColor = '#2196f3';
                                    this.style.color = '#1976d2';
                                    // console.log(`ğŸ”µ ${this.id || this.name} íŒŒë€ìƒ‰ ì ìš© (ì‹ ê·œ ì…ë ¥)`);
                                }
                            }
                        }, 100); // 100ms ì§€ì—°
                    });
                });
            });
        });
    </script>

    <!-- ğŸš€ ì¦‰ì‹œ ì‹¤í–‰ ì„ íƒ í•¨ìˆ˜ë“¤ (í—¤ë“œì—ì„œ ë¨¼ì € ì •ì˜) -->
    <script th:inline="javascript">
        // console.log('ğŸ”¥ í—¤ë“œì—ì„œ í•¨ìˆ˜ ì •ì˜ ì‹œì‘');

        // ğŸ¯ ì„œë²„ ë°ì´í„°ë¥¼ JavaScript ë³€ìˆ˜ë¡œ ì „ë‹¬ (ëŒ€í‘œë‹˜ ìš”ì²­ì‚¬í•­)
        const serverData = {
            isEdit: /*[[${isEdit}]]*/ false,
            siteName: /*[[${returnItem?.siteName}]]*/ '',
            returnTypeCode: /*[[${returnItem?.returnTypeCode}]]*/ '',
            returnReason: /*[[${returnItem?.returnReason}]]*/ '',
            // ëŒ€í‘œë‹˜ ìš”ì²­ìœ¼ë¡œ ì „ì²´ ë°ì´í„° ì¶”ê°€
            orderNumber: /*[[${returnItem?.orderNumber}]]*/ '',
            orderItemCode: /*[[${returnItem?.orderItemCode}]]*/ '',
            customerName: /*[[${returnItem?.customerName}]]*/ '',
            customerPhone: /*[[${returnItem?.customerPhone}]]*/ '',
            productColor: /*[[${returnItem?.productColor}]]*/ '',
            productSize: /*[[${returnItem?.productSize}]]*/ '',
            quantity: /*[[${returnItem?.quantity}]]*/ '',
            refundAmount: /*[[${returnItem?.refundAmount}]]*/ '',
            trackingNumber: /*[[${returnItem?.trackingNumber}]]*/ '',
            returnStatusCode: /*[[${returnItem?.returnStatusCode}]]*/ '',
            shippingFee: /*[[${returnItem?.shippingFee}]]*/ '',
            processor: /*[[${returnItem?.processor}]]*/ '',
            remarks: /*[[${returnItem?.remarks}]]*/ '',
            // ğŸ”¥ ëŒ€í‘œë‹˜ ìš”ì²­: CS ì ‘ìˆ˜ì¼ ì •í™•í•œ í˜•ì‹ìœ¼ë¡œ ì „ë‹¬
            csReceivedDate: /*[[${returnItem?.csReceivedDate != null ? returnItem.csReceivedDate.toString() : ''}]]*/ '',
            orderDate: /*[[${returnItem?.orderDate != null ? returnItem.orderDate.toString() : ''}]]*/ '',
            collectionCompletedDate: /*[[${returnItem?.collectionCompletedDate != null ? returnItem.collectionCompletedDate.toString() : ''}]]*/ '',
            logisticsConfirmedDate: /*[[${returnItem?.logisticsConfirmedDate != null ? returnItem.logisticsConfirmedDate.toString() : ''}]]*/ '',
            shippingDate: /*[[${returnItem?.shippingDate != null ? returnItem.shippingDate.toString() : ''}]]*/ '',
            refundDate: /*[[${returnItem?.refundDate != null ? returnItem.refundDate.toString() : ''}]]*/ '',
            isCompleted: /*[[${returnItem?.isCompleted}]]*/ '',
            defectDetail: /*[[${returnItem?.defectDetail}]]*/ '',
            defectPhotoUrl: /*[[${returnItem?.defectPhotoUrl}]]*/ '',
            // ğŸ”¥ ë°°ì†¡ë¹„ ì…ê¸ˆìƒíƒœ ì¶”ê°€
            paymentStatus: /*[[${returnItem?.paymentStatus}]]*/ ''
        };

        // console.log('ğŸ“ŠğŸ”¥ ëŒ€í‘œë‹˜ ìš”ì²­ - ì„œë²„ì—ì„œ ì „ë‹¬ë°›ì€ ì „ì²´ ë°ì´í„°:');
        // console.log('='.repeat(80));
        // Object.keys(serverData).forEach(key => {
        //     console.log(`${key}: "${serverData[key]}"`);
        // });
        // console.log('='.repeat(80));

        // ğŸ”¥ ëŒ€í‘œë‹˜ ê¸´ê¸‰ ìˆ˜ì •: ìˆ˜ì • ëª¨ë“œì¼ ë•Œ ì¦‰ì‹œ ì›ë³¸ê°’ ì„¤ì •
        if (serverData.isEdit) {
            // console.log('ğŸ”§ğŸ”¥ ìˆ˜ì • ëª¨ë“œ ê°ì§€ - ì¦‰ì‹œ ì›ë³¸ê°’ ì„¤ì • ì‹œì‘');

            // DOMì´ ì¤€ë¹„ë˜ë©´ ì¦‰ì‹œ ì›ë³¸ê°’ ì„¤ì •
            const setOriginalValues = () => {
                if (document.readyState === 'loading') {
                    setTimeout(setOriginalValues, 50);
                    return;
                }

                // console.log('âš¡ ì›ë³¸ê°’ ì¦‰ì‹œ ì„¤ì • ì‹œì‘');

                // ëª¨ë“  í•„ë“œì— ì›ë³¸ê°’ ì„¤ì •
                Object.keys(serverData).forEach(key => {
                    const field = document.getElementById(key);
                    const value = serverData[key];

                    if (field && value !== null && value !== undefined && value !== '') {
                        field.dataset.originalValue = value;
                        
                        // ğŸ”¥ğŸ”¥ğŸ”¥ ëŒ€í‘œë‹˜ ê¸´ê¸‰ ìˆ˜ì •: ë°°ì†¡ë¹„ í•„ë“œëŠ” ê°’ë„ ì§ì ‘ ì„¤ì •
                        if (key === 'shippingFee') {
                            field.value = value;
                            field.style.backgroundColor = '#e8f5e8';
                            field.style.borderColor = '#4caf50';
                            field.style.color = '#2e7d32';
                            // console.log(`ğŸ”¥âœ… ${key} ê°’ê³¼ ì›ë³¸ê°’ ëª¨ë‘ ì„¤ì •: "${value}"`);
                        } else {
                            // console.log(`ğŸ”§ ${key} ì›ë³¸ê°’ ì„¤ì •: "${value}"`);
                        }
                    }
                });
            };

            setOriginalValues();
        }

        // ğŸ¯ ë¸Œëœë“œ ì¶”ì¶œ í•¨ìˆ˜ (ëŒ€í‘œë‹˜ ì‚¬ì´íŠ¸ ê¸°ì¤€)
        function extractBrandFromSite(siteName) {
            // console.log('ğŸ” ë¸Œëœë“œ ì¶”ì¶œ ì‹œë„:', siteName);
            if (!siteName) return null;

            if (siteName.includes('ë ˆë…¸ë§ˆ')) {
                // console.log('âœ… ë ˆë…¸ë§ˆ ë¸Œëœë“œ ê°ì§€');
                return 'ë ˆë…¸ë§ˆ';
            }
            if (siteName.includes('ì½”ë„ë¦¬í¬')) {
                // console.log('âœ… ì½”ë„ë¦¬í¬ ë¸Œëœë“œ ê°ì§€');
                return 'ì½”ë„ë¦¬í¬';
            }

            // console.log('âŒ ì•Œ ìˆ˜ ì—†ëŠ” ë¸Œëœë“œ:', siteName);
            return null;
        }

        // ğŸ¯ ë¸Œëœë“œ ì„ íƒ í•¨ìˆ˜ (Direct)
        function selectBrandDirect(brand, element) {
            // console.log('ğŸ·ï¸ ë¸Œëœë“œ ì„ íƒ (Direct):', brand);

            // ëª¨ë“  ë¸Œëœë“œ ë²„íŠ¼ ì´ˆê¸°í™”
            document.querySelectorAll('.selection-row:first-child .selection-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // ì„ íƒëœ ë²„íŠ¼ í™œì„±í™”
            element.classList.add('active');

            // ì‚¬ì´íŠ¸ ë²„íŠ¼ ìƒì„±
            const siteButtonsContainer = document.getElementById('siteButtons');
            let siteButtons = '';

            if (brand === 'ë ˆë…¸ë§ˆ') {
                siteButtons = `
                    <div class="selection-btn" onclick="selectSiteDirect('29CM-ë ˆë…¸ë§ˆ', this)">29CM-ë ˆë…¸ë§ˆ</div>
                    <div class="selection-btn" onclick="selectSiteDirect('ë¡¯ë°ì˜¨-ë ˆë…¸ë§ˆ', this)">ë¡¯ë°ì˜¨-ë ˆë…¸ë§ˆ</div>
                    <div class="selection-btn" onclick="selectSiteDirect('ë¬´ì‹ ì‚¬-ë ˆë…¸ë§ˆ', this)">ë¬´ì‹ ì‚¬-ë ˆë…¸ë§ˆ</div>
                    <div class="selection-btn" onclick="selectSiteDirect('ìŠ¤í† ì–´íŒœ-ë ˆë…¸ë§ˆ', this)">ìŠ¤í† ì–´íŒœ-ë ˆë…¸ë§ˆ</div>
                    <div class="selection-btn" onclick="selectSiteDirect('ìì‚¬ëª°-ë ˆë…¸ë§ˆ', this)">ìì‚¬ëª°-ë ˆë…¸ë§ˆ</div>
                    <div class="selection-btn" onclick="selectSiteDirect('ì§€ê·¸ì¬ê·¸-ë ˆë…¸ë§ˆ', this)">ì§€ê·¸ì¬ê·¸-ë ˆë…¸ë§ˆ</div>
                    <div class="selection-btn" onclick="selectSiteDirect('ì¹´ì¹´ì˜¤-ë ˆë…¸ë§ˆ', this)">ì¹´ì¹´ì˜¤-ë ˆë…¸ë§ˆ</div>
                    <div class="selection-btn" onclick="selectSiteDirect('íŒ¨ì…˜í”ŒëŸ¬ìŠ¤-ë ˆë…¸ë§ˆ', this)">íŒ¨ì…˜í”ŒëŸ¬ìŠ¤-ë ˆë…¸ë§ˆ</div>
                    <div class="selection-btn" onclick="selectSiteDirect('í•˜í”„í´ëŸ½-ë ˆë…¸ë§ˆ', this)">í•˜í”„í´ëŸ½-ë ˆë…¸ë§ˆ</div>
                    <div class="selection-btn" onclick="selectSiteDirect('SSG-ë ˆë…¸ë§ˆ', this)">SSG-ë ˆë…¸ë§ˆ</div>
                    <div class="selection-btn" onclick="selectSiteDirect('EQL-ë ˆë…¸ë§ˆ', this)">EQL-ë ˆë…¸ë§ˆ</div>
                    <div class="selection-btn" onclick="selectSiteDirect('Wì»¨ì…‰-ë ˆë…¸ë§ˆ', this)">Wì»¨ì…‰-ë ˆë…¸ë§ˆ</div>
                `;
            } else if (brand === 'ì½”ë„ë¦¬í¬') {
                siteButtons = `
                    <div class="selection-btn" onclick="selectSiteDirect('29CM-ì½”ë„ë¦¬í¬', this)">29CM-ì½”ë„ë¦¬í¬</div>
                    <div class="selection-btn" onclick="selectSiteDirect('ë¬´ì‹ ì‚¬-ì½”ë„ë¦¬í¬', this)">ë¬´ì‹ ì‚¬-ì½”ë„ë¦¬í¬</div>
                    <div class="selection-btn" onclick="selectSiteDirect('ìì‚¬ëª°-ì½”ë„ë¦¬í¬', this)">ìì‚¬ëª°-ì½”ë„ë¦¬í¬</div>
                    <div class="selection-btn" onclick="selectSiteDirect('ì§€ê·¸ì¬ê·¸-ì½”ë„ë¦¬í¬', this)">ì§€ê·¸ì¬ê·¸-ì½”ë„ë¦¬í¬</div>
                    <div class="selection-btn" onclick="selectSiteDirect('CJì˜¤ì‡¼í•‘-ì½”ë„ë¦¬í¬', this)">CJì˜¤ì‡¼í•‘-ì½”ë„ë¦¬í¬</div>
                    <div class="selection-btn" onclick="selectSiteDirect('SSG-ì½”ë„ë¦¬í¬', this)">SSG-ì½”ë„ë¦¬í¬</div>
                    <div class="selection-btn" onclick="selectSiteDirect('EQL-ì½”ë„ë¦¬í¬', this)">EQL-ì½”ë„ë¦¬í¬</div>
                    <div class="selection-btn" onclick="selectSiteDirect('LFëª°-ì½”ë„ë¦¬í¬', this)">LFëª°-ì½”ë„ë¦¬í¬</div>
                    <div class="selection-btn" onclick="selectSiteDirect('ìŠ¤í† ì–´íŒœ-ì½”ë„ë¦¬í¬', this)">ìŠ¤í† ì–´íŒœ-ì½”ë„ë¦¬í¬</div>
                `;
            }

            if (siteButtonsContainer) {
                siteButtonsContainer.innerHTML = siteButtons;
            }
            updateSelectedInfoDirect();
        }

        // ğŸ¯ ì‚¬ì´íŠ¸ ì„ íƒ í•¨ìˆ˜ (Direct)
        function selectSiteDirect(site, element) {
            // console.log('ğŸŒ ì‚¬ì´íŠ¸ ì„ íƒ (Direct):', site);

            // ëª¨ë“  ì‚¬ì´íŠ¸ ë²„íŠ¼ ì´ˆê¸°í™”
            document.querySelectorAll('#siteButtons .selection-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // ì„ íƒëœ ë²„íŠ¼ í™œì„±í™”
            element.classList.add('active');

            // í¼ì— ì‚¬ì´íŠ¸ ì •ë³´ ì„¤ì •
            const siteNameField = document.getElementById('siteName');
            if (siteNameField) {
                siteNameField.value = site;
                // ğŸ¨ ì¦‰ì‹œ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
                updateSingleFieldColor(siteNameField);
            }

            updateSelectedInfoDirect();
        }

        // ğŸ¯ ìœ í˜• ì½”ë“œ ë§¤í•‘ í…Œì´ë¸” (ëŒ€í‘œë‹˜ ì‹œìŠ¤í…œ ê¸°ì¤€)
        const typeDisplayMap = {
            'FULL_RETURN': 'ì „ì²´ë°˜í’ˆ',
            'FULL_EXCHANGE': 'ì „ì²´êµí™˜',
            'PARTIAL_RETURN': 'ë¶€ë¶„ë°˜í’ˆ',
            'PARTIAL_EXCHANGE': 'ë¶€ë¶„êµí™˜'
        };

        // ğŸ¯ ì—­ë°©í–¥ ë§¤í•‘ (í•œê¸€ â†’ ì½”ë“œ)
        const typeCodeMap = {
            'ì „ì²´ë°˜í’ˆ': 'FULL_RETURN',
            'ì „ì²´êµí™˜': 'FULL_EXCHANGE',
            'ë¶€ë¶„ë°˜í’ˆ': 'PARTIAL_RETURN',
            'ë¶€ë¶„êµí™˜': 'PARTIAL_EXCHANGE'
        };

        // ğŸ¯ ìœ í˜• ì„ íƒ í•¨ìˆ˜ (Direct)
        function selectTypeDirect(type, element) {
            // console.log('ğŸ“‹ ìœ í˜• ì„ íƒ (Direct):', type);

            // ğŸ”¥ ëŒ€í‘œë‹˜ ìˆ˜ì •: ì •í™•í•œ ìœ í˜• ë²„íŠ¼ ì„ íƒì ì‚¬ìš©
            const allRows = document.querySelectorAll('.selection-row');
            const typeRow = allRows[2]; // ì„¸ ë²ˆì§¸ rowê°€ ìœ í˜•
            if (typeRow) {
                typeRow.querySelectorAll('.selection-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
            }

            // ì„ íƒëœ ë²„íŠ¼ í™œì„±í™”
            element.classList.add('active');

            // í¼ì— ìœ í˜• ì •ë³´ ì„¤ì •
            const returnTypeCodeField = document.getElementById('returnTypeCode');
            if (returnTypeCodeField) {
                returnTypeCodeField.value = type;
            }

            // í‘œì‹œìš© í…ìŠ¤íŠ¸ ì„¤ì •
            const returnTypeDisplayField = document.getElementById('returnTypeDisplay');
            if (returnTypeDisplayField) {
                returnTypeDisplayField.value = typeDisplayMap[type] || type;
                // ğŸ¨ ì¦‰ì‹œ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
                updateSingleFieldColor(returnTypeDisplayField);
            }

            updateSelectedInfoDirect();
        }

        // ğŸ¯ ì‚¬ìœ  ì„ íƒ í•¨ìˆ˜ (Direct)
        function selectReasonDirect(reason, element) {
            // console.log('ğŸ“ ì‚¬ìœ  ì„ íƒ (Direct):', reason);

            // ğŸ”¥ ëŒ€í‘œë‹˜ ìˆ˜ì •: ì •í™•í•œ ì‚¬ìœ  ë²„íŠ¼ ì„ íƒì ì‚¬ìš©
            const allRowsReason = document.querySelectorAll('.selection-row');
            const reasonRow = allRowsReason[3]; // ë„¤ ë²ˆì§¸ rowê°€ ì‚¬ìœ 
            if (reasonRow) {
                reasonRow.querySelectorAll('.selection-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
            }

            // ì„ íƒëœ ë²„íŠ¼ í™œì„±í™”
            element.classList.add('active');

            // í¼ì— ì‚¬ìœ  ì •ë³´ ì„¤ì •
            const returnReasonField = document.getElementById('returnReason');
            if (returnReasonField) {
                returnReasonField.value = reason;
                // ğŸ¨ ì¦‰ì‹œ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
                updateSingleFieldColor(returnReasonField);
            }

            updateSelectedInfoDirect();
        }

        // ğŸ¯ ì„ íƒ ì •ë³´ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (Direct)
        function updateSelectedInfoDirect() {
            const allRowsUpdate = document.querySelectorAll('.selection-row');
            const selectedBrand = allRowsUpdate[0] ? allRowsUpdate[0].querySelector('.selection-btn.active')?.textContent || '' : '';
            const selectedSite = document.querySelector('#siteButtons .selection-btn.active')?.textContent || '';
            const selectedType = allRowsUpdate[2] ? allRowsUpdate[2].querySelector('.selection-btn.active')?.textContent || '' : '';
            const selectedReason = allRowsUpdate[3] ? allRowsUpdate[3].querySelector('.selection-btn.active')?.textContent || '' : '';

            let infoText = '';
            if (selectedBrand) infoText += `ë¸Œëœë“œ: ${selectedBrand}`;
            if (selectedSite) infoText += ` | ì‚¬ì´íŠ¸: ${selectedSite}`;
            if (selectedType) infoText += ` | ìœ í˜•: ${selectedType}`;
            if (selectedReason) infoText += ` | ì‚¬ìœ : ${selectedReason}`;

            if (!infoText) {
                infoText = 'ë¸Œëœë“œ, ì‚¬ì´íŠ¸, ìœ í˜•, ì‚¬ìœ ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”';
            }

            const selectedTextElement = document.getElementById('selectedText');
            if (selectedTextElement) {
                selectedTextElement.textContent = infoText;
            }

            const selectedInfoElement = document.getElementById('selectedInfo');
            if (selectedInfoElement) {
                selectedInfoElement.style.display = infoText !== 'ë¸Œëœë“œ, ì‚¬ì´íŠ¸, ìœ í˜•, ì‚¬ìœ ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”' ? 'block' : 'none';
            }
        }

        // ğŸ¨ ëŒ€í‘œë‹˜ ìš”ì²­: ì›ë³¸ ë°ì´í„°ëŠ” ì´ˆë¡ìƒ‰, ìˆ˜ì •ëœ ë°ì´í„°ëŠ” ë¹¨ê°„ìƒ‰
        function updateSingleFieldColor(field) {
            if (!field) return;

            const fieldId = field.id;
            const currentValue = field.value ? field.value.trim() : '';
            const originalValue = field.dataset.originalValue || '';

            // ê¸°ì¡´ í´ë˜ìŠ¤ ì œê±°
            field.classList.remove('completed', 'modified', 'original-data');

            if (currentValue !== '') {
                // ìˆ˜ì • ëª¨ë“œì—ì„œ ì›ë³¸ ê°’ê³¼ ë¹„êµ
                if (originalValue && currentValue !== originalValue) {
                    // ğŸ”´ ìˆ˜ì •ëœ ë°ì´í„°ëŠ” ë¹¨ê°„ìƒ‰
                    field.classList.add('modified');
                    field.style.backgroundColor = '#ffebee'; // ì—°í•œ ë¹¨ê°„ìƒ‰ ë°°ê²½
                    field.style.borderColor = '#f44336'; // ë¹¨ê°„ìƒ‰ í…Œë‘ë¦¬
                    field.style.color = '#d32f2f'; // ì§„í•œ ë¹¨ê°„ìƒ‰ í…ìŠ¤íŠ¸
                    // console.log(`ğŸ”´ ${fieldId} ìˆ˜ì •ë¨: "${originalValue}" â†’ "${currentValue}"`);
                } else if (originalValue) {
                    // ğŸŸ¢ ì›ë³¸ ë°ì´í„°ëŠ” ì´ˆë¡ìƒ‰ (ì„±ê³µ ìƒ‰ìƒ)
                    field.classList.add('original-data');
                    field.style.backgroundColor = '#e8f5e8'; // ì—°í•œ ì´ˆë¡ìƒ‰ ë°°ê²½
                    field.style.borderColor = '#4caf50'; // ì´ˆë¡ìƒ‰ í…Œë‘ë¦¬
                    field.style.color = '#2e7d32'; // ì§„í•œ ì´ˆë¡ìƒ‰ í…ìŠ¤íŠ¸
                    // console.log(`ğŸŸ¢ ${fieldId} ì›ë³¸ ë°ì´í„° ìœ ì§€: "${currentValue}"`);
                } else {
                    // ìƒˆë¡œ ì…ë ¥ëœ ë°ì´í„°ëŠ” ê¸°ë³¸ ì™„ë£Œ ìƒ‰ìƒ
                    field.classList.add('completed');
                    field.style.backgroundColor = '#e3f2fd'; // ì—°í•œ íŒŒë€ìƒ‰ ë°°ê²½
                    field.style.borderColor = '#2196f3'; // íŒŒë€ìƒ‰ í…Œë‘ë¦¬
                    field.style.color = '#1976d2'; // ì§„í•œ íŒŒë€ìƒ‰ í…ìŠ¤íŠ¸
                    // console.log(`ğŸ”µ ${fieldId} ìƒˆë¡œ ì…ë ¥: "${currentValue}"`);
                }
            } else {
                // ë¹ˆ ê°’ì€ ê¸°ë³¸ ìŠ¤íƒ€ì¼ë¡œ ë³µì›
                field.style.backgroundColor = '';
                field.style.borderColor = '';
                field.style.color = '';
                // console.log(`âšª ${fieldId} ë¹ˆ ê°’`);
            }
        }

        // ğŸ—ƒï¸ ëŒ€í‘œë‹˜ ìš”ì²­: ê°•í™”ëœ ì›ë³¸ ë°ì´í„° ì €ì¥ í•¨ìˆ˜
        function saveOriginalValues() {
            // console.log('ğŸ—ƒï¸ğŸ”¥ ëŒ€í‘œë‹˜ ì›ë³¸ ë°ì´í„° ì €ì¥ ì‹œì‘');

            // ëª¨ë“  ì…ë ¥ í•„ë“œ ëŒ€ìƒìœ¼ë¡œ ì €ì¥
            const allFields = document.querySelectorAll('input, select, textarea');
            let savedCount = 0;

            allFields.forEach(field => {
                if (field.value && field.value.trim() !== '') {
                    field.dataset.originalValue = field.value.trim();
                    // console.log(`ğŸ’¾ğŸ”¥ ${field.id || field.name} ì›ë³¸ê°’ ì €ì¥: "${field.value.trim()}"`);
                    savedCount++;

                    // ì¦‰ì‹œ ë…¹ìƒ‰ìœ¼ë¡œ í‘œì‹œ
                    field.style.backgroundColor = '#e8f5e8'; // ì—°í•œ ì´ˆë¡ìƒ‰ ë°°ê²½
                    field.style.borderColor = '#4caf50'; // ì´ˆë¡ìƒ‰ í…Œë‘ë¦¬
                    field.style.color = '#2e7d32'; // ì§„í•œ ì´ˆë¡ìƒ‰ í…ìŠ¤íŠ¸
                    field.classList.add('original-data');
                }
            });

            // console.log(`âœ…ğŸ”¥ ëŒ€í‘œë‹˜ ì›ë³¸ ë°ì´í„° ì €ì¥ ì™„ë£Œ: ${savedCount}ê°œ í•„ë“œ`);
        }

        // console.log('âœ… í—¤ë“œì—ì„œ í•¨ìˆ˜ ì •ì˜ ì™„ë£Œ');
    </script>
    <style>
        /* ì»´íŒ©íŠ¸í•œ ë“±ë¡ í¼ì„ ìœ„í•œ ë””ìì¸ */
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3f37c9;
            --success-color: #35b27f;
            --warning-color: #f72585;
            --danger-color: #ff4d6d;
            --bg-color: #f8fafc;
            --bg-card: #ffffff;
            --border-color: #e2e8f0;
            --text-color: #2d3748;
            --text-muted: #718096;
            --shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            --radius: 0.375rem;
        }

        /* ë¡œë”© ì˜¤ë²„ë ˆì´ */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .loading-content {
            background: white;
            padding: 2rem;
            border-radius: var(--radius);
            text-align: center;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: var(--text-color);
            font-weight: 500;
        }

        /* ì„±ê³µ ë©”ì‹œì§€ */
        .success-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .success-content {
            background: white;
            padding: 2rem;
            border-radius: var(--radius);
            text-align: center;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .success-icon {
            width: 60px;
            height: 60px;
            background: var(--success-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            color: white;
            font-size: 1.5rem;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
            font-size: 0.8rem;
        }

        .container {
            max-width: 100%;
            width: 100%;
            margin: 0;
            padding: 0.75rem;
        }

        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1rem;
            border-radius: var(--radius);
            margin-bottom: 1rem;
            box-shadow: var(--shadow);
        }

        .header h2 {
            margin: 0 0 0.25rem 0;
            font-size: 1.25rem;
            font-weight: 600;
        }

        .header p {
            margin: 0;
            opacity: 0.9;
            font-size: 0.75rem;
        }

        /* ìƒë‹¨ ì„ íƒ ë²„íŠ¼ë“¤ */
        .top-selections {
            background: var(--bg-card);
            border-radius: var(--radius);
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        .selection-row {
            display: flex;
            align-items: center;
            margin-bottom: 0.75rem;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .selection-row:last-child {
            margin-bottom: 0;
        }

        .selection-label {
            font-weight: 600;
            color: var(--text-color);
            font-size: 0.75rem;
            min-width: 60px;
            margin-right: 0.5rem;
        }

        .selection-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .selection-btn {
            padding: 0.5rem 1rem;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--text-color);
            min-width: 80px;
            text-align: center;
        }

        .selection-btn:hover {
            border-color: var(--primary-color);
            background: var(--primary-color);
            color: white;
        }

        .selection-btn.active {
            background: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
            box-shadow: var(--shadow);
        }

        /* ì„ íƒëœ ì •ë³´ í‘œì‹œ */
        .selected-info {
            background: var(--primary-color);
            color: white;
            padding: 0.75rem;
            border-radius: var(--radius);
            margin-bottom: 1rem;
            font-size: 0.75rem;
            display: none;
        }
        
        .selected-info.show {
            display: block;
        }
        
        /* í¼ ì»¨í…Œì´ë„ˆ */
        .form-container {
            background: var(--bg-card);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .form-content {
            padding: 1rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .form-section-header {
            grid-column: 1 / -1;
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--primary-color);
            margin: 1rem 0 0.5rem 0;
            padding-bottom: 0.25rem;
            border-bottom: 1px solid var(--border-color);
        }

        .form-section-header:first-child {
            margin-top: 0;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 0.25rem;
            font-weight: 500;
            color: var(--text-color);
            font-size: 0.7rem;
        }

        .form-group label.required::after {
            content: ' *';
            color: var(--danger-color);
        }

        .form-control {
            padding: 0.5rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            font-size: 0.75rem;
            transition: all 0.2s ease;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(67, 97, 238, 0.1);
        }

        .form-control.selected {
            background-color: #e3f2fd;
            border-color: var(--primary-color);
            color: var(--primary-color);
            font-weight: 600;
        }

        .form-control.selected:focus {
            background-color: #e3f2fd;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(67, 97, 238, 0.2);
        }

        /* ğŸ¨ ì™„ë£Œëœ í•„ë“œ ìŠ¤íƒ€ì¼ */
        .form-control.completed {
            background-color: #e8f5e8 !important;
            border-color: var(--success-color) !important;
            color: #2e7d32 !important;
            font-weight: 600 !important;
        }

        .form-control.completed:focus {
            background-color: #e8f5e8 !important;
            border-color: var(--success-color) !important;
            box-shadow: 0 0 0 2px rgba(53, 178, 127, 0.2) !important;
        }

        /* ì™„ë£Œëœ í•„ë“œì˜ ë¼ë²¨ì— ì²´í¬ í‘œì‹œ */
        .form-group:has(.form-control.completed) label::before {
            content: 'âœ… ';
            color: var(--success-color);
            font-weight: bold;
        }

        /* ğŸ”¥ ëŒ€í‘œë‹˜ ìš”ì²­: ë…¸ë€ìƒ‰ ì œê±° - ìˆ˜ì •ëœ í•„ë“œëŠ” ë¹¨ê°„ìƒ‰ìœ¼ë¡œ */
        .form-control.modified {
            background-color: #ffebee !important;
            border-color: #f44336 !important;
            color: #d32f2f !important;
            font-weight: 600 !important;
        }

        .form-control.modified:focus {
            background-color: #ffebee !important;
            border-color: #f44336 !important;
            box-shadow: 0 0 0 2px rgba(244, 67, 54, 0.2) !important;
        }

        /* ìˆ˜ì •ëœ í•„ë“œì˜ ë¼ë²¨ì— ìˆ˜ì • í‘œì‹œ */
        .form-group:has(.form-control.modified) label::before {
            content: 'ğŸ”„ ';
            color: #ffc107;
            font-weight: bold;
        }

        .form-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: var(--bg-color);
            border-top: 1px solid var(--border-color);
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: var(--radius);
            font-weight: 500;
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            transition: all 0.2s ease;
            font-size: 0.75rem;
        }

        .btn-secondary {
            background: var(--bg-color);
            color: var(--text-color);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--border-color);
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: var(--secondary-color);
        }

        .progress-info {
            font-size: 0.7rem;
            color: var(--text-muted);
        }

        /* ì´ë¯¸ì§€ ë¶™ì—¬ë„£ê¸° ìŠ¤íƒ€ì¼ - register.htmlê³¼ ë™ì¼ */
        .image-paste-container {
            transition: all 0.3s ease;
        }
        
        .image-paste-container:hover {
            border-color: var(--primary-color) !important;
            background-color: rgba(67, 97, 238, 0.05) !important;
        }
        
        .image-paste-container.dragover {
            border-color: var(--success-color) !important;
            background-color: rgba(53, 178, 127, 0.1) !important;
        }
        
        .pasted-preview-container {
            transition: all 0.2s ease;
        }
        
        .pasted-preview-container:hover {
            transform: scale(1.02);
        }

        /* ì¶”ê°€ ì œí’ˆ ë“±ë¡ ì˜ì—­ ìŠ¤íƒ€ì¼ */
        #addProductArea {
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .form-check-input:checked {
            background-color: var(--success-color);
            border-color: var(--success-color);
        }

        #customOrderInput:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(67, 97, 238, 0.1);
        }

        /* ë³µì‚¬ëœ í•„ë“œ ì½ê¸° ì „ìš© ìŠ¤íƒ€ì¼ */
        .field-copied {
            background-color: #e3f2fd !important;
            border-color: #2196f3 !important;
            color: #1976d2 !important;
            font-weight: 500 !important;
        }

        .field-copied::before {
            content: 'ğŸ“‹ ';
            color: #2196f3;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .container {
                padding: 0.5rem;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .selection-row {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .selection-buttons {
                width: 100%;
            }
            
            .selection-btn {
                flex: 1;
                min-width: 70px;
            }
            
            .form-actions {
                flex-direction: column;
                gap: 0.5rem;
                align-items: stretch;
            }

            #addProductArea .btn {
                width: 100%;
                margin-bottom: 0.5rem;
            }
        }
    </style>
</head>

<body>
    <div layout:fragment="content">
        <div class="container mt-4">
            <div class="page-header">
                <h2 th:text="${isEdit ? 'êµí™˜/ë°˜í’ˆ ìˆ˜ì •' : 'êµí™˜/ë°˜í’ˆ ë“±ë¡'}">êµí™˜/ë°˜í’ˆ ë“±ë¡</h2>
                <p th:text="${isEdit ? 'ê¸°ì¡´ ì •ë³´ë¥¼ ìˆ˜ì •í•˜ê³  ì €ì¥í•˜ì„¸ìš”' : 'ë¸Œëœë“œ, ì‚¬ì´íŠ¸, ìœ í˜•ì„ ì„ íƒí•œ í›„ ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”'}">ë¸Œëœë“œ, ì‚¬ì´íŠ¸, ìœ í˜•ì„ ì„ íƒí•œ í›„ ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”</p>
            </div>
            
            <!-- ìƒë‹¨ ì„ íƒ ë²„íŠ¼ë“¤ -->
            <div class="top-selections">
                <div class="selection-row">
                    <div class="selection-label">ë¸Œëœë“œ:</div>
                    <div class="selection-buttons">
                    <div class="selection-btn" onclick="selectBrandDirect('ë ˆë…¸ë§ˆ', this)">ë ˆë…¸ë§ˆ</div>
                    <div class="selection-btn" onclick="selectBrandDirect('ì½”ë„ë¦¬í¬', this)">ì½”ë„ë¦¬í¬</div>
                    </div>
                </div>

                <div class="selection-row">
                    <div class="selection-label">ì‚¬ì´íŠ¸:</div>
                    <div class="selection-buttons" id="siteButtons">
                        <!-- ì‚¬ì´íŠ¸ ë²„íŠ¼ë“¤ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                    </div>
                </div>

                <div class="selection-row">
                    <div class="selection-label">ìœ í˜•:</div>
                    <div class="selection-buttons">
                    <div class="selection-btn" onclick="selectTypeDirect('FULL_RETURN', this)">ì „ì²´ë°˜í’ˆ</div>
                    <div class="selection-btn" onclick="selectTypeDirect('FULL_EXCHANGE', this)">ì „ì²´êµí™˜</div>
                    <div class="selection-btn" onclick="selectTypeDirect('PARTIAL_RETURN', this)">ë¶€ë¶„ë°˜í’ˆ</div>
                    <div class="selection-btn" onclick="selectTypeDirect('PARTIAL_EXCHANGE', this)">ë¶€ë¶„êµí™˜</div>
                    </div>
                </div>
                
                <div class="selection-row">
                    <div class="selection-label">ì‚¬ìœ :</div>
                    <div class="selection-buttons">
                    <div class="selection-btn" onclick="selectReasonDirect('ê³ ê°ë³€ì‹¬', this)">ê³ ê°ë³€ì‹¬</div>
                    <div class="selection-btn" onclick="selectReasonDirect('ë¶ˆëŸ‰', this)">ë¶ˆëŸ‰</div>
                    <div class="selection-btn" onclick="selectReasonDirect('ì˜¤ë°°ì†¡', this)">ì˜¤ë°°ì†¡</div>
                    <div class="selection-btn" onclick="selectReasonDirect('ê¸°íƒ€', this)">ê¸°íƒ€</div>
                    </div>
                </div>
            </div>

            <!-- ì„ íƒëœ ì •ë³´ í‘œì‹œ -->
            <div class="selected-info" id="selectedInfo">
                <span id="selectedText">ë¸Œëœë“œ, ì‚¬ì´íŠ¸, ìœ í˜•, ì‚¬ìœ ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</span>
            </div>

            <!-- í¼ ì»¨í…Œì´ë„ˆ -->
            <div class="form-container">
                <form th:action="@{/exchange/save}" method="post" th:object="${returnItem}" enctype="multipart/form-data" onsubmit="return handleFormSubmit(event)">
                    <!-- ìˆ˜ì • ëª¨ë“œì¼ ë•Œ ID ì „ë‹¬ -->
                    <input type="hidden" th:if="${isEdit}" th:field="*{id}">
                    <!-- ğŸ¯ ëª©ë¡ ëŒì•„ê°€ê¸° URL -->
                    <input type="hidden" name="returnTo" th:value="${returnUrl}">

                    <div class="form-content">
                        <!-- ê¸°ë³¸ ì •ë³´ -->
                        <div class="form-section-header">ê¸°ë³¸ ì •ë³´</div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="returnTypeCode" class="required">êµí™˜/ë°˜í’ˆ ìœ í˜• *</label>
                                <input type="hidden" id="returnTypeCode" name="returnTypeCode" th:field="*{returnTypeCode}">
                                <input type="text" id="returnTypeDisplay" name="returnTypeDisplay" class="form-control" placeholder="ì „ì²´ë°˜í’ˆ" readonly>
                            </div>

                            <div class="form-group">
                                <label for="returnReason" class="required">ë°˜í’ˆ ì‚¬ìœ  *</label>
                                <input type="text" id="returnReason" name="returnReason" class="form-control" th:field="*{returnReason}" placeholder="ê³ ê°ë³€ì‹¬" readonly>
                            </div>

                            <div class="form-group">
                                <label for="csReceivedDate" class="required">CS ì ‘ìˆ˜ì¼ *</label>
                                <input type="date" id="csReceivedDate" name="csReceivedDate" class="form-control" 
                                       th:field="*{csReceivedDate}" 
                                       required>
                                
                                <!-- ğŸ”¥ğŸ”¥ğŸ”¥ ëŒ€í‘œë‹˜ ê¸´ê¸‰: CS ì ‘ìˆ˜ì¼ ê°•ì œ ì„¤ì • -->
                                <script th:inline="javascript">
                                    (function() {
                                        // console.log('ğŸ”¥ğŸ”¥ğŸ”¥ ëŒ€í‘œë‹˜ CS ì ‘ìˆ˜ì¼ ê°•ì œ ì„¤ì •!');
                                        
                                        const csField = document.getElementById('csReceivedDate');
                                        const isEditMode = /*[[${isEdit}]]*/ false;
                                        const serverCsDate = /*[[${returnItem?.csReceivedDate}]]*/ null;
                                        
                                        // console.log('ğŸ”§ ëª¨ë“œ:', isEditMode);
                                        // console.log('ğŸ” ì„œë²„ CS ì ‘ìˆ˜ì¼:', serverCsDate);
                                        // console.log('ğŸ” í•„ë“œ í˜„ì¬ê°’:', csField.value);
                                        
                                        if (isEditMode && serverCsDate) {
                                            // ğŸ”¥ ìˆ˜ì • ëª¨ë“œ: ì„œë²„ ê°’ ê°•ì œ ì„¤ì •
                                            const dateStr = serverCsDate.toString();
                                            csField.value = dateStr;
                                            csField.dataset.originalValue = dateStr;
                                            
                                            // ğŸŸ¢ ë…¹ìƒ‰ í‘œì‹œ
                                            csField.style.backgroundColor = '#e8f5e8';
                                            csField.style.borderColor = '#4caf50';
                                            csField.style.color = '#2e7d32';
                                            
                                            // console.log('ğŸ”¥âœ… CS ì ‘ìˆ˜ì¼ ê°•ì œ ì„¤ì • ì™„ë£Œ:', dateStr);
                                        } else if (!isEditMode) {
                                            // ğŸ†• ë“±ë¡ ëª¨ë“œ: ì˜¤ëŠ˜ ë‚ ì§œ
                                            const today = new Date();
                                            const todayStr = today.getFullYear() + '-' + 
                                                           String(today.getMonth() + 1).padStart(2, '0') + '-' + 
                                                           String(today.getDate()).padStart(2, '0');
                                            csField.value = todayStr;
                                            csField.dataset.originalValue = todayStr;
                                            
                                            // ğŸ”µ íŒŒë€ìƒ‰ í‘œì‹œ
                                            csField.style.backgroundColor = '#e3f2fd';
                                            csField.style.borderColor = '#2196f3';
                                            csField.style.color = '#1976d2';
                                            
                                            // console.log('ğŸ”¥âœ… CS ì ‘ìˆ˜ì¼ ì˜¤ëŠ˜ë‚ ì§œ ì„¤ì •:', todayStr);
                                        }
                                    })();
                                </script>
                            </div>

                            <div class="form-group">
                                <label for="returnStatusCode">ì²˜ë¦¬ ìƒíƒœ</label>
                                <select id="returnStatusCode" name="returnStatusCode" class="form-control selected" 
                                        th:field="*{returnStatusCode}"
                                        style="background-color: #e3f2fd; border-color: #2196f3;">
                                    <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                    <option value="PENDING">ì ‘ìˆ˜</option>
                                    <option value="PROCESSING">ì²˜ë¦¬ì¤‘</option>
                                    <option value="COMPLETED">ì™„ë£Œ</option>
                                    <option value="CANCELLED">ì·¨ì†Œ</option>
                                </select>
                                <script>
                                    document.getElementById('returnStatusCode').value = 'PENDING';
                                </script>
                            </div>
                        </div>

                        <!-- ì£¼ë¬¸ ì •ë³´ -->
                        <div class="form-section-header">ì£¼ë¬¸ ì •ë³´</div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="siteName" class="required">ì£¼ë¬¸ ì‚¬ì´íŠ¸ *</label>
                                <input type="text" id="siteName" name="siteName" class="form-control" th:field="*{siteName}" placeholder="ìŠ¤í† ì–´íŒœ-ë ˆë…¸ë§ˆ" readonly required>
                            </div>

                            <div class="form-group">
                                <label for="orderNumber" class="required">ì£¼ë¬¸ë²ˆí˜¸ *</label>
                                <input type="text" id="orderNumber" name="orderNumber" class="form-control" th:field="*{orderNumber}" placeholder="20250412-0000868" required>
                            </div>

                            <div class="form-group">
                                <label for="orderDate">ì£¼ë¬¸ì¼</label>
                                <input type="date" id="orderDate" name="orderDate" class="form-control" th:field="*{orderDate}">
                            
                            <!-- ğŸ”¥ğŸ”¥ğŸ”¥ ëŒ€í‘œë‹˜ ê¸´ê¸‰: ì£¼ë¬¸ì¼ ê°•ì œ ì„¤ì • -->
                            <script th:inline="javascript">
                                (function() {
                                    // console.log('ğŸ”¥ğŸ”¥ğŸ”¥ ëŒ€í‘œë‹˜ ì£¼ë¬¸ì¼ ê°•ì œ ì„¤ì •!');
                                    
                                    const orderField = document.getElementById('orderDate');
                                    const isEditMode = /*[[${isEdit}]]*/ false;
                                    const serverOrderDate = /*[[${returnItem?.orderDate}]]*/ null;
                                    
                                    // console.log('ğŸ”§ ëª¨ë“œ:', isEditMode);
                                    // console.log('ğŸ” ì„œë²„ ì£¼ë¬¸ì¼:', serverOrderDate);
                                    // console.log('ğŸ” í•„ë“œ í˜„ì¬ê°’:', orderField.value);
                                    
                                    if (isEditMode && serverOrderDate) {
                                        // ğŸ”¥ ìˆ˜ì • ëª¨ë“œ: ì„œë²„ ê°’ ê°•ì œ ì„¤ì •
                                        const dateStr = serverOrderDate.toString();
                                        orderField.value = dateStr;
                                        orderField.dataset.originalValue = dateStr;
                                        
                                        // ğŸŸ¢ ë…¹ìƒ‰ í‘œì‹œ
                                        orderField.style.backgroundColor = '#e8f5e8';
                                        orderField.style.borderColor = '#4caf50';
                                        orderField.style.color = '#2e7d32';
                                        
                                        // console.log('ğŸ”¥âœ… ì£¼ë¬¸ì¼ ê°•ì œ ì„¤ì • ì™„ë£Œ:', dateStr);
                                    }
                                })();
                            </script>
                            </div>

                            <div class="form-group">
                                <label for="orderItemCode" class="required">ì£¼ë¬¸í’ˆë²ˆ</label>
                                <input type="text" id="orderItemCode" name="orderItemCode" class="form-control" th:field="*{orderItemCode}" placeholder="RN-GSZD962" required>
                            </div>
                
                            <div class="form-group">
                                <label for="productColor" class="required">ìƒ‰ìƒ</label>
                                <input type="text" id="productColor" name="productColor" class="form-control" th:field="*{productColor}" placeholder="PK" required>
                            </div>
            
                            <div class="form-group">
                                <label for="productSize" class="required">ì‚¬ì´ì¦ˆ</label>
                                <input type="text" id="productSize" name="productSize" class="form-control" th:field="*{productSize}" placeholder="75" required>
                            </div>
                
                            <div class="form-group">
                                <label for="quantity" class="required">ìˆ˜ëŸ‰</label>
                                <input type="number" id="quantity" name="quantity" class="form-control" th:field="*{quantity}" min="1" value="1" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="refundAmount">í™˜ë¶ˆê¸ˆì•¡</label>
                                <input type="number" id="refundAmount" name="refundAmount" class="form-control" th:field="*{refundAmount}" placeholder="39200">
                            </div>
                            
                            <div class="form-group">
                            <label for="shippingFee">ë°°ì†¡ë¹„ 
                                <span th:if="${isEdit and returnItem.paymentStatus != null}" 
                                      class="badge ms-2"
                                      th:classappend="${returnItem.paymentStatus == 'COMPLETED'} ? 'bg-success' : (${returnItem.paymentStatus == 'NOT_REQUIRED'} ? 'bg-info' : 'bg-warning')"
                                      th:text="${returnItem.paymentStatus}">ì…ê¸ˆìƒíƒœ</span>
                            </label>
                                <select id="shippingFee" name="shippingFee" class="form-control" th:field="*{shippingFee}">
                                    <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                    <option value="6000" th:selected="${returnItem?.shippingFee == '6000'}">6000ì°¨ê°</option>
                                    <option value="3000" th:selected="${returnItem?.shippingFee == '3000'}">3000ì°¨ê°</option>
                                    <option value="0" th:selected="${returnItem?.shippingFee == '0'}">ë¬´ìƒ</option>
                                    <option value="6350" th:selected="${returnItem?.shippingFee == '6350'}">6350ì°¨ê°</option>
                                    <option value="3350" th:selected="${returnItem?.shippingFee == '3350'}">3350ì°¨ê°</option>
                                                            <option value="ì…ê¸ˆì˜ˆì •" th:selected="${returnItem?.shippingFee == 'ì…ê¸ˆì˜ˆì •'}">ì…ê¸ˆì˜ˆì •</option>
                                    <option value="ê¸°íƒ€ë¬¸ì˜" th:selected="${returnItem?.shippingFee == 'ê¸°íƒ€ë¬¸ì˜'}">ê¸°íƒ€ë¬¸ì˜</option>
                                    <option value="í•©ë°°ì†¡" th:selected="${returnItem?.shippingFee == 'í• ë°°ì†¡'}">í•©ë°°ì†¡</option>
                                </select>
                                
                                <!-- ğŸ”¥ ë°°ì†¡ë¹„ ì…ê¸ˆìƒíƒœ hidden í•„ë“œ ì¶”ê°€ -->
                                <input type="hidden" id="paymentStatus" name="paymentStatus" th:field="*{paymentStatus}">
                                
                            <small class="form-text text-muted">
                                ğŸ’¡ "ì…ê¸ˆì˜ˆì •" ì„ íƒ ì‹œ ë‹´ë‹¹ìê°€ ì…ê¸ˆ ë‚´ì—­ì„ ë“±ë¡í•˜ë©´ ìë™ìœ¼ë¡œ ë§¤í•‘ë©ë‹ˆë‹¤.
                                <span th:if="${isEdit and returnItem.returnTypeCode != null and returnItem.returnTypeCode.contains('EXCHANGE')}" class="text-success">
                                    <i class="fas fa-shipping-fast"></i> êµí™˜ ì¶œê³  ê°€ëŠ¥
                                </span>
                            </small>
                            </div>
                        </div>

                        <!-- ê³ ê° ì •ë³´ -->
                        <div class="form-section-header">ê³ ê° ì •ë³´</div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="customerName" class="required">ê³ ê°ëª… (ìˆ˜ì·¨ì¸)</label>
                                <input type="text" id="customerName" name="customerName" class="form-control" th:field="*{customerName}" placeholder="ê¹€ë¯¼ì§€" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="customerPhone" class="required">ì—°ë½ì²˜</label>
                                <input type="tel" id="customerPhone" name="customerPhone" class="form-control" th:field="*{customerPhone}" placeholder="010-1234-5678" required>
                            </div>
                        </div>
            
                        <!-- ì²˜ë¦¬ ì •ë³´ -->
                        <div class="form-section-header">ì²˜ë¦¬ ì •ë³´</div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="trackingNumber">ìš´ì†¡ì¥ë²ˆí˜¸</label>
                                <input type="text" id="trackingNumber" name="trackingNumber" class="form-control" th:field="*{trackingNumber}" placeholder="5738757014">
                            </div>
            
                            <div class="form-group">
                                <label for="collectionCompletedDate">íšŒìˆ˜ì™„ë£Œì¼</label>
                                <input type="date" id="collectionCompletedDate" name="collectionCompletedDate" class="form-control" th:field="*{collectionCompletedDate}">
                                
                                <!-- ğŸ”¥ğŸ”¥ğŸ”¥ ëŒ€í‘œë‹˜ ê¸´ê¸‰: íšŒìˆ˜ì™„ë£Œì¼ ê°•ì œ ì„¤ì • -->
                                <script th:inline="javascript">
                                    (function() {
                                        const field = document.getElementById('collectionCompletedDate');
                                        const isEditMode = /*[[${isEdit}]]*/ false;
                                        const serverValue = /*[[${returnItem?.collectionCompletedDate}]]*/ null;
                                        
                                        if (isEditMode && serverValue) {
                                            const dateStr = serverValue.toString();
                                            field.value = dateStr;
                                            field.dataset.originalValue = dateStr;
                                            field.style.backgroundColor = '#e8f5e8';
                                            field.style.borderColor = '#4caf50';
                                            field.style.color = '#2e7d32';
                                            // console.log('ğŸ”¥âœ… íšŒìˆ˜ì™„ë£Œì¼ ê°•ì œ ì„¤ì •:', dateStr);
                                        }
                                    })();
                                </script>
                            </div>
                
                            <div class="form-group">
                                <label for="logisticsConfirmedDate">ë¬¼ë¥˜í™•ì¸ì¼</label>
                                <input type="date" id="logisticsConfirmedDate" name="logisticsConfirmedDate" class="form-control" th:field="*{logisticsConfirmedDate}">
                                
                                <!-- ğŸ”¥ğŸ”¥ğŸ”¥ ëŒ€í‘œë‹˜ ê¸´ê¸‰: ë¬¼ë¥˜í™•ì¸ì¼ ê°•ì œ ì„¤ì • -->
                                <script th:inline="javascript">
                                    (function() {
                                        const field = document.getElementById('logisticsConfirmedDate');
                                        const isEditMode = /*[[${isEdit}]]*/ false;
                                        const serverValue = /*[[${returnItem?.logisticsConfirmedDate}]]*/ null;
                                        
                                        if (isEditMode && serverValue) {
                                            const dateStr = serverValue.toString();
                                            field.value = dateStr;
                                            field.dataset.originalValue = dateStr;
                                            field.style.backgroundColor = '#e8f5e8';
                                            field.style.borderColor = '#4caf50';
                                            field.style.color = '#2e7d32';
                                            // console.log('ğŸ”¥âœ… ë¬¼ë¥˜í™•ì¸ì¼ ê°•ì œ ì„¤ì •:', dateStr);
                                        }
                                    })();
                                </script>
                            </div>
            
                            <div class="form-group">
                                <label for="shippingDate">ì¶œê³ ì¼ì</label>
                                <input type="date" id="shippingDate" name="shippingDate" class="form-control" th:field="*{shippingDate}">
                                
                                <!-- ğŸ”¥ğŸ”¥ğŸ”¥ ëŒ€í‘œë‹˜ ê¸´ê¸‰: ì¶œê³ ì¼ì ê°•ì œ ì„¤ì • -->
                                <script th:inline="javascript">
                                    (function() {
                                        const field = document.getElementById('shippingDate');
                                        const isEditMode = /*[[${isEdit}]]*/ false;
                                        const serverValue = /*[[${returnItem?.shippingDate}]]*/ null;
                                        
                                        if (isEditMode && serverValue) {
                                            const dateStr = serverValue.toString();
                                            field.value = dateStr;
                                            field.dataset.originalValue = dateStr;
                                            field.style.backgroundColor = '#e8f5e8';
                                            field.style.borderColor = '#4caf50';
                                            field.style.color = '#2e7d32';
                                            // console.log('ğŸ”¥âœ… ì¶œê³ ì¼ì ê°•ì œ ì„¤ì •:', dateStr);
                                        }
                                    })();
                                </script>
                            </div>
                
                            <div class="form-group">
                                <label for="refundDate">í™˜ë¶ˆì¼ì</label>
                                <input type="date" id="refundDate" name="refundDate" class="form-control" th:field="*{refundDate}">
                                
                                <!-- ğŸ”¥ğŸ”¥ğŸ”¥ ëŒ€í‘œë‹˜ ê¸´ê¸‰: í™˜ë¶ˆì¼ì ê°•ì œ ì„¤ì • -->
                                <script th:inline="javascript">
                                    (function() {
                                        const field = document.getElementById('refundDate');
                                        const isEditMode = /*[[${isEdit}]]*/ false;
                                        const serverValue = /*[[${returnItem?.refundDate}]]*/ null;
                                        
                                        if (isEditMode && serverValue) {
                                            const dateStr = serverValue.toString();
                                            field.value = dateStr;
                                            field.dataset.originalValue = dateStr;
                                            field.style.backgroundColor = '#e8f5e8';
                                            field.style.borderColor = '#4caf50';
                                            field.style.color = '#2e7d32';
                                            // console.log('ğŸ”¥âœ… í™˜ë¶ˆì¼ì ê°•ì œ ì„¤ì •:', dateStr);
                                        }
                                    })();
                                </script>
                            </div>
                            
                            <div class="form-group">
                                <label for="isCompleted">ì™„ë£Œ ì²˜ë¦¬</label>
                                <select id="isCompleted" name="isCompleted" class="form-control selected" 
                                        th:field="*{isCompleted}"
                                        style="background-color: #e3f2fd; border-color: #2196f3;">
                                    <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                    <option value="1">ì™„ë£Œ</option>
                                    <option value="0">ë¯¸ì™„ë£Œ</option>
                                </select>
                                <script>
                                    document.getElementById('isCompleted').value = '0';
                                </script>
                            </div>
                            
                            <div class="form-group">
                                <label for="processor">ì²˜ë¦¬ì</label>
                                <input type="text" id="processor" name="processor" class="form-control" th:field="*{processor}" placeholder="ë‹´ë‹¹ìëª…">
                            </div>
                
                            <div class="form-group">
                                <label for="remarks">ë¹„ê³ </label>
                                <textarea id="remarks" name="remarks" class="form-control" th:field="*{remarks}" rows="2" placeholder="ì¶”ê°€ ë©”ëª¨ì‚¬í•­"></textarea>
                            </div>
                        </div>

                        <!-- ì´ë¯¸ì§€ ì²¨ë¶€ ì„¹ì…˜ -->
                        <div id="imageSection" class="form-card" style="margin-top: 20px;">
                            <div class="form-section-header">ì´ë¯¸ì§€ ì²¨ë¶€</div>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="attachmentDescription">ì²¨ë¶€ ì„¤ëª… (ì„ íƒì‚¬í•­)</label>
                                    <textarea id="attachmentDescription" name="attachmentDescription" class="form-control" 
                                             rows="2" placeholder="ì²¨ë¶€ íŒŒì¼ì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš” (ì„ íƒì‚¬í•­)"></textarea>
                                </div>
                
                                <div class="form-group">
                                    <label for="attachmentPhoto">ì´ë¯¸ì§€ ì²¨ë¶€</label>
                                    
                                    <!-- ê¸°ì¡´ ì´ë¯¸ì§€ í‘œì‹œ (ìˆ˜ì • ëª¨ë“œì¼ ë•Œ) -->
                                    <div th:if="${isEdit and returnItem.defectPhotoUrl != null and !#strings.isEmpty(returnItem.defectPhotoUrl)}" class="mt-2 mb-2">
                                        <div style="border: 2px solid #007bff; padding: 10px; margin: 10px 0; border-radius: 5px; background: #f8f9ff;">
                                            <h6 style="color: #007bff; margin: 0 0 10px 0;">í˜„ì¬ ë“±ë¡ëœ ì´ë¯¸ì§€</h6>
                                            <img th:src="@{'/uploads/' + ${returnItem.defectPhotoUrl}}" style="max-width: 200px; max-height: 200px; border: 1px solid #ddd; border-radius: 3px;" alt="í˜„ì¬ ì´ë¯¸ì§€">
                                            <br><small style="color: #666;">ìƒˆ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ë©´ ê¸°ì¡´ ì´ë¯¸ì§€ê°€ êµì²´ë©ë‹ˆë‹¤.</small>
                                        </div>
                                    </div>
                                    
                                    <input type="file" class="form-control-file" id="attachmentPhoto" name="attachmentPhoto" accept="image/*">
                                    <small class="form-text text-muted">ê´€ë ¨ ì´ë¯¸ì§€ë¥¼ ì²¨ë¶€í•´ì£¼ì„¸ìš”.</small>
                                    <div id="defectImagePreview" class="mt-2"></div>
                                    
                                    <!-- ì´ë¯¸ì§€ ë¶™ì—¬ë„£ê¸° ì˜ì—­ -->
                                    <div class="mt-2">
                                        <label>ì´ë¯¸ì§€ ë¶™ì—¬ë„£ê¸°</label>
                                        <div class="image-paste-container" id="defectImagePasteArea" 
                                             style="border: 2px dashed #ddd; padding: 20px; text-align: center; cursor: pointer; background-color: #f9f9f9;" 
                                             tabindex="0" onclick="this.focus(); alert('ì´ì œ Ctrl+Vë¥¼ ëˆŒëŸ¬ ì´ë¯¸ì§€ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”!');">
                                            <i class="fas fa-paste"></i>
                                            <span>ì´ë¯¸ì§€ë¥¼ í´ë¦½ë³´ë“œì—ì„œ ë¶™ì—¬ë„£ìœ¼ì„¸ìš” (Ctrl+V)</span>
                                            <br><small style="color: #666; margin-top: 10px; display: block;">ë˜ëŠ” ì´ë¯¸ì§€ íŒŒì¼ì„ ì—¬ê¸°ë¡œ ë“œë˜ê·¸í•˜ì„¸ìš”</small>
                                            <br><button type="button" id="selectImageBtn" style="margin-top: 10px; padding: 5px 10px; background: #28a745; color: white; border: none; border-radius: 3px; font-size: 12px;">íŒŒì¼ ì„ íƒ</button>
                                        </div>
                                        <div id="defectPastedImagePreview" class="mt-2"></div>
                                    </div>
            
                                    <!-- Base64 ì´ë¯¸ì§€ ë°ì´í„°ë¥¼ ì €ì¥í•  hidden í•„ë“œ -->
                                    <input type="hidden" id="defectPastedImageData" name="attachmentImageData" />
                                    
                                    <!-- ì²¨ë¶€ ì´ë¯¸ì§€ URL ì €ì¥ í•„ë“œ -->
                                    <input type="hidden" id="attachmentPhotoUrl" name="attachmentPhotoUrl" />
                                    
                                    <!-- ë“±ë¡ì/ìˆ˜ì •ì ì •ë³´ (ì„œë²„ì—ì„œ ìë™ ì„¤ì •) -->
                                    <input type="hidden" id="createdBy" name="createdBy" th:field="*{createdBy}" />
                                    <input type="hidden" id="updatedBy" name="updatedBy" th:field="*{updatedBy}" />
                                </div>
                            </div>
                        </div>
                    </div>
                
                    <div class="form-actions">
                        <div class="progress-info">
                            <span th:text="${isEdit ? 'ì •ë³´ë¥¼ ìˆ˜ì •í•œ í›„ ì €ì¥í•˜ì„¸ìš”' : 'ëª¨ë“  ì •ë³´ë¥¼ ì…ë ¥í•œ í›„ ë“±ë¡í•˜ì„¸ìš”'}">ëª¨ë“  ì •ë³´ë¥¼ ì…ë ¥í•œ í›„ ë“±ë¡í•˜ì„¸ìš”</span>
                        </div>
                        <div>
                            <a th:href="${returnUrl != null ? returnUrl : '/exchange/list'}" class="btn btn-secondary">ì·¨ì†Œ</a>
                            <button type="submit" class="btn btn-primary" id="submitBtn" th:text="${isEdit ? 'ìˆ˜ì •' : 'ë“±ë¡'}">ë“±ë¡</button>
                        </div>
                    </div>
                </form>
            </div>

            <!-- ğŸ”¥ğŸ”¥ğŸ”¥ ì¶”ê°€ ì œí’ˆ ë“±ë¡ ì˜ì—­ (ì €ì¥ ì„±ê³µ í›„ì—ë§Œ í‘œì‹œ) -->
            <div id="addProductArea" class="mt-4" style="display: none;">
                <div class="card border-success">
                    <div class="card-header bg-success text-white">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">
                                <i class="fas fa-plus-circle"></i> ê°™ì€ ì£¼ë¬¸ì˜ ì¶”ê°€ ì œí’ˆ ë“±ë¡
                            </h5>
                            <span class="badge badge-light text-dark">ìŠ¤ë§ˆíŠ¸ ê°ì§€</span>
                        </div>
                    </div>
                    <div class="card-body">
                        <!-- ğŸ¯ ê¸°ë³¸ ì •ë³´ í‘œì‹œ -->
                        <div class="row mb-3">
                            <div class="col-md-8">
                                <p class="mb-1">
                                    <strong>ê³ ê°:</strong> <span id="displayCustomerName"></span> 
                                    (<span id="displayCustomerPhone"></span>)
                                </p>
                                <p class="mb-1">
                                    <strong>ì£¼ë¬¸ì¼:</strong> <span id="displayOrderDate"></span> |
                                    <strong>ì‚¬ì´íŠ¸:</strong> <span id="displaySiteName"></span>
                                </p>
                                <p class="mb-0">
                                    <strong>ë°©ê¸ˆ ë“±ë¡:</strong> 
                                    <span id="displayOrderNumber"></span> - 
                                    <span id="displayOrderItemCode"></span>
                                </p>
                            </div>
                        </div>
                        
                        <!-- ğŸ”¥ ì£¼ë¬¸ë²ˆí˜¸ ì˜µì…˜ ì„ íƒ -->
                        <div class="card border-info mb-3">
                            <div class="card-header bg-light">
                                <h6 class="mb-0">ğŸ“ ì¶”ê°€ ì œí’ˆì˜ ì£¼ë¬¸ë²ˆí˜¸ ì„ íƒ</h6>
                            </div>
                            <div class="card-body">
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="radio" name="orderNumberOption" 
                                           id="sameOrderNumber" value="same" checked>
                                    <label class="form-check-label" for="sameOrderNumber">
                                        <strong>ê°™ì€ ì£¼ë¬¸ë²ˆí˜¸ ì‚¬ìš©</strong>
                                        <code id="currentOrderNumber"></code>
                                        <br><small class="text-muted">ë™ì¼í•œ ì£¼ë¬¸ì—ì„œ ë‹¤ë¥¸ ì‚¬ì´ì¦ˆ/ì˜µì…˜ì¸ ê²½ìš°</small>
                                    </label>
                                </div>
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="radio" name="orderNumberOption" 
                                           id="incrementOrderNumber" value="increment">
                                    <label class="form-check-label" for="incrementOrderNumber">
                                        <strong>ìˆœë²ˆ ì¦ê°€ ì£¼ë¬¸ë²ˆí˜¸</strong>
                                        <code id="suggestedOrderNumber"></code>
                                        <br><small class="text-muted">ë³„ë„ ì£¼ë¬¸ë²ˆí˜¸ê°€ ë¶€ì—¬ë˜ëŠ” ê²½ìš°</small>
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="orderNumberOption" 
                                           id="customOrderNumber" value="custom">
                                    <label class="form-check-label" for="customOrderNumber">
                                        <strong>ì§ì ‘ ì…ë ¥</strong>
                                        <input type="text" id="customOrderInput" class="form-control form-control-sm mt-1" 
                                               placeholder="ì£¼ë¬¸ë²ˆí˜¸ ì§ì ‘ ì…ë ¥" style="max-width: 300px;">
                                        <br><small class="text-muted">íŠ¹ë³„í•œ íŒ¨í„´ì˜ ì£¼ë¬¸ë²ˆí˜¸ì¸ ê²½ìš°</small>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ğŸ¯ ì•¡ì…˜ ë²„íŠ¼ -->
                        <div class="text-center">
                            <button type="button" class="btn btn-success btn-lg" onclick="proceedAddProduct()">
                                <i class="fas fa-arrow-right"></i> ì„ íƒí•œ ë°©ì‹ìœ¼ë¡œ ì¶”ê°€ ë“±ë¡
                            </button>
                            <button type="button" class="btn btn-outline-secondary ms-2" onclick="hideAddArea()">
                                ë‚˜ì¤‘ì— í•˜ê¸°
                            </button>
                        </div>
                    </div>
                </div>
            </div>
                
            <!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
            <div class="loading-overlay" id="loadingOverlay">
                <div class="loading-content">
                    <div class="loading-spinner"></div>
                    <div class="loading-text" th:text="${isEdit ? 'ìˆ˜ì • ì¤‘ì…ë‹ˆë‹¤...' : 'ì €ì¥ ì¤‘ì…ë‹ˆë‹¤...'}">ì €ì¥ ì¤‘ì…ë‹ˆë‹¤...</div>
                </div>
            </div>
            
            <!-- ì„±ê³µ ë©”ì‹œì§€ ì˜¤ë²„ë ˆì´ -->
            <div class="success-overlay" id="successOverlay">
                <div class="success-content">
                    <div class="success-icon">âœ“</div>
                    <div class="loading-text" th:text="${isEdit ? 'ìˆ˜ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!' : 'ì €ì¥ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!'}">ì €ì¥ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</div>
        </div>
    </div>

                        <!-- ğŸ”¥ğŸ”¥ğŸ”¥ ì¶”ê°€ ì œí’ˆ ë“±ë¡ JavaScript -->
            <script>
                // console.log('ğŸš¨ ì¶”ê°€ ì œí’ˆ ë“±ë¡ ê¸°ëŠ¥ ì‹œì‘!');
                
                // ğŸ”¥ í†µí•© í˜ì´ì§€ ë¡œë“œ ì´ë²¤íŠ¸
                window.addEventListener('load', function() {
                    // console.log('ğŸ“ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ - ì´ˆê¸°í™” ì‹œì‘');
                    
                    // 1ï¸âƒ£ URL íŒŒë¼ë¯¸í„° ë³µì‚¬ ëª¨ë“œ í™•ì¸
                    const urlParams = new URLSearchParams(window.location.search);
                    const copyMode = urlParams.get('copyMode');
                    
                    if (copyMode === 'true') {
                        // console.log('ğŸ“‹ ë³µì‚¬ ëª¨ë“œ ê°ì§€!');
                        
                        // ğŸ”¥ ë¸Œëœë“œ/ì‚¬ì´íŠ¸ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                        const brand = urlParams.get('brand');
                        const siteName = urlParams.get('siteName');
                        
                        // ê³ ê° ì •ë³´ ìë™ ì±„ìš°ê¸°
                        const customerName = urlParams.get('customerName');
                        const customerPhone = urlParams.get('customerPhone');
                        const orderNumber = urlParams.get('orderNumber');
                        const orderDate = urlParams.get('orderDate');
                        const csReceivedDate = urlParams.get('csReceivedDate');
                        const trackingNumber = urlParams.get('trackingNumber');
                        
                        // í•„ë“œ ìë™ ì±„ìš°ê¸°
                        const fieldsToFill = [
                            { param: 'customerName', id: 'customerName', readonly: true },
                            { param: 'customerPhone', id: 'customerPhone', readonly: true },
                            { param: 'orderNumber', id: 'orderNumber', readonly: false },
                            { param: 'orderDate', id: 'orderDate', readonly: true },
                            { param: 'csReceivedDate', id: 'csReceivedDate', readonly: true },
                            { param: 'trackingNumber', id: 'trackingNumber', readonly: true },
                            { param: 'siteName', id: 'siteName', readonly: true }
                        ];
                        
                        fieldsToFill.forEach(fieldInfo => {
                            const value = urlParams.get(fieldInfo.param);
                            const field = document.getElementById(fieldInfo.id);
                            
                            if (value && field) {
                                field.value = value;
                                field.style.backgroundColor = '#e3f2fd';
                                field.style.borderColor = '#2196f3';
                                field.style.color = '#1976d2';
                                if (fieldInfo.readonly) {
                                    field.readOnly = true;
                                }
                            }
                        });
                        
                        // ğŸ”¥ ë¸Œëœë“œ/ì‚¬ì´íŠ¸ ìë™ ì„ íƒ (1ì´ˆ í›„ ì‹¤í–‰)
                        setTimeout(() => {
                            if (brand) {
                                // console.log('ğŸ·ï¸ ë¸Œëœë“œ ìë™ ì„ íƒ:', brand);
                                
                                // ë¸Œëœë“œ ë²„íŠ¼ ì°¾ê¸°
                                const brandButtons = document.querySelectorAll('.selection-row:first-child .selection-btn');
                                const brandButton = Array.from(brandButtons).find(btn => 
                                    btn.textContent.trim() === brand
                                );
                                
                                if (brandButton) {
                                    // console.log('âœ… ë¸Œëœë“œ ë²„íŠ¼ ì°¾ìŒ:', brand);
                                    brandButton.click(); // ë²„íŠ¼ í´ë¦­ ì‹œë®¬ë ˆì´ì…˜
                                    
                                    // ì‚¬ì´íŠ¸ ì„ íƒ (ë¸Œëœë“œ ì„ íƒ í›„ 800ms ëŒ€ê¸°)
                                    setTimeout(() => {
                                        if (siteName) {
                                            // console.log('ğŸŒ ì‚¬ì´íŠ¸ ìë™ ì„ íƒ:', siteName);
                                            
                                            // ì‚¬ì´íŠ¸ ë²„íŠ¼ ì°¾ê¸°
                                            const siteButtons = document.querySelectorAll('#siteButtons .selection-btn');
                                            const siteButton = Array.from(siteButtons).find(btn => 
                                                btn.textContent.trim() === siteName
                                            );
                                            
                                            if (siteButton) {
                                                // console.log('âœ… ì‚¬ì´íŠ¸ ë²„íŠ¼ ì°¾ìŒ:', siteName);
                                                siteButton.click(); // ë²„íŠ¼ í´ë¦­ ì‹œë®¬ë ˆì´ì…˜
                                            } else {
                                                // console.log('âŒ ì‚¬ì´íŠ¸ ë²„íŠ¼ ëª»ì°¾ìŒ:', siteName);
                                            }
                                        }
                                    }, 800);
                                } else {
                                    // console.log('âŒ ë¸Œëœë“œ ë²„íŠ¼ ëª»ì°¾ìŒ:', brand);
                                }
                            }
                        }, 1000);
                        
                        // ìƒë‹¨ì— ì•Œë¦¼ í‘œì‹œ
                        const container = document.querySelector('.container');
                        const alertHtml = `
                            <div class="alert alert-info alert-dismissible fade show mt-3" role="alert">
                                <h5>ğŸ“‹ ì¶”ê°€ ì œí’ˆ ë“±ë¡ ëª¨ë“œ</h5>
                                <p class="mb-0">ê¸°ì¡´ ì£¼ë¬¸ì •ë³´ê°€ ìë™ìœ¼ë¡œ ì±„ì›Œì¡ŒìŠµë‹ˆë‹¤. <strong>ì œí’ˆ ì •ë³´ë§Œ ì…ë ¥</strong>í•˜ì„¸ìš”.</p>
                                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            </div>
                        `;
                        container.insertAdjacentHTML('afterbegin', alertHtml);
                    }
                    
                    // 2ï¸âƒ£ ëª¨ë“œ í™•ì¸ë§Œ
                    const isEditMode = document.querySelector('input[name="id"]') !== null;
                    // console.log('ğŸ”§ í˜„ì¬ ëª¨ë“œ:', isEditMode ? 'ìˆ˜ì •' : 'ë“±ë¡');
                });
                
                // ğŸ¯ ê°„ë‹¨í•œ ì¶”ê°€ ë“±ë¡ ì˜ì—­ í‘œì‹œ
                function showSimpleAddArea() {
                    // console.log('ğŸ“ ì¶”ê°€ ë“±ë¡ ì˜ì—­ í‘œì‹œ');
                    
                    const addArea = document.getElementById('addProductArea');
                    if (addArea) {
                        // ì €ì¥ëœ ì •ë³´ ì±„ìš°ê¸°
                        const customerName = document.getElementById('customerName')?.value || '';
                        const customerPhone = document.getElementById('customerPhone')?.value || '';
                        const orderNumber = document.getElementById('orderNumber')?.value || '';
                        const orderItemCode = document.getElementById('orderItemCode')?.value || '';
                        
                        document.getElementById('displayCustomerName').textContent = customerName;
                        document.getElementById('displayCustomerPhone').textContent = customerPhone;
                        document.getElementById('displayOrderNumber').textContent = orderNumber;
                        document.getElementById('displayOrderItemCode').textContent = orderItemCode;
                        document.getElementById('currentOrderNumber').textContent = orderNumber;
                        
                        // ìë™ ì¦ê°€ ì£¼ë¬¸ë²ˆí˜¸ ìƒì„±
                        const suggested = generateOrderNumber(orderNumber);
                        document.getElementById('suggestedOrderNumber').textContent = suggested;
                        
                        // ì˜ì—­ í‘œì‹œ
                        addArea.style.display = 'block';
                        
                        // ìŠ¤í¬ë¡¤
                        setTimeout(() => {
                            addArea.scrollIntoView({ behavior: 'smooth' });
                        }, 300);
                    }
                }
                
                // ğŸ¯ ì£¼ë¬¸ë²ˆí˜¸ ìë™ ìƒì„±
                function generateOrderNumber(baseNumber) {
                    if (!baseNumber) return '';
                    
                    // -01 â†’ -02 íŒ¨í„´
                    if (baseNumber.match(/-\d+$/)) {
                        const lastDash = baseNumber.lastIndexOf('-');
                        const prefix = baseNumber.substring(0, lastDash + 1);
                        const num = baseNumber.substring(lastDash + 1);
                        const nextNum = String(parseInt(num) + 1).padStart(num.length, '0');
                        return prefix + nextNum;
                    }
                    
                    // ê¸°ë³¸ì ìœ¼ë¡œ -02 ì¶”ê°€
                    return baseNumber + '-02';
                }
                
                // ğŸ¯ ì¶”ê°€ ë“±ë¡ ì§„í–‰
                function proceedAddProduct() {
                    // console.log('ğŸš€ ì¶”ê°€ ë“±ë¡ ì§„í–‰');
                    
                    const selectedOption = document.querySelector('input[name="orderNumberOption"]:checked')?.value;
                    let targetOrderNumber = '';
                    
                    if (selectedOption === 'same') {
                        targetOrderNumber = document.getElementById('currentOrderNumber').textContent;
                    } else if (selectedOption === 'increment') {
                        targetOrderNumber = document.getElementById('suggestedOrderNumber').textContent;
                    } else if (selectedOption === 'custom') {
                        targetOrderNumber = document.getElementById('customOrderInput').value.trim();
                        if (!targetOrderNumber) {
                            alert('ì£¼ë¬¸ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                            return;
                        }
                    }
                    
                    // ğŸ”¥ ëª¨ë“  í•„ìš”í•œ ì •ë³´ë¥¼ URL íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬
                    const selectedBrand = document.querySelector('.selection-row:first-child .selection-btn.active')?.textContent?.trim() || '';
                    
                    const params = new URLSearchParams({
                        copyMode: 'true',
                        customerName: document.getElementById('customerName')?.value || '',
                        customerPhone: document.getElementById('customerPhone')?.value || '',
                        orderNumber: targetOrderNumber,
                        orderDate: document.getElementById('orderDate')?.value || '',
                        csReceivedDate: document.getElementById('csReceivedDate')?.value || '',
                        trackingNumber: document.getElementById('trackingNumber')?.value || '',
                        siteName: document.getElementById('siteName')?.value || '',
                        brand: selectedBrand
                    });
                    
                    window.location.href = `/exchange/create?${params.toString()}`;
                }
                
                // ğŸ¯ ì˜ì—­ ìˆ¨ê¸°ê¸°
                function hideAddArea() {
                    document.getElementById('addProductArea').style.display = 'none';
                }
                
                // ğŸ”¥ğŸ”¥ğŸ”¥ í¼ ì œì¶œ ì²˜ë¦¬ í•¨ìˆ˜ (form íƒœê·¸ì—ì„œ ì§ì ‘ í˜¸ì¶œ)
                function handleFormSubmit(event) {
                    // console.log('ğŸš¨ í¼ ì œì¶œ ì²˜ë¦¬ ì‹œì‘');
                    
                    const isEditMode = document.querySelector('input[name="id"]') !== null;
                    // console.log('ğŸ”§ ëª¨ë“œ í™•ì¸:', isEditMode ? 'ìˆ˜ì •' : 'ë“±ë¡');
                    
                    // ìˆ˜ì • ëª¨ë“œëŠ” ê¸°ì¡´ëŒ€ë¡œ ì§„í–‰
                    if (isEditMode) {
                        // console.log('ğŸ”§ ìˆ˜ì • ëª¨ë“œ - ê¸°ì¡´ ì œì¶œ ë°©ì‹');
                        return true; // ê¸°ë³¸ form ì œì¶œ í—ˆìš©
                    }
                    
                    // ë“±ë¡ ëª¨ë“œëŠ” Ajax ì²˜ë¦¬
                    // console.log('ğŸ†• ë“±ë¡ ëª¨ë“œ - Ajax ì²˜ë¦¬ ì‹œì‘');
                    event.preventDefault(); // ê¸°ë³¸ ì œì¶œ ë°©ì§€
                    
                    const form = event.target;
                    const formData = new FormData(form);
                    
                    // ë¡œë”© í‘œì‹œ
                    const loadingOverlay = document.getElementById('loadingOverlay');
                    if (loadingOverlay) {
                        loadingOverlay.style.display = 'flex';
                        // console.log('â³ ë¡œë”© í‘œì‹œ');
                    }
                    
                    // Ajax ì œì¶œ
                    fetch(form.action, {
                        method: 'POST',
                        body: formData
                    })
                    .then(response => {
                        // console.log('ğŸ“¡ ì„œë²„ ì‘ë‹µ:', response.status);
                        
                        if (response.ok) {
                            // ë¡œë”© ìˆ¨ê¸°ê¸°
                            if (loadingOverlay) {
                                loadingOverlay.style.display = 'none';
                            }
                            
                            // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
                            const successOverlay = document.getElementById('successOverlay');
                            if (successOverlay) {
                                successOverlay.style.display = 'flex';
                                // console.log('âœ… ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ');
                            }
                            
                            // 1ì´ˆ í›„ ì¶”ê°€ ë“±ë¡ ì—¬ë¶€ í™•ì¸
                            setTimeout(() => {
                                if (successOverlay) {
                                    successOverlay.style.display = 'none';
                                }
                                
                                // ì¶”ê°€ ë“±ë¡ ì—¬ë¶€ ë¬¼ì–´ë³´ê¸°
                                const result = confirm('âœ… ë“±ë¡ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\n\nê°™ì€ ì£¼ë¬¸ì˜ ë‹¤ë¥¸ ì œí’ˆë„ ì¶”ê°€ë¡œ ë“±ë¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');
                                
                                if (result) {
                                    // console.log('ğŸ‘ ì¶”ê°€ ë“±ë¡ ì„ íƒ');
                                    showSimpleAddArea();
                                } else {
                                                            // console.log('ğŸ‘ ëª©ë¡ìœ¼ë¡œ ì´ë™');
                        // ğŸ¯ returnUrlì´ ìˆìœ¼ë©´ í•´ë‹¹ URLë¡œ, ì—†ìœ¼ë©´ ê¸°ë³¸ ëª©ë¡ìœ¼ë¡œ
                        const returnUrl = '[[${returnUrl}]]';
                        window.location.href = returnUrl || '/exchange/list';
                                }
                            }, 1000);
                            
                        } else {
                            throw new Error('ì„œë²„ ì˜¤ë¥˜: ' + response.status);
                        }
                    })
                    .catch(error => {
                        console.error('âŒ ì €ì¥ ì˜¤ë¥˜:', error);
                        
                        if (loadingOverlay) {
                            loadingOverlay.style.display = 'none';
                        }
                        
                        alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\në‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                    });
                    
                    return false; // ê¸°ë³¸ form ì œì¶œ ë°©ì§€
                }
</script>
        </div>
    </div>
</body>
</html>