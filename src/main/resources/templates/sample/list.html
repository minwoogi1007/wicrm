<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout/default}">
<head>
    <title>êµí™˜/ë°˜í’ˆ ëª©ë¡</title>
    <link rel="stylesheet" th:href="@{/css/exchange.css}">
        <script>
        // console.log('ğŸ”¥ ì„œë²„ ê¸°ë°˜ ì¹´ë“œ í•„í„°ë§ ì‹œìŠ¤í…œ ë¡œë”©...');
        
        // ğŸ¯ í™œì„± í•„í„°ë“¤ì„ ê´€ë¦¬í•˜ëŠ” Set
        let activeFilters = new Set();
        
        // ğŸ¯ í˜„ì¬ ê²€ìƒ‰ ì¡°ê±´ì„ ì½ì–´ì˜¤ëŠ” í•¨ìˆ˜ (filters ì œì™¸)
        function getCurrentSearchParams() {
            const searchForm = document.getElementById('searchForm');
            const formData = new FormData(searchForm);
            const params = new URLSearchParams();
            
            // ê²€ìƒ‰ ì¡°ê±´ë“¤ì„ íŒŒë¼ë¯¸í„°ë¡œ ì¶”ê°€ (filtersëŠ” ì œì™¸)
            for (const [key, value] of formData.entries()) {
                if (key !== 'filters' && value && value.trim() !== '') {
                    params.append(key, value);
                }
            }
            
            return params;
        }

        // ğŸ¯ ëª¨ë“  ì¡°ê±´(ê²€ìƒ‰ + í•„í„° + í˜ì´ì§€)ì„ í¬í•¨í•œ URL ìƒì„± í•¨ìˆ˜
        function getFullParamsUrl() {
            const params = new URLSearchParams();
            
            // ê²€ìƒ‰ ì¡°ê±´ ì¶”ê°€
            const keyword = document.getElementById('keyword').value.trim();
            if (keyword) {
                params.append('keyword', keyword);
            }
            
            const startDate = document.getElementById('startDate').value;
            if (startDate) {
                params.append('startDate', startDate);
            }
            
            const endDate = document.getElementById('endDate').value;
            if (endDate) {
                params.append('endDate', endDate);
            }
            
            // í•„í„° ì •ë³´ ì¶”ê°€
            if (activeFilters.size > 0) {
                const filtersArray = Array.from(activeFilters);
                params.append('filters', filtersArray.join(','));
            }
            
            // í˜„ì¬ í˜ì´ì§€ ì •ë³´ ì¶”ê°€
            const currentPage = new URLSearchParams(window.location.search).get('page') || '0';
            params.append('page', currentPage);
            
            return params.toString();
        }
        
        // ğŸš€ AJAX ì„œë²„ í•„í„°ë§ í•¨ìˆ˜ (ë¹ ë¥¸ ì‘ë‹µ)
        async function filterByServer(filterType) {
            console.log('ğŸš€ AJAX í•„í„°ë§ ìš”ì²­:', filterType);
            
            // í•„í„° í† ê¸€ (ìˆìœ¼ë©´ ì œê±°, ì—†ìœ¼ë©´ ì¶”ê°€)
            if (activeFilters.has(filterType)) {
                activeFilters.delete(filterType);
            } else {
                activeFilters.add(filterType);
            }
            
            // ë¡œë”© í‘œì‹œ
            showLoadingBanner();
            
            try {
                // ğŸ¯ í˜„ì¬ ê²€ìƒ‰ ì¡°ê±´ ìˆ˜ì§‘
                const searchForm = document.getElementById('searchForm');
                const formData = new FormData(searchForm);
                
                const requestBody = {
                    filterType: filterType,
                    page: 0,
                    size: 20
                };
                
                // ê²€ìƒ‰ ì¡°ê±´ ì¶”ê°€
                if (formData.get('keyword') && formData.get('keyword').trim() !== '') {
                    requestBody.keyword = formData.get('keyword');
                }
                if (formData.get('startDate')) {
                    requestBody.startDate = formData.get('startDate');
                }
                if (formData.get('endDate')) {
                    requestBody.endDate = formData.get('endDate');
                }
                
                console.log('ğŸ“¤ AJAX ìš”ì²­ ë°ì´í„°:', requestBody);
                
                // ğŸš€ AJAX ìš”ì²­
                const response = await fetch('/exchange/api/filter-html', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestBody)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const htmlText = await response.text();
                console.log('ğŸ“¥ AJAX ì‘ë‹µ ìˆ˜ì‹  ì™„ë£Œ');
                
                // ğŸ¯ í…Œì´ë¸” ì„¹ì…˜ë§Œ êµì²´
                const tableContainer = document.querySelector('.table-container .table-wrapper');
                if (tableContainer) {
                    tableContainer.innerHTML = htmlText;
                    console.log('âœ… í…Œì´ë¸” ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                    
                    // ğŸ¯ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¬ë“±ë¡
                    setTimeout(() => {
                        reattachEventListeners();
                        updateFilterBanner();
                    }, 100);
                } else {
                    console.error('âŒ í…Œì´ë¸” ì»¨í…Œì´ë„ˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                }
                
                // ğŸ¯ ì‹¤ì‹œê°„ í†µê³„ ì—…ë°ì´íŠ¸
                setTimeout(() => {
                    refreshCardStats();
                }, 300);
                
            } catch (error) {
                console.error('âŒ AJAX í•„í„°ë§ ì‹¤íŒ¨:', error);
                
                // í´ë°±: ê¸°ì¡´ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ë°©ì‹
                const searchParams = getCurrentSearchParams();
                searchParams.set('page', '0');
                
                const filterParams = Array.from(activeFilters).join(',');
                if (filterParams) {
                    searchParams.append('filters', filterParams);
                }
                
                const urlWithParams = `/exchange/list${searchParams.toString() ? '?' + searchParams.toString() : ''}`;
                window.location.href = urlWithParams;
            }
        }
        
        // ë¡œë”© ë°°ë„ˆ í‘œì‹œ (ë‹¤ì¤‘ í•„í„° ì§€ì›)
        function showLoadingBanner() {
            const existingBanner = document.querySelector('.filter-banner');
            if (existingBanner) {
                existingBanner.remove();
            }
            
            const activeCount = activeFilters.size;
            const loadingText = activeCount > 0 ? 
                `ğŸ”„ <strong>í•„í„°ë§ ì¤‘...</strong> ${activeCount}ê°œ í•„í„° ì ìš© ì¤‘` : 
                `ğŸ”„ <strong>í•„í„°ë§ ì¤‘...</strong> ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”`;
            
            const banner = document.createElement('div');
            banner.className = 'filter-banner';
            banner.innerHTML = `
                <div style="background: linear-gradient(90deg, #4361ee, #3f37c9); color: white; padding: 0.75rem 1.5rem; border-radius: 0.5rem; margin-bottom: 1rem; display: flex; justify-content: center; align-items: center; box-shadow: 0 2px 8px rgba(67, 97, 238, 0.3);">
                    <span>${loadingText}</span>
                </div>
            `;
            
            const tableContainer = document.querySelector('.table-container');
            tableContainer.parentNode.insertBefore(banner, tableContainer);
        }
        
        // ì „ì²´ ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°
        function clearFilter() {
            // console.log('ğŸ”„ ì „ì²´ ëª©ë¡ìœ¼ë¡œ ì´ë™');
            activeFilters.clear();
            window.location.href = '/exchange/list';
        }
        
        // ğŸ¯ ëª¨ë“  í•„í„° í•´ì œ (ê²€ìƒ‰ ì¡°ê±´ ìœ ì§€) - AJAX ë°©ì‹
        async function clearAllFilters() {
            console.log('ğŸ”„ ëª¨ë“  í•„í„° í•´ì œ (AJAX)');
            
            activeFilters.clear();
            
            // ëª¨ë“  ì¹´ë“œì˜ í™œì„± ìƒíƒœ ì œê±°
            document.querySelectorAll('.stat-box').forEach(box => {
                box.classList.remove('active');
            });
            
            showLoadingBanner();
            
            try {
                // í˜„ì¬ ê²€ìƒ‰ ì¡°ê±´ë§Œìœ¼ë¡œ ë°ì´í„° ì¬ì¡°íšŒ
                const searchForm = document.getElementById('searchForm');
                const formData = new FormData(searchForm);
                
                const hasSearchCondition = (formData.get('keyword') && formData.get('keyword').trim() !== '') ||
                                          formData.get('startDate') || formData.get('endDate');
                
                if (hasSearchCondition) {
                    // ê²€ìƒ‰ ì¡°ê±´ì´ ìˆìœ¼ë©´ ê²€ìƒ‰ ì‹¤í–‰
                    searchForm.submit();
                } else {
                    // ê²€ìƒ‰ ì¡°ê±´ì´ ì—†ìœ¼ë©´ ì „ì²´ ëª©ë¡ìœ¼ë¡œ
                    window.location.href = '/exchange/list';
                }
                
            } catch (error) {
                console.error('âŒ í•„í„° í•´ì œ ì‹¤íŒ¨:', error);
                window.location.href = '/exchange/list';
            }
        }
        
        // ğŸ¯ ê²€ìƒ‰ê³¼ í•„í„° ëª¨ë‘ ì´ˆê¸°í™”
        function resetAllFiltersAndSearch() {
            console.log('ğŸ”„ ëª¨ë“  ì¡°ê±´ ì´ˆê¸°í™”');
            activeFilters.clear();
            
            // ëª¨ë“  ì¹´ë“œì˜ í™œì„± ìƒíƒœ ì œê±°
            document.querySelectorAll('.stat-box').forEach(box => {
                box.classList.remove('active');
            });
            
            window.location.href = '/exchange/list';
        }
        
        // ğŸ¯ ê²€ìƒ‰ í¼ ì œì¶œ ì‹œ í˜„ì¬ í™œì„± í•„í„°ë“¤ì„ hidden inputì— ì—…ë°ì´íŠ¸
        function handleSearchSubmit(event) {
            // í˜„ì¬ í™œì„± í•„í„°ë“¤ì„ hidden inputì— ì„¤ì •
            const filtersInput = document.getElementById('filtersInput');
            const filterParams = Array.from(activeFilters).join(',');
            filtersInput.value = filterParams;
            
            // ğŸ¯ ê²€ìƒ‰ ì‹œ í˜ì´ì§€ë¥¼ 1í˜ì´ì§€ë¡œ ë¦¬ì…‹
            const pageInput = document.querySelector('input[name="page"]');
            if (pageInput) {
                pageInput.value = '0';
            } else {
                // page inputì´ ì—†ìœ¼ë©´ ìƒˆë¡œ ìƒì„±
                const form = event.target;
                const newPageInput = document.createElement('input');
                newPageInput.type = 'hidden';
                newPageInput.name = 'page';
                newPageInput.value = '0';
                form.appendChild(newPageInput);
            }
            
            // í¼ ì œì¶œ ê³„ì† ì§„í–‰
            return true;
        }
        
        // ğŸ¯ í˜ì´ì§€ ë¡œë“œ ì‹œ URL íŒŒë¼ë¯¸í„°ì™€ activeFilters ë™ê¸°í™”
        function syncFiltersFromInput() {
            // URL íŒŒë¼ë¯¸í„°ì—ì„œ filters ê°’ ì½ê¸°
            const urlParams = new URLSearchParams(window.location.search);
            const urlFilters = urlParams.get('filters');
            
            // hidden input ì—…ë°ì´íŠ¸
            const filtersInput = document.getElementById('filtersInput');
            if (filtersInput) {
                filtersInput.value = urlFilters || '';
            }
            
            // activeFilters Set ì—…ë°ì´íŠ¸
            if (urlFilters) {
                const filters = urlFilters.split(',').map(f => f.trim()).filter(f => f);
                filters.forEach(filter => activeFilters.add(filter));
                
                // ğŸ¯ í•´ë‹¹ í•„í„° ì¹´ë“œë“¤ì„ í™œì„± ìƒíƒœë¡œ í‘œì‹œ
                filters.forEach(filter => {
                    const filterElement = document.querySelector(`[data-filter="${filter}"]`);
                    if (filterElement) {
                        const parentCard = filterElement.closest('.stat-box');
                        if (parentCard) {
                            parentCard.classList.add('active');
                        }
                    }
                });
            }
        }

        // ğŸ¯ ë³´ê¸°/ìˆ˜ì • ë§í¬ì— í˜„ì¬ ì¡°ê±´ ì¶”ê°€
        function updateViewEditLinks() {
            const currentParams = getFullParamsUrl();
            
            // ëª¨ë“  ë³´ê¸° ë§í¬ ì—…ë°ì´íŠ¸
            document.querySelectorAll('a[href*="/exchange/view/"]').forEach(link => {
                const originalHref = link.getAttribute('href');
                const itemId = originalHref.split('/').pop();
                const separator = currentParams ? '&' : '';
                const newHref = `${originalHref}?returnTo=${encodeURIComponent('/exchange/list?' + currentParams)}`;
                link.setAttribute('href', newHref);
            });
            
            // ëª¨ë“  ìˆ˜ì • ë§í¬ ì—…ë°ì´íŠ¸
            document.querySelectorAll('a[href*="/exchange/edit/"]').forEach(link => {
                const originalHref = link.getAttribute('href');
                const itemId = originalHref.split('/').pop();
                const separator = currentParams ? '&' : '';
                const newHref = `${originalHref}?returnTo=${encodeURIComponent('/exchange/list?' + currentParams)}`;
                link.setAttribute('href', newHref);
            });
        }
        
        // ğŸ¯ ê°œë³„ í•„í„° ì œê±° - AJAX ë°©ì‹
        async function removeFilter(filterType) {
            console.log('ğŸ¯ ê°œë³„ í•„í„° ì œê±° (AJAX):', filterType);
            
            // í•„í„° Setì—ì„œ ì œê±°
            activeFilters.delete(filterType);
            
            // í•´ë‹¹ ì¹´ë“œì˜ í™œì„± ìƒíƒœ ì œê±°
            const filterElement = document.querySelector(`[data-filter="${filterType}"]`);
            if (filterElement) {
                const parentCard = filterElement.closest('.stat-box');
                if (parentCard) {
                    parentCard.classList.remove('active');
                }
            }
            
            showLoadingBanner();
            
            try {
                // ë‚¨ì€ í•„í„°ê°€ ìˆìœ¼ë©´ í•´ë‹¹ í•„í„°ë¡œ, ì—†ìœ¼ë©´ ì „ì²´ ëª©ë¡ ë˜ëŠ” ê²€ìƒ‰ ê²°ê³¼
                if (activeFilters.size > 0) {
                    // ë‚¨ì€ í•„í„° ì¤‘ ì²« ë²ˆì§¸ë¡œ í•„í„°ë§
                    const remainingFilter = Array.from(activeFilters)[0];
                    await filterByServer(remainingFilter);
                } else {
                    // í•„í„°ê°€ ëª¨ë‘ ì œê±°ë˜ë©´ ê²€ìƒ‰ ì¡°ê±´ì— ë”°ë¼ ì²˜ë¦¬
                    const searchForm = document.getElementById('searchForm');
                    const formData = new FormData(searchForm);
                    
                    const hasSearchCondition = (formData.get('keyword') && formData.get('keyword').trim() !== '') ||
                                              formData.get('startDate') || formData.get('endDate');
                    
                    if (hasSearchCondition) {
                        // ê²€ìƒ‰ ì¡°ê±´ì´ ìˆìœ¼ë©´ ê²€ìƒ‰ ì‹¤í–‰
                        searchForm.submit();
                    } else {
                        // ê²€ìƒ‰ ì¡°ê±´ì´ ì—†ìœ¼ë©´ ì „ì²´ ëª©ë¡ìœ¼ë¡œ
                        window.location.href = '/exchange/list';
                    }
                }
                
            } catch (error) {
                console.error('âŒ ê°œë³„ í•„í„° ì œê±° ì‹¤íŒ¨:', error);
                
                // í´ë°±: í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ë°©ì‹
                const searchParams = getCurrentSearchParams();
                searchParams.set('page', '0');
                
                const filterParams = Array.from(activeFilters).join(',');
                if (filterParams) {
                    searchParams.append('filters', filterParams);
                }
                
                const urlWithParams = `/exchange/list${searchParams.toString() ? '?' + searchParams.toString() : ''}`;
                window.location.href = urlWithParams;
            }
        }
        
        // ğŸ¯ í˜ì´ì§€ë„¤ì´ì…˜ ë§í¬ì— í˜„ì¬ í•„í„°ì™€ ê²€ìƒ‰ ì¡°ê±´ ì¶”ê°€
        function updatePaginationLinks() {
            const paginationLinks = document.querySelectorAll('.pagination .page-link');
            
            paginationLinks.forEach(link => {
                // ê¸°ì¡´ hrefì—ì„œ page íŒŒë¼ë¯¸í„° ì¶”ì¶œ
                const href = link.getAttribute('href');
                if (!href || href === '#') return;
                
                const url = new URL(href, window.location.origin);
                const pageParam = url.searchParams.get('page');
                const sizeParam = url.searchParams.get('size');
                
                // í˜„ì¬ ê²€ìƒ‰ ì¡°ê±´ ê°€ì ¸ì˜¤ê¸°
                const searchParams = getCurrentSearchParams();
                
                // pageì™€ size íŒŒë¼ë¯¸í„° ì¶”ê°€
                if (pageParam !== null) searchParams.set('page', pageParam);
                if (sizeParam !== null) searchParams.set('size', sizeParam);
                
                // í˜„ì¬ í™œì„± í•„í„° ì¶”ê°€
                const filterParams = Array.from(activeFilters).join(',');
                if (filterParams) {
                    searchParams.set('filters', filterParams);
                }
                
                // ìƒˆë¡œìš´ URL ìƒì„±
                const newUrl = `/exchange/list?${searchParams.toString()}`;
                link.setAttribute('href', newUrl);
            });
        }
        
        // ğŸ¯ í–‰ ë”ë¸”í´ë¦­ìœ¼ë¡œ ìˆ˜ì •í˜ì´ì§€ ì´ë™
        function addRowDoubleClickEvents() {
            const tableRows = document.querySelectorAll('.data-table tbody tr');
            
            tableRows.forEach(row => {
                // ë¹ˆ í–‰ì´ë‚˜ "ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤" í–‰ì€ ì œì™¸
                const checkbox = row.querySelector('input[name="selected"]');
                if (!checkbox) return;
                
                row.style.cursor = 'pointer';
                row.title = 'ë”ë¸”í´ë¦­í•˜ë©´ ìˆ˜ì •í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤';
                
                row.addEventListener('dblclick', function(e) {
                    // ì²´í¬ë°•ìŠ¤ë‚˜ ë§í¬ í´ë¦­ì‹œì—ëŠ” ë”ë¸”í´ë¦­ ë¬´ì‹œ
                    if (e.target.type === 'checkbox' || 
                        e.target.tagName === 'A' || 
                        e.target.closest('a') || 
                        e.target.type === 'date' ||
                        e.target.classList.contains('btn-clear-date')) {
                        return;
                    }
                    
                    // í–‰ì—ì„œ ID ì¶”ì¶œ (ì²´í¬ë°•ìŠ¤ valueì—ì„œ)
                    const itemId = checkbox.value;
                    const currentParams = getFullParamsUrl();
                    const returnToParam = currentParams ? `?returnTo=${encodeURIComponent('/exchange/list?' + currentParams)}` : '';
                    
                    // ìˆ˜ì • í˜ì´ì§€ë¡œ ì´ë™
                    window.location.href = `/exchange/edit/${itemId}${returnToParam}`;
                });
                
                // í˜¸ë²„ íš¨ê³¼ ì¶”ê°€
                row.addEventListener('mouseenter', function() {
                    if (!this.classList.contains('table-row-hover')) {
                        this.style.backgroundColor = 'rgba(67, 97, 238, 0.05)';
                        this.style.transform = 'scale(1.002)';
                        this.style.transition = 'all 0.2s ease';
                    }
                });
                
                row.addEventListener('mouseleave', function() {
                    this.style.backgroundColor = '';
                    this.style.transform = '';
                });
            });
        }

        // DOM ë¡œë“œ ì™„ë£Œ í›„ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ DOM ë¡œë“œ ì™„ë£Œ - AJAX í•„í„°ë§ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì‹œì‘');
            
            // ğŸ¯ í˜ì´ì§€ ë¡œë“œ ì‹œ í•„í„° ë™ê¸°í™”
            syncFiltersFromInput();
            
            // ğŸ¯ ë³´ê¸°/ìˆ˜ì • ë§í¬ ì—…ë°ì´íŠ¸
            updateViewEditLinks();
            
            // ğŸ¯ í–‰ ë”ë¸”í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
            addRowDoubleClickEvents();
            
            // ğŸ¯ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì´ˆê¸° ë“±ë¡
            reattachEventListeners();
            
            // ğŸ¯ ì¹´ë“œë³„ í´ë¦­ ì´ë²¤íŠ¸ ë“±ë¡
            setTimeout(function() {
                const cardMappings = [
                    { selector: '[data-filter="collection-completed"]', filterType: 'collection-completed' },
                    { selector: '[data-filter="collection-pending"]', filterType: 'collection-pending' },
                    { selector: '[data-filter="logistics-confirmed"]', filterType: 'logistics-confirmed' },
                    { selector: '[data-filter="logistics-pending"]', filterType: 'logistics-pending' },
                    { selector: '[data-filter="shipping-completed"]', filterType: 'shipping-completed' },
                    { selector: '[data-filter="shipping-pending"]', filterType: 'shipping-pending' },
                    { selector: '[data-filter="refund-completed"]', filterType: 'refund-completed' },
                    { selector: '[data-filter="refund-pending"]', filterType: 'refund-pending' },
                    { selector: '[data-filter="payment-pending"]', filterType: 'payment-pending' },
                    { selector: '[data-filter="payment-completed"]', filterType: 'payment-completed' },
                    { selector: '[data-filter="completed"]', filterType: 'completed' },
                    { selector: '[data-filter="incompleted"]', filterType: 'incompleted' },
                    { selector: '[data-filter="overdue-ten-days"]', filterType: 'overdue-ten-days' }
                ];
                
                cardMappings.forEach(mapping => {
                    const elements = document.querySelectorAll(mapping.selector);
                    console.log(`ğŸ”— ${mapping.selector} ìš”ì†Œ ê°œìˆ˜:`, elements.length);
                    
                    elements.forEach(element => {
                        element.style.cursor = 'pointer';
                        element.style.transition = 'all 0.2s ease';
                        
                        element.addEventListener('click', function(e) {
                            e.stopPropagation();
                            console.log('ğŸ¯ ì¹´ë“œ í´ë¦­ (AJAX í•„í„°ë§):', mapping.filterType);
                            
                            // ğŸ¯ ê°œë³„ ì¹´ë“œ í™œì„± ìƒíƒœ í† ê¸€
                            const parentCard = this.closest('.stat-box');
                            if (parentCard) {
                                if (activeFilters.has(mapping.filterType)) {
                                    // ì´ë¯¸ í™œì„±í™”ëœ í•„í„°ë©´ ë¹„í™œì„±í™”
                                    parentCard.classList.remove('active');
                                } else {
                                    // ë¹„í™œì„±í™”ëœ í•„í„°ë©´ í™œì„±í™”
                                    parentCard.classList.add('active');
                                }
                            }
                            
                            // ğŸš€ AJAX ì„œë²„ í•„í„°ë§ ì‹¤í–‰
                            filterByServer(mapping.filterType);
                        });
                        
                        // í˜¸ë²„ íš¨ê³¼
                        element.addEventListener('mouseenter', function() {
                            this.style.transform = 'scale(1.1)';
                            this.style.textShadow = '0 2px 4px rgba(0,0,0,0.3)';
                        });
                        
                        element.addEventListener('mouseleave', function() {
                            this.style.transform = 'scale(1)';
                            this.style.textShadow = 'none';
                        });
                    });
                });
                
                console.log('âœ… ëª¨ë“  ì¹´ë“œ ì´ë²¤íŠ¸ ë“±ë¡ ì™„ë£Œ - AJAX í•„í„°ë§ ì¤€ë¹„ë¨');
            }, 500);
            
            // ğŸ¯ í˜ì´ì§€ ë¡œë“œ ì‹œ ì¹´ë“œ í†µê³„ ì´ˆê¸° ì—…ë°ì´íŠ¸ (í…ŒìŠ¤íŠ¸)
            setTimeout(() => {
                console.log('ğŸ§ª ì´ˆê¸° ì¹´ë“œ í†µê³„ ì—…ë°ì´íŠ¸ í…ŒìŠ¤íŠ¸...');
                refreshCardStats();
            }, 1000);
        });
        
        // í˜„ì¬ í•„í„° ìƒíƒœ í‘œì‹œ (ì„œë²„ì—ì„œ ì „ë‹¬ë°›ì€ ê²½ìš°)
        document.addEventListener('DOMContentLoaded', function() {
            // ğŸ¯ URL íŒŒë¼ë¯¸í„°ì—ì„œ filters ê°’ ì½ê¸° ë˜ëŠ” Thymeleafì—ì„œ ì „ë‹¬ë°›ì€ ê°’ ì‚¬ìš©
            const urlParams = new URLSearchParams(window.location.search);
            const urlFilters = urlParams.get('filters');
            const thymeleafFilters = '[[${param.filters != null ? param.filters[0] : ""}]]';
            
            const currentFilter = urlFilters || thymeleafFilters || '';
            
            if (currentFilter && currentFilter !== 'null' && currentFilter !== '') {
                // console.log('ğŸ¯ í˜„ì¬ ì ìš©ëœ í•„í„°:', currentFilter);
                
                // ğŸ¯ ì—¬ëŸ¬ í•„í„°ë¥¼ ì§€ì›í•˜ë„ë¡ ìˆ˜ì • (ì‰¼í‘œë¡œ êµ¬ë¶„)
                const currentFilters = currentFilter.split(',').map(f => f.trim()).filter(f => f);
                
                // activeFilters Setì— í˜„ì¬ í•„í„°ë“¤ ì¶”ê°€
                currentFilters.forEach(filter => {
                    activeFilters.add(filter);
                    
                    // í•´ë‹¹ ì¹´ë“œë¥¼ í™œì„±í™”
                    const filterElement = document.querySelector(`[data-filter="${filter}"]`);
                    if (filterElement) {
                        const parentCard = filterElement.closest('.stat-box');
                        if (parentCard) {
                            parentCard.classList.add('active');
                        }
                    }
                });
                
                // í•„í„° ë°°ë„ˆ í‘œì‹œ
                showCurrentFilterBanner(currentFilters);
            }
        });
        
        // í˜„ì¬ í•„í„° ë°°ë„ˆ í‘œì‹œ (ë‹¤ì¤‘ í•„í„° ì§€ì›)
        function showCurrentFilterBanner(filters) {
            const filterNames = {
                'collection-completed': 'íšŒìˆ˜ì™„ë£Œ',
                'collection-pending': 'íšŒìˆ˜ë¯¸ì™„ë£Œ',
                'logistics-confirmed': 'ë¬¼ë¥˜í™•ì¸ì™„ë£Œ',
                'logistics-pending': 'ë¬¼ë¥˜í™•ì¸ë¯¸ì™„ë£Œ',
                'shipping-completed': 'ì¶œê³ ì™„ë£Œ',
                'shipping-pending': 'ì¶œê³ ëŒ€ê¸°',
                'refund-completed': 'í™˜ë¶ˆì™„ë£Œ',
                'refund-pending': 'í™˜ë¶ˆëŒ€ê¸°',
                'payment-pending': 'ì…ê¸ˆì˜ˆì •',
                'payment-completed': 'ì…ê¸ˆì™„ë£Œ',
                'completed': 'ì „ì²´ì™„ë£Œ',
                'incompleted': 'ì „ì²´ë¯¸ì™„ë£Œ',
                'overdue-ten-days': 'ì²˜ë¦¬ê¸°ê°„ ì„ë°•'
            };
            
            // ğŸ¯ ì—¬ëŸ¬ í•„í„°ë¥¼ ì²˜ë¦¬
            const filterArray = Array.isArray(filters) ? filters : [filters];
            // ğŸ¯ ì„œë²„ì—ì„œ ì „ë‹¬ë°›ì€ totalItems ê°’ ì‚¬ìš© (í•„í„° ì ìš©ëœ ê²°ê³¼ ê°œìˆ˜)
            const totalItems = '[[${totalItems}]]' || '0';
            
            // ê°œë³„ í•„í„° ë°°ì§€ ìƒì„±
            const filterBadges = filterArray.map(filter => {
                const displayName = filterNames[filter] || filter;
                return `<span class="filter-badge" style="background: rgba(255,255,255,0.2); padding: 0.25rem 0.5rem; border-radius: 1rem; font-size: 0.75rem; margin-right: 0.5rem; display: inline-flex; align-items: center; gap: 0.25rem;">
                    ${displayName}
                    <button onclick="removeFilter('${filter}')" style="background: rgba(255,255,255,0.3); border: none; color: white; border-radius: 50%; width: 1rem; height: 1rem; font-size: 0.6rem; cursor: pointer; display: flex; align-items: center; justify-content: center;" title="ì´ í•„í„° ì œê±°">Ã—</button>
                </span>`;
            }).join('');
            
            const banner = document.createElement('div');
            banner.className = 'filter-banner';
            banner.innerHTML = `
                <div style="background: linear-gradient(90deg, #4361ee, #3f37c9); color: white; padding: 0.75rem 1.5rem; border-radius: 0.5rem; margin-bottom: 1rem; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 8px rgba(67, 97, 238, 0.3);">
                    <div style="flex: 1;">
                        <div style="margin-bottom: 0.25rem;">ğŸ” <strong>í•„í„° ì ìš©ë¨:</strong> ${totalItems}ê±´ í‘œì‹œ <small>(${filterArray.length}ê°œ í•„í„° í™œì„±)</small></div>
                        <div style="display: flex; flex-wrap: wrap; gap: 0.25rem;">
                            ${filterBadges}
                        </div>
                    </div>
                    <div>
                        <button onclick="clearAllFilters()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.25rem 0.75rem; border-radius: 0.25rem; cursor: pointer; font-size: 0.875rem; margin-left: 0.5rem;">âœ• ëª¨ë“  í•„í„° í•´ì œ</button>
                    </div>
                </div>
            `;
            
            const tableContainer = document.querySelector('.table-container');
            tableContainer.parentNode.insertBefore(banner, tableContainer);
        }
        
        // ğŸ¯ ì „ì²´ ì„ íƒ/í•´ì œ ê¸°ëŠ¥
        function toggleSelectAll() {
            const selectAllCheckbox = document.getElementById('selectAll');
            const rowCheckboxes = document.querySelectorAll('input[name="selected"]');
            
            // console.log('ğŸ”„ ì „ì²´ ì„ íƒ í† ê¸€:', selectAllCheckbox.checked);
            // console.log('ğŸ“ ëŒ€ìƒ ì²´í¬ë°•ìŠ¤ ê°œìˆ˜:', rowCheckboxes.length);
            
            // ëª¨ë“  í–‰ ì²´í¬ë°•ìŠ¤ë¥¼ í—¤ë” ì²´í¬ë°•ìŠ¤ ìƒíƒœì— ë§ì¶¤
            rowCheckboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
            });
            
            // ì„ íƒëœ ê°œìˆ˜ ì—…ë°ì´íŠ¸
            updateSelectedCount();
            updateBulkDeleteButton();
        }
        
        // ê°œë³„ ì²´í¬ë°•ìŠ¤ í´ë¦­ ì‹œ í—¤ë” ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateSelectAllState() {
            const selectAllCheckbox = document.getElementById('selectAll');
            const rowCheckboxes = document.querySelectorAll('input[name="selected"]');
            const checkedCount = document.querySelectorAll('input[name="selected"]:checked').length;
            
            // console.log('ğŸ“Š ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸:', checkedCount, '/', rowCheckboxes.length);
            
            if (checkedCount === 0) {
                // ì•„ë¬´ê²ƒë„ ì„ íƒë˜ì§€ ì•ŠìŒ
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = false;
            } else if (checkedCount === rowCheckboxes.length) {
                // ëª¨ë‘ ì„ íƒë¨
                selectAllCheckbox.checked = true;
                selectAllCheckbox.indeterminate = false;
            } else {
                // ì¼ë¶€ë§Œ ì„ íƒë¨ (ì¤‘ê°„ ìƒíƒœ)
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = true;
            }
            
            updateSelectedCount();
            updateBulkDeleteButton();
        }
        
        // ì„ íƒëœ í•­ëª© ê°œìˆ˜ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateSelectedCount() {
            const checkedCount = document.querySelectorAll('input[name="selected"]:checked').length;
            
            // ê¸°ì¡´ ì¹´ìš´í„° ì œê±°
            const existingCounter = document.querySelector('.selection-counter');
            if (existingCounter) {
                existingCounter.remove();
            }
            
            // ì„ íƒëœ í•­ëª©ì´ ìˆì„ ë•Œë§Œ ì¹´ìš´í„° í‘œì‹œ
            if (checkedCount > 0) {
                const counter = document.createElement('div');
                counter.className = 'selection-counter';
                counter.innerHTML = `
                    <div style="background: linear-gradient(90deg, #35b27f, #2d8659); color: white; padding: 0.5rem 1rem; border-radius: 0.375rem; margin-bottom: 0.5rem; display: inline-flex; align-items: center; gap: 0.5rem; font-size: 0.875rem; box-shadow: 0 2px 4px rgba(53, 178, 127, 0.3);">
                        <span>âœ… <strong>${checkedCount}ê°œ í•­ëª©</strong>ì´ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤</span>
                        <button onclick="clearAllSelections()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.125rem 0.5rem; border-radius: 0.25rem; cursor: pointer; font-size: 0.75rem;">âœ• ì„ íƒí•´ì œ</button>
                    </div>
                `;
                
                const tableContainer = document.querySelector('.table-container');
                tableContainer.parentNode.insertBefore(counter, tableContainer);
            }
        }
        
        // ëª¨ë“  ì„ íƒ í•´ì œ
        function clearAllSelections() {
            const selectAllCheckbox = document.getElementById('selectAll');
            const rowCheckboxes = document.querySelectorAll('input[name="selected"]');
            
            selectAllCheckbox.checked = false;
            selectAllCheckbox.indeterminate = false;
            
            rowCheckboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
            
            updateSelectedCount();
            updateBulkDeleteButton();
        }
        
        // ì¼ê´„ ì‚­ì œ ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™”
        function updateBulkDeleteButton() {
            const checkedCount = document.querySelectorAll('input[name="selected"]:checked').length;
            const deleteBtn = document.getElementById('bulkDeleteBtn');
            const deleteCountElement = document.getElementById('deleteCount');
            
            if (deleteBtn && deleteCountElement) {
                deleteCountElement.textContent = checkedCount;
                
                if (checkedCount > 0) {
                    deleteBtn.disabled = false;
                    deleteBtn.style.backgroundColor = '#dc3545';
                } else {
                    deleteBtn.disabled = true;
                    deleteBtn.style.backgroundColor = '#6c757d';
                }
            }
        }
        
        // ì¼ê´„ ì‚­ì œ í•¨ìˆ˜
        function bulkDeleteItems() {
            const checkedBoxes = document.querySelectorAll('input[name="selected"]:checked');
            const checkedCount = checkedBoxes.length;
            
            if (checkedCount === 0) {
                alert('ì‚­ì œí•  í•­ëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!confirm(`ì„ íƒí•œ ${checkedCount}ê°œì˜ í•­ëª©ì„ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâš ï¸ ì‚­ì œëœ ë°ì´í„°ëŠ” ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)) {
                return;
            }
            
            // ì‚­ì œ ë²„íŠ¼ ë¹„í™œì„±í™”
            const deleteBtn = document.getElementById('bulkDeleteBtn');
            if (deleteBtn) {
                deleteBtn.disabled = true;
                deleteBtn.innerHTML = 'ğŸ—‘ï¸ ì‚­ì œì¤‘...';
            }
            
            // ì„ íƒëœ ID ìˆ˜ì§‘
            const selectedIds = Array.from(checkedBoxes).map(checkbox => checkbox.value);
            
            // ê° í•­ëª©ì„ ê°œë³„ì ìœ¼ë¡œ ì‚­ì œ (ê¸°ì¡´ DELETE API í™œìš©)
            let successCount = 0;
            let failedCount = 0;
            let processedCount = 0;
            
            selectedIds.forEach(id => {
                fetch(`/exchange/api/${id}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => {
                    processedCount++;
                    
                    if (response.ok) {
                        successCount++;
                    } else {
                        failedCount++;
                    }
                    
                    // ëª¨ë“  ìš”ì²­ì´ ì™„ë£Œë˜ë©´ ê²°ê³¼ í‘œì‹œ
                    if (processedCount === selectedIds.length) {
                        showDeleteResults(successCount, failedCount);
                    }
                })
                .catch(error => {
                    processedCount++;
                    failedCount++;
                    
                    if (processedCount === selectedIds.length) {
                        showDeleteResults(successCount, failedCount);
                    }
                });
            });
        }
        
        // ì‚­ì œ ê²°ê³¼ í‘œì‹œ
        function showDeleteResults(successCount, failedCount) {
            const deleteBtn = document.getElementById('bulkDeleteBtn');
            
            if (successCount > 0) {
                if (failedCount > 0) {
                    alert(`ì¼ë¶€ í•­ëª©ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.\nâœ… ì„±ê³µ: ${successCount}ê°œ\nâŒ ì‹¤íŒ¨: ${failedCount}ê°œ`);
                } else {
                    alert(`âœ… ${successCount}ê°œ í•­ëª©ì´ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
                }
                
                // ğŸ¯ í˜„ì¬ ìƒíƒœë¡œ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                refreshCurrentPage();
            } else {
                alert(`âŒ ì‚­ì œ ì‹¤íŒ¨: ${failedCount}ê°œ í•­ëª©ì„ ì‚­ì œí•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.`);
                
                // ë²„íŠ¼ ìƒíƒœ ë³µì›
                if (deleteBtn) {
                    deleteBtn.disabled = false;
                    deleteBtn.innerHTML = 'ğŸ—‘ï¸ ì‚­ì œ (<span id="deleteCount">0</span>ê±´)';
                    updateBulkDeleteButton();
                }
            }
        }
        
        // ğŸ¯ ëŒ€í‘œë‹˜ ìš”ì²­: ë‚ ì§œ ì¼ê´„ ìˆ˜ì • ê¸°ëŠ¥
        let dateChanges = new Map(); // ë³€ê²½ëœ ë‚ ì§œë“¤ì„ ì €ì¥
        
        // ğŸ¯ ëŒ€í‘œë‹˜ ìš”ì²­: ì™„ë£Œ ìƒíƒœ ì¼ê´„ ìˆ˜ì • ê¸°ëŠ¥
        let completionChanges = new Map(); // ë³€ê²½ëœ ì™„ë£Œ ìƒíƒœë“¤ì„ ì €ì¥
        
        // ë‚ ì§œ ë³€ê²½ ì‹œ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜
        function markDateAsChanged(input) {
            const id = input.getAttribute('data-id');
            const field = input.getAttribute('data-field');
            const value = input.value;
            
            // console.log('ğŸ“… ë‚ ì§œ ë³€ê²½:', id, field, value);
            
            // ë³€ê²½ì‚¬í•­ ì €ì¥
            if (!dateChanges.has(id)) {
                dateChanges.set(id, {});
            }
            
            const itemChanges = dateChanges.get(id);
            itemChanges[field] = value || null;
            
            // ì‹œê°ì  í”¼ë“œë°± - ë³€ê²½ëœ í–‰ ë°°ê²½ìƒ‰ ë³€ê²½
            const row = input.closest('tr');
            if (row) {
                row.style.backgroundColor = '#fff3cd'; // ì—°í•œ ë…¸ë€ìƒ‰
                row.classList.add('date-changed');
            }
            
            // ë³€ê²½ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
            updateDateChangeCount();
        }
        
        // ë³€ê²½ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
        function updateDateChangeCount() {
            const changeCount = dateChanges.size;
            const changeCountElement = document.getElementById('changeCount');
            
            // null ì²´í¬ ì¶”ê°€
            if (changeCountElement) {
                changeCountElement.textContent = changeCount;
            }
            
            const saveBtn = document.getElementById('bulkSaveBtn');
            if (saveBtn) {
                if (changeCount > 0) {
                    saveBtn.disabled = false;
                    saveBtn.style.backgroundColor = '#28a745';
                } else {
                    saveBtn.disabled = true;
                    saveBtn.style.backgroundColor = '#6c757d';
                }
            }
        }
        
        // ì¼ê´„ ë‚ ì§œ ì €ì¥ í•¨ìˆ˜
        function saveBulkDateChanges() {
            if (dateChanges.size === 0) {
                alert('ë³€ê²½ëœ ë‚ ì§œê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // console.log('ğŸ’¾ ì¼ê´„ ë‚ ì§œ ì €ì¥ ì‹œì‘:', dateChanges);
            
            // ì €ì¥ ë²„íŠ¼ ë¹„í™œì„±í™”
            const saveBtn = document.getElementById('bulkSaveBtn');
            if (saveBtn) {
                saveBtn.disabled = true;
                saveBtn.innerHTML = 'ğŸ’¾ ì €ì¥ì¤‘...';
            }
            
            // ì„œë²„ë¡œ ì „ì†¡í•  ë°ì´í„° ì¤€ë¹„ (null ê°’ë„ í¬í•¨)
            const updates = [];
            dateChanges.forEach((changes, id) => {
                const updateData = { id: parseInt(id) };
                
                // undefinedê°€ ì•„ë‹Œ ê²½ìš° ëª¨ë‘ ì „ì†¡ (null í¬í•¨)
                if (changes.collectionCompletedDate !== undefined) {
                    updateData.collectionCompletedDate = changes.collectionCompletedDate;
                }
                if (changes.logisticsConfirmedDate !== undefined) {
                    updateData.logisticsConfirmedDate = changes.logisticsConfirmedDate;
                }
                if (changes.shippingDate !== undefined) {
                    updateData.shippingDate = changes.shippingDate;
                }
                if (changes.refundDate !== undefined) {
                    updateData.refundDate = changes.refundDate;
                }
                
                updates.push(updateData);
            });
            
            // console.log('ğŸ“¤ ì„œë²„ ì „ì†¡ ë°ì´í„°:', updates);
            
            // ì„œë²„ë¡œ AJAX ìš”ì²­
            fetch('/exchange/api/bulk-update-dates', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(updates)
            })
            .then(response => response.json())
            .then(data => {
                // console.log('ğŸ“¥ ì„œë²„ ì‘ë‹µ:', data);
                
                if (data.success) {
                    alert(`âœ… ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\nì—…ë°ì´íŠ¸ëœ ê±´ìˆ˜: ${data.updatedCount}/${data.totalCount}ê±´`);
                    
                    // ë³€ê²½ì‚¬í•­ ì´ˆê¸°í™”
                    dateChanges.clear();
                    
                    // ë³€ê²½ëœ í–‰ ë°°ê²½ìƒ‰ ì›ë³µ
                    document.querySelectorAll('.date-changed').forEach(row => {
                        row.style.backgroundColor = '';
                        row.classList.remove('date-changed');
                    });
                    
                    // ë²„íŠ¼ ìƒíƒœ ì´ˆê¸°í™”
                    updateDateChangeCount();
                    
                    // ğŸ¯ í˜„ì¬ ìƒíƒœë¡œ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ (ë°ì´í„°ì™€ ì¹´ë“œ í†µê³„ ëª¨ë‘ ì—…ë°ì´íŠ¸)
                    setTimeout(() => {
                        refreshCurrentPage();
                    }, 500);
                    
                } else {
                    alert(`âŒ ì €ì¥ ì‹¤íŒ¨: ${data.message}`);
                }
            })
            .catch(error => {
                // console.error('âŒ ì €ì¥ ì˜¤ë¥˜:', error);
                alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            })
            .finally(() => {
                // ë²„íŠ¼ ìƒíƒœ ë³µì›
                if (saveBtn) {
                    saveBtn.disabled = false;
                    saveBtn.innerHTML = 'ğŸ’¾ ë‚ ì§œì €ì¥ (<span id="changeCount">0</span>ê±´)';
                }
            });
        }
        
        // ì™„ë£Œ ìƒíƒœ ë³€ê²½ ì‹œ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜
        function markCompletionAsChanged(checkbox) {
            const id = checkbox.getAttribute('data-id');
            const isCompleted = checkbox.checked;
            
            // console.log('âœ… ì™„ë£Œ ìƒíƒœ ë³€ê²½:', id, isCompleted);
            
            // ë³€ê²½ì‚¬í•­ ì €ì¥
            completionChanges.set(id, isCompleted);
            
            // ì‹œê°ì  í”¼ë“œë°± - ë³€ê²½ëœ í–‰ ë°°ê²½ìƒ‰ ë³€ê²½
            const row = checkbox.closest('tr');
            if (row) {
                row.style.borderLeft = '4px solid #ffc107'; // ë…¸ë€ìƒ‰ ì™¼ìª½ í…Œë‘ë¦¬
                row.classList.add('completion-changed');
            }
            
            // ì™„ë£Œ ë³€ê²½ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
            updateCompletionChangeCount();
            
            // ğŸ¯ ì‹¤ì‹œê°„ ì¹´ë“œ í†µê³„ ì—…ë°ì´íŠ¸ (ì•½ê°„ì˜ ì§€ì—° í›„)
            setTimeout(() => {
                refreshCardStats();
            }, 300);
        }
        
        // ì™„ë£Œ ë³€ê²½ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
        function updateCompletionChangeCount() {
            const changeCount = completionChanges.size;
            const changeCountElement = document.getElementById('completeCount');
            
            // null ì²´í¬ ì¶”ê°€
            if (changeCountElement) {
                changeCountElement.textContent = changeCount;
            }
            
            const completeBtn = document.getElementById('bulkCompleteBtn');
            if (completeBtn) {
                if (changeCount > 0) {
                    completeBtn.disabled = false;
                    completeBtn.style.backgroundColor = '#ffc107';
                } else {
                    completeBtn.disabled = true;
                    completeBtn.style.backgroundColor = '#6c757d';
                }
            }
        }
        
        // ì¼ê´„ ì™„ë£Œ ìƒíƒœ ì €ì¥ í•¨ìˆ˜
        function saveBulkCompletionChanges() {
            if (completionChanges.size === 0) {
                alert('ë³€ê²½ëœ ì™„ë£Œ ìƒíƒœê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // console.log('âœ… ì¼ê´„ ì™„ë£Œ ìƒíƒœ ì €ì¥ ì‹œì‘:', completionChanges);
            
            // ì €ì¥ ë²„íŠ¼ ë¹„í™œì„±í™”
            const completeBtn = document.getElementById('bulkCompleteBtn');
            if (completeBtn) {
                completeBtn.disabled = true;
                completeBtn.innerHTML = 'âœ… ì²˜ë¦¬ì¤‘...';
            }
            
            // ì„œë²„ë¡œ ì „ì†¡í•  ë°ì´í„° ì¤€ë¹„
            const updates = [];
            completionChanges.forEach((isCompleted, id) => {
                updates.push({
                    id: parseInt(id),
                    isCompleted: isCompleted
                });
            });
            
            // console.log('ğŸ“¤ ì™„ë£Œ ìƒíƒœ ì„œë²„ ì „ì†¡ ë°ì´í„°:', updates);
            
            // ê° í•­ëª©ì„ ê°œë³„ì ìœ¼ë¡œ ì²˜ë¦¬
            let processedCount = 0;
            let successCount = 0;
            
            updates.forEach(update => {
                fetch('/exchange/api/update-completion', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(update)
                })
                .then(response => response.json())
                .then(data => {
                    processedCount++;
                    if (data.success) {
                        successCount++;
                    }
                    
                    // ëª¨ë“  ìš”ì²­ì´ ì™„ë£Œë˜ë©´
                    if (processedCount === updates.length) {
                        if (successCount === updates.length) {
                            alert(`âœ… ì™„ë£Œ ìƒíƒœê°€ ì„±ê³µì ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤!\nì²˜ë¦¬ëœ ê±´ìˆ˜: ${successCount}/${updates.length}ê±´`);
                            
                            // ë³€ê²½ì‚¬í•­ ì´ˆê¸°í™”
                            completionChanges.clear();
                            
                            // ë³€ê²½ëœ í–‰ ìŠ¤íƒ€ì¼ ì›ë³µ
                            document.querySelectorAll('.completion-changed').forEach(row => {
                                row.style.borderLeft = '';
                                row.classList.remove('completion-changed');
                            });
                            
                            // ì™„ë£Œëœ í•­ëª©ë“¤ì— completed í´ë˜ìŠ¤ ì ìš©
                            updates.forEach(update => {
                                const checkbox = document.querySelector(`input[data-id="${update.id}"]`);
                                if (checkbox) {
                                    const row = checkbox.closest('tr');
                                    if (update.isCompleted) {
                                        row.classList.add('completed');
                                    } else {
                                        row.classList.remove('completed');
                                    }
                                }
                            });
                            
                                                         // ë²„íŠ¼ ìƒíƒœ ì´ˆê¸°í™”
                             updateCompletionChangeCount();
                             
                             // ğŸ¯ í˜„ì¬ ìƒíƒœë¡œ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ (ë°ì´í„°ì™€ ì¹´ë“œ í†µê³„ ëª¨ë‘ ì—…ë°ì´íŠ¸)
                             setTimeout(() => {
                                 refreshCurrentPage();
                             }, 500);
                             
                         } else {
                            alert(`âš ï¸ ì¼ë¶€ í•­ëª© ì²˜ë¦¬ ì‹¤íŒ¨\nì„±ê³µ: ${successCount}ê±´, ì‹¤íŒ¨: ${updates.length - successCount}ê±´`);
                        }
                        
                        // ë²„íŠ¼ ìƒíƒœ ë³µì›
                        if (completeBtn) {
                            completeBtn.disabled = false;
                            completeBtn.innerHTML = 'âœ… ì™„ë£Œì²˜ë¦¬ (<span id="completeCount">0</span>ê±´)';
                        }
                    }
                })
                .catch(error => {
                    // console.error('âŒ ì™„ë£Œ ìƒíƒœ ì €ì¥ ì˜¤ë¥˜:', error);
                    processedCount++;
                    
                    if (processedCount === updates.length) {
                        alert('ì™„ë£Œ ìƒíƒœ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                        
                        // ë²„íŠ¼ ìƒíƒœ ë³µì›
                        if (completeBtn) {
                            completeBtn.disabled = false;
                            completeBtn.innerHTML = 'âœ… ì™„ë£Œì²˜ë¦¬ (<span id="completeCount">0</span>ê±´)';
                        }
                    }
                });
            });
        }
        
        // ì™„ë£Œ ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (ê°œë³„ ì²˜ë¦¬ìš© - ì‚¬ìš©í•˜ì§€ ì•ŠìŒ)
        function updateCompletionStatus(checkbox) {
            const itemId = checkbox.getAttribute('data-id');
            const isCompleted = checkbox.checked;
            
            // console.log(`ì™„ë£Œ ìƒíƒœ ì—…ë°ì´íŠ¸: ID=${itemId}, ì™„ë£Œ=${isCompleted}`);
            
            // ì²´í¬ë°•ìŠ¤ ë¹„í™œì„±í™” (ì¤‘ë³µ í´ë¦­ ë°©ì§€)
            checkbox.disabled = true;
            
            // ì„œë²„ë¡œ AJAX ìš”ì²­
            fetch('/exchange/api/update-completion', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    id: parseInt(itemId),
                    isCompleted: isCompleted
                })
            })
            .then(response => response.json())
            .then(data => {
                // console.log('ì™„ë£Œ ìƒíƒœ ì—…ë°ì´íŠ¸ ì‘ë‹µ:', data);
                
                if (data.success) {
                    // ì„±ê³µ ì‹œ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ìœ ì§€
                    // console.log(`âœ… ì™„ë£Œ ìƒíƒœê°€ ${isCompleted ? 'ì™„ë£Œ' : 'ë¯¸ì™„ë£Œ'}ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                    
                    // í–‰ ìŠ¤íƒ€ì¼ ë³€ê²½ (ì™„ë£Œëœ í•­ëª©ì€ completed í´ë˜ìŠ¤ ì¶”ê°€/ì œê±°)
                    const row = checkbox.closest('tr');
                    if (isCompleted) {
                        row.classList.add('completed');
                    } else {
                        row.classList.remove('completed');
                    }
                } else {
                    // ì‹¤íŒ¨ ì‹œ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ë˜ëŒë¦¬ê¸°
                    checkbox.checked = !isCompleted;
                    alert(`âŒ ì™„ë£Œ ìƒíƒœ ë³€ê²½ ì‹¤íŒ¨: ${data.message}`);
                }
            })
            .catch(error => {
                // console.error('âŒ ì™„ë£Œ ìƒíƒœ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
                // ì˜¤ë¥˜ ì‹œ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ë˜ëŒë¦¬ê¸°
                checkbox.checked = !isCompleted;
                alert('ì™„ë£Œ ìƒíƒœ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            })
            .finally(() => {
                // ì²´í¬ë°•ìŠ¤ ë‹¤ì‹œ í™œì„±í™”
                checkbox.disabled = false;
            });
        }
        
        // ë‚ ì§œ í•„ë“œ ì´ˆê¸°í™” í•¨ìˆ˜
        function clearDateField(button) {
            const itemId = button.getAttribute('data-id');
            const fieldName = button.getAttribute('data-field');
            
            // í•´ë‹¹ ë‚ ì§œ ì…ë ¥ í•„ë“œ ì°¾ê¸°
            const dateInput = document.querySelector(`input[data-id="${itemId}"][data-field="${fieldName}"]`);
            
            if (dateInput) {
                // ë‚ ì§œ í•„ë“œ ì´ˆê¸°í™”
                dateInput.value = '';
                
                // ë³€ê²½ì‚¬í•­ ì¶”ê°€ (nullë¡œ ì„¤ì •)
                if (!dateChanges.has(itemId)) {
                    dateChanges.set(itemId, {});
                }
                
                const changes = dateChanges.get(itemId);
                changes[fieldName] = null; // nullë¡œ ì„¤ì •í•˜ì—¬ DBì—ì„œ NULLë¡œ ì—…ë°ì´íŠ¸
                
                // í–‰ ìŠ¤íƒ€ì¼ ë³€ê²½ (ë³€ê²½ëœ ê²ƒìœ¼ë¡œ í‘œì‹œ)
                const row = dateInput.closest('tr');
                if (row) {
                    row.classList.add('date-changed');
                    row.style.backgroundColor = '#fff3cd'; // ì—°í•œ ë…¸ë€ìƒ‰ ë°°ê²½
                }
                
                // ë³€ê²½ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
                updateDateChangeCount();
                
                // console.log(`ë‚ ì§œ ì´ˆê¸°í™”: ID=${itemId}, í•„ë“œ=${fieldName}`);
                
                // ğŸ¯ ì‹¤ì‹œê°„ ì¹´ë“œ í†µê³„ ì—…ë°ì´íŠ¸ (ì•½ê°„ì˜ ì§€ì—° í›„)
                setTimeout(() => {
                    refreshCardStats();
                }, 300);
            }
        }
        
        // ğŸ¯ ì•ˆì „í•œ ë³µì‚¬ í•¨ìˆ˜ (HTTP/HTTPS í™˜ê²½ ëª¨ë‘ ì§€ì›)
        function safeCopyToClipboard(text, element, type) {
            // Method 1: ìµœì‹  Clipboard API ì‹œë„ (HTTPS í™˜ê²½)
            if (navigator.clipboard && navigator.clipboard.writeText) {
                return navigator.clipboard.writeText(text)
                    .then(() => {
                        showCopySuccess(element, type, text);
                        return true;
                    })
                    .catch(() => {
                        return fallbackCopyMethod(text, element, type);
                    });
            }
            
            // Method 2: ëŒ€ì²´ ë°©ë²• (HTTP í™˜ê²½)
            return Promise.resolve(fallbackCopyMethod(text, element, type));
        }
        
        // ëŒ€ì²´ ë³µì‚¬ ë°©ë²• (HTTP í™˜ê²½ìš©)
        function fallbackCopyMethod(text, element, type) {
            try {
                // ì„ì‹œ í…ìŠ¤íŠ¸ ì˜ì—­ ìƒì„±
                const textArea = document.createElement('textarea');
                textArea.value = text;
                textArea.style.position = 'fixed';
                textArea.style.left = '-9999px';
                textArea.style.top = '-9999px';
                document.body.appendChild(textArea);
                
                // í…ìŠ¤íŠ¸ ì„ íƒ ë° ë³µì‚¬
                textArea.focus();
                textArea.select();
                
                // execCommandë¡œ ë³µì‚¬ ì‹œë„
                const success = document.execCommand('copy');
                document.body.removeChild(textArea);
                
                if (success) {
                    showCopySuccess(element, type, text);
                    return true;
                } else {
                    throw new Error('execCommand failed');
                }
            } catch (err) {
                // ìµœí›„ì˜ ìˆ˜ë‹¨: í…ìŠ¤íŠ¸ ì„ íƒ ìƒíƒœë¡œ ë§Œë“¤ê¸°
                selectText(element);
                showCopyError(element, type, text);
                return false;
            }
        }
        
        // í…ìŠ¤íŠ¸ ì„ íƒ í•¨ìˆ˜
        function selectText(element) {
            if (document.selection) {
                const range = document.body.createTextRange();
                range.moveToElementText(element);
                range.select();
            } else if (window.getSelection) {
                const range = document.createRange();
                range.selectNodeContents(element);
                const selection = window.getSelection();
                selection.removeAllRanges();
                selection.addRange(range);
            }
        }
        
        // ë³µì‚¬ ì„±ê³µ ì²˜ë¦¬
        function showCopySuccess(element, type, text) {
            // ì‹œê°ì  í”¼ë“œë°±
            const originalText = element.textContent;
            const originalColor = element.style.color;
            const originalBg = element.style.backgroundColor;
            
            // ë³µì‚¬ ì™„ë£Œ í‘œì‹œ
            element.style.backgroundColor = '#28a745';
            element.style.color = 'white';
            element.style.transform = 'scale(1.05)';
            element.textContent = 'âœ… ë³µì‚¬ì™„ë£Œ!';
            
            // 1ì´ˆ í›„ ì›ë˜ ìƒíƒœë¡œ ë³µì›
            setTimeout(() => {
                element.style.backgroundColor = originalBg;
                element.style.color = originalColor;
                element.style.transform = 'scale(1)';
                element.textContent = originalText;
            }, 1000);
            
            // í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ
            showCopyToast(text, type);
        }
        
        // ë³µì‚¬ ì‹¤íŒ¨ ì²˜ë¦¬
        function showCopyError(element, type, text) {
            // ì‹¤íŒ¨ í”¼ë“œë°±
            element.style.backgroundColor = '#dc3545';
            element.style.color = 'white';
            element.style.transform = 'scale(1.05)';
            element.textContent = 'âŒ ë³µì‚¬ì‹¤íŒ¨';
            
            setTimeout(() => {
                element.style.backgroundColor = '';
                element.style.color = '';
                element.style.transform = 'scale(1)';
                element.textContent = text;
            }, 1500);
            
            alert(`${type} ìë™ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\ní…ìŠ¤íŠ¸ê°€ ì„ íƒëœ ìƒíƒœì…ë‹ˆë‹¤. Ctrl+Cë¡œ ë³µì‚¬í•´ì£¼ì„¸ìš”.\n\nğŸ“‹ ${type}: ${text}`);
        }

        // ğŸ¯ ì£¼ë¬¸ë²ˆí˜¸ ë³µì‚¬ ê¸°ëŠ¥
        function copyOrderNumber(element) {
            const orderNumber = element.getAttribute('data-order-number');
            safeCopyToClipboard(orderNumber, element, 'ğŸ“‹ ì£¼ë¬¸ë²ˆí˜¸');
        }
        
        // ë³µì‚¬ ì™„ë£Œ í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ
        function showCopyToast(value, type) {
            // ê¸°ì¡´ í† ìŠ¤íŠ¸ ì œê±°
            const existingToast = document.querySelector('.copy-toast');
            if (existingToast) {
                existingToast.remove();
            }
            
            // ìƒˆ í† ìŠ¤íŠ¸ ìƒì„±
            const toast = document.createElement('div');
            toast.className = 'copy-toast';
            toast.innerHTML = `
                <div style="
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: linear-gradient(135deg, #28a745, #20c997);
                    color: white;
                    padding: 1rem 1.5rem;
                    border-radius: 0.5rem;
                    box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
                    z-index: 9999;
                    display: flex;
                    align-items: center;
                    gap: 0.5rem;
                    font-size: 0.9rem;
                    font-weight: 500;
                    animation: slideInRight 0.3s ease-out;
                ">
                    <span>${type.split(' ')[0]}</span>
                    <span><strong>${type} ë³µì‚¬ì™„ë£Œ!</strong><br/><small>${value}</small></span>
                </div>
            `;
            
            document.body.appendChild(toast);
            
            // 3ì´ˆ í›„ ìë™ ì œê±°
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.style.animation = 'slideOutRight 0.3s ease-out';
                    setTimeout(() => {
                        if (toast.parentNode) {
                            toast.remove();
                        }
                    }, 300);
                }
            }, 3000);
        }
        
        // ğŸ¯ ê³ ê°ëª… ë³µì‚¬ ê¸°ëŠ¥
        function copyCustomerName(element) {
            const customerName = element.getAttribute('data-customer-name');
            safeCopyToClipboard(customerName, element, 'ğŸ‘¤ ê³ ê°ëª…');
        }
        
        // ğŸ¯ ì—°ë½ì²˜ ë³µì‚¬ ê¸°ëŠ¥
        function copyCustomerPhone(element) {
            const customerPhone = element.getAttribute('data-customer-phone');
            safeCopyToClipboard(customerPhone, element, 'ğŸ“ ì—°ë½ì²˜');
        }
        

        
        // ğŸ¯ ì£¼ë¬¸í’ˆë²ˆ ë³µì‚¬ ê¸°ëŠ¥
        function copyOrderItemCode(element) {
            const orderItemCode = element.getAttribute('data-order-item-code');
            safeCopyToClipboard(orderItemCode, element, 'ğŸ·ï¸ ì£¼ë¬¸í’ˆë²ˆ');
        }
        
        // ğŸ¯ ìš´ì†¡ì¥ë²ˆí˜¸ ë³µì‚¬ ê¸°ëŠ¥
        function copyTrackingNumber(element) {
            const trackingNumber = element.getAttribute('data-tracking-number');
            safeCopyToClipboard(trackingNumber, element, 'ğŸšš ìš´ì†¡ì¥ë²ˆí˜¸');
        }

        // ğŸ¯ í˜„ì¬ ìƒíƒœë¥¼ ìœ ì§€í•˜ë©´ì„œ ì „ì²´ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
        function refreshCurrentPage() {
            console.log('ğŸ”„ í˜„ì¬ ìƒíƒœë¡œ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨...');
            
            // í˜„ì¬ ëª¨ë“  ì¡°ê±´(ê²€ìƒ‰ + í•„í„° + í˜ì´ì§€)ì„ í¬í•¨í•œ URL ìƒì„±
            const currentParams = getFullParamsUrl();
            const refreshUrl = `/exchange/list${currentParams ? '?' + currentParams : ''}`;
            
            // í˜ì´ì§€ ì´ë™ (í˜„ì¬ ìƒíƒœ ìœ ì§€)
            window.location.href = refreshUrl;
        }
        
        // ğŸ¯ ëŒ€í‘œë‹˜ ìš”ì²­: ì‹¤ì‹œê°„ ì¹´ë“œ í†µê³„ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function refreshCardStats() {
            console.log('ğŸ“Š ì¹´ë“œ í†µê³„ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ì‹œì‘...');
            
            // í˜„ì¬ ê²€ìƒ‰ ì¡°ê±´ ê°€ì ¸ì˜¤ê¸°
            const searchForm = document.getElementById('searchForm');
            const formData = new FormData(searchForm);
            const searchParams = new URLSearchParams(formData);
            
            // ì¹´ë“œ í†µê³„ API í˜¸ì¶œ - realtime-stats ì—”ë“œí¬ì¸íŠ¸ ì‚¬ìš©
            fetch(`/exchange/api/realtime-stats?${searchParams.toString()}`)
                .then(response => response.json())
                .then(data => {
                    console.log('ğŸ“Š ì¹´ë“œ í†µê³„ ë°ì´í„°:', data);
                    
                    // ê° ì¹´ë“œì˜ ìˆ«ì ì—…ë°ì´íŠ¸
                    updateCardValue('collectionCompletedCount', data.collectionCompletedCount);
                    updateCardValue('collectionPendingCount', data.collectionPendingCount);
                    updateCardValue('logisticsConfirmedCount', data.logisticsConfirmedCount);
                    updateCardValue('logisticsPendingCount', data.logisticsPendingCount);
                    updateCardValue('exchangeShippedCount', data.exchangeShippedCount);
                    updateCardValue('exchangeNotShippedCount', data.exchangeNotShippedCount);
                    updateCardValue('returnRefundedCount', data.returnRefundedCount);
                    updateCardValue('returnNotRefundedCount', data.returnNotRefundedCount);
                    updateCardValue('paymentCompletedCount', data.paymentCompletedCount);
                    updateCardValue('paymentPendingCount', data.paymentPendingCount);
                    updateCardValue('completedCount', data.completedCount);
                    updateCardValue('incompletedCount', data.incompletedCount);
                    
                    // ğŸ¯ ì²˜ë¦¬ê¸°ê°„ ì„ë°• ì¹´ë“œ ì—…ë°ì´íŠ¸
                    updateCardValue('overdueTenDaysCount', data.overdueTenDaysCount);
                    
                    // í†µê³„ ìš”ì•½ ë¶€ë¶„ì˜ todayCount ì—…ë°ì´íŠ¸
                    updateStatsValue('todayCount', data.todayCount);
                    
                    console.log('âœ… ì¹´ë“œ í†µê³„ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                })
                .catch(error => {
                    console.error('âŒ ì¹´ë“œ í†µê³„ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
                });
        }
        
        // ğŸ¯ AJAX í›„ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¬ë“±ë¡
        function reattachEventListeners() {
            console.log('ğŸ”— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¬ë“±ë¡ ì‹œì‘...');
            
            // í—¤ë” ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
            const selectAllCheckbox = document.getElementById('selectAll');
            if (selectAllCheckbox) {
                selectAllCheckbox.removeEventListener('change', toggleSelectAll);
                selectAllCheckbox.addEventListener('change', toggleSelectAll);
            }
            
            // ê°œë³„ ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
            const rowCheckboxes = document.querySelectorAll('input[name="selected"]');
            rowCheckboxes.forEach(checkbox => {
                checkbox.removeEventListener('change', updateSelectAllState);
                checkbox.addEventListener('change', updateSelectAllState);
            });
            
            // í–‰ ë”ë¸”í´ë¦­ ì´ë²¤íŠ¸ ì¬ë“±ë¡
            addRowDoubleClickEvents();
            
            // AJAX í˜ì´ì§€ë„¤ì´ì…˜ ì´ë²¤íŠ¸ ë“±ë¡
            const ajaxPageLinks = document.querySelectorAll('.ajax-page-link');
            ajaxPageLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const page = parseInt(this.getAttribute('data-page'));
                    filterByServerWithPage(getCurrentActiveFilter(), page);
                });
            });
            
            console.log('âœ… ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¬ë“±ë¡ ì™„ë£Œ');
        }
        
        // ğŸ¯ í˜„ì¬ í™œì„± í•„í„° ê°€ì ¸ì˜¤ê¸°
        function getCurrentActiveFilter() {
            if (activeFilters.size > 0) {
                return Array.from(activeFilters)[0]; // ì²« ë²ˆì§¸ í™œì„± í•„í„° ë°˜í™˜
            }
            return null;
        }
        
        // ğŸ¯ í˜ì´ì§€ë„¤ì´ì…˜ê³¼ í•¨ê»˜ í•„í„°ë§
        async function filterByServerWithPage(filterType, page) {
            if (!filterType) return;
            
            console.log('ğŸ“„ í˜ì´ì§€ë„¤ì´ì…˜ í•„í„°ë§:', filterType, page);
            
            showLoadingBanner();
            
            try {
                const searchForm = document.getElementById('searchForm');
                const formData = new FormData(searchForm);
                
                const requestBody = {
                    filterType: filterType,
                    page: page || 0,
                    size: 20
                };
                
                // ê²€ìƒ‰ ì¡°ê±´ ì¶”ê°€
                if (formData.get('keyword') && formData.get('keyword').trim() !== '') {
                    requestBody.keyword = formData.get('keyword');
                }
                if (formData.get('startDate')) {
                    requestBody.startDate = formData.get('startDate');
                }
                if (formData.get('endDate')) {
                    requestBody.endDate = formData.get('endDate');
                }
                
                const response = await fetch('/exchange/api/filter-html', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestBody)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const htmlText = await response.text();
                
                const tableContainer = document.querySelector('.table-container .table-wrapper');
                if (tableContainer) {
                    tableContainer.innerHTML = htmlText;
                    
                    setTimeout(() => {
                        reattachEventListeners();
                        updateFilterBanner();
                    }, 100);
                }
                
            } catch (error) {
                console.error('âŒ í˜ì´ì§€ë„¤ì´ì…˜ í•„í„°ë§ ì‹¤íŒ¨:', error);
            }
        }
        
        // ğŸ¯ í•„í„° ë°°ë„ˆ ì—…ë°ì´íŠ¸
        function updateFilterBanner() {
            // ê¸°ì¡´ ë°°ë„ˆ ì œê±°
            const existingBanner = document.querySelector('.filter-banner');
            if (existingBanner) {
                existingBanner.remove();
            }
            
            // í™œì„± í•„í„°ê°€ ìˆìœ¼ë©´ ë°°ë„ˆ í‘œì‹œ
            if (activeFilters.size > 0) {
                showCurrentFilterBanner(Array.from(activeFilters));
            }
        }
        
        // ì¹´ë“œ ê°’ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ í¬í•¨)
        function updateCardValue(cardId, newValue) {
            // ì¹´ë“œ IDì— ë”°ë¥¸ ì‹¤ì œ data-filter ì†ì„± ë§¤í•‘
            const filterMapping = {
                'todayCount': 'today',  // ì„ì‹œë¡œ today í•„í„° ì‚¬ìš©
                'collectionCompletedCount': 'collection-completed',
                'collectionPendingCount': 'collection-pending', 
                'logisticsConfirmedCount': 'logistics-confirmed',
                'logisticsPendingCount': 'logistics-pending',
                'exchangeShippedCount': 'shipping-completed',
                'exchangeNotShippedCount': 'shipping-pending',
                'returnRefundedCount': 'refund-completed',
                'returnNotRefundedCount': 'refund-pending',
                'paymentCompletedCount': 'payment-completed',
                'paymentPendingCount': 'payment-pending',
                'completedCount': 'completed',
                'incompletedCount': 'incompleted',
                'overdueTenDaysCount': 'overdue-ten-days'
            };
            
            const filterName = filterMapping[cardId];
            if (!filterName) {
                // console.warn(`âš ï¸ ë§¤í•‘ë˜ì§€ ì•Šì€ ì¹´ë“œ ID: ${cardId}`);
                return;
            }
            
            // data-filter ì†ì„±ìœ¼ë¡œ ì¹´ë“œ ìš”ì†Œ ì°¾ê¸°
            const cardElement = document.querySelector(`[data-filter="${filterName}"]`);
            if (cardElement) {
                const currentValue = parseInt(cardElement.textContent.replace(/,/g, '')) || 0;
                
                // ê°’ì´ ë³€ê²½ëœ ê²½ìš°ì—ë§Œ ì• ë‹ˆë©”ì´ì…˜ ì ìš©
                if (currentValue !== newValue) {
                    // console.log(`ğŸ“Š ì¹´ë“œ ì—…ë°ì´íŠ¸: ${cardId} (${filterName}) ${currentValue} â†’ ${newValue}`);
                    
                    // ì²˜ë¦¬ê¸°ê°„ ì„ë°• ì¹´ë“œ íŠ¹ë³„ ì²˜ë¦¬
                    if (cardId === 'overdueTenDaysCount') {
                        const overdueCard = document.querySelector('[data-card="overdue"]');
                        if (overdueCard) {
                            // ê¹œë¹¡ì„ íš¨ê³¼ (ê²½ê³ ìƒ‰)
                            cardElement.style.transition = 'all 0.3s ease';
                            cardElement.style.backgroundColor = '#ffebee';
                            cardElement.style.transform = 'scale(1.1)';
                            cardElement.style.boxShadow = '0 4px 12px rgba(255, 68, 68, 0.6)';
                            
                            // ìˆ«ì ì—…ë°ì´íŠ¸
                            setTimeout(() => {
                                cardElement.textContent = newValue.toLocaleString();
                                
                                // ì²˜ë¦¬ê¸°ê°„ ì„ë°• ì¹´ë“œ (ì• ë‹ˆë©”ì´ì…˜ ì œê±°ë¨)
                                
                                // ì›ë˜ ìƒíƒœë¡œ ë³µì›
                                setTimeout(() => {
                                    cardElement.style.backgroundColor = '';
                                    cardElement.style.transform = '';
                                    cardElement.style.boxShadow = '';
                                }, 300);
                            }, 150);
                        }
                    } else {
                        // ì¼ë°˜ ì¹´ë“œ ê¹œë¹¡ì„ íš¨ê³¼
                        cardElement.style.transition = 'all 0.3s ease';
                        cardElement.style.backgroundColor = '#fff3cd';
                        cardElement.style.transform = 'scale(1.05)';
                        cardElement.style.boxShadow = '0 4px 12px rgba(255, 193, 7, 0.4)';
                        
                        // ìˆ«ì ì—…ë°ì´íŠ¸
                        setTimeout(() => {
                            cardElement.textContent = newValue.toLocaleString();
                            
                            // ì›ë˜ ìƒíƒœë¡œ ë³µì›
                            setTimeout(() => {
                                cardElement.style.backgroundColor = '';
                                cardElement.style.transform = '';
                                cardElement.style.boxShadow = '';
                            }, 300);
                        }, 150);
                    }
                }
            } else {
                // console.warn(`âš ï¸ ì¹´ë“œ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ: ${cardId} (filter: ${filterName})`);
            }
        }
        
        // í†µê³„ ìš”ì•½ ë¶€ë¶„ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateStatsValue(statId, newValue) {
            // í†µê³„ ìš”ì•½ì—ì„œ todayCount ì°¾ê¸° (Thymeleaf ì¡°ê±´ì— ë”°ë¼ ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œ ì°¾ì•„ì•¼ í•¨)
            if (statId === 'todayCount') {
                // "ê¸ˆì¼ ë“±ë¡" ë¼ë²¨ ë‹¤ìŒì˜ ê°’ ì°¾ê¸°
                const statsLabels = document.querySelectorAll('.stats-label');
                for (let label of statsLabels) {
                    if (label.textContent.includes('ê¸ˆì¼ ë“±ë¡')) {
                        const valueElement = label.nextElementSibling;
                        if (valueElement && valueElement.classList.contains('stats-value')) {
                            const currentValue = parseInt(valueElement.textContent.replace(/[^0-9]/g, '')) || 0;
                            if (currentValue !== newValue) {
                                // console.log(`ğŸ“Š í†µê³„ ì—…ë°ì´íŠ¸: ${statId} ${currentValue} â†’ ${newValue}`);
                                
                                // ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
                                valueElement.style.transition = 'all 0.3s ease';
                                valueElement.style.backgroundColor = '#fff3cd';
                                valueElement.style.transform = 'scale(1.05)';
                                
                                // ê°’ ì—…ë°ì´íŠ¸
                                setTimeout(() => {
                                    valueElement.textContent = `${newValue}ê±´`;
                                    
                                    // ì›ë˜ ìƒíƒœë¡œ ë³µì›
                                    setTimeout(() => {
                                        valueElement.style.backgroundColor = '';
                                        valueElement.style.transform = '';
                                    }, 300);
                                }, 150);
                            }
                        }
                        break;
                    }
                }
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì™„ë£Œëœ í•­ëª©ë“¤ì— ìŠ¤íƒ€ì¼ ì ìš©
        document.addEventListener('DOMContentLoaded', function() {
            // ì™„ë£Œ ì²´í¬ë°•ìŠ¤ë“¤ì„ ì°¾ì•„ì„œ ì²´í¬ëœ í•­ëª©ë“¤ì˜ í–‰ì— completed í´ë˜ìŠ¤ ì¶”ê°€
            const completionCheckboxes = document.querySelectorAll('input[type="checkbox"][data-id]');
            completionCheckboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    const row = checkbox.closest('tr');
                    if (row) {
                        row.classList.add('completed');
                    }
                }
            });
            
            // ğŸ¯ í˜ì´ì§€ ë¡œë“œ ì‹œ ì¹´ë“œ í†µê³„ í…ŒìŠ¤íŠ¸ (1ì´ˆ í›„)
            setTimeout(() => {
                // console.log('ğŸ§ª ì¹´ë“œ í†µê³„ í…ŒìŠ¤íŠ¸ ì‹¤í–‰...');
                refreshCardStats();
            }, 1000);
        });
    </script>
    <style>
        /* ê°œì„ ëœ ëª¨ë˜ ë””ìì¸ */
        :root {
            --primary-color: #4361ee;
            --primary-light: #eef2ff;
            --secondary-color: #3f37c9;
            --accent-color: #4cc9f0;
            --warning-color: #f72585;
            --success-color: #35b27f;
            --danger-color: #ff4d6d;
            --info-color: #4a6fff;
            --dark-color: #1e2a3b;
            --text-color: #2d3748;
            --text-muted: #718096;
            --bg-color: #f8fafc;
            --bg-card: #ffffff;
            --border-color: #e2e8f0;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --radius-sm: 0.375rem;
            --radius: 0.5rem;
            --radius-lg: 0.75rem;
            --transition: all 0.2s ease;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, 'Helvetica Neue', 'Segoe UI', sans-serif;
            line-height: 1.6;
        }

        .page-container {
            max-width: 100%;
            width: 100%;
            margin: 0;
            padding: 1rem;
        }

        .header {
            border-radius: var(--radius-lg);
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            padding: 2rem;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0) 60%);
            transform: rotate(30deg);
        }

        .header h2 {
            color: white;
            font-weight: 700;
            margin: 0;
            font-size: 1.875rem;
            position: relative;
            z-index: 1;
        }

        .header p {
            color: rgba(255,255,255,0.9);
            margin: 0.5rem 0 0;
            font-size: 1rem;
            position: relative;
            z-index: 1;
        }

        /* í†µê³„ ëŒ€ì‹œë³´ë“œ - ì»´íŒ©íŠ¸í•œ ì¹´ë“œ */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .stat-box {
            border-radius: var(--radius);
            padding: 1rem;
            background-color: var(--bg-card);
            box-shadow: var(--shadow-sm);
            border-left: 4px solid var(--primary-color);
            transition: var(--transition);
            cursor: pointer;
            min-height: 100px;
        }

        .stat-box:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .card-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            height: 100%;
            justify-content: space-between;
        }

        .stat-box h3 {
            color: var(--text-color);
            font-size: 0.85rem;
            font-weight: 600;
            margin: 0 0 0.5rem 0;
            white-space: nowrap;
        }

        .stat-box .value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--dark-color);
            margin: 0.25rem 0;
            line-height: 1.2;
            border-radius: 0.5rem;
            padding: 0.25rem 0.5rem;
            transition: all 0.3s ease;
        }

        .stat-box .description {
            font-size: 0.7rem;
            color: var(--text-muted);
            margin: 0;
            font-weight: 500;
            white-space: nowrap;
        }

        .stat-box.warning { border-left-color: var(--warning-color); }
        .stat-box.warning .value { color: var(--warning-color); }
        
        .stat-box.primary { border-left-color: var(--info-color); }
        .stat-box.primary .value { color: var(--info-color); }
        
        .stat-box.success { border-left-color: var(--success-color); }
        .stat-box.success .value { color: var(--success-color); }
        
                    .stat-box.danger { border-left-color: var(--danger-color); }
            .stat-box.danger .value { color: var(--danger-color); }
            
            .stat-box.urgent { 
                border-left-color: #ff4444; 
                background: linear-gradient(135deg, #fff5f5, #ffeaea);
                border: 2px solid #ff4444;
                box-shadow: 0 4px 12px rgba(255, 68, 68, 0.3);
            }
            .stat-box.urgent .value { color: #ff4444; font-weight: bold; }
            .stat-box.urgent h3 { color: #ff4444; }

        /* í´ë¦­ ê°€ëŠ¥í•œ ìš”ì†Œ ìŠ¤íƒ€ì¼ */
        .filter-link {
            cursor: pointer;
            padding: 2px 4px;
            border-radius: 3px;
            transition: all 0.2s ease;
            text-decoration: underline;
            text-decoration-color: transparent;
        }

        .filter-link:hover {
            background-color: rgba(255, 255, 255, 0.3);
            text-decoration-color: currentColor;
            transform: scale(1.1);
        }

        /* í™œì„± ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .stat-box.active {
            border-left-width: 6px;
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(67, 97, 238, 0.3);
            background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(255,255,255,1));
            position: relative;
            overflow: hidden;
        }

        .stat-box.active .value {
            color: var(--primary-color) !important;
            text-shadow: 0 2px 4px rgba(67, 97, 238, 0.2);
        }

        /* ğŸ¯ í™œì„± ì¹´ë“œ ìƒë‹¨ì— ì‘ì€ ë°°ì§€ ì¶”ê°€ */
        .stat-box.active::before {
            content: 'âœ“';
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: var(--primary-color);
            color: white;
            font-size: 0.6rem;
            font-weight: bold;
            width: 1rem;
            height: 1rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        /* ğŸ¯ í™œì„± ì¹´ë“œ ì• ë‹ˆë©”ì´ì…˜ */
        .stat-box.active {
            animation: cardActivation 0.3s ease-out;
        }

        @keyframes cardActivation {
            0% {
                transform: translateY(0) scale(1);
                box-shadow: 0 2px 4px rgba(67, 97, 238, 0.1);
            }
            50% {
                transform: translateY(-5px) scale(1.02);
                box-shadow: 0 12px 30px rgba(67, 97, 238, 0.4);
            }
            100% {
                transform: translateY(-3px) scale(1);
                box-shadow: 0 8px 25px rgba(67, 97, 238, 0.3);
            }
        }

        /* í•„í„° ë°°ë„ˆ ìŠ¤íƒ€ì¼ */
        .filter-banner {
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ğŸ¯ í•„í„° ë°°ì§€ í˜¸ë²„ íš¨ê³¼ */
        .filter-badge {
            transition: all 0.2s ease;
        }

        .filter-badge:hover {
            background: rgba(255,255,255,0.3) !important;
            transform: translateY(-1px);
        }

        .filter-badge button:hover {
            background: rgba(255,255,255,0.5) !important;
            transform: scale(1.1);
        }

        /* í•„í„° ìƒíƒœ í‘œì‹œ */
        .filter-status {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 0.75rem 1rem;
            border-radius: var(--radius);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: var(--shadow);
        }

        .filter-text {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .clear-filter {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius-sm);
            font-size: 0.8rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .clear-filter:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }

        /* ë°°ì†¡ë¹„ ìƒíƒœ ë°°ì§€ ìŠ¤íƒ€ì¼ */
        .badge.bg-danger {
            background-color: #dc3545 !important;
            color: white !important;
            font-weight: 600;
            padding: 0.4rem 0.8rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            box-shadow: 0 2px 4px rgba(220, 53, 69, 0.3);
        }

        .badge.bg-warning {
            background-color: #ffc107 !important;
            color: #212529 !important;
            font-weight: 600;
            padding: 0.4rem 0.8rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            box-shadow: 0 2px 4px rgba(255, 193, 7, 0.3);
        }

        /* ì…ê¸ˆìƒíƒœ ë°°ì§€ ìŠ¤íƒ€ì¼ */
        .badge.bg-success {
            background-color: #198754 !important;
            color: white !important;
            font-weight: 600;
            padding: 0.4rem 0.8rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            box-shadow: 0 2px 4px rgba(25, 135, 84, 0.3);
        }

        .badge.bg-info {
            background-color: #0dcaf0 !important;
            color: white !important;
            font-weight: 600;
            padding: 0.4rem 0.8rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            box-shadow: 0 2px 4px rgba(13, 202, 240, 0.3);
        }

        .badge.bg-secondary {
            background-color: #6c757d !important;
            color: white !important;
            font-weight: 600;
            padding: 0.4rem 0.8rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            box-shadow: 0 2px 4px rgba(108, 117, 125, 0.3);
        }

        /* ê²€ìƒ‰ ì»¨í…Œì´ë„ˆ - ë” ëª…í™•í•œ êµ¬ì¡° */
        .search-container {
            background-color: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow-sm);
            margin-bottom: 1.5rem;
            border: 1px solid var(--border-color);
        }

        .search-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--dark-color);
            margin: 0 0 1rem 0;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--border-color);
        }

        .search-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .search-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            align-items: end;
        }

        .search-group {
            display: flex;
            flex-direction: column;
        }

        .search-group label {
            margin-bottom: 0.25rem;
            font-size: 0.75rem;
            color: var(--text-color);
            font-weight: 500;
        }

        .form-control {
            padding: 0.5rem;
            font-size: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            transition: var(--transition);
            background-color: var(--bg-card);
            height: 2rem;
        }

        .form-control:focus {
            border-color: var(--primary-color);
            outline: 0;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        .search-actions {
            display: flex;
            gap: 0.75rem;
            justify-content: space-between;
            align-items: center;
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            border-top: 1px solid var(--border-color);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem 1rem;
            font-size: 0.75rem;
            font-weight: 500;
            border-radius: var(--radius);
            border: none;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            height: 2rem;
        }

        .btn-search {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-search:hover {
            background-color: var(--secondary-color);
            transform: translateY(-1px);
            color: white;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
            border: none;
        }

        .btn-primary:hover {
            background-color: var(--secondary-color);
            transform: translateY(-1px);
            color: white;
        }
        
        .btn-success {
            background-color: var(--success-color);
            color: white;
            border: none;
        }

        .btn-success:hover {
            background-color: #2ea043;
            transform: translateY(-1px);
            color: white;
        }
        
        .btn-success:disabled {
            background-color: #6c757d;
            color: white;
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-warning {
            background-color: #ffc107;
            color: #212529;
            border: none;
        }

        .btn-warning:hover {
            background-color: #e0a800;
            transform: translateY(-1px);
            color: #212529;
        }
        
        .btn-warning:disabled {
            background-color: #6c757d;
            color: white;
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-secondary {
            background-color: #6c757d;
            color: white;
            border: none;
        }

        .btn-secondary:hover {
            background-color: #5a6268;
            transform: translateY(-1px);
            color: white;
        }
        
        /* X ì•„ì´ì½˜ CSS ìŠ¤íƒ€ì¼ */
        .btn-clear-date {
            background: none;
            border: none;
            color: #dc3545;
            cursor: pointer;
            padding: 0.25rem;
            font-size: 0.8rem;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        
        .btn-clear-date:hover {
            background-color: #dc3545;
            color: white;
            transform: scale(1.1);
        }
        
        .btn-clear-date:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .btn-reset {
            background-color: var(--bg-color);
            color: var(--text-color);
            border: 1px solid var(--border-color);
        }

        .btn-reset:hover {
            background-color: var(--border-color);
            transform: translateY(-1px);
        }

        .btn-info {
            background-color: var(--info-color);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .btn-info:hover {
            background-color: #3654e6;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(74, 111, 255, 0.3);
        }

        /* í…Œì´ë¸” ì»¨í…Œì´ë„ˆ - ë” ê¹”ë”í•œ ë””ìì¸ */
        .table-container {
            background-color: var(--bg-card);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            overflow: hidden;
            border: 1px solid var(--border-color);
        }

        .table-header {
            padding: 1.5rem 2rem;
            background-color: var(--bg-color);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-header h3 {
            font-size: 1.125rem;
            font-weight: 600;
            margin: 0;
            color: var(--dark-color);
        }

        .table-meta {
            font-size: 0.875rem;
            color: var(--text-muted);
        }

        .table-wrapper {
            overflow-x: auto;
            width: 100%;
        }

        .data-table {
            width: 100%;
            min-width: 2200px;
            border-collapse: separate;
            border-spacing: 0;
            font-size: 0.9rem;
        }

        .data-table th {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-weight: 600;
            text-align: center;
            padding: 1rem 0.75rem;
            border-bottom: 2px solid var(--border-color);
            vertical-align: middle;
            font-size: 0.85rem;
            white-space: nowrap;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        


        .data-table td {
            padding: 1rem 0.75rem;
            border-bottom: 1px solid var(--border-color);
            vertical-align: middle;
            font-size: 0.9rem;
            white-space: nowrap;
            text-align: center;
        }
        


        /* ğŸ¯ ê³ ì • ì»¬ëŸ¼ ìŠ¤íƒ€ì¼ - ê³ ê°ëª…ê¹Œì§€ ê³ ì • */
        .data-table th.fixed-column,
        .data-table td.fixed-column {
            position: sticky;
            z-index: 15;
            background-color: var(--bg-card);
            border-right: 2px solid var(--border-color);
            box-shadow: 2px 0 4px rgba(0, 0, 0, 0.1);
        }

        .data-table th.fixed-column {
            background-color: var(--bg-color);
            z-index: 20;
        }

        /* ê° ê³ ì • ì»¬ëŸ¼ì˜ left ìœ„ì¹˜ ì„¤ì • */
        .data-table th.fixed-column-1,
        .data-table td.fixed-column-1 {
            left: 0;
        }

        .data-table th.fixed-column-2,
        .data-table td.fixed-column-2 {
            left: 35px;
        }

        .data-table th.fixed-column-3,
        .data-table td.fixed-column-3 {
            left: 85px;
        }

        .data-table th.fixed-column-4,
        .data-table td.fixed-column-4 {
            left: 145px;
        }

        .data-table th.fixed-column-5,
        .data-table td.fixed-column-5 {
            left: 205px;
        }

        .data-table th.fixed-column-6,
        .data-table td.fixed-column-6 {
            left: 285px;
        }

        .data-table th.fixed-column-7,
        .data-table td.fixed-column-7 {
            left: 385px;
        }

        /* ë§ˆì§€ë§‰ ê³ ì • ì»¬ëŸ¼ (ê³ ê°ëª…)ì€ ê²½ê³„ì„  ê°•ì¡° */
        .data-table th.fixed-column-7,
        .data-table td.fixed-column-7 {
            border-right: 3px solid var(--primary-color);
            box-shadow: 3px 0 6px rgba(67, 97, 238, 0.2);
        }

        /* í˜¸ë²„ íš¨ê³¼ ì‹œ ê³ ì • ì»¬ëŸ¼ ë°°ê²½ ìœ ì§€ */
        .data-table tbody tr:hover .fixed-column {
            background-color: var(--bg-card);
        }

        /* ì¤‘ìš” ì •ë³´ ê°•ì¡° */
        .data-table .important-info {
            font-weight: 600;
            color: var(--dark-color);
        }

        .data-table .money-info {
            font-weight: 600;
            color: var(--success-color);
            text-align: right;
        }

        .data-table .contact-info {
            font-weight: 500;
            color: var(--primary-color);
        }

        .data-table .order-info {
            font-weight: 500;
            color: var(--info-color);
        }

        /* í…ìŠ¤íŠ¸ ì •ë ¬ */
        .data-table .text-left {
            text-align: left;
        }

        .data-table .text-right {
            text-align: right;
        }

        .data-table .text-center {
            text-align: center;
        }

        .data-table tbody tr {
            transition: var(--transition);
        }

        .data-table tbody tr:hover {
            background-color: var(--primary-light);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(67, 97, 238, 0.15);
        }
        
        /* ì™„ë£Œëœ í•­ëª© ìŠ¤íƒ€ì¼ - ë” ëšœë ·í•˜ê²Œ */
        .data-table tbody tr.completed {
            background-color: #d4edda !important; /* ì—°í•œ ì´ˆë¡ìƒ‰ ë°°ê²½ */
            border-left: 4px solid #28a745 !important; /* ì™¼ìª½ ì´ˆë¡ìƒ‰ í…Œë‘ë¦¬ */
            opacity: 0.9;
        }
        
        .data-table tbody tr.completed:hover {
            background-color: #c3e6cb !important; /* í˜¸ë²„ ì‹œ ì¢€ ë” ì§„í•œ ì´ˆë¡ìƒ‰ */
            opacity: 1;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);
        }
        
        /* ì™„ë£Œëœ í•­ëª©ì˜ ê³ ì • ì»¬ëŸ¼ ë°°ê²½ìƒ‰ë„ ë™ì¼í•˜ê²Œ */
        .data-table tbody tr.completed .fixed-column {
            background-color: #d4edda !important;
        }
        
        .data-table tbody tr.completed:hover .fixed-column {
            background-color: #c3e6cb !important;
        }
        
        /* ì™„ë£Œ ìƒíƒœ ë³€ê²½ëœ í•­ëª© ìŠ¤íƒ€ì¼ */
        .data-table tbody tr.completion-changed {
            border-left: 4px solid #ffc107;
        }

        .data-table .no-data {
            text-align: center;
            color: var(--text-muted);
            padding: 3rem 0;
            font-style: italic;
        }

        /* ìƒíƒœ ë°°ì§€ - ë” í˜„ëŒ€ì ì¸ ë””ìì¸ */
        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.375rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            line-height: 1.2;
            text-transform: uppercase;
            letter-spacing: 0.025em;
            min-width: 60px;
            justify-content: center;
        }

        .status-badge.pending {
            background-color: rgba(247, 37, 133, 0.1);
            color: var(--warning-color);
        }

        .status-badge.in_progress {
            background-color: rgba(67, 97, 238, 0.1);
            color: var(--primary-color);
        }

        .status-badge.completed {
            background-color: rgba(53, 178, 127, 0.1);
            color: var(--success-color);
        }

        .status-badge.cancelled {
            background-color: rgba(255, 77, 109, 0.1);
            color: var(--danger-color);
        }

        /* ìœ í˜•ë³„ ë°°ì§€ ìŠ¤íƒ€ì¼ */
        .type-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.375rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            line-height: 1.2;
            text-transform: uppercase;
            letter-spacing: 0.025em;
            min-width: 70px;
            justify-content: center;
        }

        /* ì „ì²´ë°˜í’ˆ - ë¹¨ê°„ìƒ‰ */
        .type-badge.full-return {
            background-color: rgba(220, 53, 69, 0.15);
            color: #dc3545;
            border: 1px solid rgba(220, 53, 69, 0.3);
        }

        /* ë¶€ë¶„ë°˜í’ˆ - ì£¼í™©ìƒ‰ */
        .type-badge.partial-return {
            background-color: rgba(255, 193, 7, 0.15);
            color: #fd7e14;
            border: 1px solid rgba(255, 193, 7, 0.3);
        }

        /* ì „ì²´êµí™˜ - íŒŒë€ìƒ‰ */
        .type-badge.full-exchange {
            background-color: rgba(13, 110, 253, 0.15);
            color: #0d6efd;
            border: 1px solid rgba(13, 110, 253, 0.3);
        }

        /* ë¶€ë¶„êµí™˜ - ë³´ë¼ìƒ‰ */
        .type-badge.partial-exchange {
            background-color: rgba(111, 66, 193, 0.15);
            color: #6f42c1;
            border: 1px solid rgba(111, 66, 193, 0.3);
        }

        /* ì¼ë°˜êµí™˜ - ì´ˆë¡ìƒ‰ */
        .type-badge.exchange {
            background-color: rgba(25, 135, 84, 0.15);
            color: #198754;
            border: 1px solid rgba(25, 135, 84, 0.3);
        }

        /* ìœ í˜• ë°°ì§€ í˜¸ë²„ íš¨ê³¼ */
        .type-badge:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            transition: all 0.2s ease;
        }

        .type-badge.full-return:hover {
            background-color: rgba(220, 53, 69, 0.25);
            border-color: rgba(220, 53, 69, 0.5);
        }

        .type-badge.partial-return:hover {
            background-color: rgba(255, 193, 7, 0.25);
            border-color: rgba(255, 193, 7, 0.5);
        }

        .type-badge.full-exchange:hover {
            background-color: rgba(13, 110, 253, 0.25);
            border-color: rgba(13, 110, 253, 0.5);
        }

        .type-badge.partial-exchange:hover {
            background-color: rgba(111, 66, 193, 0.25);
            border-color: rgba(111, 66, 193, 0.5);
        }

        .type-badge.exchange:hover {
            background-color: rgba(25, 135, 84, 0.25);
            border-color: rgba(25, 135, 84, 0.5);
        }

        /* ì²´í¬ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
        .data-table input[type="checkbox"] {
            width: 1.125rem;
            height: 1.125rem;
            border-radius: 0.25rem;
            border: 2px solid var(--border-color);
            cursor: pointer;
            position: relative;
            transition: all 0.2s ease;
            accent-color: var(--primary-color);
        }

        .data-table input[type="checkbox"]:checked {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            transform: scale(1.05);
        }

        .data-table input[type="checkbox"]:hover {
            border-color: var(--primary-color);
            box-shadow: 0 2px 4px rgba(67, 97, 238, 0.2);
        }

        /* í—¤ë” ì²´í¬ë°•ìŠ¤ íŠ¹ë³„ ìŠ¤íƒ€ì¼ */
        #selectAll {
            width: 1.25rem !important;
            height: 1.25rem !important;
            cursor: pointer;
            accent-color: var(--primary-color);
            border-radius: 0.375rem;
            transition: all 0.2s ease;
            border: 2px solid var(--border-color);
        }

        #selectAll:hover {
            transform: scale(1.1);
            border-color: var(--primary-color);
            box-shadow: 0 2px 6px rgba(67, 97, 238, 0.3);
        }

        #selectAll:indeterminate {
            background-color: var(--warning-color);
            accent-color: var(--warning-color);
            border-color: var(--warning-color);
        }

        /* ì„ íƒ ì¹´ìš´í„° ì• ë‹ˆë©”ì´ì…˜ */
        .selection-counter {
            animation: slideInDown 0.3s ease-out;
        }

        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ì•¡ì…˜ ë§í¬ */
        .action-link {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius-sm);
            transition: var(--transition);
        }

        .action-link:hover {
            background-color: var(--primary-light);
            color: var(--primary-color);
        }

        .action-link.danger {
            color: var(--danger-color);
        }

        .action-link.danger:hover {
            background-color: rgba(255, 77, 109, 0.1);
            color: var(--danger-color);
        }

        /* í˜ì´ì§€ë„¤ì´ì…˜ */
        .pagination-container {
            display: flex;
            justify-content: center;
            margin-top: 2rem;
        }

        .pagination {
            display: flex;
            list-style: none;
            padding: 0;
            margin: 0;
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }

        .page-link {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem 0.75rem;
            background-color: var(--bg-card);
            color: var(--text-color);
            text-decoration: none;
            border: 1px solid var(--border-color);
            border-right: none;
            min-width: 32px;
            transition: var(--transition);
            font-size: 0.75rem;
        }

        .pagination li:last-child .page-link {
            border-right: 1px solid var(--border-color);
        }

        .page-link.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            font-weight: 600;
        }

        .page-link:hover:not(.active) {
            background-color: var(--bg-color);
        }

        /* ì•¡ì…˜ ë§í¬ ìŠ¤íƒ€ì¼ */
        .action-link {
            font-size: 0.7rem;
            color: var(--primary-color);
            text-decoration: none;
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius-sm);
            transition: var(--transition);
            font-weight: 500;
            display: inline-block;
            margin: 0 0.1rem;
        }

        .action-link:hover {
            background-color: var(--primary-light);
            color: var(--primary-color);
            transform: translateY(-1px);
        }

        .action-link.danger {
            color: var(--danger-color);
        }

        .action-link.danger:hover {
            background-color: rgba(255, 77, 109, 0.1);
            color: var(--danger-color);
            transform: translateY(-1px);
        }

        /* ì‹¬í”Œ í†µê³„ ìŠ¤íƒ€ì¼ - CSS Only Toggle */
        .simple-stats {
            background: white;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        /* ì²´í¬ë°•ìŠ¤ ìˆ¨ê¸°ê¸° */
        .stats-toggle {
            display: none;
        }
        
        /* í—¤ë” ìŠ¤íƒ€ì¼ */
        .stats-header {
            margin: 0;
            color: #333;
            font-size: 1.1rem;
            font-weight: 600;
            padding: 1.5rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-bottom: 1px solid #dee2e6;
            transition: background-color 0.2s ease;
            user-select: none;
        }
        
        .stats-header:hover {
            background: linear-gradient(135deg, #e9ecef, #dee2e6);
        }
        
        /* í™”ì‚´í‘œ ì•„ì´ì½˜ */
        .stats-header::after {
            content: 'â–¼';
            font-size: 0.8rem;
            color: #666;
            transition: transform 0.3s ease;
        }
        
        /* ì²´í¬ë°•ìŠ¤ê°€ ì²´í¬ë˜ì§€ ì•Šì•˜ì„ ë•Œ (ì ‘íŒ ìƒíƒœ) */
        .stats-toggle:not(:checked) + .stats-header::after {
            transform: rotate(-90deg);
        }
        
        /* ì½˜í…ì¸  ê¸°ë³¸ ìƒíƒœ (í¼ì³ì§„ ìƒíƒœ) */
        .stats-content {
            padding: 1.5rem;
            transition: all 0.3s ease;
            max-height: 1000px;
            opacity: 1;
            overflow: visible;
        }
        
        /* ì²´í¬ë°•ìŠ¤ê°€ ì²´í¬ë˜ì§€ ì•Šì•˜ì„ ë•Œ ì½˜í…ì¸  ìˆ¨ê¸°ê¸° (ì ‘íŒ ìƒíƒœ) */
        .stats-toggle:not(:checked) ~ .stats-content {
            max-height: 0;
            padding: 0 1.5rem;
            opacity: 0;
            overflow: hidden;
        }
        
        .stats-row {
            display: flex;
            gap: 2rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }
        
        .stats-group {
            flex: 1;
            min-width: 200px;
        }
        
        .stats-group h4 {
            margin: 0 0 0.5rem 0;
            color: #666;
            font-size: 0.9rem;
            font-weight: 500;
            border-bottom: 1px solid #eee;
            padding-bottom: 0.3rem;
        }
        
        .stats-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .stats-list li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.3rem 0;
            border-bottom: 1px solid #f8f9fa;
        }
        
        .stats-list li:last-child {
            border-bottom: none;
        }
        
        .stats-label {
            color: #666;
            font-size: 0.85rem;
        }
        
        .stats-value {
            font-weight: 600;
            color: #333;
            font-size: 0.9rem;
        }
        
        .stats-value.primary {
            color: #0d6efd;
        }
        
        .stats-value.success {
            color: #198754;
        }
        
        .stats-value.warning {
            color: #fd7e14;
        }
        
        .stats-value.danger {
            color: #dc3545;
        }

        /* ğŸ¯ ëŒ€í‘œë‹˜ ìš”ì²­: ë‚ ì§œ ì…ë ¥ í•„ë“œ ìŠ¤íƒ€ì¼ */
        .date-input {
            width: 110px !important;
            font-size: 0.7rem !important;
            padding: 0.25rem !important;
            border: 1px solid var(--border-color) !important;
            border-radius: 0.25rem !important;
            transition: all 0.2s ease !important;
            background-color: white !important;
        }
        
        .date-input:focus {
            border-color: var(--primary-color) !important;
            box-shadow: 0 0 0 2px rgba(67, 97, 238, 0.2) !important;
            outline: none !important;
        }
        
        .date-input:hover {
            border-color: var(--primary-color) !important;
        }
        
        /* ë³€ê²½ëœ í–‰ ìŠ¤íƒ€ì¼ */
        .date-changed {
            background-color: #fff3cd !important;
            border-left: 3px solid #ffc107 !important;
            transition: all 0.3s ease !important;
        }
        
        .date-changed .date-input {
            background-color: #fffbf0 !important;
            border-color: #ffc107 !important;
        }
        
        /* ì €ì¥ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn-success:disabled {
            background-color: #6c757d !important;
            border-color: #6c757d !important;
            cursor: not-allowed !important;
            opacity: 0.6 !important;
        }
        
        .btn-success:not(:disabled):hover {
            background-color: #218838 !important;
            border-color: #1e7e34 !important;
            transform: translateY(-1px) !important;
        }
        
        /* ë²„íŠ¼ í…ìŠ¤íŠ¸ ê¹¨ì§ ë°©ì§€ */
        #bulkSaveBtn, #bulkCompleteBtn {
            min-width: 160px !important;
            white-space: nowrap !important;
            font-size: 0.85rem !important;
            padding: 0.5rem 0.75rem !important;
            display: inline-flex !important;
            align-items: center !important;
            justify-content: center !important;
        }
        
        .btn-warning:disabled {
            background-color: #6c757d !important;
            border-color: #6c757d !important;
            cursor: not-allowed !important;
            opacity: 0.6 !important;
        }
        
        .btn-warning:not(:disabled):hover {
            background-color: #e0a800 !important;
            border-color: #d39e00 !important;
            transform: translateY(-1px) !important;
        }

        /* ğŸ¯ ì£¼ë¬¸ë²ˆí˜¸ ë³µì‚¬ ê¸°ëŠ¥ ìŠ¤íƒ€ì¼ */
        .order-number-copy {
            cursor: pointer !important;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            transition: all 0.2s ease;
            display: inline-block;
            font-weight: 600;
            color: var(--info-color);
            border: 1px solid transparent;
            background-color: rgba(74, 111, 255, 0.1);
        }
        
        .order-number-copy:hover {
            background-color: var(--info-color);
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(74, 111, 255, 0.3);
            border-color: var(--info-color);
        }
        
        .order-number-copy:active {
            transform: translateY(0);
            box-shadow: 0 1px 4px rgba(74, 111, 255, 0.4);
        }
        
        /* í† ìŠ¤íŠ¸ ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes slideOutRight {
            from {
                opacity: 1;
                transform: translateX(0);
            }
            to {
                opacity: 0;
                transform: translateX(100%);
            }
        }
        
        /* ë³µì‚¬ ì™„ë£Œ íš¨ê³¼ */
        .order-number-copy.copying {
            animation: pulse 0.6s ease-in-out;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        /* ğŸ¯ ê³ ê°ëª… ë³µì‚¬ ê¸°ëŠ¥ ìŠ¤íƒ€ì¼ */
        .customer-name-copy {
            cursor: pointer !important;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            transition: all 0.2s ease;
            display: inline-block;
            font-weight: 600;
            color: var(--dark-color);
            border: 1px solid transparent;
            background-color: rgba(45, 55, 72, 0.1);
        }
        
        .customer-name-copy:hover {
            background-color: var(--dark-color);
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(45, 55, 72, 0.3);
            border-color: var(--dark-color);
        }
        
        .customer-name-copy:active {
            transform: translateY(0);
            box-shadow: 0 1px 4px rgba(45, 55, 72, 0.4);
        }
        
        /* ğŸ¯ ì—°ë½ì²˜ ë³µì‚¬ ê¸°ëŠ¥ ìŠ¤íƒ€ì¼ */
        .customer-phone-copy {
            cursor: pointer !important;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            transition: all 0.2s ease;
            display: inline-block;
            font-weight: 600;
            color: var(--primary-color);
            border: 1px solid transparent;
            background-color: rgba(67, 97, 238, 0.1);
        }
        
        .customer-phone-copy:hover {
            background-color: var(--primary-color);
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(67, 97, 238, 0.3);
            border-color: var(--primary-color);
        }
        
        .customer-phone-copy:active {
            transform: translateY(0);
            box-shadow: 0 1px 4px rgba(67, 97, 238, 0.4);
        }
        
        /* ğŸ¯ ì£¼ë¬¸í’ˆë²ˆ ë³µì‚¬ ê¸°ëŠ¥ ìŠ¤íƒ€ì¼ */
        .order-item-code-copy {
            cursor: pointer !important;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            transition: all 0.2s ease;
            display: inline-block;
            font-weight: 600;
            color: var(--info-color);
            border: 1px solid transparent;
            background-color: rgba(74, 111, 255, 0.1);
        }
        
        .order-item-code-copy:hover {
            background-color: var(--info-color);
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(74, 111, 255, 0.3);
            border-color: var(--info-color);
        }
        
        .order-item-code-copy:active {
            transform: translateY(0);
            box-shadow: 0 1px 4px rgba(74, 111, 255, 0.4);
        }
        
        /* ğŸ¯ ìš´ì†¡ì¥ë²ˆí˜¸ ë³µì‚¬ ê¸°ëŠ¥ ìŠ¤íƒ€ì¼ */
        .tracking-number-copy {
            cursor: pointer !important;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            transition: all 0.2s ease;
            display: inline-block;
            font-weight: 600;
            color: var(--success-color);
            border: 1px solid transparent;
            background-color: rgba(53, 178, 127, 0.1);
        }
        
        .tracking-number-copy:hover {
            background-color: var(--success-color);
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(53, 178, 127, 0.3);
            border-color: var(--success-color);
        }
        
        .tracking-number-copy:active {
            transform: translateY(0);
            box-shadow: 0 1px 4px rgba(53, 178, 127, 0.4);
        }

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .page-container {
                padding: 0.5rem;
            }
            
            .search-row {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .search-actions {
                flex-direction: column;
                align-items: stretch;
                gap: 0.75rem;
            }
            
            .data-table {
                font-size: 0.8rem;
                min-width: 2400px;
            }
            
            .data-table th,
            .data-table td {
                padding: 0.4rem 0.3rem;
                font-size: 0.85rem;
            }
            
            .action-link {
                font-size: 0.7rem;
                padding: 0.15rem 0.25rem;
                margin: 0 0.03rem;
            }
            
            .stats-row {
                flex-direction: column;
                gap: 1rem;
            }
            
            .stats-group {
                min-width: auto;
            }
            
            /* ëª¨ë°”ì¼ì—ì„œ ê²€ìƒ‰ ê·¸ë£¹ ìŠ¤íƒ€ì¼ */
            .search-group {
                flex: 1 1 100%;
            }
            
            /* ëª¨ë°”ì¼ì—ì„œ ë³µì‚¬ ë²„íŠ¼ í¬ê¸° ì¡°ì • */
            .order-number-copy,
            .customer-name-copy,
            .customer-phone-copy,
            .order-item-code-copy,
            .tracking-number-copy {
                padding: 0.2rem 0.4rem;
                font-size: 0.75rem;
                min-width: 80px;
                text-align: center;
            }
        }

        .button-group {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            flex-wrap: wrap;
        }
        .button-group .btn {
            min-width: 120px;
            white-space: nowrap;
            font-size: 0.85rem;
            padding: 0.5rem 0.75rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        /* ë°˜ì‘í˜•: í™”ë©´ì´ ì‘ì„ ë•Œ ë²„íŠ¼ í¬ê¸° ì¡°ì • */
        @media (max-width: 1200px) {
            .button-group .btn {
                min-width: 100px;
                font-size: 0.8rem;
                padding: 0.4rem 0.6rem;
            }
        }
        
        @media (max-width: 992px) {
            .button-group {
                flex-direction: column;
                align-items: stretch;
                gap: 0.3rem;
            }
            .button-group .btn {
                min-width: auto;
                width: 100%;
                font-size: 0.85rem;
                padding: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <div layout:fragment="content">
        <div class="page-container">
            <div class="header">
                <h2>êµí™˜/ë°˜í’ˆ ëª©ë¡</h2>
            </div>

            <!-- ğŸ¯ ìƒë‹¨ ì¹´ë“œ ëŒ€ì‹œë³´ë“œ -->
            <div class="dashboard">
                <!-- â‘  íšŒìˆ˜ì™„ë£Œ ì¹´ë“œ -->
                <div class="stat-box success" data-card="collection">
                    <div class="card-content">
                        <h3>ğŸ“¦ íšŒìˆ˜ì™„ë£Œ</h3>
                        <div class="value clickable">
                            <span class="filter-link" data-filter="collection-completed" th:text="${cardStats.collectionCompleted}">0</span>
                            <span> / </span>
                            <span class="filter-link" data-filter="collection-pending" th:text="${cardStats.collectionPending}">0</span>
                        </div>
                        <div class="description">ì™„ë£Œ / ë¯¸ì™„ë£Œ</div>
                    </div>
                </div>
                
                <!-- â‘¡ ë¬¼ë¥˜í™•ì¸ ì¹´ë“œ -->
                <div class="stat-box primary" data-card="logistics">
                    <div class="card-content">
                        <h3>ğŸš› ë¬¼ë¥˜í™•ì¸</h3>
                        <div class="value clickable">
                            <span class="filter-link" data-filter="logistics-confirmed" th:text="${cardStats.logisticsConfirmed}">0</span>
                            <span> / </span>
                            <span class="filter-link" data-filter="logistics-pending" th:text="${cardStats.logisticsPending}">0</span>
                        </div>
                        <div class="description">í™•ì¸ / ë¯¸í™•ì¸</div>
                    </div>
                </div>
                
                <!-- â‘¢ êµí™˜ ì¶œê³ ì¼ì ì¹´ë“œ -->
                <div class="stat-box warning" data-card="exchange">
                    <div class="card-content">
                        <h3>ğŸ“¤ êµí™˜ ì¶œê³ </h3>
                        <div class="value clickable">
                            <span class="filter-link" data-filter="shipping-completed" th:text="${cardStats.exchangeShipped}">0</span>
                            <span> / </span>
                            <span class="filter-link" data-filter="shipping-pending" th:text="${cardStats.exchangeNotShipped}">0</span>
                        </div>
                        <div class="description">ì¶œê³ ì™„ë£Œ / ì¶œê³ ëŒ€ê¸°</div>
                    </div>
                </div>
                
                <!-- â‘£ ë°˜í’ˆ í™˜ë¶ˆì¼ì ì¹´ë“œ (ë°˜í’ˆë§Œ) -->
                <div class="stat-box danger" data-card="return">
                    <div class="card-content">
                        <h3>ğŸ’° ë°˜í’ˆ í™˜ë¶ˆ</h3>
                        <div class="value clickable">
                            <span class="filter-link" data-filter="refund-completed" th:text="${cardStats.returnRefunded}">0</span>
                            <span> / </span>
                            <span class="filter-link" data-filter="refund-pending" th:text="${cardStats.returnNotRefunded}">0</span>
                        </div>
                        <div class="description">í™˜ë¶ˆì™„ë£Œ / í™˜ë¶ˆëŒ€ê¸°</div>
                    </div>
                </div>
                
                <!-- â‘¤ ë°°ì†¡ë¹„ì…ê¸ˆ ì¹´ë“œ (êµí™˜ë§Œ) -->
                <div class="stat-box warning" data-card="payment">
                    <div class="card-content">
                        <h3>ğŸ’³ ë°°ì†¡ë¹„ì…ê¸ˆ</h3>
                        <div class="value clickable">
                            <span class="filter-link" data-filter="payment-pending" th:text="${cardStats.paymentPending}">0</span>
                            <span> / </span>
                            <span class="filter-link" data-filter="payment-completed" th:text="${cardStats.paymentCompleted}">0</span>
                        </div>
                        <div class="description">ì…ê¸ˆì˜ˆì • / ì…ê¸ˆì™„ë£Œ</div>
                    </div>
                </div>
                
                <!-- â‘¥ ì „ì²´ì™„ë£Œ ì¹´ë“œ -->
                <div class="stat-box info" data-card="completion">
                    <div class="card-content">
                        <h3>âœ… ì „ì²´ì™„ë£Œ</h3>
                        <div class="value clickable">
                            <span class="filter-link" data-filter="completed" th:text="${cardStats.completedCount}">0</span>
                            <span> / </span>
                            <span class="filter-link" data-filter="incompleted" th:text="${cardStats.incompletedCount}">0</span>
                        </div>
                        <div class="description">ì™„ë£Œ / ë¯¸ì™„ë£Œ</div>
                    </div>
                </div>
                
                <!-- â‘¦ ì²˜ë¦¬ê¸°ê°„ ì„ë°• ì¹´ë“œ -->
                <div class="stat-box urgent" data-card="overdue">
                    <div class="card-content">
                        <h3>âš ï¸ ì²˜ë¦¬ê¸°ê°„ ì„ë°•</h3>
                        <div class="value clickable">
                            <span class="filter-link" data-filter="overdue-ten-days" th:text="${cardStats.overdueTenDaysCount}">0</span>
                        </div>
                        <div class="description">10ì¼ì´ìƒ ë¯¸ì™„ë£Œ</div>
                    </div>
                </div>
            </div>
            
            <!-- í•„í„° ìƒíƒœ í‘œì‹œ -->
            <div id="filterStatus" class="filter-status" style="display: none;">
                <span class="filter-text"></span>
                <button class="clear-filter" id="clearFilterBtn">âœ• í•„í„° í•´ì œ</button>
            </div>
            
            <!-- í†µê³„ ìš”ì•½ -->
            <div class="simple-stats">
                <input type="checkbox" id="statsToggle" class="stats-toggle">
                <label for="statsToggle" class="stats-header">ğŸ“Š í˜„í™© ìš”ì•½</label>
                <div class="stats-content">
                    <div class="stats-row">
                    <!-- ì²˜ë¦¬ ìƒíƒœ -->
                    <div class="stats-group">
                        <h4>ì²˜ë¦¬ ìƒíƒœ</h4>
                        <ul class="stats-list">
                            <li>
                                <span class="stats-label">ì „ì²´ ê±´ìˆ˜</span>
                                <span class="stats-value primary" th:text="${totalItems != null ? totalItems : 0}">8</span>
                            </li>
                            <li>
                                <span class="stats-label">ì ‘ìˆ˜ëŒ€ê¸°</span>
                                <span class="stats-value warning" th:text="${statusCounts['PENDING'] != null ? statusCounts['PENDING'] : 0}">0</span>
                            </li>
                            <li>
                                <span class="stats-label">ì²˜ë¦¬ì¤‘</span>
                                <span class="stats-value" th:text="${statusCounts['PROCESSING'] != null ? statusCounts['PROCESSING'] : 0}">0</span>
                            </li>
                            <li>
                                <span class="stats-label">ë°°ì†¡ì¤‘</span>
                                <span class="stats-value" th:text="${statusCounts['SHIPPING'] != null ? statusCounts['SHIPPING'] : 0}">0</span>
                            </li>
                            <li>
                                <span class="stats-label">ì™„ë£Œ</span>
                                <span class="stats-value success" th:text="${statusCounts['COMPLETED'] != null ? statusCounts['COMPLETED'] : 0}">0</span>
                            </li>
                        </ul>
                    </div>

                    <!-- ìœ í˜•ë³„ í˜„í™© -->
                    <div class="stats-group">
                        <h4>ìœ í˜•ë³„ í˜„í™©</h4>
                        <ul class="stats-list">
                            <li>
                                <span class="stats-label">ì „ì²´ë°˜í’ˆ</span>
                                <span class="stats-value danger" th:text="${typeCounts['FULL_RETURN'] != null ? typeCounts['FULL_RETURN'] : 0}">0</span>
                            </li>
                            <li>
                                <span class="stats-label">ë¶€ë¶„ë°˜í’ˆ</span>
                                <span class="stats-value warning" th:text="${typeCounts['PARTIAL_RETURN'] != null ? typeCounts['PARTIAL_RETURN'] : 0}">0</span>
                            </li>
                            <li>
                                <span class="stats-label">ì „ì²´êµí™˜</span>
                                <span class="stats-value primary" th:text="${typeCounts['FULL_EXCHANGE'] != null ? typeCounts['FULL_EXCHANGE'] : 0}">0</span>
                            </li>
                            <li>
                                <span class="stats-label">ë¶€ë¶„êµí™˜</span>
                                <span class="stats-value" th:text="${typeCounts['PARTIAL_EXCHANGE'] != null ? typeCounts['PARTIAL_EXCHANGE'] : 0}">0</span>
                            </li>
                            <li>
                                <span class="stats-label">ì¼ë°˜êµí™˜</span>
                                <span class="stats-value success" th:text="${typeCounts['EXCHANGE'] != null ? typeCounts['EXCHANGE'] : 0}">0</span>
                            </li>
                        </ul>
                    </div>

                                         <!-- ê¸ˆì•¡ í˜„í™© -->
                     <div class="stats-group">
                         <h4>ê¸ˆì•¡ í˜„í™©</h4>
                         <ul class="stats-list">
                             <li>
                                 <span class="stats-label">ì´ í™˜ë¶ˆê¸ˆì•¡</span>
                                 <span class="stats-value primary" th:text="${amountSummary['totalRefundAmount'] != null ? #numbers.formatInteger(amountSummary['totalRefundAmount'], 0, 'COMMA') + 'ì›' : '0ì›'}">0ì›</span>
                             </li>
                             <li>
                                 <span class="stats-label">ë°°ì†¡ë¹„ í•©ê³„</span>
                                 <span class="stats-value warning" th:text="${amountSummary['totalShippingFee'] != null ? #numbers.formatInteger(amountSummary['totalShippingFee'], 0, 'COMMA') + 'ì›' : '0ì›'}">0ì›</span>
                             </li>
                             <li>
                                 <span class="stats-label">ê¸ˆì¼ ë“±ë¡</span>
                                 <span class="stats-value success" th:text="${todayCount != null ? todayCount + 'ê±´' : '0ê±´'}">0ê±´</span>
                             </li>
                         </ul>
                     </div>
                </div>

                <!-- ë‘ ë²ˆì§¸ í–‰ -->
                <div class="stats-row" th:if="${(reasonCounts != null and !reasonCounts.isEmpty()) or (siteCounts != null and !siteCounts.isEmpty()) or (brandCounts != null and !brandCounts.isEmpty())}">
                    <!-- ì£¼ìš” ì‚¬ìœ  -->
                    <div class="stats-group" th:if="${reasonCounts != null and !reasonCounts.isEmpty()}">
                        <h4>ì£¼ìš” ì‚¬ìœ </h4>
                        <ul class="stats-list">
                            <li th:each="reasonKey : ${reasonCounts.keySet()}">
                                <span class="stats-label" th:text="${reasonKey}">ê³ ê°ë³€ì‹¬</span>
                                <span class="stats-value" th:text="${reasonCounts.get(reasonKey)}">4</span>
                            </li>
                        </ul>
                    </div>

                    <!-- ì£¼ìš” ì‚¬ì´íŠ¸ -->
                    <div class="stats-group" th:if="${siteCounts != null and !siteCounts.isEmpty()}">
                        <h4>ì£¼ìš” ì‚¬ì´íŠ¸</h4>
                        <ul class="stats-list">
                            <li th:each="siteKey : ${siteCounts.keySet()}">
                                <span class="stats-label" th:text="${siteKey}">ìì‚¬ëª°-ë ˆë…¸ë§ˆ</span>
                                <span class="stats-value" th:text="${siteCounts.get(siteKey)}">4</span>
                            </li>
                        </ul>
                    </div>

                                         <!-- ë¸Œëœë“œë³„ í˜„í™© -->
                     <div class="stats-group" th:if="${brandCounts != null and !brandCounts.isEmpty()}">
                         <h4>ë¸Œëœë“œë³„ í˜„í™©</h4>
                         <ul class="stats-list">
                             <li>
                                 <span class="stats-label">ë ˆë…¸ë§ˆ</span>
                                 <span class="stats-value primary" th:text="${brandCounts['ë ˆë…¸ë§ˆ'] != null ? brandCounts['ë ˆë…¸ë§ˆ'] : 0}">0</span>
                             </li>
                             <li>
                                 <span class="stats-label">ì½”ë„ë¦¬í¬</span>
                                 <span class="stats-value success" th:text="${brandCounts['ì½”ë„ë¦¬í¬'] != null ? brandCounts['ì½”ë„ë¦¬í¬'] : 0}">0</span>
                             </li>
                         </ul>
                     </div>
                </div>
                </div>
            </div>
            
            <!-- í†µí•© ê²€ìƒ‰ -->
            <div class="search-container">
                <h3 class="search-title">ğŸ” í†µí•© ê²€ìƒ‰</h3>
                                        <form id="searchForm" action="/exchange/list" method="get" class="search-form" th:object="${searchDTO}" onsubmit="return handleSearchSubmit(event)">
                    <!-- ğŸ¯ í˜„ì¬ í™œì„± í•„í„°ë¥¼ ìœ„í•œ hidden input -->
                    <input type="hidden" id="filtersInput" name="filters" th:value="${currentFilter}">
                    
                    <div class="search-row">
                        <div class="search-group" style="flex: 2;">
                            <label for="keyword">í†µí•©ê²€ìƒ‰</label>
                                                          <input type="text" id="keyword" name="keyword" class="form-control" 
                                     placeholder="ì£¼ë¬¸ë²ˆí˜¸, ê³ ê°ëª…, ì—°ë½ì²˜, ì‚¬ì´íŠ¸, í’ˆë²ˆ, ìƒ‰ìƒ, ì‚¬ì´ì¦ˆ, ìš´ì†¡ì¥ë²ˆí˜¸, ìœ í˜•, ì‚¬ìœ  ë“± ê²€ìƒ‰" 
                                     th:field="*{keyword}">
                        </div>
                        <div class="search-group">
                            <label for="startDate">ì‹œì‘ì¼</label>
                            <input type="date" id="startDate" name="startDate" class="form-control" th:field="*{startDate}">
                        </div>
                        <div class="search-group">
                            <label for="endDate">ì¢…ë£Œì¼</label>
                            <input type="date" id="endDate" name="endDate" class="form-control" th:field="*{endDate}">
                        </div>
                        <div class="search-group">
                            <label>&nbsp;</label>
                            <div style="display: flex; gap: 0.5rem;">
                                <button type="submit" class="btn btn-search">ğŸ” ê²€ìƒ‰</button>
                                <button type="button" class="btn btn-reset" onclick="resetAllFiltersAndSearch()">ğŸ”„ ì´ˆê¸°í™”</button>
                                <button type="button" class="btn btn-info" onclick="refreshCurrentPage()" title="í˜„ì¬ ìƒíƒœë¡œ ë°ì´í„° ìƒˆë¡œê³ ì¹¨">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
                            </div>
                        </div>
                        <div class="search-group">
                            <label>&nbsp;</label>
                            <div class="button-group">
                                <!--
                                <button type="button" class="btn btn-secondary" onclick="
                                    const selectedIds = [];
                                    document.querySelectorAll('input[name=&quot;selected&quot;]:checked').forEach(checkbox => {
                                        selectedIds.push(checkbox.value);
                                    });
                                    if (selectedIds.length === 0) {
                                        alert('ë‹¤ìš´ë¡œë“œí•  í•­ëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                                        return;
                                    }
                                    const form = document.createElement('form');
                                    form.method = 'POST';
                                    form.action = '/exchange/api/export';
                                    selectedIds.forEach(id => {
                                        const input = document.createElement('input');
                                        input.type = 'hidden';
                                        input.name = 'ids';
                                        input.value = id;
                                        form.appendChild(input);
                                    });
                                    document.body.appendChild(form);
                                    form.submit();
                                    document.body.removeChild(form);
                                ">ğŸ“„ ì—‘ì…€</button>-->
                                <button type="button" id="bulkSaveBtn" class="btn btn-success" onclick="saveBulkDateChanges()" disabled style="min-width: 160px; white-space: nowrap;">ğŸ’¾ ë‚ ì§œì €ì¥ (<span id="changeCount">0</span>ê±´)</button>
                                <button type="button" id="bulkCompleteBtn" class="btn btn-warning" onclick="saveBulkCompletionChanges()" disabled style="min-width: 160px; white-space: nowrap;">âœ… ì™„ë£Œì²˜ë¦¬ (<span id="completeCount">0</span>ê±´)</button>
                                <button type="button" id="bulkDeleteBtn" class="btn btn-danger" onclick="bulkDeleteItems()" disabled style="min-width: 160px; white-space: nowrap;">ğŸ—‘ï¸ ì‚­ì œ (<span id="deleteCount">0</span>ê±´)</button>
                                <a href="/exchange/create" class="btn btn-primary">â• ë“±ë¡</a>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ê²€ìƒ‰ ë„ì›€ë§ -->
                    <div style="margin-top: 0.5rem; padding: 0.5rem; background-color: var(--primary-light); border-radius: var(--radius); font-size: 0.7rem; color: var(--text-muted);">
                        ğŸ’¡ <strong>ê²€ìƒ‰ íŒ:</strong> ì£¼ë¬¸ë²ˆí˜¸, ê³ ê°ëª…, ì—°ë½ì²˜, ì‚¬ì´íŠ¸ëª…, í’ˆë²ˆ, ìƒ‰ìƒ, ì‚¬ì´ì¦ˆ, ìš´ì†¡ì¥ë²ˆí˜¸, ìœ í˜•, ë°˜í’ˆì‚¬ìœ , ì²˜ë¦¬ì, ë¹„ê³  ë“± ëª¨ë“  ì •ë³´ë¥¼ í•˜ë‚˜ì˜ ê²€ìƒ‰ì°½ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br/>
                        ğŸ¯ <strong>ì™„ë£Œ ìƒíƒœ ê²€ìƒ‰:</strong> "ì™„ë£Œ" ë˜ëŠ” "ì „ì²´ì™„ë£Œ" â†’ ì™„ë£Œëœ ê±´ë§Œ ì¡°íšŒ | "ë¯¸ì™„ë£Œ" ë˜ëŠ” "ì§„í–‰ì¤‘" â†’ ë¯¸ì™„ë£Œ ê±´ë§Œ ì¡°íšŒ | "Y" â†’ ì™„ë£Œ | "N" â†’ ë¯¸ì™„ë£Œ<br/>
                        ğŸ”¥ <strong>í•„í„° + ê²€ìƒ‰:</strong> ìƒë‹¨ ì¹´ë“œ í•„í„°ì™€ ê²€ìƒ‰ ì¡°ê±´ì„ í•¨ê»˜ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤! ì˜ˆ: "íšŒìˆ˜ì™„ë£Œ" í•„í„° + "ê¹€ë¯¼ì§€" ê²€ìƒ‰ â†’ íšŒìˆ˜ì™„ë£Œëœ ê¹€ë¯¼ì§€ ê³ ê° ê±´ë§Œ ì¡°íšŒ
                    </div>
                </form>
            </div>
            
            <!-- ë°ì´í„° í…Œì´ë¸” -->
            <div class="table-container">
                <div class="table-header">
                    <h3>êµí™˜/ë°˜í’ˆ ëª©ë¡</h3>
                    <div class="table-meta">
                        <span th:text="${returnItems != null ? 'ì´ ' + returnItems.totalElements + 'ê±´' : 'ì´ 0ê±´'}">ì´ 0ê±´</span>
                    </div>
                </div>
                
                <div class="table-wrapper">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th class="fixed-column fixed-column-1" style="width: 35px;"><input type="checkbox" id="selectAll"></th>
                                <th class="fixed-column fixed-column-2" style="width: 50px;">ìœ í˜•</th>
                                <th class="fixed-column fixed-column-3" style="width: 60px;">ì£¼ë¬¸ì¼</th>
                                <th class="fixed-column fixed-column-4" style="width: 60px;">CSì ‘ìˆ˜ì¼</th>
                                <th class="fixed-column fixed-column-5" style="width: 80px;">ì‚¬ì´íŠ¸</th>
                                <th class="fixed-column fixed-column-6" style="width: 100px;">ì£¼ë¬¸ë²ˆí˜¸</th>
                                <th class="fixed-column fixed-column-7" style="width: 60px;">ìˆ˜ì·¨ì¸</th>
                                <th style="width: 85px;">ì—°ë½ì²˜</th>
                                <th style="width: 80px;">ì£¼ë¬¸í’ˆë²ˆ</th>
                                <th style="width: 40px;">ìƒ‰ìƒ</th>
                                <th style="width: 40px;">ì‚¬ì´ì¦ˆ</th>
                                <th style="width: 35px;">ìˆ˜ëŸ‰</th>
                                <th style="width: 60px;">í™˜ë¶ˆê¸ˆì•¡</th>
                                <th style="width: 55px;">ë°°ì†¡ë¹„</th>
                                <th style="width: 65px;">ğŸ¯ ì…ê¸ˆìƒíƒœ</th>
                                <th style="width: 60px;">ì‚¬ìœ </th>
                                <th style="width: 80px;">ìš´ì†¡ì¥ë²ˆí˜¸</th>
                                <th style="width: 70px;">íšŒìˆ˜ì™„ë£Œ</th>
                                <th style="width: 70px;">ë¬¼ë¥˜í™•ì¸</th>
                                <th style="width: 70px;">ì¶œê³ ì¼ì</th>
                                <th style="width: 70px;">í™˜ë¶ˆì¼ì</th>
                                <th style="width: 40px;">ì™„ë£Œ</th>
                                <th style="width: 80px;">ë¹„ê³ </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="item, iterStat : ${returnItems}" th:if="${returnItems != null and !returnItems.empty}" 
                                th:classappend="${item.isCompleted != null and item.isCompleted == 1 ? 'completed' : ''}">
                                <td class="fixed-column fixed-column-1"><input type="checkbox" name="selected" th:value="${item.id}"></td>
                                <td class="fixed-column fixed-column-2">
                                    <span class="type-badge" 
                                          th:classappend="${item.returnTypeCode == 'FULL_RETURN' ? 'full-return' : 
                                                          item.returnTypeCode == 'PARTIAL_RETURN' ? 'partial-return' : 
                                                          item.returnTypeCode == 'FULL_EXCHANGE' ? 'full-exchange' :
                                                          item.returnTypeCode == 'PARTIAL_EXCHANGE' ? 'partial-exchange' :
                                                          item.returnTypeCode == 'EXCHANGE' ? 'exchange' : 'partial-return'}"
                                          th:text="${item.returnTypeCode == 'FULL_RETURN' ? 'ì „ì²´ë°˜í’ˆ' : 
                                                    item.returnTypeCode == 'PARTIAL_RETURN' ? 'ë¶€ë¶„ë°˜í’ˆ' : 
                                                    item.returnTypeCode == 'FULL_EXCHANGE' ? 'ì „ì²´êµí™˜' :
                                                    item.returnTypeCode == 'PARTIAL_EXCHANGE' ? 'ë¶€ë¶„êµí™˜' :
                                                    item.returnTypeCode == 'EXCHANGE' ? 'êµí™˜' : item.returnTypeCode}">ë¶€ë¶„ë°˜í’ˆ</span>
                                </td>
                                <td class="fixed-column fixed-column-3" th:text="${item.orderDate != null ? #temporals.format(item.orderDate, 'MM-dd') : ''}">04-26</td>
                                <td class="fixed-column fixed-column-4" th:text="${item.csReceivedDate != null ? #temporals.format(item.csReceivedDate, 'MM-dd') : ''}">05-03</td>
                                <td class="fixed-column fixed-column-5 text-left" th:text="${item.siteName}">ìì‚¬ëª°-ë ˆë…¸ë§ˆ</td>
                                <td class="fixed-column fixed-column-6 order-info">
                                    <span class="order-number-copy" 
                                          th:text="${item.orderNumber}" 
                                          th:data-order-number="${item.orderNumber}"
                                          onclick="copyOrderNumber(this)"
                                          title="í´ë¦­í•˜ë©´ ì£¼ë¬¸ë²ˆí˜¸ê°€ ë³µì‚¬ë©ë‹ˆë‹¤">20250426-0001236-03</span>
                                </td>
                                <td class="fixed-column fixed-column-7 important-info">
                                    <span class="customer-name-copy" 
                                          th:text="${item.customerName}" 
                                          th:data-customer-name="${item.customerName}"
                                          onclick="copyCustomerName(this)"
                                          title="í´ë¦­í•˜ë©´ ê³ ê°ëª…ì´ ë³µì‚¬ë©ë‹ˆë‹¤">ê¹€ë¯¼ì§€</span>
                                </td>
                                <td class="contact-info">
                                    <span class="customer-phone-copy" 
                                          th:text="${item.customerPhone}" 
                                          th:data-customer-phone="${item.customerPhone}"
                                          onclick="copyCustomerPhone(this)"
                                          title="í´ë¦­í•˜ë©´ ì—°ë½ì²˜ê°€ ë³µì‚¬ë©ë‹ˆë‹¤">010-7409-5050</span>
                                </td>
                                <td class="order-info">
                                    <span class="order-item-code-copy" 
                                          th:text="${item.orderItemCode}" 
                                          th:data-order-item-code="${item.orderItemCode}"
                                          onclick="copyOrderItemCode(this)"
                                          title="í´ë¦­í•˜ë©´ ì£¼ë¬¸í’ˆë²ˆì´ ë³µì‚¬ë©ë‹ˆë‹¤">RN-GSZD962</span>
                                </td>
                                <td th:text="${item.productColor}">PK</td>
                                <td th:text="${item.productSize}">75</td>
                                <td th:text="${item.quantity}">1</td>
                                <td class="money-info" th:text="${item.refundAmount != null ? #numbers.formatInteger(item.refundAmount, 0, 'COMMA') : ''}">39,200</td>
                                <td class="text-center">
                                    <span th:if="${item.shippingFee != null and item.shippingFee == 'ì…ê¸ˆì˜ˆì •'}"
                                          class="badge bg-warning text-dark">ì…ê¸ˆì˜ˆì •</span>
                                    <span th:if="${item.shippingFee != null and item.shippingFee != 'ì…ê¸ˆì˜ˆì •'}" 
                                          class="money-info" 
                                          th:text="${item.shippingFee matches '[0-9]+' ? #numbers.formatInteger(T(java.lang.Integer).parseInt(item.shippingFee), 0, 'COMMA') : item.shippingFee}">3,000</span>
                                </td>
                                <td class="text-center">
                                    <span th:if="${item.paymentStatusText == 'ì…ê¸ˆì™„ë£Œ'}" 
                                          class="badge bg-success text-white" 
                                          th:text="${item.paymentStatusText}">ì…ê¸ˆì™„ë£Œ</span>
                                    <span th:if="${item.paymentStatusText == 'ì…ê¸ˆì˜ˆì •'}" 
                                          class="badge bg-warning text-dark" 
                                          th:text="${item.paymentStatusText}">ì…ê¸ˆì˜ˆì •</span>
                                    <span th:if="${item.paymentStatusText == 'ì…ê¸ˆë¶ˆí•„ìš”'}" 
                                          class="badge bg-info text-white" 
                                          th:text="${item.paymentStatusText}">ì…ê¸ˆë¶ˆí•„ìš”</span>
                                    <span th:if="${item.paymentStatusText != 'ì…ê¸ˆì™„ë£Œ' and item.paymentStatusText != 'ì…ê¸ˆì˜ˆì •' and item.paymentStatusText != 'ì…ê¸ˆë¶ˆí•„ìš”'}" 
                                          class="badge bg-secondary text-white" 
                                          th:text="${item.paymentStatusText}">ê¸°íƒ€</span>
                                </td>
                                <td class="text-left" th:text="${item.returnReason}">ê³ ê°ë³€ì‹¬</td>
                                <td class="order-info">
                                    <span class="tracking-number-copy" 
                                          th:text="${item.trackingNumber}" 
                                          th:data-tracking-number="${item.trackingNumber}"
                                          onclick="copyTrackingNumber(this)"
                                          title="í´ë¦­í•˜ë©´ ìš´ì†¡ì¥ë²ˆí˜¸ê°€ ë³µì‚¬ë©ë‹ˆë‹¤">5738757014</span>
                                </td>
                                <td>
                                    <div style="display: flex; align-items: center; gap: 0.25rem;">
                                        <input type="date" 
                                               class="form-control date-input" 
                                               data-field="collectionCompletedDate"
                                               th:data-id="${item.id}"
                                               th:value="${item.collectionCompletedDate}"
                                               onchange="markDateAsChanged(this)"
                                               style="width: 85px; font-size: 0.65rem; padding: 0.2rem;">
                                        <button type="button" 
                                                class="btn-clear-date" 
                                                th:data-id="${item.id}"
                                                data-field="collectionCompletedDate"
                                                onclick="clearDateField(this)"
                                                title="ë‚ ì§œ ì´ˆê¸°í™”"
                                                style="background: none; border: none; color: #dc3545; cursor: pointer; padding: 0.2rem; font-size: 0.7rem; width: 18px; height: 18px; display: flex; align-items: center; justify-content: center;">âœ•</button>
                                    </div>
                                </td>
                                <td>
                                    <div style="display: flex; align-items: center; gap: 0.25rem;">
                                        <input type="date" 
                                               class="form-control date-input" 
                                               data-field="logisticsConfirmedDate"
                                               th:data-id="${item.id}"
                                               th:value="${item.logisticsConfirmedDate}"
                                               onchange="markDateAsChanged(this)"
                                               style="width: 85px; font-size: 0.65rem; padding: 0.2rem;">
                                        <button type="button" 
                                                class="btn-clear-date" 
                                                th:data-id="${item.id}"
                                                data-field="logisticsConfirmedDate"
                                                onclick="clearDateField(this)"
                                                title="ë‚ ì§œ ì´ˆê¸°í™”"
                                                style="background: none; border: none; color: #dc3545; cursor: pointer; padding: 0.2rem; font-size: 0.7rem; width: 18px; height: 18px; display: flex; align-items: center; justify-content: center;">âœ•</button>
                                    </div>
                                </td>
                                <td>
                                    <div style="display: flex; align-items: center; gap: 0.25rem;">
                                        <input type="date" 
                                               class="form-control date-input" 
                                               data-field="shippingDate"
                                               th:data-id="${item.id}"
                                               th:value="${item.shippingDate}"
                                               onchange="markDateAsChanged(this)"
                                               style="width: 85px; font-size: 0.65rem; padding: 0.2rem;">
                                        <button type="button" 
                                                class="btn-clear-date" 
                                                th:data-id="${item.id}"
                                                data-field="shippingDate"
                                                onclick="clearDateField(this)"
                                                title="ë‚ ì§œ ì´ˆê¸°í™”"
                                                style="background: none; border: none; color: #dc3545; cursor: pointer; padding: 0.2rem; font-size: 0.7rem; width: 18px; height: 18px; display: flex; align-items: center; justify-content: center;">âœ•</button>
                                    </div>
                                </td>
                                <td>
                                    <div style="display: flex; align-items: center; gap: 0.25rem;">
                                        <input type="date" 
                                               class="form-control date-input" 
                                               data-field="refundDate"
                                               th:data-id="${item.id}"
                                               th:value="${item.refundDate}"
                                               onchange="markDateAsChanged(this)"
                                               style="width: 85px; font-size: 0.65rem; padding: 0.2rem;">
                                        <button type="button" 
                                                class="btn-clear-date" 
                                                th:data-id="${item.id}"
                                                data-field="refundDate"
                                                onclick="clearDateField(this)"
                                                title="ë‚ ì§œ ì´ˆê¸°í™”"
                                                style="background: none; border: none; color: #dc3545; cursor: pointer; padding: 0.2rem; font-size: 0.7rem; width: 18px; height: 18px; display: flex; align-items: center; justify-content: center;">âœ•</button>
                                    </div>
                                </td>
                                <td>
                                    <input type="checkbox" 
                                           th:checked="${item.isCompleted}" 
                                           th:data-id="${item.id}"
                                           onchange="markCompletionAsChanged(this)"
                                           style="transform: scale(1.2);">
                                </td>
                                <td class="text-left" th:text="${item.remarks}"></td>
                            </tr>
                            <tr th:if="${returnItems == null or returnItems.empty}">
                                <td class="fixed-column fixed-column-1"></td>
                                <td class="fixed-column fixed-column-2"></td>
                                <td class="fixed-column fixed-column-3"></td>
                                <td class="fixed-column fixed-column-4"></td>
                                <td class="fixed-column fixed-column-5"></td>
                                <td class="fixed-column fixed-column-6"></td>
                                <td class="fixed-column fixed-column-7"></td>
                                <td colspan="16" class="no-data">ë“±ë¡ëœ êµí™˜/ë°˜í’ˆ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
                <div class="pagination-container" th:if="${returnItems != null and returnItems.totalPages > 1}">
                    <ul class="pagination">
                        <li th:if="${currentPage > 0}">
                            <a class="page-link" th:href="@{/exchange/list(page=0, size=${returnItems.size})}">&laquo;</a>
                        </li>
                        <li th:if="${currentPage > 0}">
                            <a class="page-link" th:href="@{/exchange/list(page=${currentPage - 1}, size=${returnItems.size})}">&lt;</a>
                        </li>
                        
                        <li th:each="i : ${#numbers.sequence(T(java.lang.Math).max(0, currentPage - 2), T(java.lang.Math).min(returnItems.totalPages - 1, currentPage + 2))}">
                            <a class="page-link" 
                               th:href="@{/exchange/list(page=${i}, size=${returnItems.size})}"
                               th:text="${i + 1}"
                               th:classappend="${i == currentPage ? 'active' : ''}">1</a>
                        </li>
                        
                        <li th:if="${currentPage < returnItems.totalPages - 1}">
                            <a class="page-link" th:href="@{/exchange/list(page=${currentPage + 1}, size=${returnItems.size})}">&gt;</a>
                        </li>
                        <li th:if="${currentPage < returnItems.totalPages - 1}">
                            <a class="page-link" th:href="@{/exchange/list(page=${returnItems.totalPages - 1}, size=${returnItems.size})}">&raquo;</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    

</body>
</html> 