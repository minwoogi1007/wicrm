<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout/default}">
<head>
    <title>Î∞∞ÏÜ°ÎπÑ ÏûÖÍ∏à Îß§Ìïë ÎåÄÏãúÎ≥¥Îìú</title>
    
    <!-- JavaScript Ïã§Ìñâ ÌôïÏù∏Ïö© Ïä§ÌÅ¨Î¶ΩÌä∏ -->
    <script>
        // console.log('üî• HEAD ÏÑπÏÖòÏóêÏÑú Ïã§ÌñâÎê®');
    </script>

    <style>
        :root {
            --primary-color: #4361ee;
            --primary-light: #eef2ff;
            --secondary-color: #3f37c9;
            --accent-color: #4cc9f0;
            --warning-color: #f72585;
            --success-color: #35b27f;
            --danger-color: #ff4d6d;
            --info-color: #4a6fff;
            --dark-color: #1e2a3b;
            --text-color: #2d3748;
            --text-muted: #718096;
            --bg-color: #f8fafc;
            --bg-card: #ffffff;
            --border-color: #e2e8f0;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --radius-sm: 0.375rem;
            --radius: 0.5rem;
            --radius-lg: 0.75rem;
            --transition: all 0.2s ease;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
            line-height: 1.6;
        }

        .dashboard-container {
            max-width: 100%;
            margin: 0;
            padding: 1rem;
        }

        .dashboard-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: var(--radius-lg);
            padding: 1rem;
            color: white;
            margin-bottom: 1rem;
            position: relative;
            overflow: hidden;
        }

        .dashboard-header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0) 60%);
            transform: rotate(30deg);
        }

        .dashboard-header h1 {
            margin: 0;
            font-size: 1.25rem;
            font-weight: 700;
            position: relative;
            z-index: 1;
        }

        .dashboard-header p {
            margin: 0.25rem 0 0;
            opacity: 0.9;
            position: relative;
            z-index: 1;
            font-size: 0.8rem;
        }

        /* ÌÜµÍ≥Ñ ÎåÄÏãúÎ≥¥Îìú */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .stat-card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: 1rem;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .stat-card h3 {
            margin: 0 0 0.25rem 0;
            font-size: 0.75rem;
            color: var(--text-muted);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .stat-card .value {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0;
            color: var(--dark-color);
        }

        .stat-card.primary .value { color: var(--primary-color); }
        .stat-card.success .value { color: var(--success-color); }
        .stat-card.warning .value { color: var(--warning-color); }
        .stat-card.info .value { color: var(--info-color); }

        /* Î©îÏù∏ Í∑∏Î¶¨Îìú Î†àÏù¥ÏïÑÏõÉ */
        .main-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1rem;
            align-items: start;
        }

        /* ÏûÖÍ∏à ÎÇ¥Ïó≠ ÏÑπÏÖò */
        .payments-section {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
        }

        .section-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-header h2 {
            margin: 0;
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--dark-color);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            font-weight: 500;
            border-radius: var(--radius);
            border: none;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            gap: 0.5rem;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--secondary-color);
            transform: translateY(-1px);
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background-color: #2a9d6f;
            transform: translateY(-1px);
        }

        .btn-warning {
            background-color: var(--warning-color);
            color: white;
        }

        .btn-warning:hover {
            background-color: #e91e63;
            transform: translateY(-1px);
        }

        /* ÏûÖÍ∏à ÎÇ¥Ïó≠ ÌÖåÏù¥Î∏î */
        .payments-table {
            width: 100%;
            border-collapse: collapse;
        }

        .payments-table th,
        .payments-table td {
            padding: 0.5rem 0.25rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.75rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .payments-table th {
            background-color: var(--bg-color);
            font-weight: 600;
            color: var(--text-color);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .payments-table tbody tr {
            transition: var(--transition);
            cursor: pointer;
        }

        .payments-table tbody tr:hover {
            background-color: var(--primary-light);
        }

        .payments-table tbody tr.selected {
            background-color: var(--primary-light);
            border-left: 3px solid var(--primary-color);
        }

        /* ÌõÑÎ≥¥ ÏÑπÏÖò */
        .candidates-section {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            position: sticky;
            top: 1rem;
        }

        .candidate-card {
            padding: 0.75rem;
            border-bottom: 1px solid var(--border-color);
            transition: var(--transition);
            cursor: pointer;
        }

        .candidate-card:hover {
            background-color: var(--bg-color);
        }

        .candidate-card:last-child {
            border-bottom: none;
        }

        .candidate-card.selected {
            background-color: var(--primary-light);
            border-left: 3px solid var(--primary-color);
        }

        .candidate-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .candidate-name {
            font-weight: 600;
            color: var(--dark-color);
        }

        .match-score {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .match-score.high {
            background-color: rgba(53, 178, 127, 0.1);
            color: var(--success-color);
        }

        .match-score.medium {
            background-color: rgba(67, 97, 238, 0.1);
            color: var(--primary-color);
        }

        .match-score.low {
            background-color: rgba(247, 37, 133, 0.1);
            color: var(--warning-color);
        }

        .candidate-details {
            font-size: 0.7rem;
            color: var(--text-muted);
            line-height: 1.3;
        }

        .candidate-details div {
            margin-bottom: 0.15rem;
        }

        /* Îß§Ìïë Ïï°ÏÖò */
        .mapping-actions {
            padding: 1.5rem;
            border-top: 1px solid var(--border-color);
            background-color: var(--bg-color);
            border-radius: 0 0 var(--radius-lg) var(--radius-lg);
        }

        .mapping-actions .btn {
            width: 100%;
            justify-content: center;
            margin-bottom: 0.5rem;
        }

        /* ÏµúÍ∑º Îß§Ìïë ÎÇ¥Ïó≠ */
        .recent-mappings {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            margin-top: 2rem;
        }

        .mapping-item {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .mapping-item:last-child {
            border-bottom: none;
        }

        .mapping-info {
            flex: 1;
        }

        .mapping-customer {
            font-weight: 600;
            color: var(--dark-color);
        }

        .mapping-details {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 0.25rem;
        }

        .mapping-status {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            background-color: rgba(53, 178, 127, 0.1);
            color: var(--success-color);
        }

        /* Î°úÎî© ÏÉÅÌÉú */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            color: var(--text-muted);
        }

        .loading::before {
            content: '';
            width: 1rem;
            height: 1rem;
            border: 2px solid var(--border-color);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 0.5rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Î≤ÑÌäº Ìò∏Î≤Ñ Ìö®Í≥º */
        .btn-success:hover {
            background: #059669 !important;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(16, 185, 129, 0.3);
        }

        .btn-outline-danger:hover {
            background: #ef4444 !important;
            color: white !important;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(239, 68, 68, 0.3);
        }

        /* Î∞òÏùëÌòï */
        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .candidates-section {
                position: static;
            }
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .dashboard-container {
                padding: 0.5rem;
            }
            
            .payments-table {
                font-size: 0.75rem;
            }
            
            .payments-table th,
            .payments-table td {
                padding: 0.75rem 0.5rem;
            }
        }
    </style>
</head>
<body>
    <div layout:fragment="content">
        <div class="dashboard-container">
            <!-- Ìó§Îçî -->
            <div class="dashboard-header">
                <h1>üéØ Î∞∞ÏÜ°ÎπÑ ÏûÖÍ∏à Îß§Ìïë ÎåÄÏãúÎ≥¥Îìú</h1>
                <p>üí° ÌÜµÏû• ÏûÖÍ∏à ÎÇ¥Ïó≠ ‚Üí ÍµêÌôò/Î∞òÌíà ÌõÑÎ≥¥ ÌôïÏù∏ ‚Üí ÏàòÎèô Îß§ÌïëÏúºÎ°ú Í∞ÑÌé∏ÌïòÍ≤å Ï≤òÎ¶¨ÌïòÏÑ∏Ïöî<br/>
                ‚ö†Ô∏è ÏûêÎèô Îß§ÌïëÏùÄ ÌòÑÏã§Ï†Å Ï†úÏïΩÏúºÎ°ú Ïù∏Ìï¥ Î∂àÍ∞ÄÎä•Ìï©ÎãàÎã§ (ÎèôÎ™ÖÏù¥Ïù∏, ÎåÄÎ¶¨ÏûÖÍ∏à, Ïó∞ÎùΩÏ≤ò Î∂ÄÏû¨ Îì±)</p>
            </div>
            
            <!-- ÏÑ±Í≥µ Î©îÏãúÏßÄ -->
            <div th:if="${successMessage}" class="alert alert-success" style="background: #d1fae5; color: #065f46; padding: 0.75rem; border-radius: 8px; margin-bottom: 0.75rem; border: 1px solid #a7f3d0; font-size: 0.9rem;">
                <i class="fas fa-check-circle me-2"></i>
                <span th:text="${successMessage}">ÏÑ±Í≥µ Î©îÏãúÏßÄ</span>
            </div>
            
            <!-- ÌÜµÍ≥Ñ ÎåÄÏãúÎ≥¥Îìú -->
            <div class="stats-grid">
                <div class="stat-card primary">
                    <h3>Ï¥ù ÏûÖÍ∏à ÎÇ¥Ïó≠</h3>
                    <p class="value" th:text="${stats?.totalPayments ?: 0}">0</p>
                </div>
                <div class="stat-card warning">
                    <h3>ÎØ∏Îß§Ìïë Í±¥Ïàò</h3>
                    <p class="value" th:text="${stats?.pendingPayments ?: 0}">0</p>
                </div>
                <div class="stat-card success">
                    <h3>Îß§Ìïë ÏôÑÎ£å</h3>
                    <p class="value" th:text="${stats?.mappedPayments ?: 0}">0</p>
                </div>
                <div class="stat-card info">
                    <h3>Ïò§Îäò Îß§Ìïë</h3>
                    <p class="value" th:text="${stats?.todayMapped ?: 0}">0</p>
                </div>
            </div>
            
            <!-- ÏûÖÍ∏à ÎÇ¥Ïó≠ ÌïÑÌÑ∞ ÏÑπÏÖò -->
            <div class="payments-section" style="margin-bottom: 1rem;">
                <div class="section-header">
                    <h2>üîç ÏûÖÍ∏à ÎÇ¥Ïó≠ ÌïÑÌÑ∞</h2>
                    <div>
                        <a href="/shipping-payment/register" class="btn btn-primary">
                            ‚ûï ÏûÖÍ∏à Îì±Î°ù
                        </a>
                        <button class="btn btn-primary" id="refreshBtn">
                            üîÑ ÏÉàÎ°úÍ≥†Ïπ®
                        </button>
                    </div>
                </div>
                
                <div style="padding: 0.75rem 1rem;">
                    <div class="filter-buttons" style="display: flex; gap: 0.5rem; margin-bottom: 0.75rem; flex-wrap: wrap;">
                        <button class="btn" id="filterAll" style="padding: 0.5rem 1rem; border: 2px solid var(--border-color); border-radius: 25px; background: var(--primary-color); color: white;">
                            üìã Ï†ÑÏ≤¥
                        </button>
                        <button class="btn" id="filterUnmapped" style="padding: 0.5rem 1rem; border: 2px solid var(--border-color); border-radius: 25px; background: white; color: var(--text-muted);">
                            ‚è≥ ÎØ∏Îß§Ìïë
                        </button>
                        <button class="btn" id="filterMapped" style="padding: 0.5rem 1rem; border: 2px solid var(--border-color); border-radius: 25px; background: white; color: var(--text-muted);">
                            ‚úÖ Îß§ÌïëÏôÑÎ£å
                        </button>
                        <button class="btn" id="filterRenoma" style="padding: 0.5rem 1rem; border: 2px solid var(--border-color); border-radius: 25px; background: white; color: var(--text-muted);">
                            üíé Î†àÎÖ∏Îßà
                        </button>
                        <button class="btn" id="filterCoralik" style="padding: 0.5rem 1rem; border: 2px solid var(--border-color); border-radius: 25px; background: white; color: var(--text-muted);">
                            üíñ ÏΩîÎûÑÎ¶¨ÌÅ¨
                        </button>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <input type="text" id="searchCustomerName" class="form-control" placeholder="Í≥†Í∞ùÎ™Ö Í≤ÄÏÉâ" style="padding: 0.5rem; border: 1px solid var(--border-color); border-radius: var(--radius);">
                        <input type="number" id="searchAmount" class="form-control" placeholder="ÏûÖÍ∏àÍ∏àÏï° Í≤ÄÏÉâ" style="padding: 0.5rem; border: 1px solid var(--border-color); border-radius: var(--radius);">
                        <input type="text" id="searchSiteName" class="form-control" placeholder="ÏÇ¨Ïù¥Ìä∏Î™Ö Í≤ÄÏÉâ" style="padding: 0.5rem; border: 1px solid var(--border-color); border-radius: var(--radius);">
                        <button class="btn btn-primary" id="searchBtn" style="padding: 0.5rem 1rem;">
                            üîç Í≤ÄÏÉâ
                        </button>
                    </div>
                </div>
            </div>

            <!-- Î©îÏù∏ Í∑∏Î¶¨Îìú -->
            <div class="main-grid">
                <!-- ÏûÖÍ∏à ÎÇ¥Ïó≠ ÏÑπÏÖò -->
                <div class="payments-section">
                    <div class="section-header">
                        <h2>üí∞ ÏûÖÍ∏à ÎÇ¥Ïó≠</h2>
                        <div>
                            <button class="btn btn-success" disabled style="opacity: 0.5; cursor: not-allowed;" title="ÌÜµÏû• ÏûÖÍ∏à ÎÇ¥Ïó≠ÎßåÏúºÎ°úÎäî Ï†ïÌôïÌïú ÏûêÎèô Îß§ÌïëÏù¥ Î∂àÍ∞ÄÎä•Ìï©ÎãàÎã§" id="autoMappingBtn">
                                ü§ñ ÏûêÎèô Îß§Ìïë (ÎπÑÌôúÏÑ±Ìôî)
                            </button>
                        </div>
                    </div>
                    
                    <div style="max-height: 400px; overflow-y: auto;">
                        <table class="payments-table">
                            <thead>
                                <tr>
                                    <th style="width: 100px;">ÏûÖÍ∏àÏûêÎ™Ö</th>
                                    <th style="width: 60px;">Ïó∞ÎùΩÏ≤ò</th>
                                    <th style="width: 80px;">Í∏àÏï°</th>
                                    <th style="width: 60px;">ÏûÖÍ∏àÏùº</th>
                                    <th style="width: 60px;">Î∏åÎûúÎìú</th>
                                    <th style="width: 120px;">ÏÇ¨Ïù¥Ìä∏</th>
                                    <th style="width: 60px;">ÏÉÅÌÉú</th>
                                    <th style="width: 50px;">Í¥ÄÎ¶¨</th>
                                </tr>
                            </thead>
                            <tbody id="paymentsTableBody">
                                <tr th:each="payment : ${allPayments}" 
                                    th:attr="data-payment-id=${payment.registerId},data-mapping-status=${payment.mappingStatus}"
                                    style="cursor: pointer;">
                                    <td class="candidate-name" th:text="${payment.customerName}">ÍπÄÎØºÏàò</td>
                                    <td th:text="${payment.customerPhone != null and payment.customerPhone.length() > 8 ? payment.customerPhone.substring(payment.customerPhone.length() - 4) : payment.customerPhone ?: ''}">5678</td>
                                    <td style="text-align: right; font-weight: 600;" 
                                        th:text="${payment.amount != null ? #numbers.formatInteger(payment.amount, 0, 'COMMA') + 'Ïõê' : ''}">3,000Ïõê</td>
                                    <td th:text="${payment.paymentDate != null ? #temporals.format(payment.paymentDate, 'MM-dd') : ''}">12-25</td>
                                    <td>
                                        <span style="padding: 0.25rem 0.5rem; border-radius: 15px; font-size: 0.75rem; font-weight: 600; color: white;"
                                              th:style="${payment.brand == 'RENOMA'} ? 'background-color: #059669;' : 'background-color: #dc2626;'"
                                              th:text="${payment.brand == 'RENOMA'} ? 'Î†àÎÖ∏Îßà' : 'ÏΩîÎûÑÎ¶¨ÌÅ¨'">Î†àÎÖ∏Îßà</span>
                                    </td>
                                    <td th:text="${payment.siteName ?: ''}">ÏûêÏÇ¨Î™∞-Î†àÎÖ∏Îßà</td>
                                    <td>
                                        <span style="padding: 0.25rem 0.5rem; border-radius: 15px; font-size: 0.75rem; font-weight: 600;"
                                              th:style="${payment.mappingStatus == 'MAPPED'} ? 'background-color: #d1fae5; color: #065f46;' : 'background-color: #fef3c7; color: #92400e;'"
                                              th:text="${payment.mappingStatus == 'MAPPED'} ? 'Îß§ÌïëÏôÑÎ£å' : 'ÎØ∏Îß§Ìïë'">ÎØ∏Îß§Ìïë</span>
                                    </td>
                                    <td>
                                        <button th:if="${payment.mappingStatus == 'PENDING'}" 
                                                class="btn btn-success" 
                                                style="padding: 0.25rem 0.5rem; font-size: 0.75rem; background: #10b981; border: none; color: white; border-radius: 4px;"
                                                th:onclick="'selectPayment(' + ${payment.registerId} + ')'"
                                                onclick="event.stopPropagation();"
                                                title="Îß§Ìïë Ïã§Ìñâ">
                                            ‚úÖ Îß§Ìïë
                                        </button>
                                        <button th:if="${payment.mappingStatus == 'MAPPED'}" 
                                                class="btn btn-outline-danger" 
                                                style="padding: 0.25rem 0.5rem; font-size: 0.75rem; background: white; border: 1px solid #ef4444; color: #ef4444; border-radius: 4px;"
                                                th:onclick="'cancelMapping(' + ${payment.registerId} + ')'"
                                                onclick="event.stopPropagation();"
                                                title="Îß§Ìïë Ï∑®ÏÜå">
                                            üóëÔ∏è Ï∑®ÏÜå
                                        </button>
                                    </td>
                                </tr>
                                <tr th:if="${allPayments == null or allPayments.empty}">
                                    <td colspan="8" style="text-align: center; color: var(--text-muted); padding: 2rem;">
                                        Îì±Î°ùÎêú ÏûÖÍ∏à ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§.
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- ÌõÑÎ≥¥ ÏÑπÏÖò -->
                <div class="candidates-section">
                    <div class="section-header">
                        <h2>üîç ÍµêÌôò/Î∞òÌíà ÌõÑÎ≥¥</h2>
                    </div>
                    
                    <!-- ÌõÑÎ≥¥ Í≤ÄÏÉâ -->
                    <div id="candidatesSearchContainer" style="display: none; padding: 0.75rem 1rem; background: #f8fafc; border-bottom: 1px solid var(--border-color);">
                        <div style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 0.5rem; align-items: center;">
                            <input type="text" id="candidateSearchName" class="form-control" placeholder="Í≥†Í∞ùÎ™Ö Í≤ÄÏÉâ" 
                                   style="padding: 0.5rem; border: 1px solid var(--border-color); border-radius: var(--radius); font-size: 0.9rem;">
                            <input type="text" id="candidateSearchOrder" class="form-control" placeholder="Ï£ºÎ¨∏Î≤àÌò∏ Í≤ÄÏÉâ" 
                                   style="padding: 0.5rem; border: 1px solid var(--border-color); border-radius: var(--radius); font-size: 0.9rem;">
                            <button class="btn btn-primary" id="candidateSearchBtn" 
                                    style="padding: 0.5rem 1rem; font-size: 0.9rem; white-space: nowrap;">
                                üîç Í≤ÄÏÉâ
                            </button>
                        </div>
                        <div style="margin-top: 0.5rem; font-size: 0.8rem; color: var(--text-muted);">
                            üí° ÌõÑÎ≥¥Í∞Ä ÎßéÏùÑ Îïå Ïù¥Î¶ÑÏù¥ÎÇò Ï£ºÎ¨∏Î≤àÌò∏Î°ú ÌïÑÌÑ∞ÎßÅÌïòÏÑ∏Ïöî
                        </div>
                    </div>
                    
                    <div id="candidatesContainer" style="max-height: 300px; overflow-y: auto;">
                        <div class="loading" style="display: none;" id="candidatesLoading">
                            ÌõÑÎ≥¥Î•º Í≤ÄÏÉâÌïòÍ≥† ÏûàÏäµÎãàÎã§...
                        </div>
                        
                        <div style="padding: 1rem; text-align: center; color: var(--text-muted); font-size: 0.8rem;" id="candidatesEmpty">
                            ÏûÖÍ∏à ÎÇ¥Ïó≠ÏùÑ ÏÑ†ÌÉùÌïòÎ©¥ Îß§Ïπ≠ Í∞ÄÎä•Ìïú ÍµêÌôò/Î∞òÌíà ÌõÑÎ≥¥Í∞Ä ÌëúÏãúÎê©ÎãàÎã§.
                        </div>
                        
                        <div id="candidatesList" style="display: none;">
                            <!-- ÌõÑÎ≥¥ Î™©Î°ùÏù¥ Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎê©ÎãàÎã§ -->
                        </div>
                    </div>
                    
                    <div class="mapping-actions" id="mappingActions" style="display: none;">
                        <button class="btn btn-primary" id="executeMappingBtn">
                            ‚úÖ Îß§Ìïë Ïã§Ìñâ
                        </button>
                        <button class="btn btn-warning" id="cancelSelectionBtn">
                            ‚ùå ÏÑ†ÌÉù Ï∑®ÏÜå
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- ÏµúÍ∑º Îß§Ìïë ÎÇ¥Ïó≠ (Ïª¥Ìå©Ìä∏) -->
            <div class="recent-mappings" th:if="${recentMappings != null and !recentMappings.empty}" style="margin-top: 1rem;">
                <div class="section-header" style="padding: 0.75rem 1rem;">
                    <h2 style="font-size: 1rem; margin: 0;">üìã ÏµúÍ∑º Îß§Ìïë ÎÇ¥Ïó≠</h2>
                    <small style="color: var(--text-muted);">ÏµúÍ∑º 3Í±¥</small>
                </div>
                
                <div style="max-height: 150px; overflow-y: auto;">
                    <div th:each="mapping, iterStat : ${recentMappings}" 
                         th:if="${iterStat.index < 3}"
                         class="mapping-item" 
                         style="padding: 0.5rem 1rem; border-bottom: 1px solid var(--border-color);">
                        <div class="mapping-info">
                            <div class="mapping-customer" 
                                 style="font-size: 0.8rem; font-weight: 600;"
                                 th:text="${mapping.payment?.customerName + ' ‚Üí ' + mapping.returnItem?.customerName}">
                                ÍπÄÎØºÏàò ‚Üí ÍπÄÎØºÏàò
                            </div>
                            <div class="mapping-details" style="font-size: 0.7rem; margin-top: 0.25rem;">
                                <span th:text="${mapping.payment?.amount != null ? #numbers.formatInteger(mapping.payment.amount, 0, 'COMMA') + 'Ïõê' : ''}">3,000Ïõê</span>
                                <span th:text="' | ' + ${mapping.returnItem?.orderNumber}"> | 20250101-0001</span>
                                <span th:if="${mapping.canShipExchange}" style="color: var(--success-color); font-weight: 600;"> | üööÏ∂úÍ≥†Í∞ÄÎä•</span>
                            </div>
                        </div>
                        <div class="mapping-status" style="font-size: 0.7rem; padding: 0.2rem 0.4rem;">ÏôÑÎ£å</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <th:block layout:fragment="script">
    <script>
        // console.log('üî• JavaScript ÌååÏùºÏù¥ Î°úÎìúÎêòÏóàÏäµÎãàÎã§!');
        // console.log('üî• ÌòÑÏû¨ ÏãúÍ∞Ñ:', new Date());

        // Ï†ÑÏó≠ Î≥ÄÏàò
        let selectedPaymentId = null;
        let selectedCandidateId = null;
        let currentPaymentData = null;
        let currentCandidates = [];
        let originalCandidates = []; // ÏõêÎ≥∏ ÌõÑÎ≥¥ Îç∞Ïù¥ÌÑ∞ (Í≤ÄÏÉâÏö©)
        let allPaymentsData = []; // Ï†ÑÏ≤¥ ÏûÖÍ∏à Îç∞Ïù¥ÌÑ∞
        let currentFilter = 'all'; // ÌòÑÏû¨ ÌïÑÌÑ∞ ÏÉÅÌÉú
        
        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¥àÍ∏∞Ìôî
        document.addEventListener('DOMContentLoaded', function() {
            // console.log('ÔøΩÔøΩ DOMContentLoaded Ïù¥Î≤§Ìä∏ Î∞úÏÉù!');
            // console.log('Îß§Ìïë ÎåÄÏãúÎ≥¥Îìú Ï¥àÍ∏∞Ìôî');
            // console.log('selectPayment Ìï®Ïàò Ï†ïÏùòÎê®:', typeof selectPayment);
            
            // üö® Ï¶âÏãú ÌÖåÏä§Ìä∏Ïö© Î°úÍ∑∏
            // console.log('üî• DOMÏù¥ ÏôÑÏ†ÑÌûà Î°úÎìúÎê®');
            // console.log('üî• ÌòÑÏû¨ URL:', window.location.href);
            
            // Ï¥àÍ∏∞ Îç∞Ïù¥ÌÑ∞ ÏàòÏßë
            collectPaymentsData();
            
            // ÌÖåÏù¥Î∏î Ìñâ ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï∂îÍ∞Ä - ÏïàÏ†ÑÏÑ± Í≤ÄÏÇ¨ Í∞ïÌôî
            const paymentTable = document.getElementById('paymentsTableBody');
            // console.log('paymentTable Ï∞æÍ∏∞:', paymentTable);
            
            if (paymentTable) {
                // console.log('ÌÖåÏù¥Î∏î Ìñâ ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Îì±Î°ùÎê®');
                paymentTable.addEventListener('click', function(e) {
                    try {
                        // Î≤ÑÌäº ÌÅ¥Î¶≠ÏùÄ Ìñâ ÏÑ†ÌÉùÏúºÎ°ú Ï≤òÎ¶¨ÌïòÏßÄ ÏïäÏùå
                        if (e.target.tagName === 'BUTTON' || e.target.closest('button')) {
                            return;
                        }
                        
                        // console.log('ÌÖåÏù¥Î∏î ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Î∞úÏÉù:', e.target);
                        const row = e.target.closest('tr');
                        // console.log('Í∞ÄÏû• Í∞ÄÍπåÏö¥ Ìñâ:', row);
                        // console.log('ÌñâÏùò data-payment-id:', row ? row.dataset.paymentId : 'null');
                        
                        if (row && row.dataset.paymentId && row.dataset.mappingStatus === 'PENDING') {
                            // console.log('selectPayment Ìò∏Ï∂ú ÏãúÎèÑ:', row.dataset.paymentId);
                            selectPayment(parseInt(row.dataset.paymentId));
                        } else {
                            // console.log('‚ö†Ô∏è ÌñâÏù¥ ÏóÜÍ±∞ÎÇò Ïù¥ÎØ∏ Îß§ÌïëÎêú ÏÉÅÌÉúÏûÑ. mappingStatus:', row ? row.dataset.mappingStatus : 'null');
                        }
                    } catch (error) {
                        // console.error('ÌÖåÏù¥Î∏î ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Ïò§Î•ò:', error);
                    }
                });
            } else {
                // console.error('‚ùå paymentsTableBodyÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏùå');
            }
            
            // Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï∂îÍ∞Ä - ÏïàÏ†ÑÏÑ± Í≤ÄÏÇ¨ Í∞ïÌôî
            try {
                const refreshBtn = document.getElementById('refreshBtn');
                if (refreshBtn) {
                    refreshBtn.addEventListener('click', refreshData);
                    // console.log('‚úÖ refreshBtn Ïù¥Î≤§Ìä∏ Îì±Î°ùÎê®');
                }
                
                const autoMappingBtn = document.getElementById('autoMappingBtn');
                if (autoMappingBtn) {
                    autoMappingBtn.addEventListener('click', executeAutoMapping);
                    // console.log('‚úÖ autoMappingBtn Ïù¥Î≤§Ìä∏ Îì±Î°ùÎê®');
                }
                
                const executeMappingBtn = document.getElementById('executeMappingBtn');
                if (executeMappingBtn) {
                    executeMappingBtn.addEventListener('click', executeMapping);
                    // console.log('‚úÖ executeMappingBtn Ïù¥Î≤§Ìä∏ Îì±Î°ùÎê®');
                }
                
                const cancelSelectionBtn = document.getElementById('cancelSelectionBtn');
                if (cancelSelectionBtn) {
                    cancelSelectionBtn.addEventListener('click', cancelSelection);
                    // console.log('‚úÖ cancelSelectionBtn Ïù¥Î≤§Ìä∏ Îì±Î°ùÎê®');
                }
                
                // ÌïÑÌÑ∞ Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
                const filterButtons = ['filterAll', 'filterUnmapped', 'filterMapped', 'filterRenoma', 'filterCoralik'];
                filterButtons.forEach(btnId => {
                    const btn = document.getElementById(btnId);
                    if (btn) {
                        btn.addEventListener('click', () => applyFilter(btnId.replace('filter', '').toLowerCase()));
                    }
                });
                
                // Í≤ÄÏÉâ Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
                const searchBtn = document.getElementById('searchBtn');
                if (searchBtn) {
                    searchBtn.addEventListener('click', performSearch);
                }
                
                // ÏóîÌÑ∞ÌÇ§Î°ú Í≤ÄÏÉâ
                ['searchCustomerName', 'searchAmount', 'searchSiteName'].forEach(inputId => {
                    const input = document.getElementById(inputId);
                    if (input) {
                        input.addEventListener('keypress', function(e) {
                            if (e.key === 'Enter') {
                                performSearch();
                            }
                        });
                    }
                });
                
                // ÌõÑÎ≥¥ Í≤ÄÏÉâ Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
                const candidateSearchBtn = document.getElementById('candidateSearchBtn');
                if (candidateSearchBtn) {
                    candidateSearchBtn.addEventListener('click', performCandidateSearch);
                }
                
                // ÌõÑÎ≥¥ Í≤ÄÏÉâ ÏóîÌÑ∞ÌÇ§ Ïù¥Î≤§Ìä∏
                ['candidateSearchName', 'candidateSearchOrder'].forEach(inputId => {
                    const input = document.getElementById(inputId);
                    if (input) {
                        input.addEventListener('keypress', function(e) {
                            if (e.key === 'Enter') {
                                performCandidateSearch();
                            }
                        });
                    }
                });
                
            } catch (error) {
                // console.error('Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Îì±Î°ù Ïò§Î•ò:', error);
            }
            
            // ÌÜµÍ≥Ñ ÏÉàÎ°úÍ≥†Ïπ® (5Î∂ÑÎßàÎã§)
            setInterval(refreshStats, 5 * 60 * 1000);
        });
        
        // ÏûÖÍ∏à ÎÇ¥Ïó≠ ÏÑ†ÌÉù
        function selectPayment(paymentId) {
            // console.log('‚úÖ selectPayment Ìï®Ïàò Ìò∏Ï∂úÎê®! paymentId:', paymentId);
            
            // Ïù¥Ï†Ñ ÏÑ†ÌÉù Ìï¥Ï†ú
            const allRows = document.querySelectorAll('.payments-table tbody tr');
            // console.log('Í∏∞Ï°¥ ÏÑ†ÌÉù Ìï¥Ï†úÌï† Ìñâ Í∞úÏàò:', allRows.length);
            allRows.forEach(row => {
                row.classList.remove('selected');
            });
            
            // ÏÉà ÏÑ†ÌÉù ÌëúÏãú
            const selectedRow = document.querySelector(`tr[data-payment-id="${paymentId}"]`);
            // console.log('ÏÑ†ÌÉùÌï† Ìñâ Ï∞æÍ∏∞:', selectedRow);
            if (selectedRow) {
                selectedRow.classList.add('selected');
                // console.log('‚úÖ Ìñâ ÏÑ†ÌÉù ÌëúÏãú ÏôÑÎ£å');
            } else {
                // console.error('‚ùå ÏÑ†ÌÉùÌï† ÌñâÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏùå');
            }
            
            selectedPaymentId = paymentId;
            selectedCandidateId = null;
            
            // console.log('ÌõÑÎ≥¥ Ï°∞Ìöå ÏãúÏûë...');
            loadCandidates(paymentId);
        }
        
        // ÌõÑÎ≥¥ Ï°∞Ìöå
        async function loadCandidates(paymentId) {
            // console.log('ÔøΩÔøΩ loadCandidates Ìï®Ïàò Ìò∏Ï∂úÎê®! paymentId:', paymentId);
            
            try {
                const candidatesContainer = document.getElementById('candidatesContainer');
                const candidatesLoading = document.getElementById('candidatesLoading');
                const candidatesEmpty = document.getElementById('candidatesEmpty');
                const candidatesList = document.getElementById('candidatesList');
                const mappingActions = document.getElementById('mappingActions');
                
                // console.log('DOM ÏöîÏÜåÎì§ Ï∞æÍ∏∞:');
                // console.log('- candidatesContainer:', candidatesContainer);
                // console.log('- candidatesLoading:', candidatesLoading);
                // console.log('- candidatesEmpty:', candidatesEmpty);
                // console.log('- candidatesList:', candidatesList);
                // console.log('- mappingActions:', mappingActions);
                
                // ÌïÑÏàò ÏöîÏÜåÎì§Ïù¥ ÏóÜÏúºÎ©¥ Ïò§Î•ò Ï≤òÎ¶¨
                if (!candidatesLoading || !candidatesEmpty || !candidatesList || !mappingActions) {
                    // console.error('‚ùå ÌïÑÏàò DOM ÏöîÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                    return;
                }
            
            // Î°úÎî© ÏÉÅÌÉú ÌëúÏãú
            // console.log('Î°úÎî© ÏÉÅÌÉú ÌëúÏãú...');
            candidatesLoading.style.display = 'flex';
            candidatesEmpty.style.display = 'none';
            candidatesList.style.display = 'none';
            mappingActions.style.display = 'none';
            
            try {
                const url = `/shipping-payment/mapping/api/candidates/${paymentId}`;
                // console.log('API Ìò∏Ï∂ú URL:', url);
                
                const response = await fetch(url);
                // console.log('ÏùëÎãµ ÏÉÅÌÉú:', response.status, response.statusText);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    // console.error('API Ïò§Î•ò ÏùëÎãµ:', errorText);
                    throw new Error(`ÌõÑÎ≥¥ Ï°∞Ìöå Ïã§Ìå®: ${response.status} ${response.statusText}`);
                }
                
                const candidates = await response.json();
                currentCandidates = candidates;
                originalCandidates = [...candidates]; // ÏõêÎ≥∏ Îç∞Ïù¥ÌÑ∞ Î∞±ÏóÖ
                
                // console.log('ÌõÑÎ≥¥ Ï°∞Ìöå ÏôÑÎ£å:', candidates.length, 'Í∞ú');
                // console.log('ÌõÑÎ≥¥ Îç∞Ïù¥ÌÑ∞:', candidates);
                
                // Î°úÎî© Ïà®Í∏∞Í∏∞
                candidatesLoading.style.display = 'none';
                
                if (candidates.length === 0) {
                    candidatesEmpty.innerHTML = `
                        <div style="padding: 2rem; text-align: center; color: var(--text-muted);">
                            <p>üí° Îß§Ïπ≠ Í∞ÄÎä•Ìïú ÍµêÌôò/Î∞òÌíà ÌõÑÎ≥¥Í∞Ä ÏóÜÏäµÎãàÎã§.</p>
                            <p style="font-size: 0.8rem; margin-top: 1rem;">
                                ÏõêÏù∏: PAYMENT_STATUSÍ∞Ä 'PENDING'Ïù∏ ÍµêÌôò/Î∞òÌíà Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏùå<br/>
                                Ìï¥Í≤∞: ÍµêÌôò/Î∞òÌíà Îì±Î°ù Ïãú Î∞∞ÏÜ°ÎπÑÎ•º "ÏûÖÍ∏àÏòàÏ†ï"ÏúºÎ°ú ÏÑ§Ï†ïÌïòÏÑ∏Ïöî
                            </p>
                        </div>
                    `;
                    candidatesEmpty.style.display = 'block';
                    // ÌõÑÎ≥¥Í∞Ä ÏóÜÏúºÎ©¥ Í≤ÄÏÉâ Ïª®ÌÖåÏù¥ÎÑà Ïà®ÍπÄ
                    document.getElementById('candidatesSearchContainer').style.display = 'none';
                } else {
                    displayCandidates(candidates);
                    candidatesList.style.display = 'block';
                    // ÌõÑÎ≥¥Í∞Ä ÏûàÏúºÎ©¥ Í≤ÄÏÉâ Ïª®ÌÖåÏù¥ÎÑà ÌëúÏãú
                    document.getElementById('candidatesSearchContainer').style.display = 'block';
                    // Í≤ÄÏÉâ ÏûÖÎ†•ÎûÄ Ï¥àÍ∏∞Ìôî
                    document.getElementById('candidateSearchName').value = '';
                    document.getElementById('candidateSearchOrder').value = '';
                }
                
            } catch (error) {
                // console.error('ÌõÑÎ≥¥ Ï°∞Ìöå Ïò§Î•ò:', error);
                candidatesLoading.style.display = 'none';
                candidatesEmpty.innerHTML = `
                    <div style="padding: 2rem; text-align: center; color: var(--danger-color);">
                        <p>‚ùå ÌõÑÎ≥¥ Ï°∞Ìöå Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.</p>
                        <p style="font-size: 0.8rem; margin-top: 1rem;">
                            Ïò§Î•ò: ${error.message}<br/>
                            Î∏åÎùºÏö∞Ï†Ä Í∞úÎ∞úÏûê ÎèÑÍµ¨(F12) ‚Üí Console ÌÉ≠ÏóêÏÑú ÏûêÏÑ∏Ìïú Î°úÍ∑∏Î•º ÌôïÏù∏ÌïòÏÑ∏Ïöî
                        </p>
                    </div>
                `;
                candidatesEmpty.style.display = 'block';
            }
            } catch (error) {
                // console.error('loadCandidates Ìï®Ïàò Ï†ÑÏ≤¥ Ïò§Î•ò:', error);
            }
        }
        
        // ÌõÑÎ≥¥ Î™©Î°ù ÌëúÏãú
        function displayCandidates(candidates) {
            try {
                const candidatesList = document.getElementById('candidatesList');
                
                if (!candidatesList) {
                    // console.error('‚ùå candidatesList ÏöîÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                    return;
                }
                
                candidatesList.innerHTML = candidates.map(candidate => {
                    // Îß§Ìïë ÏÉÅÌÉú ÌôïÏù∏
                    const isAlreadyMapped = candidate.matchReason && candidate.matchReason.includes('Ïù¥ÎØ∏ Îß§ÌïëÎê®');
                    const isCompleted = candidate.paymentStatus === 'COMPLETED';
                    const isPending = candidate.paymentStatus === 'PENDING';
                    
                    // Ïπ¥Îìú Ïä§ÌÉÄÏùº Í≤∞Ï†ï
                    let cardStyle = 'cursor: pointer;';
                    let statusIcon = '';
                    let statusText = '';
                    
                    if (isAlreadyMapped) {
                        cardStyle += ' opacity: 0.7; border: 2px solid #fbbf24; background: #fef3c7;';
                        statusIcon = 'üîó';
                        statusText = 'Ïù¥ÎØ∏ Îß§ÌïëÎê®';
                    } else if (isCompleted) {
                        cardStyle += ' border: 2px solid #10b981; background: #d1fae5;';
                        statusIcon = '‚úÖ';
                        statusText = 'Í≤∞Ï†úÏôÑÎ£å';
                    } else if (isPending) {
                        cardStyle += ' border: 2px solid #3b82f6; background: #dbeafe;';
                        statusIcon = '‚è≥';
                        statusText = 'Îß§Ìïë Í∞ÄÎä•';
                    }
                    
                    return `
                    <div class="candidate-card" data-candidate-id="${candidate.returnItemId}" style="${cardStyle}">
                        <div class="candidate-header">
                            <span class="candidate-name">${candidate.customerName}</span>
                            <span class="match-score ${candidate.matchLevel.toLowerCase()}">${candidate.matchScore}%</span>
                        </div>
                        <div class="candidate-details">
                            <div><strong>Ï£ºÎ¨∏:</strong> ${candidate.orderNumber || ''}</div>
                            <div><strong>Î∞∞ÏÜ°ÎπÑ:</strong> ${candidate.shippingFee ? candidate.shippingFee.toLocaleString() + 'Ïõê' : candidate.paymentStatus || 'ÏûÖÍ∏àÏòàÏ†ï'}</div>
                            <div><strong>Îß§Ïπ≠:</strong> ${candidate.matchReason}</div>
                            <div style="color: ${isAlreadyMapped ? '#f59e0b' : isCompleted ? '#059669' : '#3b82f6'}; font-weight: 600;">
                                ${statusIcon} ${statusText}
                            </div>
                            ${candidate.canShipExchange ? '<div style="color: var(--success-color); font-weight: 600;">üöö Ï∂úÍ≥†Í∞ÄÎä•</div>' : ''}
                        </div>
                    </div>
                    `;
                }).join('');
            
            // ÌõÑÎ≥¥ Ïπ¥Îìú ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï∂îÍ∞Ä
            candidatesList.addEventListener('click', function(e) {
                const card = e.target.closest('.candidate-card');
                if (card && card.dataset.candidateId) {
                    selectCandidate(parseInt(card.dataset.candidateId));
                }
            });
            } catch (error) {
                // console.error('displayCandidates Ìï®Ïàò Ïò§Î•ò:', error);
            }
        }
        
        // ÌõÑÎ≥¥ ÏÑ†ÌÉù
        function selectCandidate(candidateId) {
            // console.log('ÌõÑÎ≥¥ ÏÑ†ÌÉù:', candidateId);
            
            // ÏÑ†ÌÉùÎêú Ïπ¥Îìú ÌôïÏù∏
            const selectedCard = document.querySelector(`[data-candidate-id="${candidateId}"]`);
            if (!selectedCard) {
                // console.error('ÏÑ†ÌÉùÎêú ÌõÑÎ≥¥ Ïπ¥ÎìúÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                return;
            }
            
            // Ïù¥ÎØ∏ Îß§ÌïëÎêú ÌõÑÎ≥¥Ïù∏ÏßÄ ÌôïÏù∏
            const isAlreadyMapped = selectedCard.style.opacity === '0.7' || 
                                   selectedCard.innerHTML.includes('Ïù¥ÎØ∏ Îß§ÌïëÎê®');
            
            if (isAlreadyMapped) {
                alert('‚ö†Ô∏è Ïù¥ÎØ∏ Îã§Î•∏ ÏûÖÍ∏à ÎÇ¥Ïó≠Í≥º Îß§ÌïëÎêú ÍµêÌôò/Î∞òÌíàÏûÖÎãàÎã§.\n\nÏ∞∏Í≥†Ïö©ÏúºÎ°úÎßå ÌëúÏãúÎêòÎ©∞ ÏÉàÎ°úÏö¥ Îß§ÌïëÏùÄ Î∂àÍ∞ÄÎä•Ìï©ÎãàÎã§.');
                return;
            }
            
            // Ïù¥Ï†Ñ ÏÑ†ÌÉù Ìï¥Ï†ú
            document.querySelectorAll('.candidate-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // ÏÉà ÏÑ†ÌÉù ÌëúÏãú
            selectedCard.classList.add('selected');
            
            selectedCandidateId = candidateId;
            
            // Îß§Ìïë Ïï°ÏÖò Î≤ÑÌäº ÌëúÏãú
            document.getElementById('mappingActions').style.display = 'block';
        }
        
        // Îß§Ìïë Ïã§Ìñâ
        async function executeMapping() {
            if (!selectedPaymentId || !selectedCandidateId) {
                alert('ÏûÖÍ∏à ÎÇ¥Ïó≠Í≥º ÍµêÌôò/Î∞òÌíàÏùÑ Î™®Îëê ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            const notes = prompt('Îß§Ìïë Î©îÎ™®Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî (ÏÑ†ÌÉùÏÇ¨Ìï≠):');
            
            try {
                const response = await fetch('/shipping-payment/mapping/api/execute', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        paymentId: selectedPaymentId,
                        returnItemId: selectedCandidateId,
                        mappedBy: 'ÏÉÅÎã¥Ïõê', // Ïã§Ï†úÎ°úÎäî Î°úÍ∑∏Ïù∏ ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥
                        notes: notes || ''
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('‚úÖ ' + result.message);
                    
                    // ÌÖåÏù¥Î∏î Ìñâ ÏóÖÎç∞Ïù¥Ìä∏
                    updatePaymentRowStatus(selectedPaymentId, 'MAPPED');
                    
                    // ÌÜµÍ≥Ñ Ïπ¥Îìú ÏóÖÎç∞Ïù¥Ìä∏
                    updateStatsCards();
                    
                    // ÏÑ†ÌÉù Ï¥àÍ∏∞Ìôî
                    cancelSelection();
                } else {
                    alert('‚ùå Îß§Ìïë Ïã§Ìñâ Ïã§Ìå®: ' + result.message);
                }
                
            } catch (error) {
                // console.error('Îß§Ìïë Ïã§Ìñâ Ïò§Î•ò:', error);
                alert('‚ùå Îß§Ìïë Ïã§Ìñâ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
            }
        }
        
        // ÏÑ†ÌÉù Ï∑®ÏÜå
        function cancelSelection() {
            selectedPaymentId = null;
            selectedCandidateId = null;
            
            // Î™®Îì† ÏÑ†ÌÉù Ìï¥Ï†ú
            document.querySelectorAll('.payments-table tbody tr, .candidate-card').forEach(element => {
                element.classList.remove('selected');
            });
            
            // ÌõÑÎ≥¥ ÏÑπÏÖò Ï¥àÍ∏∞Ìôî
            document.getElementById('candidatesEmpty').style.display = 'block';
            document.getElementById('candidatesList').style.display = 'none';
            document.getElementById('mappingActions').style.display = 'none';
            document.getElementById('candidatesSearchContainer').style.display = 'none'; // Í≤ÄÏÉâ Ïª®ÌÖåÏù¥ÎÑà Ïà®ÍπÄ
            document.getElementById('candidatesEmpty').innerHTML = '<div style="padding: 2rem; text-align: center; color: var(--text-muted);">ÏûÖÍ∏à ÎÇ¥Ïó≠ÏùÑ ÏÑ†ÌÉùÌïòÎ©¥ Îß§Ïπ≠ Í∞ÄÎä•Ìïú ÍµêÌôò/Î∞òÌíà ÌõÑÎ≥¥Í∞Ä ÌëúÏãúÎê©ÎãàÎã§.</div>';
            
            // ÌõÑÎ≥¥ Îç∞Ïù¥ÌÑ∞ Ï¥àÍ∏∞Ìôî
            originalCandidates = [];
            currentCandidates = [];
        }
        
        // ÏûêÎèô Îß§Ìïë Ïã§Ìñâ (ÎπÑÌôúÏÑ±ÌôîÎê®)
        async function executeAutoMapping() {
            alert('‚ùå ÏûêÎèô Îß§ÌïëÏùÄ ÌòÑÏã§Ï†ÅÏúºÎ°ú Î∂àÍ∞ÄÎä•Ìï©ÎãàÎã§.\n\nÏù¥Ïú†:\n‚Ä¢ ÌÜµÏû• ÏûÖÍ∏à ÎÇ¥Ïó≠ÏóêÎäî ÏûÖÍ∏àÏûêÎ™Ö, Í∏àÏï°, ÏãúÍ∞ÑÎßå ÌëúÏãú\n‚Ä¢ ÎèôÎ™ÖÏù¥Ïù∏ Î¨∏Ï†ú (ÍπÄÎØºÏàòÍ∞Ä Ïó¨Îü¨ Î™Ö)\n‚Ä¢ ÏûÖÍ∏àÏûê ‚â† Ï£ºÎ¨∏Ïûê (Í∞ÄÏ°±Ïù¥ ÎåÄÏã† ÏûÖÍ∏à)\n‚Ä¢ Ïó∞ÎùΩÏ≤ò Ï†ïÎ≥¥ ÏóÜÏùå\n‚Ä¢ ÎèôÏùº Í∏àÏï° Ï§ëÎ≥µ Î¨∏Ï†ú\n\nüëÜ ÏàòÎèô Îß§ÌïëÏùÑ ÏÇ¨Ïö©Ìï¥Ï£ºÏÑ∏Ïöî.');
        }
        
        // Îç∞Ïù¥ÌÑ∞ ÏÉàÎ°úÍ≥†Ïπ®
        function refreshData() {
            window.location.reload();
        }
        
        // ÌÜµÍ≥Ñ ÏÉàÎ°úÍ≥†Ïπ®
        async function refreshStats() {
            try {
                const response = await fetch('/shipping-payment/mapping/api/stats');
                const stats = await response.json();
                
                // ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏ - ÏïàÏ†ÑÏÑ± Í≤ÄÏÇ¨ Ï∂îÍ∞Ä
                const primaryValue = document.querySelector('.stat-card.primary .value');
                const warningValue = document.querySelector('.stat-card.warning .value');
                const successValue = document.querySelector('.stat-card.success .value');
                const infoValue = document.querySelector('.stat-card.info .value');
                
                if (primaryValue) primaryValue.textContent = stats.totalPayments || 0;
                if (warningValue) warningValue.textContent = stats.pendingPayments || 0;
                if (successValue) successValue.textContent = stats.mappedPayments || 0;
                if (infoValue) infoValue.textContent = stats.todayMapped || 0;
                
            } catch (error) {
                // console.error('ÌÜµÍ≥Ñ ÏÉàÎ°úÍ≥†Ïπ® Ïò§Î•ò:', error);
            }
        }
        
        // Ï¥àÍ∏∞ Îç∞Ïù¥ÌÑ∞ ÏàòÏßë
        function collectPaymentsData() {
            try {
                const rows = document.querySelectorAll('#paymentsTableBody tr[data-payment-id]');
                allPaymentsData = Array.from(rows).map(row => ({
                    id: row.dataset.paymentId,
                    mappingStatus: row.dataset.mappingStatus,
                    customerName: row.cells[0].textContent.trim(),
                    customerPhone: row.cells[1].textContent.trim(),
                    amount: row.cells[2].textContent.trim(),
                    paymentDate: row.cells[3].textContent.trim(),
                    brand: row.cells[4].querySelector('span') ? row.cells[4].querySelector('span').textContent.trim() : row.cells[4].textContent.trim(),
                    siteName: row.cells[5].textContent.trim(),
                    element: row
                }));
                // console.log('Ï¥àÍ∏∞ Îç∞Ïù¥ÌÑ∞ ÏàòÏßë ÏôÑÎ£å:', allPaymentsData.length, 'Í∞ú');
            } catch (error) {
                // console.error('Îç∞Ïù¥ÌÑ∞ ÏàòÏßë Ïò§Î•ò:', error);
            }
        }
        
        // ÌïÑÌÑ∞ Ï†ÅÏö©
        function applyFilter(filterType) {
            // console.log('ÌïÑÌÑ∞ Ï†ÅÏö©:', filterType);
            
            currentFilter = filterType;
            
            // ÌïÑÌÑ∞ Î≤ÑÌäº Ïä§ÌÉÄÏùº ÏóÖÎç∞Ïù¥Ìä∏
            document.querySelectorAll('[id^="filter"]').forEach(btn => {
                btn.style.background = 'white';
                btn.style.color = 'var(--text-muted)';
            });
            
            const activeBtn = document.getElementById('filter' + filterType.charAt(0).toUpperCase() + filterType.slice(1));
            if (activeBtn) {
                activeBtn.style.background = 'var(--primary-color)';
                activeBtn.style.color = 'white';
            }
            
            // ÌÖåÏù¥Î∏î Ìñâ ÌïÑÌÑ∞ÎßÅ
            allPaymentsData.forEach(payment => {
                let shouldShow = true;
                
                switch (filterType) {
                    case 'unmapped':
                        shouldShow = payment.mappingStatus === 'PENDING';
                        break;
                    case 'mapped':
                        shouldShow = payment.mappingStatus === 'MAPPED';
                        break;
                    case 'renoma':
                        shouldShow = payment.brand.includes('Î†àÎÖ∏Îßà');
                        break;
                    case 'coralik':
                        shouldShow = payment.brand.includes('ÏΩîÎûÑÎ¶¨ÌÅ¨');
                        break;
                    case 'all':
                    default:
                        shouldShow = true;
                        break;
                }
                
                payment.element.style.display = shouldShow ? '' : 'none';
            });
        }
        
        // Í≤ÄÏÉâ Ïã§Ìñâ
        function performSearch() {
            const customerName = document.getElementById('searchCustomerName').value.toLowerCase().trim();
            const searchAmount = parseFloat(document.getElementById('searchAmount').value) || 0;
            const siteName = document.getElementById('searchSiteName').value.toLowerCase().trim();
            
            // console.log('Í≤ÄÏÉâ Ïã§Ìñâ:', { customerName, searchAmount, siteName });
            
            allPaymentsData.forEach(payment => {
                let shouldShow = true;
                
                // Í≥†Í∞ùÎ™Ö Í≤ÄÏÉâ
                if (customerName && !payment.customerName.toLowerCase().includes(customerName)) {
                    shouldShow = false;
                }
                
                // ÏûÖÍ∏àÍ∏àÏï° Í≤ÄÏÉâ - Ïà´Ïûê ÎπÑÍµêÎ°ú ÏàòÏ†ï
                if (searchAmount && searchAmount.trim() !== '') {
                    // Í≤ÄÏÉâÏñ¥ÏóêÏÑú Ïà´ÏûêÎßå Ï∂îÏ∂ú
                    const searchAmountNum = parseInt(searchAmount.replace(/[,\s]/g, ''));
                    // ÏûÖÍ∏àÍ∏àÏï°ÏóêÏÑú Ïà´ÏûêÎßå Ï∂îÏ∂ú (Ïòà: "3,000Ïõê" ‚Üí 3000)
                    const paymentAmountNum = parseInt(payment.amount.replace(/[,Ïõê\s]/g, ''));
                    
                    if (!isNaN(searchAmountNum) && !isNaN(paymentAmountNum)) {
                        // Ï†ïÌôïÌïú Í∏àÏï° ÏùºÏπò Í≤ÄÏÉâ
                        if (paymentAmountNum !== searchAmountNum) {
                            shouldShow = false;
                        }
                    } else {
                        // Ïà´Ïûê Î≥ÄÌôò Ïã§Ìå® Ïãú Î¨∏ÏûêÏó¥ Ìè¨Ìï® Í≤ÄÏÉâÏúºÎ°ú fallback
                        if (!payment.amount.includes(searchAmount)) {
                            shouldShow = false;
                        }
                    }
                }
                
                // ÏÇ¨Ïù¥Ìä∏Î™Ö Í≤ÄÏÉâ
                if (siteName && !payment.siteName.toLowerCase().includes(siteName)) {
                    shouldShow = false;
                }
                
                payment.element.style.display = shouldShow ? '' : 'none';
            });
        }
        
        // Îß§Ìïë Ï∑®ÏÜå
        async function cancelMapping(paymentId) {
            if (!confirm('Ï†ïÎßêÎ°ú Ïù¥ Îß§ÌïëÏùÑ Ï∑®ÏÜåÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                return;
            }
            
            // console.log('Îß§Ìïë Ï∑®ÏÜå ÏöîÏ≤≠:', paymentId);
            
            try {
                const response = await fetch('/shipping-payment/mapping/api/cancel', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        paymentId: paymentId
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('‚úÖ ' + result.message);
                    
                    // ÌÖåÏù¥Î∏î Ìñâ ÏóÖÎç∞Ïù¥Ìä∏
                    updatePaymentRowStatus(paymentId, 'PENDING');
                    
                    // ÌÜµÍ≥Ñ Ïπ¥Îìú ÏóÖÎç∞Ïù¥Ìä∏
                    updateStatsCards();
                } else {
                    alert('‚ùå Îß§Ìïë Ï∑®ÏÜå Ïã§Ìå®: ' + result.message);
                }
                
            } catch (error) {
                // console.error('Îß§Ìïë Ï∑®ÏÜå Ïò§Î•ò:', error);
                alert('‚ùå Îß§Ìïë Ï∑®ÏÜå Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
            }
        }
        
        // ÌÖåÏù¥Î∏î Ìñâ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
        function updatePaymentRowStatus(paymentId, newStatus) {
            try {
                const row = document.querySelector(`tr[data-payment-id="${paymentId}"]`);
                if (!row) {
                    // console.error('ÌñâÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏùå:', paymentId);
                    return;
                }
                
                // data-mapping-status ÏóÖÎç∞Ïù¥Ìä∏
                row.dataset.mappingStatus = newStatus;
                
                // ÏÉÅÌÉú Î∞∞ÏßÄ ÏóÖÎç∞Ïù¥Ìä∏
                const statusCell = row.cells[6]; // ÏÉÅÌÉú Ïª¨Îüº
                const statusSpan = statusCell.querySelector('span');
                if (statusSpan) {
                    if (newStatus === 'MAPPED') {
                        statusSpan.style.backgroundColor = '#d1fae5';
                        statusSpan.style.color = '#065f46';
                        statusSpan.textContent = 'Îß§ÌïëÏôÑÎ£å';
                    } else {
                        statusSpan.style.backgroundColor = '#fef3c7';
                        statusSpan.style.color = '#92400e';
                        statusSpan.textContent = 'ÎØ∏Îß§Ìïë';
                    }
                }
                
                // Í¥ÄÎ¶¨ Î≤ÑÌäº ÏóÖÎç∞Ïù¥Ìä∏
                const actionCell = row.cells[7]; // Í¥ÄÎ¶¨ Ïª¨Îüº
                if (newStatus === 'MAPPED') {
                    actionCell.innerHTML = `
                        <button class="btn btn-outline-danger" 
                                style="padding: 0.25rem 0.5rem; font-size: 0.75rem; background: white; border: 1px solid #ef4444; color: #ef4444; border-radius: 4px;"
                                onclick="cancelMapping(${paymentId}); event.stopPropagation();"
                                title="Îß§Ìïë Ï∑®ÏÜå">
                            üóëÔ∏è Ï∑®ÏÜå
                        </button>
                    `;
                } else {
                    actionCell.innerHTML = `
                        <button class="btn btn-success" 
                                style="padding: 0.25rem 0.5rem; font-size: 0.75rem; background: #10b981; border: none; color: white; border-radius: 4px;"
                                onclick="selectPayment(${paymentId}); event.stopPropagation();"
                                title="Îß§Ìïë Ïã§Ìñâ">
                            ‚úÖ Îß§Ìïë
                        </button>
                    `;
                }
                
                // Îç∞Ïù¥ÌÑ∞ Î∞∞Ïó¥ÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
                const paymentData = allPaymentsData.find(p => p.id == paymentId);
                if (paymentData) {
                    paymentData.mappingStatus = newStatus;
                }
                
                // console.log('‚úÖ Ìñâ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å:', paymentId, '‚Üí', newStatus);
                
            } catch (error) {
                // console.error('Ìñâ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏ Ïò§Î•ò:', error);
            }
        }
        
        // ÌÜµÍ≥Ñ Ïπ¥Îìú ÏóÖÎç∞Ïù¥Ìä∏
        async function updateStatsCards() {
            // console.log('üìä ÌÜµÍ≥Ñ Ïπ¥Îìú ÏóÖÎç∞Ïù¥Ìä∏ ÏãúÏûë...');
            
            fetch('/shipping-payment/mapping/api/stats')
                .then(response => response.json())
                .then(stats => {
                    // console.log('üìä ÏÉàÎ°úÏö¥ ÌÜµÍ≥Ñ Îç∞Ïù¥ÌÑ∞:', stats);
                    
                    // Í∞Å ÌÜµÍ≥Ñ Ïπ¥Îìú ÏóÖÎç∞Ïù¥Ìä∏
                    const totalPaymentsElement = document.querySelector('.stat-card.primary .value');
                    if (totalPaymentsElement) {
                        totalPaymentsElement.textContent = stats.totalPayments || 0;
                        // console.log('üìä Ï¥ù ÏûÖÍ∏à ÎÇ¥Ïó≠ ÏóÖÎç∞Ïù¥Ìä∏:', stats.totalPayments);
                    }
                    
                    const pendingPaymentsElement = document.querySelector('.stat-card.warning .value');
                    if (pendingPaymentsElement) {
                        pendingPaymentsElement.textContent = stats.pendingPayments || 0;
                        // console.log('üìä ÎØ∏Îß§Ìïë Í±¥Ïàò ÏóÖÎç∞Ïù¥Ìä∏:', stats.pendingPayments);
                    }
                    
                    const mappedPaymentsElement = document.querySelector('.stat-card.success .value');
                    if (mappedPaymentsElement) {
                        mappedPaymentsElement.textContent = stats.mappedPayments || 0;
                        // console.log('üìä Îß§Ìïë ÏôÑÎ£å ÏóÖÎç∞Ïù¥Ìä∏:', stats.mappedPayments);
                    }
                    
                    const todayMappedElement = document.querySelector('.stat-card.info .value');
                    if (todayMappedElement) {
                        todayMappedElement.textContent = stats.todayMapped || 0;
                        // console.log('üìä Ïò§Îäò Îß§Ìïë ÏóÖÎç∞Ïù¥Ìä∏:', stats.todayMapped);
                    }
                    
                    // console.log('‚úÖ ÌÜµÍ≥Ñ Ïπ¥Îìú ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å');
                })
                .catch(error => {
                    // console.error('‚ùå ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏ Ïò§Î•ò:', error);
                });
        }
        
        // ÌõÑÎ≥¥ Í≤ÄÏÉâ Ïã§Ìñâ
        function performCandidateSearch() {
            try {
                const nameKeyword = document.getElementById('candidateSearchName').value.trim();
                const orderKeyword = document.getElementById('candidateSearchOrder').value.trim();
                
                // console.log('ÌõÑÎ≥¥ Í≤ÄÏÉâ Ïã§Ìñâ:', { nameKeyword, orderKeyword });
                
                // Í≤ÄÏÉâÏñ¥Í∞Ä ÏóÜÏúºÎ©¥ Ï†ÑÏ≤¥ ÌëúÏãú
                if (!nameKeyword && !orderKeyword) {
                    currentCandidates = [...originalCandidates];
                } else {
                    // Í≤ÄÏÉâ Ï°∞Í±¥Ïóê ÎßûÎäî ÌõÑÎ≥¥ ÌïÑÌÑ∞ÎßÅ
                    currentCandidates = originalCandidates.filter(candidate => {
                        let matches = true;
                        
                        // Í≥†Í∞ùÎ™Ö Í≤ÄÏÉâ
                        if (nameKeyword) {
                            const customerName = (candidate.customerName || '').toLowerCase();
                            matches = matches && customerName.includes(nameKeyword);
                        }
                        
                        // Ï£ºÎ¨∏Î≤àÌò∏ Í≤ÄÏÉâ
                        if (orderKeyword) {
                            const orderNumber = (candidate.orderNumber || '').toLowerCase();
                            matches = matches && orderNumber.includes(orderKeyword);
                        }
                        
                        return matches;
                    });
                }
                
                // console.log(`Í≤ÄÏÉâ Í≤∞Í≥º: ${currentCandidates.length}Í∞ú (Ï†ÑÏ≤¥ ${originalCandidates.length}Í∞ú Ï§ë)`);
                
                // Í≤ÄÏÉâ Í≤∞Í≥º ÌëúÏãú
                const candidatesEmpty = document.getElementById('candidatesEmpty');
                const candidatesList = document.getElementById('candidatesList');
                
                if (currentCandidates.length === 0) {
                    candidatesEmpty.innerHTML = `
                        <div style="padding: 2rem; text-align: center; color: var(--text-muted);">
                            <p>üîç Í≤ÄÏÉâ Ï°∞Í±¥Ïóê ÎßûÎäî ÌõÑÎ≥¥Í∞Ä ÏóÜÏäµÎãàÎã§.</p>
                            <p style="font-size: 0.8rem; margin-top: 1rem;">
                                Í≤ÄÏÉâÏñ¥: ${nameKeyword ? `Í≥†Í∞ùÎ™Ö "${nameKeyword}"` : ''}${nameKeyword && orderKeyword ? ', ' : ''}${orderKeyword ? `Ï£ºÎ¨∏Î≤àÌò∏ "${orderKeyword}"` : ''}<br/>
                                Ï†ÑÏ≤¥ ÌõÑÎ≥¥: ${originalCandidates.length}Í∞ú
                            </p>
                            <button onclick="clearCandidateSearch()" style="margin-top: 1rem; padding: 0.5rem 1rem; background: var(--primary-color); color: white; border: none; border-radius: 4px; cursor: pointer;">
                                üîÑ Í≤ÄÏÉâ Ï¥àÍ∏∞Ìôî
                            </button>
                        </div>
                    `;
                    candidatesEmpty.style.display = 'block';
                    candidatesList.style.display = 'none';
                } else {
                    displayCandidates(currentCandidates);
                    candidatesEmpty.style.display = 'none';
                    candidatesList.style.display = 'block';
                }
                
            } catch (error) {
                // console.error('ÌõÑÎ≥¥ Í≤ÄÏÉâ Ïò§Î•ò:', error);
                alert('‚ùå Í≤ÄÏÉâ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
            }
        }
        
        // ÌõÑÎ≥¥ Í≤ÄÏÉâ Ï¥àÍ∏∞Ìôî
        function clearCandidateSearch() {
            document.getElementById('candidateSearchName').value = '';
            document.getElementById('candidateSearchOrder').value = '';
            searchCandidates(); // Ï†ÑÏ≤¥ ÌõÑÎ≥¥ Îã§Ïãú ÌëúÏãú
            
            // console.log('ÌõÑÎ≥¥ Í≤ÄÏÉâ Ï¥àÍ∏∞Ìôî ÏôÑÎ£å');
        }
        
        // Ïú†Ìã∏Î¶¨Ìã∞ Ìï®Ïàò
        function getReturnTypeText(code) {
            const types = {
                'FULL_RETURN': 'Ï†ÑÏ≤¥Î∞òÌíà',
                'PARTIAL_RETURN': 'Î∂ÄÎ∂ÑÎ∞òÌíà',
                'FULL_EXCHANGE': 'Ï†ÑÏ≤¥ÍµêÌôò',
                'PARTIAL_EXCHANGE': 'Î∂ÄÎ∂ÑÍµêÌôò',
                'EXCHANGE': 'ÏùºÎ∞òÍµêÌôò'
            };
            return types[code] || code;
        }
    </script>
    </th:block>
</body>
</html> 