<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{/main}">

<div layout:fragment="content">
    <div class="app-main flex-column flex-row-fluid" id="kt_app_main">
        <!--begin::Content wrapper-->
        <div class="d-flex flex-column flex-column-fluid">
            <!--begin::Toolbar-->
            <div id="kt_app_toolbar" class="app-toolbar py-3 py-lg-6">
                <!--begin::Toolbar container-->
                <div id="kt_app_toolbar_container" class="app-container container-xxl d-flex flex-stack">
                    <!--begin::Page title-->
                    <div class="page-title d-flex flex-column justify-content-center flex-wrap me-3">
                        <!--begin::Title-->
                        <h1 class="page-heading d-flex text-gray-900 fw-bold fs-3 flex-column justify-content-center my-0">상담 조회</h1>
                        <!--end::Title-->
                        <!--begin::Breadcrumb-->
                        <ul class="breadcrumb breadcrumb-separatorless fw-semibold fs-7 my-0 pt-1">
                            <!--begin::Item-->
                            <li class="breadcrumb-item text-muted">
                                <a href="/main" class="text-muted text-hover-primary">Home</a>
                            </li>
                            <!--end::Item-->
                            <!--begin::Item-->
                            <li class="breadcrumb-item">
                                <span class="bullet bg-gray-500 w-5px h-2px"></span>
                            </li>
                            <!--end::Item-->
                            <!--begin::Item-->
                            <li class="breadcrumb-item text-muted">상담 관리</li>
                            <!--end::Item-->
                            <!--begin::Item-->
                            <li class="breadcrumb-item">
                                <span class="bullet bg-gray-500 w-5px h-2px"></span>
                            </li>
                            <!--end::Item-->
                            <!--begin::Item-->
                            <li class="breadcrumb-item text-muted">상담</li>
                            <!--end::Item-->
                        </ul>
                        <!--end::Breadcrumb-->
                    </div>
                    <!--end::Page title-->
                    <!--begin::Actions-->

                    <!--end::Actions-->
                </div>
                <!--end::Toolbar container-->
            </div>
            <!--end::Toolbar-->
            <!--begin::Content-->
            <div id="kt_app_content" class="app-content flex-column-fluid">
                <!--begin::Content container-->
                <div id="kt_app_content_container" class="app-container container-xxl">
                    <!--begin::Form-->
                    <form action="#">
                        <!--begin::Card-->
                        <div class="card mb-7">
                            <!--begin::Card body-->
                            <div class="card-body">
                                <!--begin::Compact form-->
                                <div class="d-flex align-items-center">
                                    <!--begin::Input group-->
                                    <div class="position-relative w-md-400px me-md-2">
                                        <i class="ki-duotone ki-magnifier fs-3 text-gray-500 position-absolute top-50 translate-middle ms-6">
                                            <span class="path1"></span>
                                            <span class="path2"></span>
                                        </i>
                                        <input type="text" class="form-control form-control-solid ps-10" name="search" value="" placeholder="Search" />
                                    </div>
                                    <!--end::Input group-->
                                    <!--begin:Action-->
                                    <div class="d-flex align-items-center">
                                        <button type="button" id="searchButton" class="btn btn-primary me-5">조회</button>
                                        <a href="#" id="kt_horizontal_search_advanced_link" class="btn btn-link" data-bs-toggle="collapse" data-bs-target="#kt_advanced_search_form">상세조회</a>
                                    </div>
                                    <!--end:Action-->
                                </div>
                                <!--end::Compact form-->
                                <!--begin::Advance form-->
                                <div class="collapse" id="kt_advanced_search_form">
                                    <!--begin::Separator-->
                                    <div class="separator separator-dashed mt-9 mb-6"></div>
                                    <!--end::Separator-->
                                    <!--begin::Row-->
                                    <div class="row g-8 mb-8">
                                        <!--begin::Col-->

                                        <!--end::Col-->
                                        <!--begin::Col-->
                                        <div class="col-xxl-12">
                                            <!--begin::Row-->
                                            <div class="row g-8">
                                                <!--begin::Col-->
                                                <div class="col-lg-4">
                                                    <label class="fs-6 form-label fw-bold text-gray-900">상담일</label>
                                                    <div class="position-relative w-md-260px me-md-2">
                                                        <input type="hidden" id="hidden_start_date" name="start_date" th:value="${hidden_start_date}">
                                                        <input type="hidden" id="hidden_end_date" name="end_date" th:value="${hidden_end_date}">
                                                        <input class="form-control form-control-solid w-100 mw-250px" placeholder="Pick date range" id="kt_ecommerce_report_customer_orders_daterangepicker" readonly />
                                                    </div>
                                                </div>
                                                <div class="col-lg-2">
                                                    <label class="fs-6 form-label fw-bold text-gray-900">처리상태</label>
                                                    <select class="form-select form-select-solid" data-control="select2" data-placeholder="Select Status" data-hide-search="true">
                                                        <!-- "전체" 옵션 추가 -->
                                                        <option value="all" th:selected="true" th:text="'전체'"></option>
                                                        <option th:each="constat : ${constat}"
                                                                th:value="${constat.admCode}"
                                                                th:text="${constat.admSname}"></option>
                                                    </select>
                                                    <!--end::Select-->
                                                </div>
                                                <!--end::Col-->
                                                <!--begin::Col-->
                                                <div class="col-lg-3">
                                                    <label class="fs-6 form-label fw-bold text-gray-900">상담유형</label>
                                                    <!--begin::Select-->
                                                    <select class="form-select form-select-solid" data-control="select2" data-placeholder="Select Status" data-hide-search="true">
                                                        <!-- "전체" 옵션 추가 -->
                                                        <option value="all" th:selected="true" th:text="'전체'"></option>
                                                        <option th:each="contype : ${contype}"
                                                                th:value="${contype.admCode}"
                                                                th:text="${contype.admSname}"></option>
                                                    </select>
                                                    <!--end::Radio group-->
                                                </div>
                                                <div class="col-lg-3">
                                                    <label class="fs-6 form-label fw-bold text-gray-900">구매몰</label>
                                                    <!--begin::Select-->
                                                    <select class="form-select form-select-solid" data-control="select2" data-placeholder="Select Status" data-hide-search="true">
                                                        <!-- "전체" 옵션 추가 -->
                                                        <option value="all" th:selected="true" th:text="'전체'"></option>
                                                        <option th:each="conbuy : ${conbuy}"
                                                                th:value="${conbuy.admCode}"
                                                                th:text="${conbuy.admSname}"></option>
                                                    </select>
                                                </div>
                                                <!--end::Col-->
                                            </div>
                                            <!--end::Row-->
                                        </div>
                                        <!--end::Col-->
                                    </div>
                                    <!--end::Row-->
                                    <!--begin::Row-->
                                    <div class="row g-8">
                                        <!--begin::Col-->
                                        <div class="col-xxl-12">
                                            <!--begin::Row-->
                                            <div class="row g-8">
                                                <!--begin::Col-->
                                                <div class="col-lg-6">
                                                    <label class="fs-6 form-label fw-bold text-gray-900">기타</label>
                                                    <!--begin::Radio group-->
                                                    <div class="nav-group nav-group-fluid">
                                                        <!--begin::Option-->
                                                        <label>
                                                            <input type="radio" class="btn-check" name="type" value="has" checked="checked" />
                                                            <span class="btn btn-sm btn-color-muted btn-active btn-active-primary fw-bold px-4">전체</span>
                                                        </label>
                                                        <!--end::Option-->
                                                        <!--begin::Option-->
                                                        <label>
                                                            <input type="radio" class="btn-check" name="type" value="users" />
                                                            <span class="btn btn-sm btn-color-muted btn-active btn-active-primary fw-bold px-4">긴급</span>
                                                        </label>
                                                        <!--end::Option-->
                                                        <!--begin::Option-->
                                                        <label>
                                                            <input type="radio" class="btn-check" name="type" value="orders" />
                                                            <span class="btn btn-sm btn-color-muted btn-active btn-active-primary fw-bold px-4">클레임</span>
                                                        </label>
                                                        <label>
                                                            <input type="radio" class="btn-check" name="type" value="orders" />
                                                            <span class="btn btn-sm btn-color-muted btn-active btn-active-primary fw-bold px-4">일반</span>
                                                        </label>
                                                        <!--end::Option-->
                                                    </div>
                                                    <!--end::Dialer-->
                                                </div>
                                                <!--end::Col-->
                                                <!--begin::Col-->

                                                <!--end::Col-->
                                            </div>
                                            <!--end::Row-->
                                        </div>
                                        <!--end::Col-->
                                        <!--begin::Col-->

                                        <!--end::Col-->
                                    </div>
                                    <!--end::Row-->
                                </div>
                                <!--end::Advance form-->
                            </div>
                            <!--end::Card body-->
                        </div>
                        <!--end::Card-->
                    </form>
                    <!--end::Form-->
                    <!--begin::Toolbar-->
                    <div class="d-flex flex-wrap flex-stack pb-7">
                        <!--begin::Title-->
                        <div class="d-flex flex-wrap align-items-center my-1">
                            <h3 class="fw-bold me-5 my-1">57 건</h3>
                        </div>
                        <!--end::Title-->
                        <!--begin::Controls-->
                        <div class="d-flex flex-wrap my-1">
                            <!--begin::Tab nav-->

                            <!--end::Tab nav-->
                            <!--begin::Actions-->
                            <div class="d-flex my-0">
                                <!--begin::Select-->

                                <!--end::Select-->
                                <!--begin::Select-->
                                <select name="status" data-control="select2" data-hide-search="true" data-placeholder="Export" class="form-select form-select-sm border-body bg-body w-100px">
                                    <option value="1">Excel</option>
                                    <option value="1">PDF</option>
                                    <option value="2">Print</option>
                                </select>
                                <!--end::Select-->
                            </div>
                            <!--end::Actions-->
                        </div>
                        <!--end::Controls-->
                    </div>
                    <!--end::Toolbar-->
                    <!--begin::Tab Content-->
                    <div class="tab-content">
                        <!--begin::Tab pane-->

                        <!--end::Tab pane-->
                        <!--begin::Tab pane-->
                        <div id="kt_project_users_table_pane" class="tab-pane show active">
                            <!--begin::Card-->
                            <div class="card card-flush">
                                <!--begin::Card body-->
                                <div class="card-body pt-0">
                                    <!--begin::Table container-->
                                    <div class="table-responsive">
                                        <!--begin::Table-->
                                        <table id="kt_project_users_table" class="table table-row-bordered table-row-dashed gy-4 align-middle fw-bold">
                                            <thead class="fs-7 text-gray-500 text-uppercase">
                                            <tr>
                                                <th class="min-w-80px">일자</th>
                                                <th class="min-w-80px">구분</th>
                                                <th class="min-w-100px">상담시간</th>
                                                <th class="min-w-80px">사이트</th>
                                                <th class="min-w-250px">상담내용</th>
                                                <th class="min-w-80px">댓글</th>
                                                <th class="min-w-90px">상태</th>
                                                <th class="min-w-90px">유형</th>
                                                <th class="min-w-50px text-end">상세</th>
                                            </tr>
                                            </thead>
                                            <tbody class="fs-6">
                                            <tr>
                                                <td>Oct 25, 2023</td>
                                                <td>
                                                    <span class="badge badge-light-danger fw-bold px-4 py-3">긴급</span>
                                                </td>
                                                <td>
                                                    상담시간
                                                </td>
                                                <td>
                                                    사이트
                                                </td>
                                                <td>
                                                    <div class="d-flex align-items-center">
                                                        <!--begin::Wrapper-->

                                                        <!--end::Wrapper-->
                                                        <!--begin::Info-->
                                                        <div class="d-flex flex-column justify-content-center">
                                                            <a href="" class="mb-1 text-gray-800 text-hover-primary">상담내용</a>
                                                            <div class="fw-semibold fs-6 text-gray-500">처리내용</div>
                                                        </div>
                                                        <!--end::Info-->
                                                    </div>
                                                </td>
                                                <td>
                                                    1
                                                </td>
                                                <td>
                                                    상태
                                                </td>
                                                <td>
                                                    유형
                                                </td>
                                                <td class="text-end">
                                                    <a href="#" class="btn btn-light btn-sm">View</a>
                                                </td>
                                            </tr>
                                            <nav aria-label="Page navigation example">
                                                <ul class="pagination" id="pagination">
                                                    <!-- 페이지 번호는 JavaScript에서 동적으로 생성됩니다. -->
                                                </ul>
                                            </nav>
                                            </tbody>
                                        </table>
                                        <!--end::Table-->
                                    </div>
                                    <!--end::Table container-->
                                </div>
                                <!--end::Card body-->
                            </div>
                            <!--end::Card-->
                        </div>
                        <!--end::Tab pane-->
                    </div>
                    <!--end::Tab Content-->
                </div>
                <!--end::Content container-->
            </div>
            <!--end::Content-->
            <script>
                $(document).ready(function() {
                    $('#searchButton').click(function() {
                        var formData = {
                            startDate: $('input[name="hidden_start_date"]').val(),
                            endDate: $('input[name="hidden_end_date"]').val()
                        };

                        $.ajax({
                            url: '/api/consultations',
                            type: 'GET',
                            data: formData,
                            success: function(data) {
                                var tbody = $('#kt_project_users_table tbody');
                                tbody.empty();
                                data.forEach(function(consult) {
                                    tbody.append(
                                        '<tr>' +
                            '<td>${consult.date}</td>' +
                            '<td><span class="badge badge-light-danger fw-bold px-4 py-3">${consult.type}</span></td>' +
                            '<td>${consult.time}</td>' +
                            '<td>${consult.site}</td>' +
                            '<td>' +
                                '<div class="d-flex align-items-center">' +
                                    '<div class="d-flex flex-column justify-content-center">' +
                                        '<a href="" class="mb-1 text-gray-800 text-hover-primary">${consult.content}</a>' +
                                        '<div class="fw-semibold fs-6 text-gray-500">${consult.details}</div>' +
                                    '</div>' +
                                '</div>' +
                            '</td>' +
                            '<td>${consult.comments}</td>' +
                            '<td>${consult.status}</td>' +
                            '<td>${consult.category}</td>' +
                            '<td class="text-end"><a href="#" class="btn btn-light btn-sm">View</a></td>' +
                        '</tr>'
                                    );
                                });
                                // 페이지네이션 업데이트
                                updatePagination(response.total, 10);
                            },
                            error: function(error) {
                                console.log('Error fetching data:', error);
                            }
                        });
                    });
                });
                function updatePagination(total, pageSize) {
                    var pageCount = Math.ceil(total / pageSize);
                    var pagination = $('#pagination');
                    pagination.empty();
                    for (let i = 1; i <= pageCount; i++) {
                        pagination.append(`<li class="page-item"><a class="page-link" href="#" onclick="loadPage(${i}, ${pageSize});">${i}</a></li>`);
                    }
                }

                function loadPage(page, pageSize) {
                    // 여기에 페이지 변경 시 로드할 데이터 로직 구현
                    console.log(`Loading page ${page} with size ${pageSize}`);
                    // 이 부분에 AJAX 호출 로직을 다시 적용하여 페이지 데이터를 로드할 수 있습니다.
                }
            </script>

        </div>
        <!--end::Content wrapper-->
        <!--begin::Footer-->
        <script src="/assets/plugins/custom/datatables/datatables.bundle.js"></script>
        <script src="/assets/js/board/scripts.bundle.js"></script>
        <script src="/assets/js/stat/stat.js"></script>
        <script src="/assets/js/custom/utilities/search/horizontal.js"></script>
        <!--end::Footer-->
    </div>

</div>
