
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<!--begin::Head-->
<head>
	<base href="../../../" />
	<title>WIO SERVICE</title>
	<meta charset="utf-8" />

	<link rel="shortcut icon" href="/assets/media/logos/logo.png" />
	<!--begin::Fonts(mandatory for all pages)-->
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300,400,500,600,700" />
	<!--end::Fonts-->
	<!--begin::Global Stylesheets Bundle(mandatory for all pages)-->
	<link href="/assets/plugins/global/plugins.bundle.css" rel="stylesheet" type="text/css" />
	<link href="/assets/css/style.bundle.css" rel="stylesheet" type="text/css" />
	<!--end::Global Stylesheets Bundle-->
	<meta id="_csrf" name="_csrf" th:content="${_csrf.token}"/>
	<meta id="_csrf_header" name="_csrf_header" th:content="${_csrf.headerName}"/>
</head>
<!--end::Head-->
<!--begin::Body-->
<body id="kt_body" class="app-blank app-blank">
<!--begin::Theme mode setup on page load-->
<script>
	var defaultThemeMode = "light";
	var themeMode;
	if (document.documentElement) {
		if (document.documentElement.hasAttribute("data-bs-theme-mode")) {
			themeMode = document.documentElement.getAttribute("data-bs-theme-mode");
		} else {
			if (localStorage.getItem("data-bs-theme") !== null) {
				themeMode = localStorage.getItem("data-bs-theme");
			} else {
				themeMode = defaultThemeMode;
			}
		}
		if (themeMode === "system") {
			themeMode = window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
		}
		document.documentElement.setAttribute("data-bs-theme", themeMode);
	}

</script><!--end::Theme mode setup on page load-->
<!--begin::Root-->
<div class="d-flex flex-column flex-root" id="kt_app_root">
	<!--begin::Authentication - Sign-in -->
	<div class="d-flex flex-column flex-lg-row flex-column-fluid">
		<!--begin::Aside-->
		<div class="d-flex flex-lg-row-fluid w-lg-50 bgi-size-cover bgi-position-center" style="background-image: url(/assets/media/misc/auth-bg.png)">
			<!--begin::Content-->
			<div class="d-flex flex-column flex-center p-6 p-lg-10 w-100">
				<!--begin::Logo-->

				<!--end::Logo-->
				<!--begin::Image-->
				<img class="d-none d-lg-block mx-auto w-300px w-lg-75 w-xl-500px mb-10 mb-lg-20" src="/assets/media/misc/auth-screens.png" alt="" />
				<!--end::Image-->
				<!--begin::Title-->


				<h1 class="d-none d-lg-block text-white fs-2qx fw-bold text-center mb-7"> <img alt="Logo" src="/assets/media/logos/mainLogo.png" class="h-40px h-lg-50px" /> With In Oneness</h1>
				<!--end::Title-->
				<!--begin::Text
                <div class="d-none d-lg-block text-white fs-base text-center">함께 ,
                <a href="#" class="opacity-75-hover text-warning fw-semibold me-1">the blogger</a>introduces a person they’ve interviewed
                <br />and provides some background information about
                <a href="#" class="opacity-75-hover text-warning fw-semibold me-1">the interviewee</a>and their
                <br />work following this is a transcript of the interview.</div>
                end::Text-->
			</div>
			<!--end::Content-->
		</div>
		<!--begin::Aside-->
		<!--begin::Body-->
		<div class="d-flex flex-column flex-lg-row-fluid w-lg-50 p-10">
			<!--begin::Form-->
			<div class="d-flex flex-center flex-column flex-lg-row-fluid">
				<!--begin::Wrapper-->
				<div class="w-lg-500px p-10">
					<!--begin::Form-->
					<form class="form w-100" novalidate="novalidate" id="kt_sign_in_form" th:action="@{/login}" method="post">
						<!--begin::Heading-->
						<input type="hidden" name="gubn" id="gubn" value=""/>
						<div class="text-center mb-11">
							<!--begin::Title-->
							<h1 class="text-gray-900 fw-bolder mb-3"><img alt="Logo" src="/assets/media/logos/mainLogo.png" class="h-40px h-lg-50px" />Sign In</h1>
							<!--end::Title-->
							<!--begin::Subtitle
                            <div class="text-gray-500 fw-semibold fs-6">Your Social Campaigns</div>-->
							<!--end::Subtitle=-->
						</div>
						<!--begin::Heading-->
						<!--begin::Login options-->

						<!--end::Login options-->
						<!--begin::Separator
                        <div class="separator separator-content my-14">
                            <span class="w-125px text-gray-500 fw-semibold fs-7">Or with email</span>
                        </div>-->
						<!--end::Separator-->
						<!--begin::Input group=-->
						<div class="fv-row mb-8">
							<!--begin::Email-->
							<input type="text" placeholder="ID" id="userId" name="userId"  class="form-control bg-transparent" />
							<!--end::Email-->
						</div>
						<!--end::Input group=-->
						<div class="fv-row mb-3">
							<!--begin::Password-->
							<input type="password" placeholder="Password" id="password" name="password" class="form-control bg-transparent" />
							<!--end::Password-->
						</div>
						<!--end::Input group=-->
						<!--begin::Wrapper
						<div class="d-flex flex-stack flex-wrap gap-3 fs-base fw-semibold mb-8">
							<div></div>

							<a href="/authentication/layouts/corporate/reset-password.html" class="link-primary">비밀번호 찾기</a>

						</div>
-->
						<!--end::Wrapper-->
						<!--begin::Submit button-->
						<div class="d-grid mb-10">
							<button type="submit" id="kt_sign_in_submit" class="btn btn-primary">
								<!--begin::Indicator label-->
								<span class="indicator-label">log In</span>
								<!--end::Indicator label-->
								<!--begin::Indicator progress-->
								<span class="indicator-progress">Please wait...
										<span class="spinner-border spinner-border-sm align-middle ms-2"></span></span>
								<!--end::Indicator progress-->
							</button>
						</div>
						<!--end::Submit button-->


						<div class="row g-3 mb-9">

							<div class="col-md-6">

								<a href="#" class="btn btn-flex btn-outline btn-text-gray-700 btn-active-color-primary bg-state-light flex-center text-nowrap w-100" data-bs-toggle="modal" data-bs-target="#kt_modal_new_target" data-gubn="1">

									<img alt="Logo" src="/assets/media/svg/brand-logos/icons7.png" class="h-15px me-3"d  />직원 신청</a>

							</div>

							<div class="col-md-6">

								<a href="#" class="btn btn-flex btn-outline btn-text-gray-700 btn-active-color-primary bg-state-light flex-center text-nowrap w-100" data-bs-toggle="modal" data-bs-target="#kt_modal_new_target" data-gubn="0">

									<img alt="Logo" src="/assets/media/svg/brand-logos/icons8.png" class="h-15px me-3" />업체 직원 신청</a>

							</div>

						</div>

					</form>
					<!--end::Form-->
				</div>
				<!--end::Wrapper-->
			</div>
			<!--end::Form-->
			<!--begin::Footer-->
			<!--<div class="d-flex flex-center flex-wrap px-5">
                -begin::Links
                <div class="d-flex fw-semibold text-primary fs-base">
                    <a href="https://keenthemes.com" class="px-5" target="_blank">Terms</a>
                    <a href="https://devs.keenthemes.com" class="px-5" target="_blank">Plans</a>
                    <a href="https://themes.getbootstrap.com/product/keen-the-ultimate-bootstrap-admin-theme/" class="px-5" target="_blank">Contact Us</a>
                </div>
                end::Links
            </div>-->
			<!--end::Footer-->
		</div>
		<!--end::Body-->

		<div class="modal fade" tabindex="-1" id="kt_modal_new_target">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h3 class="modal-title">아이디 신청</h3>

						<!--begin::Close-->
						<div class="btn btn-icon btn-sm btn-active-light-primary ms-2" data-bs-dismiss="modal" aria-label="Close">
							<i class="ki-duotone ki-cross fs-1"><span class="path1"></span><span class="path2"></span></i>
						</div>
						<!--end::Close-->
					</div>

					<div class="modal-body">
						<!-- CSRF 토큰을 포함한 폼 시작 -->
						<form id="applyUserIdForm" th:action="@{/apply-userid}" method="post">
							<!-- 업체명 입력 필드, 기본적으로 숨김 -->
						<div class="row mb-6" id="companyNameRow" style="display: none;">
							<label class="col-lg-3 col-form-label required fw-semibold fs-6">업체명</label>
							<div class="col-lg-8">
								<input type="text" name="companyName" class="form-control form-control-lg form-control-solid mb-3 mb-lg-0" />
							</div>
						</div>
						<div class="row mb-6">
							<!--begin::Label-->
							<label class="col-lg-3 col-form-label required fw-semibold fs-6">이름</label>
							<!--end::Label-->
							<!--begin::Col-->
							<div class="col-lg-8">
								<!--begin::Row-->
								<div class="row">
									<!--begin::Col-->
									<div class="col-lg-10 fv-row">
										<input type="text" name="fname" class="form-control form-control-lg form-control-solid mb-3 mb-lg-0" />
									</div>
									<!--end::Col-->
									<!--begin::Col-->

									<!--end::Col-->
								</div>

								<!--end::Row-->
							</div>
							<!--end::Col-->
						</div>
						<div class="row mb-6">
							<label class="col-lg-3 col-form-label required fw-semibold fs-6">아이디</label>
							<div class="col-lg-8"> <!-- col-lg-8이었던 부분을 col-lg-9로 변경하여 부모 div가 전체 행을 차지하도록 함 -->
								<div class="row"> <!-- 아이디 입력과 조회 버튼을 위한 내부 row -->
									<div class="col-lg-10 fv-row"> <!-- 아이디 입력 필드 -->
										<input type="text" name="appUserId"  class="form-control form-control-lg form-control-solid mb-3 mb-lg-0"   />
									</div>
									<div id="userIdAvailability" class="mt-2"></div>

								</div>
							</div>
						</div>
						<div class="row mb-6">
							<label class="col-lg-3 col-form-label required fw-semibold fs-6">비밀번호</label>
							<div class="col-lg-8">
								<div class="row">
									<div class="col-lg-10 fv-row">
										<input type="password" name="pass1" class="form-control form-control-lg form-control-solid mb-3 mb-lg-0" />
									</div>

								</div>
							</div>
						</div>
						<div class="row mb-6">
							<label class="col-lg-3 col-form-label required fw-semibold fs-6">비밀번호 확인</label>
							<div class="col-lg-8">
								<div class="row">
									<div class="col-lg-10 fv-row">
										<input type="password" name="pass2" class="form-control form-control-lg form-control-solid mb-3 mb-lg-0" />
									</div>

								</div>
							</div>
						</div>
						</form>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-light" data-bs-dismiss="modal">취소</button>
						<button type="button" id="applyUserIdButton" class="btn btn-primary">신청</button>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- 성공 메시지 모달 -->
	<div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="successModalLabel">신청 완료</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					신청이 완료 되었습니다. 담당자 승인 후에 로그인 가능합니다.
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-primary" data-bs-dismiss="modal">확인</button>
				</div>
			</div>
		</div>
	</div>
	<!--end::Authentication - Sign-in-->
</div>
<script>
	document.addEventListener('DOMContentLoaded', function() {
		// CSRF 토큰과 헤더 이름을 가져옵니다.
		var csrfToken = $("meta[name='_csrf']").attr("content");
		var csrfHeaderName = $("meta[name='_csrf_header']").attr("content");

		var userIdInput = document.querySelector('[name="appUserId"]');

		var passwordInput = document.querySelector('[name="pass1"]');
		var confirmPasswordInput = document.querySelector('[name="pass2"]');

		var userNameInput = document.querySelector('[name="fname"]');
		var applyButton = document.getElementById('applyUserIdButton');
		var availabilityDiv = document.getElementById('userIdAvailability');
		var companyNameRow = document.getElementById('companyNameRow');
		var isUserIdAvailable = false; // 사용자 ID 사용 가능 여부를 저장하는 변수
		let gubn ="";


		$(document).ready(function() {
		// 모달 창이 열릴 때의 로직을 설정합니다.
			$('[data-bs-toggle="modal"]').on('click', function() {
				gubn = $(this).attr('data-gubn');
				// gubn 값에 따라 업체명 입력 필드의 표시 여부를 결정합니다.
				if(gubn === "0") {
					$('#companyNameRow').show();
				} else {
					$('#companyNameRow').hide();
				}
				// 모달 내의 입력 필드 초기화
				$('#applyUserIdForm')[0].reset();
				availabilityDiv.textContent = "";
				isUserIdAvailable = false; // 모달을 열 때마다 사용자 ID 사용 가능 여부를 초기화합니다.

			});
		});

		userIdInput.addEventListener('keyup', function(event) {

			checkReg(event);
			checkUserIdAvailability();
		});

// 비밀번호 검증 함수

// 이벤트 리스너 등록
		passwordInput.addEventListener('keyup', function(event) {

			checkReg(event);
		});
		confirmPasswordInput.addEventListener('keyup', function(event) {

			checkReg(event);
		});

		applyButton.addEventListener('click', function() {
			var userId = userIdInput.value;
			var userName = userNameInput.value;
			var password = document.querySelector('[name="pass1"]').value;
			var passwordConfirm = document.querySelector('[name="pass2"]').value;

			var companyName = (gubn === "0") ? document.querySelector('[name="companyName"]').value : "";
			console.log("gubn==="+gubn);
			console.log("companyName==="+companyName);
			// 필수 입력 값 확인
			if (!userName.trim() || !userId.trim() || !password.trim() || !passwordConfirm.trim() || (gubn === "0" && !companyName.trim())) {
				alert('모든 필수 입력 항목을 채워주세요.');
				return; // 필수 입력 값 중 하나라도 빠져있다면 함수 실행을 중지
			}
			if (!isUserIdAvailable) {
				alert("이미 사용 중인 아이디입니다. 다른 아이디를 입력해주세요.");
				userIdInput.focus();
				availabilityDiv.textContent = "";
				return;
			}
			if (password !== passwordConfirm) {
				alert('비밀번호가 일치하지 않습니다.');
				return;
			}
			// Check password length and character content
			if (password.length < 8 || !/^[A-Za-z0-9]+$/.test(password)) {
				alert('비밀번호는 8자 이상이며 영문 대소문자와 숫자만 포함할 수 있습니다.');
				return;
			}


			// Ajax 요청 부분
			$.ajax({
				url: '/apply-userid',
				type: 'POST',
				contentType: 'application/json',
				data: JSON.stringify({ userName: userName, userId: userId, password: password, gubn: gubn, companyName: companyName }),
				beforeSend: function(xhr) {
					xhr.setRequestHeader(csrfHeaderName, csrfToken);
				},
				success: function() {
					$('#kt_modal_new_target').modal('hide');

					// 새로운 모달 띄우기
					$('#successModal').modal('show');
				},
				error: function(xhr, status, error) {
					alert('에러 발생: ' + error);
				}
			});
		});

		// 입력값 검증 함수
		function checkReg(event) {
			console.log(event.target.value);

			const regExp = /[^0-9a-zA-Z]/g; // 영문과 숫자만 허용
			if (regExp.test(event.target.value)) {
				console.log("2");
				event.target.value = event.target.value.replace(regExp, '');
				alert("영문, 숫자, 한글만 입력 가능합니다.");
			}
		}

		// 사용자 ID의 사용 가능 여부를 검사하는 함수
		function checkUserIdAvailability() {
			var userId = userIdInput.value;
			if (userId.length > 0) {
				$.ajax({
					url: '/check-userid-availability',
					type: 'GET',
					data: { userId: userId },
					success: function(response) {
						isUserIdAvailable = response.isAvailable; // 전역 변수 업데이트
						availabilityDiv.textContent = response.isAvailable ? "사용 가능한 아이디입니다." : "이미 사용 중인 아이디입니다.";
						availabilityDiv.style.color = response.isAvailable ? "green" : "red";
					},
					error: function() {
						availabilityDiv.textContent = "아이디 확인 중 에러가 발생했습니다.";
						availabilityDiv.style.color = "red";
					}
				});
			} else {
				availabilityDiv.textContent = "";
			}
		}
	});
</script>




<!--end::Root-->
<!--begin::Javascript-->
<script>var hostUrl = "/assets/";</script>
<!--begin::Global Javascript Bundle(mandatory for all pages)-->
<script src="/assets/plugins/global/plugins.bundle.js"></script>
<script src="/assets/js/scripts.bundle.js"></script>
<!--end::Global Javascript Bundle-->
<!--begin::Custom Javascript(used for this page only)-->
<script src="/assets/js/custom/authentication/sign-in/general.js"></script>
<!--end::Custom Javascript-->
<!-- 로그인 폼 제출 스크립트 -->

<!--end::Javascript-->
</body>
<!--end::Body-->
</html>